======================================================================
SlideSparse vLLM Throughput Benchmark Log
Created: 2026-01-28 11:01:01
======================================================================

原始命令:
  /root/vllmbench/slidesparse/tools/throughput_benchmark.py --model bitnet1.58-2b-int8 --backend cublaslt,cusparselt --stage prefill --sparsity 2_4,2_6,2_8,2_10 --M 512,1024,2048,4096,8192,16384,32768

命令行参数:
  --model: bitnet1.58-2b-int8
  --backend: cublaslt,cusparselt
  --sparsity: 2_4,2_6,2_8,2_10
  --stage: prefill
  --M: 512,1024,2048,4096,8192,16384,32768
  --N: None
  --inner-32: False
  --eager: False
  --gpu-id: 0
  --gpu-mem: 0.8
  --dry-run: False
  --list-models: False

硬件信息:
  GPU: RTX4090
  Compute Capability: cc89
  VRAM: 24.0 GB
  CUDA: 12.9
  Python: py312

Backend 环境变量 (初始状态):
  DISABLE_SLIDESPARSE: 未设置
  USE_CUBLASLT: 未设置
  USE_CUSPARSELT: 未设置
  SPARSITY: 未设置
  INNER_DTYPE_32: 未设置

======================================================================


============================================================
  BitNet-2B-INT8 | cuBLASLt | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints/BitNet-2B-INT8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cublaslt

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:01:09 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:01:09 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=3490) WARNING 01-28 11:01:26 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=3490) WARNING 01-28 11:01:37 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.19 requests/s, 7789.92 total tokens/s, 15.19 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:01:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:01:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:01:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:01:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:01:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:01:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:01:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:01:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:01:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:01:16] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:01:16] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:01:16] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:01:16] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:16] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:16] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:16] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:16] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:01:16] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:01:16] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:01:16] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:01:16] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:01:16] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:01:16] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 11:01:26.071170209 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=3490) [2026-01-28 11:01:27] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=3490) [2026-01-28 11:01:27] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=3490) [2026-01-28 11:01:27] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=3490) [2026-01-28 11:01:27] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=3490) [2026-01-28 11:01:27] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=3490) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=3490) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.37it/s]
(EngineCore_DP0 pid=3490) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.37it/s]
(EngineCore_DP0 pid=3490) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=3490) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  5.45it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.47it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.29it/s]
(EngineCore_DP0 pid=3490) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.80it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.79it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  52%|█████▏    | 67/128 [00:00<00:00, 663.20it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 677.64it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:04, 27.02it/s, est. speed input: 13833.96 toks/s, output: 27.02 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:06, 20.02it/s, est. speed input: 10725.83 toks/s, output: 20.95 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:06, 18.12it/s, est. speed input: 9826.74 toks/s, output: 19.19 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:06, 17.13it/s, est. speed input: 9402.99 toks/s, output: 18.36 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:07, 16.26it/s, est. speed input: 9053.16 toks/s, output: 17.68 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:07, 15.83it/s, est. speed input: 8846.20 toks/s, output: 17.28 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:07, 15.52it/s, est. speed input: 8686.66 toks/s, output: 16.97 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:07, 15.31it/s, est. speed input: 8563.62 toks/s, output: 16.73 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:07, 15.12it/s, est. speed input: 8458.06 toks/s, output: 16.52 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 15.06it/s, est. speed input: 8382.79 toks/s, output: 16.37 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 15.03it/s, est. speed input: 8322.57 toks/s, output: 16.25 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:06, 14.98it/s, est. speed input: 8266.64 toks/s, output: 16.15 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:06, 14.94it/s, est. speed input: 8219.63 toks/s, output: 16.05 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:02<00:06, 14.90it/s, est. speed input: 8175.98 toks/s, output: 15.97 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:02<00:06, 14.74it/s, est. speed input: 8122.91 toks/s, output: 15.86 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:06, 14.85it/s, est. speed input: 8101.31 toks/s, output: 15.82 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 15.05it/s, est. speed input: 8093.31 toks/s, output: 15.81 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 15.32it/s, est. speed input: 8097.65 toks/s, output: 15.82 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 15.50it/s, est. speed input: 8101.11 toks/s, output: 15.82 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 15.68it/s, est. speed input: 8107.60 toks/s, output: 15.84 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:05, 15.65it/s, est. speed input: 8101.99 toks/s, output: 15.82 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:03<00:05, 15.67it/s, est. speed input: 8099.26 toks/s, output: 15.82 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:03<00:04, 15.71it/s, est. speed input: 8098.99 toks/s, output: 15.82 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 15.78it/s, est. speed input: 8101.56 toks/s, output: 15.82 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 15.80it/s, est. speed input: 8102.16 toks/s, output: 15.82 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 15.75it/s, est. speed input: 8098.56 toks/s, output: 15.82 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 15.83it/s, est. speed input: 8102.30 toks/s, output: 15.82 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 15.87it/s, est. speed input: 8104.38 toks/s, output: 15.83 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:04, 15.89it/s, est. speed input: 8106.18 toks/s, output: 15.83 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:04<00:04, 15.94it/s, est. speed input: 8109.84 toks/s, output: 15.84 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:04<00:03, 15.87it/s, est. speed input: 8107.51 toks/s, output: 15.83 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 15.86it/s, est. speed input: 8107.80 toks/s, output: 15.84 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 15.23it/s, est. speed input: 8076.24 toks/s, output: 15.77 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 15.21it/s, est. speed input: 8067.50 toks/s, output: 15.76 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 15.34it/s, est. speed input: 8065.77 toks/s, output: 15.75 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 15.34it/s, est. speed input: 8060.16 toks/s, output: 15.74 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 15.13it/s, est. speed input: 8045.15 toks/s, output: 15.71 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:05<00:03, 15.25it/s, est. speed input: 8042.63 toks/s, output: 15.71 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:05<00:03, 14.98it/s, est. speed input: 8024.64 toks/s, output: 15.67 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 15.10it/s, est. speed input: 8021.16 toks/s, output: 15.67 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 15.18it/s, est. speed input: 8017.60 toks/s, output: 15.66 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 15.29it/s, est. speed input: 8016.49 toks/s, output: 15.66 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 15.42it/s, est. speed input: 8017.37 toks/s, output: 15.66 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 15.57it/s, est. speed input: 8020.14 toks/s, output: 15.66 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 15.67it/s, est. speed input: 8022.99 toks/s, output: 15.67 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:06<00:02, 15.69it/s, est. speed input: 8023.54 toks/s, output: 15.67 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:06<00:01, 15.68it/s, est. speed input: 8023.37 toks/s, output: 15.67 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 15.73it/s, est. speed input: 8025.13 toks/s, output: 15.67 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 15.83it/s, est. speed input: 8029.11 toks/s, output: 15.68 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 15.86it/s, est. speed input: 8031.60 toks/s, output: 15.69 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 15.87it/s, est. speed input: 8033.50 toks/s, output: 15.69 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 15.82it/s, est. speed input: 8033.68 toks/s, output: 15.69 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:09<00:06,  2.65it/s, est. speed input: 6184.42 toks/s, output: 12.08 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:09<00:04,  3.52it/s, est. speed input: 6207.84 toks/s, output: 12.12 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:09<00:03,  4.55it/s, est. speed input: 6225.18 toks/s, output: 12.16 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:09<00:02,  5.75it/s, est. speed input: 6244.35 toks/s, output: 12.20 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:09<00:01,  7.03it/s, est. speed input: 6262.50 toks/s, output: 12.23 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:09<00:00,  8.33it/s, est. speed input: 6279.75 toks/s, output: 12.27 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:09<00:00,  9.56it/s, est. speed input: 6296.26 toks/s, output: 12.30 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:10<00:00, 10.62it/s, est. speed input: 6310.66 toks/s, output: 12.33 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:10<00:00, 11.52it/s, est. speed input: 6324.68 toks/s, output: 12.35 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:10<00:00, 12.28it/s, est. speed input: 6339.61 toks/s, output: 12.38 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:10<00:00, 12.28it/s, est. speed input: 6339.61 toks/s, output: 12.38 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:10<00:00, 12.38it/s, est. speed input: 6339.61 toks/s, output: 12.38 toks/s]
[rank0]:[W128 11:01:59.879997651 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 61.0s

测试结果:
  Requests/s:   15.19
  Tokens/s:     7789.92
  Total Reqs:   128
  Elapsed:      8.43s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7774.73

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:02:09 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:02:10 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=4075) WARNING 01-28 11:02:17 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=4075) WARNING 01-28 11:02:27 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.64 requests/s, 16034.12 total tokens/s, 15.64 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:02:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:02:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:02:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:02:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:02:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:02:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:02:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:02:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:02:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:02:16] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:02:16] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:02:16] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:02:16] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:16] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:16] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:16] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:16] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:02:16] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:02:16] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:02:16] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:02:16] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:02:16] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:02:16] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=4075) [2026-01-28 11:02:18] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=4075) [2026-01-28 11:02:18] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=4075) [2026-01-28 11:02:18] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=4075) [2026-01-28 11:02:18] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=4075) [2026-01-28 11:02:18] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=4075) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=4075) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.73it/s]
(EngineCore_DP0 pid=4075) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.73it/s]
(EngineCore_DP0 pid=4075) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=4075) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.05it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.37it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.31it/s]
(EngineCore_DP0 pid=4075) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.96it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.95it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  27%|██▋       | 35/128 [00:00<00:00, 347.15it/s]
Adding requests:  56%|█████▋    | 72/128 [00:00<00:00, 358.61it/s]
Adding requests:  84%|████████▍ | 108/128 [00:00<00:00, 347.17it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 349.82it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:02, 44.60it/s, est. speed input: 45680.37 toks/s, output: 44.60 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:05, 22.96it/s, est. speed input: 25537.48 toks/s, output: 24.94 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:05, 20.30it/s, est. speed input: 22916.81 toks/s, output: 22.38 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:05, 18.77it/s, est. speed input: 21439.75 toks/s, output: 20.94 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:00<00:06, 17.91it/s, est. speed input: 20550.36 toks/s, output: 20.07 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.44it/s, est. speed input: 20085.12 toks/s, output: 19.61 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 17.08it/s, est. speed input: 19721.50 toks/s, output: 19.26 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.82it/s, est. speed input: 19432.05 toks/s, output: 18.98 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:05, 16.69it/s, est. speed input: 19209.79 toks/s, output: 18.76 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.59it/s, est. speed input: 19021.73 toks/s, output: 18.58 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.50it/s, est. speed input: 18856.97 toks/s, output: 18.41 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:01<00:05, 16.43it/s, est. speed input: 18710.04 toks/s, output: 18.27 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:01<00:05, 16.31it/s, est. speed input: 18566.18 toks/s, output: 18.13 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.14it/s, est. speed input: 18419.52 toks/s, output: 17.99 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.10it/s, est. speed input: 18306.68 toks/s, output: 17.88 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 15.84it/s, est. speed input: 18157.62 toks/s, output: 17.73 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 15.96it/s, est. speed input: 18082.90 toks/s, output: 17.66 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:05, 15.85it/s, est. speed input: 17978.62 toks/s, output: 17.56 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:05, 15.78it/s, est. speed input: 17887.51 toks/s, output: 17.47 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:02<00:04, 15.94it/s, est. speed input: 17837.56 toks/s, output: 17.42 toks/s]
Processed prompts:  41%|████      | 52/128 [00:02<00:04, 15.94it/s, est. speed input: 17774.41 toks/s, output: 17.36 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 15.94it/s, est. speed input: 17715.63 toks/s, output: 17.30 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.02it/s, est. speed input: 17672.60 toks/s, output: 17.26 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 16.09it/s, est. speed input: 17635.58 toks/s, output: 17.22 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 16.15it/s, est. speed input: 17602.27 toks/s, output: 17.19 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:04, 16.14it/s, est. speed input: 17564.30 toks/s, output: 17.15 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:04, 15.94it/s, est. speed input: 17505.77 toks/s, output: 17.10 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 15.78it/s, est. speed input: 17447.91 toks/s, output: 17.04 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 15.51it/s, est. speed input: 17375.68 toks/s, output: 16.97 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 15.45it/s, est. speed input: 17321.52 toks/s, output: 16.92 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 15.40it/s, est. speed input: 17270.48 toks/s, output: 16.87 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 15.67it/s, est. speed input: 17255.61 toks/s, output: 16.85 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 15.59it/s, est. speed input: 17213.53 toks/s, output: 16.81 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 15.59it/s, est. speed input: 17179.03 toks/s, output: 16.78 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:03, 15.53it/s, est. speed input: 17140.54 toks/s, output: 16.74 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 15.51it/s, est. speed input: 17105.90 toks/s, output: 16.70 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 15.69it/s, est. speed input: 17091.67 toks/s, output: 16.69 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 15.78it/s, est. speed input: 17074.49 toks/s, output: 16.67 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 15.92it/s, est. speed input: 17064.28 toks/s, output: 16.66 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 15.97it/s, est. speed input: 17050.83 toks/s, output: 16.65 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 16.08it/s, est. speed input: 17043.48 toks/s, output: 16.64 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 16.13it/s, est. speed input: 17034.67 toks/s, output: 16.64 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 16.18it/s, est. speed input: 17027.33 toks/s, output: 16.63 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 16.18it/s, est. speed input: 17017.74 toks/s, output: 16.62 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 16.18it/s, est. speed input: 17008.19 toks/s, output: 16.61 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 15.95it/s, est. speed input: 16983.50 toks/s, output: 16.59 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 15.72it/s, est. speed input: 16953.46 toks/s, output: 16.56 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 15.67it/s, est. speed input: 16932.98 toks/s, output: 16.54 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 15.59it/s, est. speed input: 16910.29 toks/s, output: 16.51 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 15.44it/s, est. speed input: 16881.43 toks/s, output: 16.49 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:01, 15.31it/s, est. speed input: 16852.03 toks/s, output: 16.46 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 15.28it/s, est. speed input: 16827.92 toks/s, output: 16.43 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 15.38it/s, est. speed input: 16812.90 toks/s, output: 16.42 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 15.37it/s, est. speed input: 16792.67 toks/s, output: 16.40 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 15.58it/s, est. speed input: 16787.26 toks/s, output: 16.39 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 15.77it/s, est. speed input: 16784.70 toks/s, output: 16.39 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 15.83it/s, est. speed input: 16777.35 toks/s, output: 16.38 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 15.90it/s, est. speed input: 16772.14 toks/s, output: 16.38 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.03it/s, est. speed input: 16771.67 toks/s, output: 16.38 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.03it/s, est. speed input: 16771.67 toks/s, output: 16.38 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.38it/s, est. speed input: 16771.67 toks/s, output: 16.38 toks/s]
[rank0]:[W128 11:02:49.235694367 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 50.0s

测试结果:
  Requests/s:   15.64
  Tokens/s:     16034.12
  Total Reqs:   128
  Elapsed:      8.18s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16018.48

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:03:00 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:03:01 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=4636) WARNING 01-28 11:03:11 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=4636) WARNING 01-28 11:03:21 [backends.py:609] Failed to read file <frozen os>
Throughput: 30.73 requests/s, 31494.16 total tokens/s, 30.73 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:03:00] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:03:00] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:03:00] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:03:00] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:00] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:00] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:00] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:00] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:00] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:03:00] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:03:00] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:03:00] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:03:00] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:03:00] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:03:10] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:03:10] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:03:10] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:03:10] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:10] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:10] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:10] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:10] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:10] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:03:10] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:03:10] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:03:10] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:03:10] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:03:10] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=4636) [2026-01-28 11:03:11] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=4636) [2026-01-28 11:03:12] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=4636) [2026-01-28 11:03:12] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=4636) [2026-01-28 11:03:12] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=4636) [2026-01-28 11:03:12] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=4636) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=4636) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.77it/s]
(EngineCore_DP0 pid=4636) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.77it/s]
(EngineCore_DP0 pid=4636) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=4636) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.61it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  7.81it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.28it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.39it/s]
(EngineCore_DP0 pid=4636) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  6.95it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.78it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.63it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▎        | 35/256 [00:00<00:00, 349.42it/s]
Adding requests:  29%|██▉       | 74/256 [00:00<00:00, 371.04it/s]
Adding requests:  44%|████▍     | 112/256 [00:00<00:00, 373.95it/s]
Adding requests:  59%|█████▊    | 150/256 [00:00<00:00, 370.00it/s]
Adding requests:  73%|███████▎  | 188/256 [00:00<00:00, 367.54it/s]
Adding requests:  88%|████████▊ | 225/256 [00:00<00:00, 367.84it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 367.68it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▌         | 14/256 [00:00<00:02, 100.14it/s, est. speed input: 102562.18 toks/s, output: 100.15 toks/s]
Processed prompts:  10%|▉         | 25/256 [00:00<00:04, 50.22it/s, est. speed input: 56127.34 toks/s, output: 54.81 toks/s]   
Processed prompts:  12%|█▎        | 32/256 [00:00<00:05, 40.33it/s, est. speed input: 46764.71 toks/s, output: 45.66 toks/s]
Processed prompts:  14%|█▍        | 37/256 [00:00<00:05, 40.47it/s, est. speed input: 46033.33 toks/s, output: 44.95 toks/s]
Processed prompts:  16%|█▋        | 42/256 [00:01<00:05, 35.91it/s, est. speed input: 42735.27 toks/s, output: 41.73 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:01<00:05, 35.18it/s, est. speed input: 41768.19 toks/s, output: 40.79 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:01<00:05, 34.58it/s, est. speed input: 40976.24 toks/s, output: 40.02 toks/s]
Processed prompts:  21%|██        | 54/256 [00:01<00:05, 34.05it/s, est. speed input: 40301.83 toks/s, output: 39.36 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:05, 33.54it/s, est. speed input: 39697.81 toks/s, output: 38.77 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 33.17it/s, est. speed input: 39186.91 toks/s, output: 38.27 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 33.04it/s, est. speed input: 38789.86 toks/s, output: 37.88 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 32.81it/s, est. speed input: 38405.95 toks/s, output: 37.51 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:01<00:05, 32.78it/s, est. speed input: 38107.36 toks/s, output: 37.21 toks/s]
Processed prompts:  30%|███       | 78/256 [00:02<00:05, 32.84it/s, est. speed input: 37856.25 toks/s, output: 36.97 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:02<00:05, 32.74it/s, est. speed input: 37604.78 toks/s, output: 36.72 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:05, 32.22it/s, est. speed input: 37287.46 toks/s, output: 36.41 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:05, 32.25it/s, est. speed input: 37079.18 toks/s, output: 36.21 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:05, 32.24it/s, est. speed input: 36885.23 toks/s, output: 36.02 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 32.27it/s, est. speed input: 36713.37 toks/s, output: 35.85 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 31.94it/s, est. speed input: 36499.89 toks/s, output: 35.64 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:02<00:04, 32.22it/s, est. speed input: 36385.98 toks/s, output: 35.53 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:03<00:04, 32.29it/s, est. speed input: 36260.66 toks/s, output: 35.41 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:03<00:04, 32.50it/s, est. speed input: 36167.42 toks/s, output: 35.32 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:03<00:04, 32.64it/s, est. speed input: 36080.08 toks/s, output: 35.23 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:03<00:04, 32.70it/s, est. speed input: 35994.86 toks/s, output: 35.15 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:03<00:03, 32.53it/s, est. speed input: 35887.37 toks/s, output: 35.05 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:03<00:03, 32.63it/s, est. speed input: 35814.39 toks/s, output: 34.97 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:03<00:03, 32.55it/s, est. speed input: 35727.96 toks/s, output: 34.89 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:03<00:03, 32.63it/s, est. speed input: 35663.38 toks/s, output: 34.83 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:04<00:03, 32.66it/s, est. speed input: 35599.19 toks/s, output: 34.76 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:04<00:03, 32.68it/s, est. speed input: 35538.96 toks/s, output: 34.71 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:04<00:03, 32.55it/s, est. speed input: 35466.27 toks/s, output: 34.63 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:04<00:03, 32.59it/s, est. speed input: 35411.37 toks/s, output: 34.58 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:04<00:03, 32.38it/s, est. speed input: 35335.82 toks/s, output: 34.51 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:04<00:02, 32.49it/s, est. speed input: 35289.78 toks/s, output: 34.46 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:04<00:02, 32.61it/s, est. speed input: 35248.73 toks/s, output: 34.42 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:04<00:02, 32.67it/s, est. speed input: 35207.97 toks/s, output: 34.38 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:05<00:02, 32.71it/s, est. speed input: 35169.14 toks/s, output: 34.34 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:05<00:02, 32.73it/s, est. speed input: 35131.34 toks/s, output: 34.31 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:05<00:02, 32.68it/s, est. speed input: 35090.16 toks/s, output: 34.27 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:05<00:02, 32.61it/s, est. speed input: 35047.66 toks/s, output: 34.23 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:05<00:02, 32.50it/s, est. speed input: 35002.58 toks/s, output: 34.18 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:05<00:01, 32.48it/s, est. speed input: 34963.75 toks/s, output: 34.14 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:05<00:01, 32.52it/s, est. speed input: 34930.91 toks/s, output: 34.11 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:05<00:01, 32.61it/s, est. speed input: 34903.20 toks/s, output: 34.09 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:06<00:01, 32.68it/s, est. speed input: 34878.04 toks/s, output: 34.06 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:06<00:01, 32.73it/s, est. speed input: 34853.31 toks/s, output: 34.04 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:06<00:01, 32.37it/s, est. speed input: 34802.51 toks/s, output: 33.99 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:08<00:07,  5.17it/s, est. speed input: 26000.94 toks/s, output: 25.39 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:08<00:04,  6.92it/s, est. speed input: 26107.23 toks/s, output: 25.50 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:08<00:03,  9.07it/s, est. speed input: 26213.09 toks/s, output: 25.60 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:08<00:02, 11.58it/s, est. speed input: 26310.69 toks/s, output: 25.69 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:09<00:01, 14.27it/s, est. speed input: 26389.86 toks/s, output: 25.77 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:09<00:01, 17.00it/s, est. speed input: 26461.32 toks/s, output: 25.84 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:09<00:00, 19.59it/s, est. speed input: 26526.86 toks/s, output: 25.91 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:09<00:00, 21.97it/s, est. speed input: 26594.46 toks/s, output: 25.97 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:09<00:00, 24.00it/s, est. speed input: 26658.72 toks/s, output: 26.03 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:09<00:00, 25.71it/s, est. speed input: 26723.97 toks/s, output: 26.10 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 25.71it/s, est. speed input: 26754.02 toks/s, output: 26.13 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 26.13it/s, est. speed input: 26754.02 toks/s, output: 26.13 toks/s]
[rank0]:[W128 11:03:43.349192728 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 53.3s

测试结果:
  Requests/s:   30.73
  Tokens/s:     31494.16
  Total Reqs:   256
  Elapsed:      8.33s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     31463.43

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:03:54 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:03:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=5192) WARNING 01-28 11:04:02 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=5192) WARNING 01-28 11:04:12 [backends.py:609] Failed to read file <frozen os>
Throughput: 46.00 requests/s, 47153.60 total tokens/s, 46.00 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:03:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:03:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:03:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:03:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:03:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:03:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:03:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:03:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:03:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:03:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:04:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:04:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:04:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:04:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:04:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:04:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:04:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:04:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:04:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=5192) [2026-01-28 11:04:03] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=5192) [2026-01-28 11:04:03] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=5192) [2026-01-28 11:04:03] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=5192) [2026-01-28 11:04:03] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=5192) [2026-01-28 11:04:03] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=5192) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=5192) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.60it/s]
(EngineCore_DP0 pid=5192) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.60it/s]
(EngineCore_DP0 pid=5192) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=5192) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  7.79it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.20it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.56it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.74it/s]
(EngineCore_DP0 pid=5192) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  6.76it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  7.67it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.02it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  7.81it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 38/512 [00:00<00:01, 376.59it/s]
Adding requests:  15%|█▌        | 78/512 [00:00<00:01, 387.86it/s]
Adding requests:  23%|██▎       | 117/512 [00:00<00:01, 385.33it/s]
Adding requests:  30%|███       | 156/512 [00:00<00:00, 382.47it/s]
Adding requests:  38%|███▊      | 195/512 [00:00<00:00, 380.49it/s]
Adding requests:  46%|████▌     | 236/512 [00:00<00:00, 387.50it/s]
Adding requests:  54%|█████▎    | 275/512 [00:00<00:00, 385.30it/s]
Adding requests:  61%|██████▏   | 314/512 [00:00<00:00, 382.23it/s]
Adding requests:  69%|██████▉   | 354/512 [00:00<00:00, 385.65it/s]
Adding requests:  77%|███████▋  | 393/512 [00:01<00:00, 386.92it/s]
Adding requests:  85%|████████▍ | 433/512 [00:01<00:00, 390.76it/s]
Adding requests:  92%|█████████▏| 473/512 [00:01<00:00, 382.86it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 379.17it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 383.39it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   9%|▉         | 46/512 [00:00<00:01, 353.51it/s, est. speed input: 362065.23 toks/s, output: 353.53 toks/s]
Processed prompts:  16%|█▌        | 82/512 [00:00<00:05, 81.70it/s, est. speed input: 96100.95 toks/s, output: 93.85 toks/s]   
Processed prompts:  20%|█▉        | 100/512 [00:01<00:05, 71.92it/s, est. speed input: 85085.28 toks/s, output: 83.09 toks/s]
Processed prompts:  22%|██▏       | 112/512 [00:01<00:06, 65.40it/s, est. speed input: 79051.79 toks/s, output: 77.20 toks/s]
Processed prompts:  24%|██▍       | 122/512 [00:01<00:06, 58.25it/s, est. speed input: 73542.91 toks/s, output: 71.82 toks/s]
Processed prompts:  25%|██▌       | 130/512 [00:01<00:06, 56.12it/s, est. speed input: 71406.10 toks/s, output: 69.73 toks/s]
Processed prompts:  27%|██▋       | 138/512 [00:02<00:06, 54.29it/s, est. speed input: 69616.43 toks/s, output: 67.98 toks/s]
Processed prompts:  29%|██▊       | 146/512 [00:02<00:06, 52.83it/s, est. speed input: 68112.14 toks/s, output: 66.52 toks/s]
Processed prompts:  30%|███       | 154/512 [00:02<00:06, 51.70it/s, est. speed input: 66823.60 toks/s, output: 65.26 toks/s]
Processed prompts:  32%|███▏      | 162/512 [00:02<00:06, 50.78it/s, est. speed input: 65689.17 toks/s, output: 64.15 toks/s]
Processed prompts:  33%|███▎      | 170/512 [00:02<00:06, 50.05it/s, est. speed input: 64681.74 toks/s, output: 63.17 toks/s]
Processed prompts:  35%|███▍      | 178/512 [00:02<00:06, 49.55it/s, est. speed input: 63799.01 toks/s, output: 62.30 toks/s]
Processed prompts:  36%|███▋      | 186/512 [00:03<00:06, 49.17it/s, est. speed input: 63010.26 toks/s, output: 61.53 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:03<00:06, 48.95it/s, est. speed input: 62314.17 toks/s, output: 60.85 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:03<00:06, 48.82it/s, est. speed input: 61692.52 toks/s, output: 60.25 toks/s]
Processed prompts:  41%|████      | 210/512 [00:03<00:06, 48.71it/s, est. speed input: 61125.86 toks/s, output: 59.69 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:03<00:06, 48.62it/s, est. speed input: 60606.27 toks/s, output: 59.19 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:03<00:05, 48.59it/s, est. speed input: 60139.12 toks/s, output: 58.73 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:04<00:05, 48.45it/s, est. speed input: 59688.62 toks/s, output: 58.29 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:04<00:05, 48.43it/s, est. speed input: 59287.44 toks/s, output: 57.90 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:04<00:05, 48.42it/s, est. speed input: 58917.51 toks/s, output: 57.54 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:04<00:05, 48.42it/s, est. speed input: 58575.97 toks/s, output: 57.20 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:04<00:05, 48.43it/s, est. speed input: 58259.77 toks/s, output: 56.89 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:04<00:04, 48.36it/s, est. speed input: 57953.88 toks/s, output: 56.60 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:05<00:04, 48.39it/s, est. speed input: 57679.03 toks/s, output: 56.33 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:05<00:04, 48.37it/s, est. speed input: 57416.95 toks/s, output: 56.07 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:05<00:04, 48.38it/s, est. speed input: 57173.96 toks/s, output: 55.83 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:05<00:04, 48.32it/s, est. speed input: 56937.39 toks/s, output: 55.60 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:05<00:04, 48.29it/s, est. speed input: 56716.23 toks/s, output: 55.39 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:05<00:03, 48.30it/s, est. speed input: 56510.99 toks/s, output: 55.19 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:06<00:03, 48.06it/s, est. speed input: 56290.68 toks/s, output: 54.97 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:06<00:03, 47.77it/s, est. speed input: 56069.43 toks/s, output: 54.76 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:06<00:03, 48.60it/s, est. speed input: 55964.16 toks/s, output: 54.65 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:06<00:03, 48.11it/s, est. speed input: 55759.31 toks/s, output: 54.45 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:06<00:03, 47.82it/s, est. speed input: 55569.52 toks/s, output: 54.27 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:06<00:02, 47.61it/s, est. speed input: 55387.42 toks/s, output: 54.09 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:07<00:02, 47.45it/s, est. speed input: 55213.65 toks/s, output: 53.92 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:07<00:02, 47.33it/s, est. speed input: 55046.88 toks/s, output: 53.76 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:07<00:02, 47.23it/s, est. speed input: 54888.80 toks/s, output: 53.60 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:07<00:02, 47.22it/s, est. speed input: 54739.19 toks/s, output: 53.46 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:07<00:02, 47.19it/s, est. speed input: 54595.90 toks/s, output: 53.32 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:07<00:01, 47.16it/s, est. speed input: 54458.18 toks/s, output: 53.18 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:08<00:01, 47.19it/s, est. speed input: 54330.23 toks/s, output: 53.06 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:08<00:01, 47.12it/s, est. speed input: 54200.82 toks/s, output: 52.93 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:08<00:01, 47.09it/s, est. speed input: 54077.71 toks/s, output: 52.81 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:08<00:01, 47.03it/s, est. speed input: 53956.29 toks/s, output: 52.69 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:08<00:01, 47.01it/s, est. speed input: 53841.91 toks/s, output: 52.58 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:08<00:00, 47.01it/s, est. speed input: 53732.56 toks/s, output: 52.47 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:09<00:00, 47.01it/s, est. speed input: 53627.14 toks/s, output: 52.37 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:09<00:00, 47.07it/s, est. speed input: 53530.26 toks/s, output: 52.28 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:09<00:00, 47.12it/s, est. speed input: 53437.12 toks/s, output: 52.18 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:09<00:00, 47.14it/s, est. speed input: 53346.09 toks/s, output: 52.10 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:09<00:00, 47.13it/s, est. speed input: 53256.81 toks/s, output: 52.01 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:09<00:00, 47.13it/s, est. speed input: 53539.33 toks/s, output: 52.28 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:09<00:00, 52.28it/s, est. speed input: 53539.33 toks/s, output: 52.28 toks/s]
[rank0]:[W128 11:04:37.022095405 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 54.9s

测试结果:
  Requests/s:   46.00
  Tokens/s:     47153.60
  Total Reqs:   512
  Elapsed:      11.13s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     47107.60

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:04:54 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:04:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=5783) WARNING 01-28 11:05:02 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=5783) WARNING 01-28 11:05:12 [backends.py:609] Failed to read file <frozen os>
Throughput: 52.27 requests/s, 53580.12 total tokens/s, 52.27 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:04:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:04:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:04:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:04:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:04:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:04:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:04:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:04:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:04:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:04:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:05:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:05:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:05:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:05:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:05:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:05:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:05:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:05:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:05:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:05:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:05:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:05:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:05:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:05:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=5783) [2026-01-28 11:05:03] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=5783) [2026-01-28 11:05:03] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=5783) [2026-01-28 11:05:03] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=5783) [2026-01-28 11:05:03] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=5783) [2026-01-28 11:05:03] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=5783) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=5783) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.95it/s]
(EngineCore_DP0 pid=5783) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.95it/s]
(EngineCore_DP0 pid=5783) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=5783) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  6.99it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  7.40it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  7.75it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  7.91it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.41it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.49it/s]
(EngineCore_DP0 pid=5783) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  6.75it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  7.60it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  7.89it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.06it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  7.85it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 36/1024 [00:00<00:02, 355.42it/s]
Adding requests:   7%|▋         | 74/1024 [00:00<00:02, 368.78it/s]
Adding requests:  11%|█         | 112/1024 [00:00<00:02, 372.56it/s]
Adding requests:  15%|█▍        | 150/1024 [00:00<00:02, 372.08it/s]
Adding requests:  18%|█▊        | 188/1024 [00:00<00:02, 368.74it/s]
Adding requests:  22%|██▏       | 227/1024 [00:00<00:02, 372.54it/s]
Adding requests:  26%|██▌       | 265/1024 [00:00<00:02, 374.89it/s]
Adding requests:  30%|██▉       | 303/1024 [00:00<00:01, 368.08it/s]
Adding requests:  33%|███▎      | 341/1024 [00:00<00:01, 369.70it/s]
Adding requests:  37%|███▋      | 380/1024 [00:01<00:01, 373.53it/s]
Adding requests:  41%|████      | 418/1024 [00:01<00:01, 374.34it/s]
Adding requests:  45%|████▍     | 456/1024 [00:01<00:01, 374.27it/s]
Adding requests:  48%|████▊     | 495/1024 [00:01<00:01, 376.30it/s]
Adding requests:  52%|█████▏    | 533/1024 [00:01<00:01, 368.63it/s]
Adding requests:  56%|█████▌    | 573/1024 [00:01<00:01, 376.27it/s]
Adding requests:  60%|█████▉    | 612/1024 [00:01<00:01, 378.20it/s]
Adding requests:  63%|██████▎   | 650/1024 [00:01<00:00, 376.24it/s]
Adding requests:  67%|██████▋   | 688/1024 [00:01<00:00, 377.28it/s]
Adding requests:  71%|███████   | 728/1024 [00:01<00:00, 382.28it/s]
Adding requests:  75%|███████▍  | 767/1024 [00:02<00:00, 379.16it/s]
Adding requests:  79%|███████▊  | 805/1024 [00:02<00:00, 373.71it/s]
Adding requests:  82%|████████▏ | 843/1024 [00:02<00:00, 370.22it/s]
Adding requests:  86%|████████▌ | 882/1024 [00:02<00:00, 375.51it/s]
Adding requests:  90%|█████████ | 922/1024 [00:02<00:00, 381.03it/s]
Adding requests:  94%|█████████▍| 961/1024 [00:02<00:00, 380.80it/s]
Adding requests:  98%|█████████▊| 1000/1024 [00:02<00:00, 382.62it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 375.97it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:00<00:00, 1048.56it/s, est. speed input: 1074022.72 toks/s, output: 1048.71 toks/s]
Processed prompts:  23%|██▎       | 235/1024 [00:02<00:08, 92.99it/s, est. speed input: 112184.67 toks/s, output: 109.56 toks/s]    
Processed prompts:  28%|██▊       | 282/1024 [00:03<00:09, 76.45it/s, est. speed input: 93792.50 toks/s, output: 91.59 toks/s]  
Processed prompts:  30%|███       | 310/1024 [00:03<00:09, 72.87it/s, est. speed input: 89520.80 toks/s, output: 87.42 toks/s]
Processed prompts:  32%|███▏      | 329/1024 [00:03<00:09, 70.84it/s, est. speed input: 87334.02 toks/s, output: 85.29 toks/s]
Processed prompts:  34%|███▎      | 344/1024 [00:04<00:10, 66.38it/s, est. speed input: 84494.41 toks/s, output: 82.51 toks/s]
Processed prompts:  35%|███▍      | 356/1024 [00:04<00:11, 60.26it/s, est. speed input: 81358.62 toks/s, output: 79.45 toks/s]
Processed prompts:  36%|███▌      | 365/1024 [00:04<00:10, 59.93it/s, est. speed input: 80614.72 toks/s, output: 78.73 toks/s]
Processed prompts:  36%|███▋      | 373/1024 [00:04<00:11, 58.55it/s, est. speed input: 79706.67 toks/s, output: 77.84 toks/s]
Processed prompts:  37%|███▋      | 380/1024 [00:04<00:11, 55.98it/s, est. speed input: 78643.76 toks/s, output: 76.80 toks/s]
Processed prompts:  38%|███▊      | 387/1024 [00:05<00:11, 53.65it/s, est. speed input: 77648.74 toks/s, output: 75.83 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:05<00:12, 52.10it/s, est. speed input: 76802.12 toks/s, output: 75.00 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:05<00:11, 52.48it/s, est. speed input: 76198.79 toks/s, output: 74.41 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:05<00:11, 52.77it/s, est. speed input: 75626.15 toks/s, output: 73.85 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:11, 53.02it/s, est. speed input: 75086.22 toks/s, output: 73.33 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:11, 53.20it/s, est. speed input: 74573.04 toks/s, output: 72.82 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:05<00:11, 53.31it/s, est. speed input: 74083.18 toks/s, output: 72.35 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:06<00:10, 53.39it/s, est. speed input: 73616.13 toks/s, output: 71.89 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:06<00:10, 53.47it/s, est. speed input: 73175.09 toks/s, output: 71.46 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:06<00:10, 53.54it/s, est. speed input: 72755.25 toks/s, output: 71.05 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:06<00:10, 53.59it/s, est. speed input: 72353.25 toks/s, output: 70.66 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:10, 53.62it/s, est. speed input: 71969.35 toks/s, output: 70.28 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:10, 53.63it/s, est. speed input: 71601.63 toks/s, output: 69.92 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:07<00:09, 53.62it/s, est. speed input: 71246.92 toks/s, output: 69.58 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:07<00:09, 53.61it/s, est. speed input: 70907.42 toks/s, output: 69.25 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:07<00:09, 53.63it/s, est. speed input: 70583.35 toks/s, output: 68.93 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:07<00:09, 53.65it/s, est. speed input: 70273.39 toks/s, output: 68.63 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:07<00:09, 53.67it/s, est. speed input: 69975.78 toks/s, output: 68.34 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:09, 53.68it/s, est. speed input: 69688.91 toks/s, output: 68.06 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:07<00:09, 53.64it/s, est. speed input: 69409.19 toks/s, output: 67.78 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:08<00:08, 53.61it/s, est. speed input: 69140.07 toks/s, output: 67.52 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:08<00:08, 53.61it/s, est. speed input: 68882.07 toks/s, output: 67.27 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:08<00:08, 53.63it/s, est. speed input: 68634.59 toks/s, output: 67.03 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:08<00:08, 53.62it/s, est. speed input: 68394.08 toks/s, output: 66.79 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:08<00:08, 53.62it/s, est. speed input: 68161.95 toks/s, output: 66.56 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:08, 53.63it/s, est. speed input: 67939.07 toks/s, output: 66.35 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:08<00:08, 53.65it/s, est. speed input: 67723.88 toks/s, output: 66.14 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:09<00:07, 53.63it/s, est. speed input: 67513.99 toks/s, output: 65.93 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:09<00:07, 53.62it/s, est. speed input: 67310.91 toks/s, output: 65.73 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:09<00:07, 53.62it/s, est. speed input: 67114.44 toks/s, output: 65.54 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:09<00:07, 53.61it/s, est. speed input: 66923.48 toks/s, output: 65.35 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:09<00:07, 53.61it/s, est. speed input: 66739.28 toks/s, output: 65.17 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:07, 53.61it/s, est. speed input: 66560.01 toks/s, output: 65.00 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:10<00:06, 53.59it/s, est. speed input: 66385.55 toks/s, output: 64.83 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:10<00:06, 53.59it/s, est. speed input: 66216.77 toks/s, output: 64.66 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:10<00:06, 53.59it/s, est. speed input: 66052.81 toks/s, output: 64.50 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:10<00:06, 53.60it/s, est. speed input: 65894.10 toks/s, output: 64.35 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:10<00:06, 53.61it/s, est. speed input: 65739.74 toks/s, output: 64.20 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:10<00:06, 53.59it/s, est. speed input: 65588.43 toks/s, output: 64.05 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:10<00:06, 53.58it/s, est. speed input: 65441.51 toks/s, output: 63.91 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:11<00:05, 53.59it/s, est. speed input: 65299.53 toks/s, output: 63.77 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:11<00:05, 53.60it/s, est. speed input: 65161.45 toks/s, output: 63.63 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:11<00:05, 53.59it/s, est. speed input: 65026.20 toks/s, output: 63.50 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:11<00:05, 53.60it/s, est. speed input: 64895.05 toks/s, output: 63.37 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:11<00:05, 53.60it/s, est. speed input: 64767.19 toks/s, output: 63.25 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:11<00:05, 53.59it/s, est. speed input: 64641.97 toks/s, output: 63.13 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:11<00:05, 53.60it/s, est. speed input: 64520.63 toks/s, output: 63.01 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:12<00:04, 53.59it/s, est. speed input: 64401.53 toks/s, output: 62.89 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:12<00:04, 53.58it/s, est. speed input: 64284.74 toks/s, output: 62.78 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:12<00:04, 53.57it/s, est. speed input: 64171.31 toks/s, output: 62.67 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:12<00:04, 53.57it/s, est. speed input: 64060.60 toks/s, output: 62.56 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:12<00:04, 53.59it/s, est. speed input: 63953.18 toks/s, output: 62.45 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:12<00:04, 53.55it/s, est. speed input: 63846.06 toks/s, output: 62.35 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:03, 53.56it/s, est. speed input: 63743.29 toks/s, output: 62.25 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:03, 53.59it/s, est. speed input: 63643.42 toks/s, output: 62.15 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:13<00:03, 53.56it/s, est. speed input: 63544.14 toks/s, output: 62.05 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:13<00:03, 53.56it/s, est. speed input: 63447.29 toks/s, output: 61.96 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:13<00:03, 53.54it/s, est. speed input: 63352.22 toks/s, output: 61.87 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:13<00:03, 53.52it/s, est. speed input: 63258.79 toks/s, output: 61.78 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:13<00:03, 53.53it/s, est. speed input: 63168.13 toks/s, output: 61.69 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:14<00:02, 53.55it/s, est. speed input: 63080.13 toks/s, output: 61.60 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 53.54it/s, est. speed input: 62993.28 toks/s, output: 61.52 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:14<00:02, 53.53it/s, est. speed input: 62907.63 toks/s, output: 61.43 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:14<00:02, 53.55it/s, est. speed input: 62825.13 toks/s, output: 61.35 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:14<00:02, 53.53it/s, est. speed input: 62742.89 toks/s, output: 61.27 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:14<00:02, 53.54it/s, est. speed input: 62663.09 toks/s, output: 61.19 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:14<00:02, 53.55it/s, est. speed input: 62585.15 toks/s, output: 61.12 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:15<00:01, 53.56it/s, est. speed input: 62508.79 toks/s, output: 61.04 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 53.56it/s, est. speed input: 62433.70 toks/s, output: 60.97 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 53.55it/s, est. speed input: 62359.94 toks/s, output: 60.90 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:15<00:01, 53.55it/s, est. speed input: 62287.47 toks/s, output: 60.83 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:15<00:01, 53.54it/s, est. speed input: 62216.19 toks/s, output: 60.76 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:15<00:01, 53.53it/s, est. speed input: 62146.31 toks/s, output: 60.69 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:16<00:01, 53.51it/s, est. speed input: 62076.87 toks/s, output: 60.62 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 53.52it/s, est. speed input: 62009.81 toks/s, output: 60.56 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 55.34it/s, est. speed input: 62006.16 toks/s, output: 60.55 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:16<00:00, 54.72it/s, est. speed input: 61938.70 toks/s, output: 60.49 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:16<00:00, 54.35it/s, est. speed input: 61874.02 toks/s, output: 60.42 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:16<00:00, 54.09it/s, est. speed input: 61810.58 toks/s, output: 60.36 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:16<00:00, 55.97it/s, est. speed input: 61814.91 toks/s, output: 60.37 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:16<00:00, 55.97it/s, est. speed input: 62178.36 toks/s, output: 60.72 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:16<00:00, 60.72it/s, est. speed input: 62178.36 toks/s, output: 60.72 toks/s]
[rank0]:[W128 11:05:46.918207478 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 68.2s

测试结果:
  Requests/s:   52.27
  Tokens/s:     53580.12
  Total Reqs:   1024
  Elapsed:      19.59s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     53527.85

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:06:08 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:06:08 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=6469) WARNING 01-28 11:06:16 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=6469) WARNING 01-28 11:06:25 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.93 requests/s, 53233.32 total tokens/s, 51.93 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:06:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:06:08] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:06:08] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:06:08] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:08] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:08] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:08] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:08] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:08] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:06:08] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:06:08] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:06:08] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:06:08] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:06:08] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:06:15] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:06:15] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:06:15] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:06:15] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:15] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:15] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:15] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:15] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:06:15] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:06:15] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:06:15] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:06:15] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:06:15] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:06:15] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=6469) [2026-01-28 11:06:16] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=6469) [2026-01-28 11:06:16] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=6469) [2026-01-28 11:06:16] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=6469) [2026-01-28 11:06:16] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=6469) [2026-01-28 11:06:16] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=6469) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=6469) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.77it/s]
(EngineCore_DP0 pid=6469) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.77it/s]
(EngineCore_DP0 pid=6469) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=6469) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.56it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.66it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.04it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.13it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.17it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  7.69it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  7.85it/s]
(EngineCore_DP0 pid=6469) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  6.71it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  7.62it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  7.93it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  7.83it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 32/2048 [00:00<00:06, 318.37it/s]
Adding requests:   3%|▎         | 68/2048 [00:00<00:05, 337.48it/s]
Adding requests:   5%|▌         | 105/2048 [00:00<00:05, 349.02it/s]
Adding requests:   7%|▋         | 141/2048 [00:00<00:05, 349.27it/s]
Adding requests:   9%|▊         | 176/2048 [00:00<00:05, 348.68it/s]
Adding requests:  10%|█         | 212/2048 [00:00<00:05, 350.03it/s]
Adding requests:  12%|█▏        | 249/2048 [00:00<00:05, 355.98it/s]
Adding requests:  14%|█▍        | 286/2048 [00:00<00:04, 358.54it/s]
Adding requests:  16%|█▌        | 322/2048 [00:00<00:04, 356.23it/s]
Adding requests:  17%|█▋        | 358/2048 [00:01<00:04, 356.74it/s]
Adding requests:  19%|█▉        | 394/2048 [00:01<00:04, 337.81it/s]
Adding requests:  21%|██        | 428/2048 [00:01<00:05, 309.01it/s]
Adding requests:  23%|██▎       | 462/2048 [00:01<00:05, 315.16it/s]
Adding requests:  24%|██▍       | 499/2048 [00:01<00:04, 329.06it/s]
Adding requests:  26%|██▌       | 534/2048 [00:01<00:04, 333.09it/s]
Adding requests:  28%|██▊       | 571/2048 [00:01<00:04, 343.71it/s]
Adding requests:  30%|██▉       | 608/2048 [00:01<00:04, 348.65it/s]
Adding requests:  31%|███▏      | 644/2048 [00:01<00:04, 337.11it/s]
Adding requests:  33%|███▎      | 678/2048 [00:01<00:04, 336.68it/s]
Adding requests:  35%|███▍      | 716/2048 [00:02<00:03, 348.16it/s]
Adding requests:  37%|███▋      | 751/2048 [00:02<00:03, 343.76it/s]
Adding requests:  38%|███▊      | 787/2048 [00:02<00:03, 348.36it/s]
Adding requests:  40%|████      | 822/2048 [00:02<00:03, 343.64it/s]
Adding requests:  42%|████▏     | 859/2048 [00:02<00:03, 350.37it/s]
Adding requests:  44%|████▍     | 902/2048 [00:02<00:03, 370.97it/s]
Adding requests:  46%|████▌     | 942/2048 [00:02<00:02, 377.71it/s]
Adding requests:  48%|████▊     | 984/2048 [00:02<00:02, 387.75it/s]
Adding requests:  50%|█████     | 1026/2048 [00:02<00:02, 394.73it/s]
Adding requests:  52%|█████▏    | 1067/2048 [00:03<00:02, 397.15it/s]
Adding requests:  54%|█████▍    | 1107/2048 [00:03<00:02, 394.71it/s]
Adding requests:  56%|█████▌    | 1147/2048 [00:03<00:02, 392.30it/s]
Adding requests:  58%|█████▊    | 1187/2048 [00:03<00:02, 389.61it/s]
Adding requests:  60%|█████▉    | 1226/2048 [00:03<00:02, 351.42it/s]
Adding requests:  62%|██████▏   | 1265/2048 [00:03<00:02, 361.12it/s]
Adding requests:  64%|██████▍   | 1306/2048 [00:03<00:01, 374.66it/s]
Adding requests:  66%|██████▌   | 1348/2048 [00:03<00:01, 387.58it/s]
Adding requests:  68%|██████▊   | 1389/2048 [00:03<00:01, 391.87it/s]
Adding requests:  70%|██████▉   | 1431/2048 [00:03<00:01, 397.52it/s]
Adding requests:  72%|███████▏  | 1474/2048 [00:04<00:01, 405.81it/s]
Adding requests:  74%|███████▍  | 1516/2048 [00:04<00:01, 409.28it/s]
Adding requests:  76%|███████▌  | 1558/2048 [00:04<00:01, 411.27it/s]
Adding requests:  78%|███████▊  | 1602/2048 [00:04<00:01, 417.43it/s]
Adding requests:  80%|████████  | 1644/2048 [00:04<00:00, 415.22it/s]
Adding requests:  82%|████████▏ | 1686/2048 [00:04<00:00, 413.47it/s]
Adding requests:  84%|████████▍ | 1728/2048 [00:04<00:00, 415.12it/s]
Adding requests:  86%|████████▋ | 1770/2048 [00:04<00:00, 412.02it/s]
Adding requests:  88%|████████▊ | 1812/2048 [00:04<00:00, 413.31it/s]
Adding requests:  91%|█████████ | 1854/2048 [00:04<00:00, 413.06it/s]
Adding requests:  93%|█████████▎| 1896/2048 [00:05<00:00, 411.81it/s]
Adding requests:  95%|█████████▍| 1938/2048 [00:05<00:00, 401.52it/s]
Adding requests:  97%|█████████▋| 1980/2048 [00:05<00:00, 404.90it/s]
Adding requests:  99%|█████████▊| 2021/2048 [00:05<00:00, 404.27it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 374.44it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:00<00:02, 715.29it/s, est. speed input: 732503.02 toks/s, output: 715.31 toks/s]
Processed prompts:  17%|█▋        | 346/2048 [00:01<00:09, 181.00it/s, est. speed input: 225326.64 toks/s, output: 220.04 toks/s]
Processed prompts:  19%|█▊        | 380/2048 [00:02<00:12, 135.42it/s, est. speed input: 179583.13 toks/s, output: 175.37 toks/s]
Processed prompts:  20%|█▉        | 401/2048 [00:02<00:13, 121.92it/s, est. speed input: 166630.41 toks/s, output: 162.72 toks/s]
Processed prompts:  20%|██        | 417/2048 [00:02<00:15, 106.27it/s, est. speed input: 154601.22 toks/s, output: 150.98 toks/s]
Processed prompts:  21%|██        | 429/2048 [00:03<00:17, 89.99it/s, est. speed input: 143578.59 toks/s, output: 140.21 toks/s] 
Processed prompts:  21%|██▏       | 439/2048 [00:03<00:21, 75.31it/s, est. speed input: 133912.89 toks/s, output: 130.77 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:03<00:24, 64.88it/s, est. speed input: 126080.41 toks/s, output: 123.12 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:03<00:25, 61.78it/s, est. speed input: 120732.55 toks/s, output: 117.90 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:04<00:26, 59.48it/s, est. speed input: 116130.04 toks/s, output: 113.41 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:04<00:26, 57.82it/s, est. speed input: 112128.98 toks/s, output: 109.50 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:04<00:27, 56.64it/s, est. speed input: 108625.60 toks/s, output: 106.08 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:05<00:27, 55.78it/s, est. speed input: 105523.55 toks/s, output: 103.05 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:05<00:27, 55.18it/s, est. speed input: 102760.62 toks/s, output: 100.35 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:05<00:27, 54.75it/s, est. speed input: 100283.48 toks/s, output: 97.93 toks/s] 
Processed prompts:  28%|██▊       | 578/2048 [00:06<00:27, 54.44it/s, est. speed input: 98050.36 toks/s, output: 95.75 toks/s] 
Processed prompts:  29%|██▉       | 594/2048 [00:06<00:26, 54.22it/s, est. speed input: 96024.66 toks/s, output: 93.77 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:06<00:26, 54.07it/s, est. speed input: 94183.47 toks/s, output: 91.98 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:06<00:26, 53.96it/s, est. speed input: 92499.00 toks/s, output: 90.33 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:07<00:26, 53.87it/s, est. speed input: 90949.14 toks/s, output: 88.82 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:07<00:25, 53.83it/s, est. speed input: 89528.30 toks/s, output: 87.43 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:07<00:25, 53.77it/s, est. speed input: 88208.72 toks/s, output: 86.14 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:08<00:25, 53.73it/s, est. speed input: 86985.17 toks/s, output: 84.95 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:08<00:24, 53.69it/s, est. speed input: 85848.34 toks/s, output: 83.84 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:08<00:24, 53.67it/s, est. speed input: 84790.07 toks/s, output: 82.80 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:09<00:24, 53.67it/s, est. speed input: 83802.64 toks/s, output: 81.84 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:09<00:24, 53.64it/s, est. speed input: 82874.82 toks/s, output: 80.93 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:09<00:23, 53.62it/s, est. speed input: 82004.43 toks/s, output: 80.08 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:09<00:23, 53.61it/s, est. speed input: 81187.17 toks/s, output: 79.28 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:10<00:23, 53.61it/s, est. speed input: 80418.46 toks/s, output: 78.53 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:10<00:22, 53.62it/s, est. speed input: 79695.21 toks/s, output: 77.83 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:10<00:22, 53.58it/s, est. speed input: 79006.29 toks/s, output: 77.15 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:11<00:22, 53.57it/s, est. speed input: 78356.15 toks/s, output: 76.52 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:11<00:22, 53.57it/s, est. speed input: 77740.68 toks/s, output: 75.92 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:11<00:21, 53.57it/s, est. speed input: 77156.57 toks/s, output: 75.35 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:12<00:21, 53.56it/s, est. speed input: 76600.62 toks/s, output: 74.81 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:12<00:21, 53.55it/s, est. speed input: 76071.12 toks/s, output: 74.29 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:12<00:20, 53.54it/s, est. speed input: 75566.68 toks/s, output: 73.80 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:12<00:20, 53.54it/s, est. speed input: 75086.34 toks/s, output: 73.33 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:13<00:20, 53.52it/s, est. speed input: 74625.46 toks/s, output: 72.88 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:13<00:19, 54.37it/s, est. speed input: 74272.04 toks/s, output: 72.53 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:13<00:19, 54.11it/s, est. speed input: 73849.67 toks/s, output: 72.12 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:14<00:19, 53.92it/s, est. speed input: 73443.74 toks/s, output: 71.72 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:14<00:19, 53.78it/s, est. speed input: 73055.10 toks/s, output: 71.34 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:14<00:18, 53.68it/s, est. speed input: 72681.39 toks/s, output: 70.98 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:14<00:18, 53.60it/s, est. speed input: 72321.55 toks/s, output: 70.63 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:15<00:18, 53.56it/s, est. speed input: 71977.28 toks/s, output: 70.29 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:15<00:17, 53.52it/s, est. speed input: 71645.39 toks/s, output: 69.97 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:15<00:17, 53.50it/s, est. speed input: 71326.70 toks/s, output: 69.65 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:16<00:17, 53.47it/s, est. speed input: 71018.50 toks/s, output: 69.35 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:16<00:17, 53.44it/s, est. speed input: 70721.14 toks/s, output: 69.06 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:16<00:16, 54.31it/s, est. speed input: 70502.19 toks/s, output: 68.85 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:17<00:16, 54.02it/s, est. speed input: 70223.79 toks/s, output: 68.58 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:17<00:16, 53.83it/s, est. speed input: 69955.14 toks/s, output: 68.32 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:17<00:15, 53.72it/s, est. speed input: 69697.71 toks/s, output: 68.06 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:17<00:15, 53.59it/s, est. speed input: 69444.56 toks/s, output: 67.82 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:18<00:15, 52.57it/s, est. speed input: 69133.30 toks/s, output: 67.51 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:18<00:15, 51.42it/s, est. speed input: 68798.56 toks/s, output: 67.19 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:18<00:15, 50.64it/s, est. speed input: 68475.03 toks/s, output: 66.87 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:19<00:15, 50.12it/s, est. speed input: 68163.30 toks/s, output: 66.57 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:19<00:15, 49.79it/s, est. speed input: 67864.27 toks/s, output: 66.27 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:19<00:14, 49.54it/s, est. speed input: 67573.37 toks/s, output: 65.99 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:20<00:14, 49.36it/s, est. speed input: 67291.30 toks/s, output: 65.71 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:20<00:14, 49.23it/s, est. speed input: 67018.15 toks/s, output: 65.45 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:20<00:13, 49.13it/s, est. speed input: 66752.45 toks/s, output: 65.19 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:21<00:13, 49.75it/s, est. speed input: 66542.53 toks/s, output: 64.98 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:21<00:12, 50.76it/s, est. speed input: 66375.19 toks/s, output: 64.82 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:21<00:12, 51.50it/s, est. speed input: 66213.38 toks/s, output: 64.66 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:24<00:37, 16.42it/s, est. speed input: 60018.88 toks/s, output: 58.61 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:24<00:29, 20.72it/s, est. speed input: 59953.06 toks/s, output: 58.55 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:24<00:23, 25.38it/s, est. speed input: 59888.74 toks/s, output: 58.49 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:25<00:19, 30.11it/s, est. speed input: 59826.08 toks/s, output: 58.42 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:25<00:16, 34.52it/s, est. speed input: 59752.57 toks/s, output: 58.35 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:25<00:14, 37.86it/s, est. speed input: 59629.99 toks/s, output: 58.23 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:26<00:12, 40.60it/s, est. speed input: 59509.88 toks/s, output: 58.12 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:26<00:11, 42.77it/s, est. speed input: 59392.90 toks/s, output: 58.00 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:26<00:11, 44.43it/s, est. speed input: 59278.66 toks/s, output: 57.89 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:27<00:10, 45.67it/s, est. speed input: 59167.12 toks/s, output: 57.78 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:27<00:09, 46.58it/s, est. speed input: 59058.48 toks/s, output: 57.67 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:27<00:09, 47.24it/s, est. speed input: 58952.18 toks/s, output: 57.57 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:28<00:09, 47.72it/s, est. speed input: 58848.36 toks/s, output: 57.47 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:28<00:08, 48.05it/s, est. speed input: 58746.99 toks/s, output: 57.37 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:28<00:08, 48.29it/s, est. speed input: 58647.68 toks/s, output: 57.27 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:29<00:07, 48.45it/s, est. speed input: 58550.41 toks/s, output: 57.18 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:29<00:07, 48.60it/s, est. speed input: 58457.25 toks/s, output: 57.09 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:29<00:07, 48.64it/s, est. speed input: 58362.73 toks/s, output: 56.99 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:30<00:06, 48.70it/s, est. speed input: 58271.95 toks/s, output: 56.91 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:30<00:06, 48.75it/s, est. speed input: 58183.27 toks/s, output: 56.82 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:30<00:06, 48.77it/s, est. speed input: 58096.26 toks/s, output: 56.73 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:31<00:05, 48.80it/s, est. speed input: 58011.45 toks/s, output: 56.65 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:31<00:05, 49.42it/s, est. speed input: 57952.69 toks/s, output: 56.59 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:31<00:05, 50.53it/s, est. speed input: 57921.12 toks/s, output: 56.56 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:32<00:04, 51.33it/s, est. speed input: 57889.67 toks/s, output: 56.53 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:32<00:04, 51.90it/s, est. speed input: 57858.84 toks/s, output: 56.50 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:32<00:03, 52.30it/s, est. speed input: 57828.35 toks/s, output: 56.47 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:32<00:03, 52.61it/s, est. speed input: 57798.95 toks/s, output: 56.44 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:33<00:03, 53.65it/s, est. speed input: 57797.22 toks/s, output: 56.44 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:33<00:02, 53.53it/s, est. speed input: 57767.83 toks/s, output: 56.41 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:33<00:02, 53.45it/s, est. speed input: 57739.36 toks/s, output: 56.39 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:34<00:02, 53.41it/s, est. speed input: 57711.59 toks/s, output: 56.36 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:34<00:02, 53.39it/s, est. speed input: 57684.54 toks/s, output: 56.33 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:34<00:01, 53.36it/s, est. speed input: 57657.74 toks/s, output: 56.31 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:35<00:01, 53.34it/s, est. speed input: 57631.27 toks/s, output: 56.28 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:35<00:01, 53.32it/s, est. speed input: 57604.91 toks/s, output: 56.25 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:35<00:00, 53.31it/s, est. speed input: 57579.35 toks/s, output: 56.23 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:35<00:00, 53.31it/s, est. speed input: 57554.47 toks/s, output: 56.21 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:36<00:00, 54.32it/s, est. speed input: 57559.33 toks/s, output: 56.21 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:36<00:00, 54.32it/s, est. speed input: 57954.95 toks/s, output: 56.60 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:36<00:00, 56.60it/s, est. speed input: 57954.95 toks/s, output: 56.60 toks/s]
[rank0]:[W128 11:07:22.205303936 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 95.9s

测试结果:
  Requests/s:   51.93
  Tokens/s:     53233.32
  Total Reqs:   2048
  Elapsed:      39.43s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     53181.39

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:07:54 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:07:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=7362) WARNING 01-28 11:08:02 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=7362) WARNING 01-28 11:08:11 [backends.py:609] Failed to read file <frozen os>
Throughput: 53.20 requests/s, 54528.27 total tokens/s, 53.20 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:07:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:07:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:07:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:07:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:07:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:07:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:07:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:07:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:07:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:07:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:07:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:07:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:07:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:07:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:08:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:08:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:08:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:08:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:08:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:08:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:08:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:08:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:08:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:08:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:08:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:08:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:08:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:08:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=7362) [2026-01-28 11:08:03] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=7362) [2026-01-28 11:08:03] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=7362) [2026-01-28 11:08:03] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=7362) [2026-01-28 11:08:03] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=7362) [2026-01-28 11:08:03] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=7362) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=7362) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.92it/s]
(EngineCore_DP0 pid=7362) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.92it/s]
(EngineCore_DP0 pid=7362) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=7362) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.49it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  7.41it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:01,  7.61it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  7.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  7.66it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  7.75it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  7.82it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:01<00:00,  7.81it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  7.87it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  7.89it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  7.33it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  7.61it/s]
(EngineCore_DP0 pid=7362) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  6.66it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  7.73it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.23it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  8.41it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  8.64it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.72it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.42it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 38/4096 [00:00<00:10, 371.52it/s]
Adding requests:   2%|▏         | 78/4096 [00:00<00:10, 385.28it/s]
Adding requests:   3%|▎         | 117/4096 [00:00<00:10, 386.81it/s]
Adding requests:   4%|▍         | 156/4096 [00:00<00:10, 387.91it/s]
Adding requests:   5%|▍         | 195/4096 [00:00<00:10, 386.18it/s]
Adding requests:   6%|▌         | 235/4096 [00:00<00:09, 389.75it/s]
Adding requests:   7%|▋         | 276/4096 [00:00<00:09, 393.68it/s]
Adding requests:   8%|▊         | 316/4096 [00:00<00:09, 388.63it/s]
Adding requests:   9%|▊         | 357/4096 [00:00<00:09, 392.13it/s]
Adding requests:  10%|▉         | 398/4096 [00:01<00:09, 396.03it/s]
Adding requests:  11%|█         | 438/4096 [00:01<00:09, 395.36it/s]
Adding requests:  12%|█▏        | 480/4096 [00:01<00:09, 399.97it/s]
Adding requests:  13%|█▎        | 521/4096 [00:01<00:09, 393.41it/s]
Adding requests:  14%|█▎        | 563/4096 [00:01<00:08, 399.26it/s]
Adding requests:  15%|█▍        | 603/4096 [00:01<00:08, 397.23it/s]
Adding requests:  16%|█▌        | 644/4096 [00:01<00:08, 397.77it/s]
Adding requests:  17%|█▋        | 685/4096 [00:01<00:08, 400.37it/s]
Adding requests:  18%|█▊        | 726/4096 [00:01<00:09, 373.73it/s]
Adding requests:  19%|█▊        | 766/4096 [00:01<00:08, 380.24it/s]
Adding requests:  20%|█▉        | 805/4096 [00:02<00:08, 377.91it/s]
Adding requests:  21%|██        | 844/4096 [00:02<00:08, 381.12it/s]
Adding requests:  22%|██▏       | 886/4096 [00:02<00:08, 392.21it/s]
Adding requests:  23%|██▎       | 928/4096 [00:02<00:07, 399.76it/s]
Adding requests:  24%|██▎       | 970/4096 [00:02<00:07, 404.66it/s]
Adding requests:  25%|██▍       | 1011/4096 [00:02<00:07, 405.35it/s]
Adding requests:  26%|██▌       | 1053/4096 [00:02<00:07, 408.57it/s]
Adding requests:  27%|██▋       | 1094/4096 [00:02<00:07, 406.66it/s]
Adding requests:  28%|██▊       | 1135/4096 [00:02<00:07, 404.38it/s]
Adding requests:  29%|██▉       | 1179/4096 [00:02<00:07, 413.26it/s]
Adding requests:  30%|██▉       | 1221/4096 [00:03<00:07, 407.35it/s]
Adding requests:  31%|███       | 1262/4096 [00:03<00:06, 405.53it/s]
Adding requests:  32%|███▏      | 1303/4096 [00:03<00:06, 400.89it/s]
Adding requests:  33%|███▎      | 1344/4096 [00:03<00:06, 403.23it/s]
Adding requests:  34%|███▍      | 1385/4096 [00:03<00:06, 401.38it/s]
Adding requests:  35%|███▍      | 1427/4096 [00:03<00:06, 405.55it/s]
Adding requests:  36%|███▌      | 1469/4096 [00:03<00:06, 409.34it/s]
Adding requests:  37%|███▋      | 1511/4096 [00:03<00:06, 410.89it/s]
Adding requests:  38%|███▊      | 1553/4096 [00:03<00:06, 409.90it/s]
Adding requests:  39%|███▉      | 1596/4096 [00:04<00:06, 414.97it/s]
Adding requests:  40%|███▉      | 1638/4096 [00:04<00:05, 414.85it/s]
Adding requests:  41%|████      | 1680/4096 [00:04<00:05, 412.60it/s]
Adding requests:  42%|████▏     | 1723/4096 [00:04<00:05, 416.65it/s]
Adding requests:  43%|████▎     | 1765/4096 [00:04<00:05, 410.94it/s]
Adding requests:  44%|████▍     | 1808/4096 [00:04<00:05, 413.69it/s]
Adding requests:  45%|████▌     | 1850/4096 [00:04<00:05, 415.45it/s]
Adding requests:  46%|████▌     | 1892/4096 [00:04<00:05, 416.53it/s]
Adding requests:  47%|████▋     | 1935/4096 [00:04<00:05, 418.34it/s]
Adding requests:  48%|████▊     | 1977/4096 [00:04<00:05, 416.69it/s]
Adding requests:  49%|████▉     | 2019/4096 [00:05<00:04, 416.60it/s]
Adding requests:  50%|█████     | 2062/4096 [00:05<00:04, 419.61it/s]
Adding requests:  51%|█████▏    | 2104/4096 [00:05<00:04, 413.51it/s]
Adding requests:  52%|█████▏    | 2146/4096 [00:05<00:04, 409.89it/s]
Adding requests:  53%|█████▎    | 2188/4096 [00:05<00:04, 407.29it/s]
Adding requests:  54%|█████▍    | 2231/4096 [00:05<00:04, 412.61it/s]
Adding requests:  55%|█████▌    | 2273/4096 [00:05<00:04, 411.02it/s]
Adding requests:  57%|█████▋    | 2315/4096 [00:05<00:04, 409.94it/s]
Adding requests:  58%|█████▊    | 2357/4096 [00:05<00:04, 405.03it/s]
Adding requests:  59%|█████▊    | 2399/4096 [00:05<00:04, 408.21it/s]
Adding requests:  60%|█████▉    | 2440/4096 [00:06<00:04, 393.87it/s]
Adding requests:  61%|██████    | 2482/4096 [00:06<00:04, 399.67it/s]
Adding requests:  62%|██████▏   | 2523/4096 [00:06<00:03, 393.97it/s]
Adding requests:  63%|██████▎   | 2566/4096 [00:06<00:03, 404.02it/s]
Adding requests:  64%|██████▎   | 2608/4096 [00:06<00:03, 408.16it/s]
Adding requests:  65%|██████▍   | 2650/4096 [00:06<00:03, 409.39it/s]
Adding requests:  66%|██████▌   | 2692/4096 [00:06<00:03, 410.66it/s]
Adding requests:  67%|██████▋   | 2734/4096 [00:06<00:03, 408.61it/s]
Adding requests:  68%|██████▊   | 2776/4096 [00:06<00:03, 409.34it/s]
Adding requests:  69%|██████▉   | 2817/4096 [00:06<00:03, 408.02it/s]
Adding requests:  70%|██████▉   | 2858/4096 [00:07<00:03, 408.55it/s]
Adding requests:  71%|███████   | 2901/4096 [00:07<00:02, 412.30it/s]
Adding requests:  72%|███████▏  | 2943/4096 [00:07<00:02, 409.19it/s]
Adding requests:  73%|███████▎  | 2985/4096 [00:07<00:02, 410.97it/s]
Adding requests:  74%|███████▍  | 3027/4096 [00:07<00:02, 409.79it/s]
Adding requests:  75%|███████▍  | 3068/4096 [00:07<00:02, 409.84it/s]
Adding requests:  76%|███████▌  | 3110/4096 [00:07<00:02, 410.43it/s]
Adding requests:  77%|███████▋  | 3152/4096 [00:07<00:02, 407.57it/s]
Adding requests:  78%|███████▊  | 3193/4096 [00:07<00:02, 407.56it/s]
Adding requests:  79%|███████▉  | 3235/4096 [00:08<00:02, 409.02it/s]
Adding requests:  80%|████████  | 3277/4096 [00:08<00:01, 411.48it/s]
Adding requests:  81%|████████  | 3319/4096 [00:08<00:01, 412.59it/s]
Adding requests:  82%|████████▏ | 3362/4096 [00:08<00:01, 415.40it/s]
Adding requests:  83%|████████▎ | 3404/4096 [00:08<00:01, 412.91it/s]
Adding requests:  84%|████████▍ | 3446/4096 [00:08<00:01, 411.57it/s]
Adding requests:  85%|████████▌ | 3488/4096 [00:08<00:01, 406.44it/s]
Adding requests:  86%|████████▌ | 3529/4096 [00:08<00:01, 405.54it/s]
Adding requests:  87%|████████▋ | 3570/4096 [00:08<00:01, 405.99it/s]
Adding requests:  88%|████████▊ | 3612/4096 [00:08<00:01, 408.06it/s]
Adding requests:  89%|████████▉ | 3653/4096 [00:09<00:01, 401.87it/s]
Adding requests:  90%|█████████ | 3695/4096 [00:09<00:00, 404.86it/s]
Adding requests:  91%|█████████ | 3736/4096 [00:09<00:00, 404.61it/s]
Adding requests:  92%|█████████▏| 3777/4096 [00:09<00:00, 399.10it/s]
Adding requests:  93%|█████████▎| 3819/4096 [00:09<00:00, 404.44it/s]
Adding requests:  94%|█████████▍| 3862/4096 [00:09<00:00, 411.43it/s]
Adding requests:  95%|█████████▌| 3904/4096 [00:09<00:00, 408.03it/s]
Adding requests:  96%|█████████▋| 3946/4096 [00:09<00:00, 410.29it/s]
Adding requests:  97%|█████████▋| 3988/4096 [00:09<00:00, 401.08it/s]
Adding requests:  98%|█████████▊| 4030/4096 [00:09<00:00, 403.72it/s]
Adding requests:  99%|█████████▉| 4071/4096 [00:10<00:00, 403.52it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 404.65it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:00<00:01, 3119.05it/s, est. speed input: 3194416.30 toks/s, output: 3119.19 toks/s]
Processed prompts:  20%|██        | 826/4096 [00:05<00:26, 123.96it/s, est. speed input: 154654.00 toks/s, output: 151.03 toks/s]   
Processed prompts:  23%|██▎       | 958/4096 [00:07<00:32, 97.82it/s, est. speed input: 125252.37 toks/s, output: 122.32 toks/s] 
Processed prompts:  25%|██▌       | 1033/4096 [00:09<00:37, 81.61it/s, est. speed input: 110105.71 toks/s, output: 107.53 toks/s]
Processed prompts:  26%|██▋       | 1080/4096 [00:10<00:37, 80.81it/s, est. speed input: 108095.70 toks/s, output: 105.56 toks/s]
Processed prompts:  27%|██▋       | 1113/4096 [00:10<00:39, 76.09it/s, est. speed input: 104782.98 toks/s, output: 102.33 toks/s]
Processed prompts:  28%|██▊       | 1137/4096 [00:11<00:42, 68.88it/s, est. speed input: 101040.26 toks/s, output: 98.67 toks/s] 
Processed prompts:  28%|██▊       | 1154/4096 [00:12<00:48, 61.06it/s, est. speed input: 97545.47 toks/s, output: 95.26 toks/s] 
Processed prompts:  29%|██▉       | 1186/4096 [00:12<00:48, 59.54it/s, est. speed input: 95580.41 toks/s, output: 93.34 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:13<00:49, 58.22it/s, est. speed input: 93786.47 toks/s, output: 91.59 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:13<00:49, 57.16it/s, est. speed input: 92145.73 toks/s, output: 89.99 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:16<01:41, 27.66it/s, est. speed input: 78172.90 toks/s, output: 76.34 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:17<01:28, 31.35it/s, est. speed input: 77153.08 toks/s, output: 75.34 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:18<01:18, 34.88it/s, est. speed input: 76207.91 toks/s, output: 74.42 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:18<01:11, 38.05it/s, est. speed input: 75324.64 toks/s, output: 73.56 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:19<01:05, 40.76it/s, est. speed input: 74501.34 toks/s, output: 72.76 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:20<01:01, 42.96it/s, est. speed input: 73730.60 toks/s, output: 72.00 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:20<00:58, 44.69it/s, est. speed input: 73008.38 toks/s, output: 71.30 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:21<00:56, 46.00it/s, est. speed input: 72329.83 toks/s, output: 70.63 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:21<00:54, 46.96it/s, est. speed input: 71689.46 toks/s, output: 70.01 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:22<00:51, 48.78it/s, est. speed input: 71247.58 toks/s, output: 69.58 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:23<00:49, 50.22it/s, est. speed input: 70837.79 toks/s, output: 69.18 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:23<00:48, 51.28it/s, est. speed input: 70447.88 toks/s, output: 68.80 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:24<00:46, 52.05it/s, est. speed input: 70077.46 toks/s, output: 68.43 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:24<00:45, 52.61it/s, est. speed input: 69725.02 toks/s, output: 68.09 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:25<00:44, 53.00it/s, est. speed input: 69388.41 toks/s, output: 67.76 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:26<00:43, 53.29it/s, est. speed input: 69068.14 toks/s, output: 67.45 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:26<00:43, 53.49it/s, est. speed input: 68761.39 toks/s, output: 67.15 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:27<00:42, 53.63it/s, est. speed input: 68467.79 toks/s, output: 66.86 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:27<00:41, 54.16it/s, est. speed input: 68226.17 toks/s, output: 66.63 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:28<00:40, 54.10it/s, est. speed input: 67956.28 toks/s, output: 66.36 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:29<00:40, 54.07it/s, est. speed input: 67698.01 toks/s, output: 66.11 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:29<00:39, 54.05it/s, est. speed input: 67450.42 toks/s, output: 65.87 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:30<00:39, 54.04it/s, est. speed input: 67212.64 toks/s, output: 65.64 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:30<00:38, 54.03it/s, est. speed input: 66983.57 toks/s, output: 65.41 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:31<00:37, 54.02it/s, est. speed input: 66763.15 toks/s, output: 65.20 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:32<00:37, 54.01it/s, est. speed input: 66551.00 toks/s, output: 64.99 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:32<00:36, 54.01it/s, est. speed input: 66346.60 toks/s, output: 64.79 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:33<00:36, 54.01it/s, est. speed input: 66149.53 toks/s, output: 64.60 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:33<00:35, 54.01it/s, est. speed input: 65959.52 toks/s, output: 64.41 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:34<00:34, 54.00it/s, est. speed input: 65775.46 toks/s, output: 64.23 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:34<00:34, 54.00it/s, est. speed input: 65597.93 toks/s, output: 64.06 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:35<00:33, 54.43it/s, est. speed input: 65455.11 toks/s, output: 63.92 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:36<00:32, 54.30it/s, est. speed input: 65288.95 toks/s, output: 63.76 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:36<00:32, 54.22it/s, est. speed input: 65128.28 toks/s, output: 63.60 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:37<00:31, 54.15it/s, est. speed input: 64972.18 toks/s, output: 63.45 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:37<00:31, 54.10it/s, est. speed input: 64820.95 toks/s, output: 63.30 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:38<00:30, 54.07it/s, est. speed input: 64674.59 toks/s, output: 63.16 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:39<00:30, 54.06it/s, est. speed input: 64532.79 toks/s, output: 63.02 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:39<00:29, 54.47it/s, est. speed input: 64420.62 toks/s, output: 62.91 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:40<00:28, 54.34it/s, est. speed input: 64286.91 toks/s, output: 62.78 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:40<00:28, 54.24it/s, est. speed input: 64157.03 toks/s, output: 62.65 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:41<00:27, 54.17it/s, est. speed input: 64030.52 toks/s, output: 62.53 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:42<00:27, 54.12it/s, est. speed input: 63907.61 toks/s, output: 62.41 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:42<00:26, 54.08it/s, est. speed input: 63787.80 toks/s, output: 62.29 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:43<00:26, 54.06it/s, est. speed input: 63671.53 toks/s, output: 62.18 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:43<00:25, 54.04it/s, est. speed input: 63558.13 toks/s, output: 62.07 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:44<00:24, 54.02it/s, est. speed input: 63447.95 toks/s, output: 61.96 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:45<00:24, 53.62it/s, est. speed input: 63319.96 toks/s, output: 61.84 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:45<00:24, 52.31it/s, est. speed input: 63141.26 toks/s, output: 61.66 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:46<00:23, 52.10it/s, est. speed input: 63003.72 toks/s, output: 61.53 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:46<00:23, 52.65it/s, est. speed input: 62906.13 toks/s, output: 61.43 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:47<00:22, 53.05it/s, est. speed input: 62811.10 toks/s, output: 61.34 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:48<00:21, 53.33it/s, est. speed input: 62718.52 toks/s, output: 61.25 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:48<00:20, 53.52it/s, est. speed input: 62627.70 toks/s, output: 61.16 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:51<00:44, 24.54it/s, est. speed input: 59682.08 toks/s, output: 58.28 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:52<00:36, 29.15it/s, est. speed input: 59605.01 toks/s, output: 58.21 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:52<00:30, 33.24it/s, est. speed input: 59494.99 toks/s, output: 58.10 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:53<00:26, 36.86it/s, est. speed input: 59388.04 toks/s, output: 58.00 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:54<00:24, 39.91it/s, est. speed input: 59283.60 toks/s, output: 57.89 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:54<00:21, 42.37it/s, est. speed input: 59182.01 toks/s, output: 57.79 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:55<00:20, 44.27it/s, est. speed input: 59082.27 toks/s, output: 57.70 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:56<00:18, 45.71it/s, est. speed input: 58985.18 toks/s, output: 57.60 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:56<00:17, 47.46it/s, est. speed input: 58924.34 toks/s, output: 57.54 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:57<00:16, 49.23it/s, est. speed input: 58886.17 toks/s, output: 57.51 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:57<00:15, 50.57it/s, est. speed input: 58849.18 toks/s, output: 57.47 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:58<00:14, 51.54it/s, est. speed input: 58812.65 toks/s, output: 57.43 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:59<00:13, 52.24it/s, est. speed input: 58776.84 toks/s, output: 57.40 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:59<00:12, 52.74it/s, est. speed input: 58741.84 toks/s, output: 57.37 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:00<00:12, 53.10it/s, est. speed input: 58707.41 toks/s, output: 57.33 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:00<00:11, 53.35it/s, est. speed input: 58673.83 toks/s, output: 57.30 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:01<00:10, 53.53it/s, est. speed input: 58640.66 toks/s, output: 57.27 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:02<00:10, 53.65it/s, est. speed input: 58608.13 toks/s, output: 57.23 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:02<00:09, 53.74it/s, est. speed input: 58576.13 toks/s, output: 57.20 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:03<00:08, 53.81it/s, est. speed input: 58545.41 toks/s, output: 57.17 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:03<00:08, 53.88it/s, est. speed input: 58515.60 toks/s, output: 57.14 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:04<00:07, 53.92it/s, est. speed input: 58486.17 toks/s, output: 57.12 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:05<00:07, 54.38it/s, est. speed input: 58471.28 toks/s, output: 57.10 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:05<00:06, 54.27it/s, est. speed input: 58442.84 toks/s, output: 57.07 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:06<00:05, 54.20it/s, est. speed input: 58414.85 toks/s, output: 57.05 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:06<00:05, 54.16it/s, est. speed input: 58387.84 toks/s, output: 57.02 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:07<00:04, 54.17it/s, est. speed input: 58362.52 toks/s, output: 56.99 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:08<00:04, 54.08it/s, est. speed input: 58334.64 toks/s, output: 56.97 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:08<00:03, 54.06it/s, est. speed input: 58308.48 toks/s, output: 56.94 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:09<00:02, 54.05it/s, est. speed input: 58282.86 toks/s, output: 56.92 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:09<00:02, 54.03it/s, est. speed input: 58257.44 toks/s, output: 56.89 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:10<00:01, 54.03it/s, est. speed input: 58232.60 toks/s, output: 56.87 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:10<00:01, 54.46it/s, est. speed input: 58221.13 toks/s, output: 56.86 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:11<00:00, 54.92it/s, est. speed input: 58214.26 toks/s, output: 56.85 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:11<00:00, 54.92it/s, est. speed input: 58643.32 toks/s, output: 57.27 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:11<00:00, 57.27it/s, est. speed input: 58643.32 toks/s, output: 57.27 toks/s]
[rank0]:[W128 11:09:49.619448606 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 147.7s

测试结果:
  Requests/s:   53.20
  Tokens/s:     54528.27
  Total Reqs:   4096
  Elapsed:      76.99s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     54475.07


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cublaslt/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,15.1850,7789.9184,8.4294
1024,1024,1,128,128,15.6430,16034.1212,8.1826
2048,1024,2,256,128,30.7260,31494.1560,8.3317
4096,1024,4,512,128,46.0035,47153.6012,11.1296
8192,1024,8,1024,128,52.2733,53580.1226,19.5894
16384,1024,16,2048,128,51.9349,53233.3203,39.4339
32768,1024,32,4096,128,53.1983,54528.2674,76.9949

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_4) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_4
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_4

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:09:59 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:10:00 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=8401) WARNING 01-28 11:10:10 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=8401) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=8401) WARNING 01-28 11:10:22 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.85 requests/s, 8642.90 total tokens/s, 16.85 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:09:59] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:09:59] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:09:59] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:09:59] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:09:59] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:09:59] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:09:59] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:09:59] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:09:59] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:09:59] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:09:59] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:09:59] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:09:59] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:09:59] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:10:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:10:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:10:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:10:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:10:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:10:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:10:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:10:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:10:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:11] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:11] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:11] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:11] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:11] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:11] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=8401) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=8401) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.49s/it]
(EngineCore_DP0 pid=8401) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.49s/it]
(EngineCore_DP0 pid=8401) 
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=8401) [2026-01-28 11:10:14] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=8401) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  6.41it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.71it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.66it/s]
(EngineCore_DP0 pid=8401) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.19it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.18it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  44%|████▍     | 56/128 [00:00<00:00, 557.39it/s]
Adding requests:  98%|█████████▊| 125/128 [00:00<00:00, 632.39it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 623.90it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 36.43it/s, est. speed input: 18658.48 toks/s, output: 36.44 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:05, 21.95it/s, est. speed input: 11952.45 toks/s, output: 23.34 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:05, 19.88it/s, est. speed input: 10912.55 toks/s, output: 21.31 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:06, 18.88it/s, est. speed input: 10393.95 toks/s, output: 20.30 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 18.21it/s, est. speed input: 10101.22 toks/s, output: 19.73 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:00<00:06, 17.84it/s, est. speed input: 9918.10 toks/s, output: 19.37 toks/s] 
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 17.66it/s, est. speed input: 9794.27 toks/s, output: 19.13 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.48it/s, est. speed input: 9686.37 toks/s, output: 18.92 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 17.22it/s, est. speed input: 9574.76 toks/s, output: 18.70 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:05, 17.02it/s, est. speed input: 9480.75 toks/s, output: 18.52 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:05, 16.94it/s, est. speed input: 9409.24 toks/s, output: 18.38 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.86it/s, est. speed input: 9345.41 toks/s, output: 18.25 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:02<00:22,  4.18it/s, est. speed input: 5506.58 toks/s, output: 10.75 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:03<00:17,  5.37it/s, est. speed input: 5621.86 toks/s, output: 10.98 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:03<00:13,  6.73it/s, est. speed input: 5729.20 toks/s, output: 11.19 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:03<00:11,  8.17it/s, est. speed input: 5827.24 toks/s, output: 11.38 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:03<00:09,  9.66it/s, est. speed input: 5923.15 toks/s, output: 11.57 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:03<00:07, 11.07it/s, est. speed input: 6012.43 toks/s, output: 11.74 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:03<00:06, 12.31it/s, est. speed input: 6094.56 toks/s, output: 11.90 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:03<00:06, 13.37it/s, est. speed input: 6171.92 toks/s, output: 12.05 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:03<00:05, 14.24it/s, est. speed input: 6245.33 toks/s, output: 12.20 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:04<00:05, 14.85it/s, est. speed input: 6310.99 toks/s, output: 12.33 toks/s]
Processed prompts:  41%|████      | 52/128 [00:04<00:04, 15.33it/s, est. speed input: 6373.91 toks/s, output: 12.45 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:04<00:04, 15.78it/s, est. speed input: 6437.26 toks/s, output: 12.57 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:04<00:04, 15.97it/s, est. speed input: 6491.81 toks/s, output: 12.68 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:04<00:04, 16.18it/s, est. speed input: 6545.90 toks/s, output: 12.78 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:04<00:04, 16.35it/s, est. speed input: 6598.17 toks/s, output: 12.89 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:04<00:04, 16.46it/s, est. speed input: 6647.17 toks/s, output: 12.98 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:04<00:03, 16.57it/s, est. speed input: 6695.08 toks/s, output: 13.08 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:05<00:03, 16.71it/s, est. speed input: 6742.61 toks/s, output: 13.17 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:05<00:03, 16.79it/s, est. speed input: 6787.50 toks/s, output: 13.26 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:05<00:03, 16.82it/s, est. speed input: 6829.55 toks/s, output: 13.34 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:05<00:03, 16.89it/s, est. speed input: 6871.16 toks/s, output: 13.42 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:05<00:03, 16.96it/s, est. speed input: 6911.62 toks/s, output: 13.50 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:05<00:03, 16.98it/s, est. speed input: 6949.49 toks/s, output: 13.57 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:05<00:02, 17.03it/s, est. speed input: 6986.86 toks/s, output: 13.65 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:05<00:02, 17.08it/s, est. speed input: 7022.93 toks/s, output: 13.72 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:05<00:02, 17.05it/s, est. speed input: 7056.00 toks/s, output: 13.78 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:06<00:02, 16.99it/s, est. speed input: 7086.91 toks/s, output: 13.84 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:06<00:02, 16.96it/s, est. speed input: 7116.78 toks/s, output: 13.90 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:06<00:02, 17.05it/s, est. speed input: 7148.45 toks/s, output: 13.96 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:06<00:02, 17.00it/s, est. speed input: 7175.87 toks/s, output: 14.02 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:06<00:02, 16.99it/s, est. speed input: 7203.31 toks/s, output: 14.07 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:06<00:01, 17.10it/s, est. speed input: 7232.36 toks/s, output: 14.13 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:06<00:01, 17.05it/s, est. speed input: 7257.48 toks/s, output: 14.17 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:06<00:01, 16.93it/s, est. speed input: 7279.72 toks/s, output: 14.22 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:07<00:01, 16.98it/s, est. speed input: 7304.18 toks/s, output: 14.27 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:07<00:01, 16.96it/s, est. speed input: 7326.82 toks/s, output: 14.31 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:07<00:01, 17.07it/s, est. speed input: 7351.36 toks/s, output: 14.36 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:07<00:01, 17.35it/s, est. speed input: 7379.75 toks/s, output: 14.41 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:07<00:01, 17.54it/s, est. speed input: 7407.19 toks/s, output: 14.47 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:07<00:01, 17.69it/s, est. speed input: 7434.02 toks/s, output: 14.52 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:07<00:00, 17.74it/s, est. speed input: 7458.86 toks/s, output: 14.57 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:07<00:00, 17.67it/s, est. speed input: 7480.84 toks/s, output: 14.61 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 17.69it/s, est. speed input: 7503.70 toks/s, output: 14.66 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:08<00:00, 17.68it/s, est. speed input: 7525.41 toks/s, output: 14.70 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:08<00:00, 17.61it/s, est. speed input: 7545.28 toks/s, output: 14.74 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:08<00:00, 17.62it/s, est. speed input: 7565.61 toks/s, output: 14.78 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:08<00:00, 17.64it/s, est. speed input: 7585.78 toks/s, output: 14.82 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:08<00:00, 17.62it/s, est. speed input: 7604.65 toks/s, output: 14.85 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 17.45it/s, est. speed input: 7620.07 toks/s, output: 14.88 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 17.45it/s, est. speed input: 7620.07 toks/s, output: 14.88 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 14.88it/s, est. speed input: 7620.07 toks/s, output: 14.88 toks/s]
[rank0]:[W128 11:10:43.842051730 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 53.7s

测试结果:
  Requests/s:   16.85
  Tokens/s:     8642.90
  Total Reqs:   128
  Elapsed:      7.60s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8626.05

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:10:53 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:10:53 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=8954) WARNING 01-28 11:11:00 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=8954) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=8954) WARNING 01-28 11:11:12 [backends.py:609] Failed to read file <frozen os>
Throughput: 17.33 requests/s, 17760.25 total tokens/s, 17.33 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:10:52] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:10:52] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:10:52] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:10:52] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:52] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:52] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:52] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:52] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:52] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:10:52] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:10:52] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:10:52] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:10:52] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:10:52] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:10:59] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:10:59] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:10:59] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:10:59] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:59] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:59] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:59] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:59] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:10:59] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:10:59] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:10:59] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:10:59] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:10:59] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:10:59] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:00] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:00] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:00] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:00] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:00] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:00] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=8954) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=8954) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.04it/s]
(EngineCore_DP0 pid=8954) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.04it/s]
(EngineCore_DP0 pid=8954) 
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=8954) [2026-01-28 11:11:01] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=8954) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  6.47it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.54it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.35it/s]
(EngineCore_DP0 pid=8954) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.56it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.55it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  28%|██▊       | 36/128 [00:00<00:00, 355.34it/s]
Adding requests:  60%|██████    | 77/128 [00:00<00:00, 383.81it/s]
Adding requests:  91%|█████████ | 116/128 [00:00<00:00, 372.10it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 371.57it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:02, 45.22it/s, est. speed input: 46311.92 toks/s, output: 45.22 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:04, 24.38it/s, est. speed input: 27158.38 toks/s, output: 26.52 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:05, 21.74it/s, est. speed input: 24575.63 toks/s, output: 24.00 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:00<00:05, 20.20it/s, est. speed input: 23103.64 toks/s, output: 22.56 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:00<00:05, 19.23it/s, est. speed input: 22142.20 toks/s, output: 21.62 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:05, 18.77it/s, est. speed input: 21672.24 toks/s, output: 21.16 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 18.45it/s, est. speed input: 21318.44 toks/s, output: 20.82 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 18.18it/s, est. speed input: 21014.28 toks/s, output: 20.52 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.93it/s, est. speed input: 20748.43 toks/s, output: 20.26 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 17.82it/s, est. speed input: 20541.37 toks/s, output: 20.06 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 17.71it/s, est. speed input: 20354.88 toks/s, output: 19.88 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 17.66it/s, est. speed input: 20201.70 toks/s, output: 19.73 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:01<00:05, 17.65it/s, est. speed input: 20071.57 toks/s, output: 19.60 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 17.66it/s, est. speed input: 19960.12 toks/s, output: 19.49 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:04, 17.62it/s, est. speed input: 19852.94 toks/s, output: 19.39 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:04, 17.64it/s, est. speed input: 19763.23 toks/s, output: 19.30 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 17.61it/s, est. speed input: 19676.82 toks/s, output: 19.22 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 17.65it/s, est. speed input: 19607.39 toks/s, output: 19.15 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 17.65it/s, est. speed input: 19538.91 toks/s, output: 19.08 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:02<00:04, 17.58it/s, est. speed input: 19466.67 toks/s, output: 19.01 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:02<00:04, 17.60it/s, est. speed input: 19410.36 toks/s, output: 18.96 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:02<00:04, 17.59it/s, est. speed input: 19354.40 toks/s, output: 18.90 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 17.50it/s, est. speed input: 19291.82 toks/s, output: 18.84 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:03, 17.54it/s, est. speed input: 19247.49 toks/s, output: 18.80 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 17.53it/s, est. speed input: 19200.62 toks/s, output: 18.75 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 17.48it/s, est. speed input: 19152.70 toks/s, output: 18.70 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 17.42it/s, est. speed input: 19104.10 toks/s, output: 18.66 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 17.38it/s, est. speed input: 19058.96 toks/s, output: 18.61 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:03<00:03, 17.35it/s, est. speed input: 19016.87 toks/s, output: 18.57 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:03<00:03, 17.36it/s, est. speed input: 18979.65 toks/s, output: 18.53 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:03<00:03, 17.41it/s, est. speed input: 18950.60 toks/s, output: 18.51 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 17.47it/s, est. speed input: 18925.02 toks/s, output: 18.48 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:02, 17.47it/s, est. speed input: 18896.78 toks/s, output: 18.45 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 17.46it/s, est. speed input: 18868.38 toks/s, output: 18.43 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 17.51it/s, est. speed input: 18847.28 toks/s, output: 18.41 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 17.51it/s, est. speed input: 18824.63 toks/s, output: 18.38 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:04<00:02, 17.47it/s, est. speed input: 18798.31 toks/s, output: 18.36 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:04<00:02, 17.51it/s, est. speed input: 18780.40 toks/s, output: 18.34 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:04<00:02, 17.56it/s, est. speed input: 18764.50 toks/s, output: 18.32 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:04<00:02, 17.62it/s, est. speed input: 18751.02 toks/s, output: 18.31 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:01, 17.66it/s, est. speed input: 18738.84 toks/s, output: 18.30 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 17.79it/s, est. speed input: 18734.40 toks/s, output: 18.30 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 17.83it/s, est. speed input: 18726.08 toks/s, output: 18.29 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 17.89it/s, est. speed input: 18720.60 toks/s, output: 18.28 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 17.82it/s, est. speed input: 18707.54 toks/s, output: 18.27 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:05<00:01, 17.80it/s, est. speed input: 18696.81 toks/s, output: 18.26 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:05<00:01, 17.83it/s, est. speed input: 18690.04 toks/s, output: 18.25 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:05<00:01, 17.86it/s, est. speed input: 18683.94 toks/s, output: 18.25 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:05<00:01, 17.87it/s, est. speed input: 18677.23 toks/s, output: 18.24 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:00, 17.85it/s, est. speed input: 18668.64 toks/s, output: 18.23 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 17.85it/s, est. speed input: 18661.48 toks/s, output: 18.22 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 17.83it/s, est. speed input: 18653.48 toks/s, output: 18.22 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 17.84it/s, est. speed input: 18647.16 toks/s, output: 18.21 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 17.83it/s, est. speed input: 18640.14 toks/s, output: 18.20 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:06<00:00, 17.79it/s, est. speed input: 18631.50 toks/s, output: 18.19 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:06<00:00, 17.84it/s, est. speed input: 18627.42 toks/s, output: 18.19 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:06<00:00, 17.88it/s, est. speed input: 18623.73 toks/s, output: 18.19 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:06<00:00, 17.88it/s, est. speed input: 18618.67 toks/s, output: 18.18 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.88it/s, est. speed input: 18614.68 toks/s, output: 18.18 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 18.18it/s, est. speed input: 18614.68 toks/s, output: 18.18 toks/s]
[rank0]:[W128 11:11:31.156636928 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 47.5s

测试结果:
  Requests/s:   17.33
  Tokens/s:     17760.25
  Total Reqs:   128
  Elapsed:      7.39s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     17742.92

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:11:41 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:11:42 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=9470) WARNING 01-28 11:11:51 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=9470) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=9470) WARNING 01-28 11:12:00 [backends.py:609] Failed to read file <frozen os>
Throughput: 34.27 requests/s, 35128.95 total tokens/s, 34.27 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:11:41] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:11:41] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:11:41] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:11:41] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:41] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:41] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:41] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:41] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:41] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:11:41] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:11:41] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:11:41] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:11:41] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:11:41] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:11:50] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:11:50] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:11:50] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:11:50] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:50] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:50] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:50] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:50] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:11:50] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:11:50] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:11:50] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:11:50] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:11:50] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:11:50] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:51] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:51] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:51] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:51] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:51] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:51] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=9470) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=9470) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.03it/s]
(EngineCore_DP0 pid=9470) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.03it/s]
(EngineCore_DP0 pid=9470) 
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=9470) [2026-01-28 11:11:52] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=9470) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  8.32it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.89it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  8.23it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  8.34it/s]
(EngineCore_DP0 pid=9470) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.69it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.71it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.53it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  15%|█▍        | 38/256 [00:00<00:00, 371.28it/s]
Adding requests:  31%|███       | 79/256 [00:00<00:00, 391.81it/s]
Adding requests:  46%|████▋     | 119/256 [00:00<00:00, 392.87it/s]
Adding requests:  62%|██████▏   | 159/256 [00:00<00:00, 393.01it/s]
Adding requests:  78%|███████▊  | 199/256 [00:00<00:00, 385.24it/s]
Adding requests:  94%|█████████▍| 241/256 [00:00<00:00, 393.64it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 391.05it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   9%|▊         | 22/256 [00:00<00:01, 142.39it/s, est. speed input: 145839.07 toks/s, output: 142.40 toks/s]
Processed prompts:  14%|█▍        | 37/256 [00:00<00:03, 59.67it/s, est. speed input: 68165.40 toks/s, output: 66.57 toks/s]   
Processed prompts:  18%|█▊        | 46/256 [00:00<00:04, 46.54it/s, est. speed input: 55430.50 toks/s, output: 54.13 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:04, 42.95it/s, est. speed input: 51823.58 toks/s, output: 50.61 toks/s]
Processed prompts:  22%|██▏       | 57/256 [00:01<00:04, 42.83it/s, est. speed input: 50954.16 toks/s, output: 49.76 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 38.20it/s, est. speed input: 47951.47 toks/s, output: 46.83 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 37.09it/s, est. speed input: 46809.99 toks/s, output: 45.71 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 36.13it/s, est. speed input: 45824.62 toks/s, output: 44.75 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:01<00:05, 35.47it/s, est. speed input: 45015.47 toks/s, output: 43.96 toks/s]
Processed prompts:  30%|███       | 78/256 [00:01<00:05, 35.00it/s, est. speed input: 44326.20 toks/s, output: 43.29 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:01<00:05, 34.49it/s, est. speed input: 43678.13 toks/s, output: 42.65 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:04, 34.23it/s, est. speed input: 43135.02 toks/s, output: 42.12 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:04, 34.63it/s, est. speed input: 42792.13 toks/s, output: 41.79 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:04, 35.08it/s, est. speed input: 42514.83 toks/s, output: 41.52 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 35.21it/s, est. speed input: 42224.80 toks/s, output: 41.23 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 35.48it/s, est. speed input: 41993.12 toks/s, output: 41.01 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:02<00:04, 35.72it/s, est. speed input: 41787.80 toks/s, output: 40.81 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:02<00:04, 35.84it/s, est. speed input: 41592.33 toks/s, output: 40.62 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:02<00:03, 35.89it/s, est. speed input: 41405.82 toks/s, output: 40.44 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:02<00:03, 35.99it/s, est. speed input: 41244.14 toks/s, output: 40.28 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:03<00:03, 36.05it/s, est. speed input: 41092.16 toks/s, output: 40.13 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:03<00:03, 36.20it/s, est. speed input: 40965.02 toks/s, output: 40.00 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:03<00:03, 35.95it/s, est. speed input: 40801.57 toks/s, output: 39.84 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:03<00:03, 35.78it/s, est. speed input: 40647.77 toks/s, output: 39.69 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:03<00:03, 35.64it/s, est. speed input: 40502.83 toks/s, output: 39.55 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:03<00:03, 35.62it/s, est. speed input: 40375.28 toks/s, output: 39.43 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:03<00:03, 35.64it/s, est. speed input: 40259.20 toks/s, output: 39.32 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:03<00:02, 35.67it/s, est. speed input: 40151.98 toks/s, output: 39.21 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:03<00:02, 35.73it/s, est. speed input: 40055.47 toks/s, output: 39.12 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:04<00:02, 35.77it/s, est. speed input: 39963.70 toks/s, output: 39.03 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:04<00:02, 35.64it/s, est. speed input: 39860.66 toks/s, output: 38.93 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:04<00:02, 35.58it/s, est. speed input: 39766.95 toks/s, output: 38.83 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:04<00:02, 35.60it/s, est. speed input: 39682.74 toks/s, output: 38.75 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:04<00:02, 35.58it/s, est. speed input: 39600.81 toks/s, output: 38.67 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:04<00:02, 35.63it/s, est. speed input: 39528.20 toks/s, output: 38.60 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:04<00:02, 35.52it/s, est. speed input: 39446.46 toks/s, output: 38.52 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:04<00:01, 35.38it/s, est. speed input: 39362.74 toks/s, output: 38.44 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:04<00:01, 35.12it/s, est. speed input: 39268.63 toks/s, output: 38.35 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:05<00:01, 35.26it/s, est. speed input: 39206.10 toks/s, output: 38.29 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:05<00:01, 35.37it/s, est. speed input: 39146.93 toks/s, output: 38.23 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:05<00:01, 35.45it/s, est. speed input: 39090.40 toks/s, output: 38.17 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:05<00:01, 35.43it/s, est. speed input: 39030.80 toks/s, output: 38.12 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:05<00:01, 35.44it/s, est. speed input: 38975.16 toks/s, output: 38.06 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:05<00:01, 35.48it/s, est. speed input: 38924.62 toks/s, output: 38.01 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:05<00:01, 35.59it/s, est. speed input: 38881.06 toks/s, output: 37.97 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:05<00:00, 35.65it/s, est. speed input: 38838.88 toks/s, output: 37.93 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:05<00:00, 35.72it/s, est. speed input: 38799.29 toks/s, output: 37.89 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:06<00:00, 35.73it/s, est. speed input: 38759.47 toks/s, output: 37.85 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:06<00:00, 35.20it/s, est. speed input: 38685.17 toks/s, output: 37.78 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:06<00:00, 35.23it/s, est. speed input: 38639.54 toks/s, output: 37.73 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:06<00:00, 35.33it/s, est. speed input: 38600.82 toks/s, output: 37.70 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:06<00:00, 35.36it/s, est. speed input: 38560.68 toks/s, output: 37.66 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:06<00:00, 35.45it/s, est. speed input: 38526.02 toks/s, output: 37.62 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:06<00:00, 35.57it/s, est. speed input: 38496.26 toks/s, output: 37.59 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 35.57it/s, est. speed input: 38474.90 toks/s, output: 37.57 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 37.57it/s, est. speed input: 38474.90 toks/s, output: 37.57 toks/s]
[rank0]:[W128 11:12:19.273319077 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.1s

测试结果:
  Requests/s:   34.27
  Tokens/s:     35128.95
  Total Reqs:   256
  Elapsed:      7.47s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     35094.68

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:12:33 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:12:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=10008) WARNING 01-28 11:12:41 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=10008) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=10008) WARNING 01-28 11:12:50 [backends.py:609] Failed to read file <frozen os>
Throughput: 65.86 requests/s, 67509.83 total tokens/s, 65.86 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:12:33] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:12:33] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:12:33] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:12:33] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:33] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:33] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:33] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:33] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:33] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:12:33] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:12:33] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:12:33] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:12:33] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:12:33] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:12:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:12:40] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:12:40] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:12:40] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:40] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:40] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:40] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:40] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:12:40] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:12:40] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:12:40] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:12:40] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:12:40] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:12:40] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:41] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:41] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:41] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:41] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:41] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:41] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=10008) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=10008) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.02it/s]
(EngineCore_DP0 pid=10008) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.02it/s]
(EngineCore_DP0 pid=10008) 
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=10008) [2026-01-28 11:12:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=10008) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  8.32it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.98it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  9.25it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.49it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.65it/s]
(EngineCore_DP0 pid=10008) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.76it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.83it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  9.18it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.95it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   8%|▊         | 39/512 [00:00<00:01, 383.98it/s]
Adding requests:  15%|█▌        | 79/512 [00:00<00:01, 391.96it/s]
Adding requests:  23%|██▎       | 120/512 [00:00<00:00, 397.47it/s]
Adding requests:  31%|███▏      | 160/512 [00:00<00:00, 396.59it/s]
Adding requests:  39%|███▉      | 200/512 [00:00<00:00, 390.69it/s]
Adding requests:  47%|████▋     | 241/512 [00:00<00:00, 394.20it/s]
Adding requests:  55%|█████▍    | 281/512 [00:00<00:00, 393.38it/s]
Adding requests:  63%|██████▎   | 321/512 [00:00<00:00, 392.85it/s]
Adding requests:  71%|███████   | 363/512 [00:00<00:00, 399.47it/s]
Adding requests:  79%|███████▉  | 404/512 [00:01<00:00, 400.33it/s]
Adding requests:  87%|████████▋ | 445/512 [00:01<00:00, 400.75it/s]
Adding requests:  95%|█████████▍| 486/512 [00:01<00:00, 402.53it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 397.02it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 62/512 [00:00<00:00, 534.06it/s, est. speed input: 546982.37 toks/s, output: 534.09 toks/s]
Processed prompts:  23%|██▎       | 116/512 [00:00<00:03, 121.14it/s, est. speed input: 141605.52 toks/s, output: 138.29 toks/s]
Processed prompts:  28%|██▊       | 143/512 [00:01<00:03, 99.79it/s, est. speed input: 119065.89 toks/s, output: 116.27 toks/s] 
Processed prompts:  31%|███▏      | 161/512 [00:01<00:03, 94.63it/s, est. speed input: 113193.25 toks/s, output: 110.54 toks/s]
Processed prompts:  34%|███▍      | 175/512 [00:01<00:03, 86.28it/s, est. speed input: 106710.64 toks/s, output: 104.21 toks/s]
Processed prompts:  37%|███▋      | 187/512 [00:01<00:03, 83.14it/s, est. speed input: 103728.12 toks/s, output: 101.30 toks/s]
Processed prompts:  38%|███▊      | 197/512 [00:01<00:03, 84.18it/s, est. speed input: 103011.82 toks/s, output: 100.60 toks/s]
Processed prompts:  40%|████      | 207/512 [00:02<00:03, 77.44it/s, est. speed input: 99667.42 toks/s, output: 97.33 toks/s]  
Processed prompts:  42%|████▏     | 216/512 [00:02<00:03, 77.89it/s, est. speed input: 98753.71 toks/s, output: 96.44 toks/s]
Processed prompts:  44%|████▍     | 225/512 [00:02<00:03, 78.44it/s, est. speed input: 97968.04 toks/s, output: 95.67 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:02<00:03, 70.37it/s, est. speed input: 95108.38 toks/s, output: 92.88 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:02<00:03, 70.80it/s, est. speed input: 94214.51 toks/s, output: 92.01 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:02<00:03, 70.56it/s, est. speed input: 93269.03 toks/s, output: 91.08 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:02<00:03, 70.39it/s, est. speed input: 92402.54 toks/s, output: 90.24 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:02<00:03, 70.29it/s, est. speed input: 91608.02 toks/s, output: 89.46 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:03<00:03, 70.29it/s, est. speed input: 90885.08 toks/s, output: 88.75 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:03<00:03, 70.21it/s, est. speed input: 90199.89 toks/s, output: 88.09 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:03<00:03, 70.25it/s, est. speed input: 89576.39 toks/s, output: 87.48 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:03<00:03, 69.90it/s, est. speed input: 88940.81 toks/s, output: 86.86 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:03<00:02, 69.80it/s, est. speed input: 88365.76 toks/s, output: 86.29 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:03<00:02, 69.96it/s, est. speed input: 87858.31 toks/s, output: 85.80 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:03<00:02, 69.96it/s, est. speed input: 87366.96 toks/s, output: 85.32 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:03<00:02, 69.57it/s, est. speed input: 86855.92 toks/s, output: 84.82 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:04<00:02, 69.33it/s, est. speed input: 86379.67 toks/s, output: 84.35 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:04<00:02, 68.79it/s, est. speed input: 85886.22 toks/s, output: 83.87 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:04<00:02, 68.81it/s, est. speed input: 85465.13 toks/s, output: 83.46 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:04<00:02, 69.13it/s, est. speed input: 85099.88 toks/s, output: 83.10 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:04<00:02, 69.37it/s, est. speed input: 84754.47 toks/s, output: 82.77 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:04<00:01, 69.63it/s, est. speed input: 84435.56 toks/s, output: 82.46 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:04<00:01, 69.75it/s, est. speed input: 84126.26 toks/s, output: 82.15 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:04<00:01, 69.84it/s, est. speed input: 83832.17 toks/s, output: 81.87 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:04<00:01, 69.73it/s, est. speed input: 83535.71 toks/s, output: 81.58 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:05<00:01, 69.79it/s, est. speed input: 83264.67 toks/s, output: 81.31 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:05<00:01, 69.62it/s, est. speed input: 82987.61 toks/s, output: 81.04 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:05<00:01, 69.64it/s, est. speed input: 82734.26 toks/s, output: 80.79 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:05<00:01, 69.65it/s, est. speed input: 82491.91 toks/s, output: 80.56 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:05<00:01, 69.35it/s, est. speed input: 82234.07 toks/s, output: 80.31 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:05<00:00, 69.47it/s, est. speed input: 82013.00 toks/s, output: 80.09 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:05<00:00, 69.65it/s, est. speed input: 81809.01 toks/s, output: 79.89 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:05<00:00, 69.76it/s, est. speed input: 81611.29 toks/s, output: 79.70 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:05<00:00, 69.77it/s, est. speed input: 81416.12 toks/s, output: 79.51 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:06<00:00, 69.90it/s, est. speed input: 81237.29 toks/s, output: 79.33 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:06<00:00, 69.88it/s, est. speed input: 81057.33 toks/s, output: 79.16 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:06<00:00, 69.54it/s, est. speed input: 80860.88 toks/s, output: 78.97 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:06<00:00, 69.39it/s, est. speed input: 80677.79 toks/s, output: 78.79 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:06<00:00, 69.39it/s, est. speed input: 80878.00 toks/s, output: 78.98 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:06<00:00, 78.98it/s, est. speed input: 80878.00 toks/s, output: 78.98 toks/s]
[rank0]:[W128 11:13:12.191118281 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 50.2s

测试结果:
  Requests/s:   65.86
  Tokens/s:     67509.83
  Total Reqs:   512
  Elapsed:      7.77s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     67443.97

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:13:26 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:13:27 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=10571) WARNING 01-28 11:13:36 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=10571) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=10571) WARNING 01-28 11:13:45 [backends.py:609] Failed to read file <frozen os>
Throughput: 68.58 requests/s, 70299.44 total tokens/s, 68.58 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:13:26] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:13:26] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:13:26] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:13:26] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:26] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:26] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:26] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:26] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:26] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:13:26] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:13:26] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:13:26] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:13:26] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:13:26] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:13:35] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:13:35] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:13:35] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:13:35] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:35] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:35] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:35] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:35] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:13:35] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:13:35] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:13:35] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:13:35] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:13:35] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:13:35] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:36] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:36] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:36] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:36] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:36] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:36] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=10571) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=10571) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.04it/s]
(EngineCore_DP0 pid=10571) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.04it/s]
(EngineCore_DP0 pid=10571) 
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=10571) [2026-01-28 11:13:37] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=10571) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  7.69it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  8.26it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  8.77it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  9.00it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.37it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.45it/s]
(EngineCore_DP0 pid=10571) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.69it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.77it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  8.89it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.88it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.76it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 34/1024 [00:00<00:02, 337.01it/s]
Adding requests:   7%|▋         | 75/1024 [00:00<00:02, 376.25it/s]
Adding requests:  11%|█▏        | 116/1024 [00:00<00:02, 390.34it/s]
Adding requests:  15%|█▌        | 156/1024 [00:00<00:02, 388.57it/s]
Adding requests:  19%|█▉        | 195/1024 [00:00<00:02, 386.35it/s]
Adding requests:  23%|██▎       | 236/1024 [00:00<00:02, 393.84it/s]
Adding requests:  27%|██▋       | 277/1024 [00:00<00:01, 396.50it/s]
Adding requests:  31%|███       | 317/1024 [00:00<00:01, 392.69it/s]
Adding requests:  35%|███▍      | 358/1024 [00:00<00:01, 396.65it/s]
Adding requests:  39%|███▉      | 398/1024 [00:01<00:01, 394.45it/s]
Adding requests:  43%|████▎     | 438/1024 [00:01<00:01, 390.17it/s]
Adding requests:  47%|████▋     | 478/1024 [00:01<00:01, 390.21it/s]
Adding requests:  51%|█████     | 518/1024 [00:01<00:01, 387.57it/s]
Adding requests:  54%|█████▍    | 557/1024 [00:01<00:01, 387.62it/s]
Adding requests:  58%|█████▊    | 599/1024 [00:01<00:01, 394.47it/s]
Adding requests:  63%|██████▎   | 641/1024 [00:01<00:00, 400.79it/s]
Adding requests:  67%|██████▋   | 683/1024 [00:01<00:00, 405.69it/s]
Adding requests:  71%|███████   | 724/1024 [00:01<00:00, 401.60it/s]
Adding requests:  75%|███████▍  | 765/1024 [00:01<00:00, 401.03it/s]
Adding requests:  79%|███████▊  | 806/1024 [00:02<00:00, 391.75it/s]
Adding requests:  83%|████████▎ | 846/1024 [00:02<00:00, 389.35it/s]
Adding requests:  87%|████████▋ | 888/1024 [00:02<00:00, 396.41it/s]
Adding requests:  91%|█████████ | 930/1024 [00:02<00:00, 402.58it/s]
Adding requests:  95%|█████████▍| 972/1024 [00:02<00:00, 405.75it/s]
Adding requests:  99%|█████████▉| 1014/1024 [00:02<00:00, 409.94it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 396.15it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  17%|█▋        | 170/1024 [00:00<00:00, 1244.18it/s, est. speed input: 1274237.47 toks/s, output: 1244.24 toks/s]
Processed prompts:  29%|██▉       | 295/1024 [00:01<00:05, 135.61it/s, est. speed input: 164145.14 toks/s, output: 160.30 toks/s]   
Processed prompts:  34%|███▍      | 351/1024 [00:02<00:06, 110.87it/s, est. speed input: 136848.11 toks/s, output: 133.64 toks/s]
Processed prompts:  38%|███▊      | 385/1024 [00:03<00:06, 102.15it/s, est. speed input: 127938.29 toks/s, output: 124.94 toks/s]
Processed prompts:  40%|███▉      | 409/1024 [00:03<00:06, 95.31it/s, est. speed input: 122172.80 toks/s, output: 119.31 toks/s] 
Processed prompts:  42%|████▏     | 427/1024 [00:03<00:07, 83.95it/s, est. speed input: 115050.99 toks/s, output: 112.35 toks/s]
Processed prompts:  43%|████▎     | 441/1024 [00:03<00:06, 86.90it/s, est. speed input: 115055.13 toks/s, output: 112.36 toks/s]
Processed prompts:  44%|████▍     | 454/1024 [00:06<00:22, 25.24it/s, est. speed input: 71572.55 toks/s, output: 69.90 toks/s]  
Processed prompts:  45%|████▌     | 463/1024 [00:06<00:20, 27.58it/s, est. speed input: 71625.55 toks/s, output: 69.95 toks/s]
Processed prompts:  46%|████▌     | 472/1024 [00:06<00:18, 30.55it/s, est. speed input: 71675.20 toks/s, output: 70.00 toks/s]
Processed prompts:  47%|████▋     | 480/1024 [00:06<00:16, 33.47it/s, est. speed input: 71576.75 toks/s, output: 69.90 toks/s]
Processed prompts:  48%|████▊     | 488/1024 [00:06<00:14, 36.87it/s, est. speed input: 71478.79 toks/s, output: 69.80 toks/s]
Processed prompts:  48%|████▊     | 496/1024 [00:07<00:13, 40.58it/s, est. speed input: 71378.45 toks/s, output: 69.71 toks/s]
Processed prompts:  49%|████▉     | 503/1024 [00:07<00:12, 43.12it/s, est. speed input: 71141.22 toks/s, output: 69.47 toks/s]
Processed prompts:  50%|████▉     | 510/1024 [00:07<00:11, 45.62it/s, est. speed input: 70915.66 toks/s, output: 69.25 toks/s]
Processed prompts:  50%|█████     | 517/1024 [00:07<00:10, 47.86it/s, est. speed input: 70693.33 toks/s, output: 69.04 toks/s]
Processed prompts:  51%|█████     | 524/1024 [00:07<00:10, 49.83it/s, est. speed input: 70481.26 toks/s, output: 68.83 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:09, 49.48it/s, est. speed input: 70147.12 toks/s, output: 68.50 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:07<00:09, 53.70it/s, est. speed input: 70104.09 toks/s, output: 68.46 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:07<00:08, 57.97it/s, est. speed input: 70131.96 toks/s, output: 68.49 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:08<00:07, 61.23it/s, est. speed input: 70154.88 toks/s, output: 68.51 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:08<00:07, 63.75it/s, est. speed input: 70180.48 toks/s, output: 68.54 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:08<00:06, 65.57it/s, est. speed input: 70203.33 toks/s, output: 68.56 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:08<00:06, 66.89it/s, est. speed input: 70225.40 toks/s, output: 68.58 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:06, 67.93it/s, est. speed input: 70251.25 toks/s, output: 68.60 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:08<00:06, 68.64it/s, est. speed input: 70274.48 toks/s, output: 68.63 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:08<00:06, 69.18it/s, est. speed input: 70298.91 toks/s, output: 68.65 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:08<00:05, 69.51it/s, est. speed input: 70320.58 toks/s, output: 68.67 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:08<00:05, 69.75it/s, est. speed input: 70341.86 toks/s, output: 68.69 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:09<00:05, 69.91it/s, est. speed input: 70362.23 toks/s, output: 68.71 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:09<00:05, 69.97it/s, est. speed input: 70379.72 toks/s, output: 68.73 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:05, 70.06it/s, est. speed input: 70399.10 toks/s, output: 68.75 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:09<00:05, 70.09it/s, est. speed input: 70416.39 toks/s, output: 68.77 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:09<00:05, 70.19it/s, est. speed input: 70436.60 toks/s, output: 68.79 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:09<00:05, 70.27it/s, est. speed input: 70456.50 toks/s, output: 68.81 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:09<00:04, 70.31it/s, est. speed input: 70475.45 toks/s, output: 68.82 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:09<00:04, 70.30it/s, est. speed input: 70492.48 toks/s, output: 68.84 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:10<00:04, 70.24it/s, est. speed input: 70507.12 toks/s, output: 68.85 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:10<00:04, 70.18it/s, est. speed input: 70520.91 toks/s, output: 68.87 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:10<00:04, 70.17it/s, est. speed input: 70535.33 toks/s, output: 68.88 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:10<00:04, 70.19it/s, est. speed input: 70550.67 toks/s, output: 68.90 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:10<00:04, 70.25it/s, est. speed input: 70567.38 toks/s, output: 68.91 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:10<00:04, 70.28it/s, est. speed input: 70583.20 toks/s, output: 68.93 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:10<00:04, 70.31it/s, est. speed input: 70598.82 toks/s, output: 68.94 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:10<00:03, 70.28it/s, est. speed input: 70612.50 toks/s, output: 68.96 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:10<00:03, 70.29it/s, est. speed input: 70627.03 toks/s, output: 68.97 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:11<00:03, 70.30it/s, est. speed input: 70641.26 toks/s, output: 68.99 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:11<00:03, 70.22it/s, est. speed input: 70652.29 toks/s, output: 69.00 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:11<00:03, 70.18it/s, est. speed input: 70663.71 toks/s, output: 69.01 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:11<00:03, 70.18it/s, est. speed input: 70675.75 toks/s, output: 69.02 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:11<00:03, 70.26it/s, est. speed input: 70690.22 toks/s, output: 69.03 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:11<00:03, 70.27it/s, est. speed input: 70702.69 toks/s, output: 69.05 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:11<00:03, 70.30it/s, est. speed input: 70716.04 toks/s, output: 69.06 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:11<00:02, 70.34it/s, est. speed input: 70729.57 toks/s, output: 69.07 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:11<00:02, 70.33it/s, est. speed input: 70741.58 toks/s, output: 69.08 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:12<00:02, 70.28it/s, est. speed input: 70751.97 toks/s, output: 69.09 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:12<00:02, 70.27it/s, est. speed input: 70763.15 toks/s, output: 69.10 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:12<00:02, 70.21it/s, est. speed input: 70772.15 toks/s, output: 69.11 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:12<00:02, 70.23it/s, est. speed input: 70783.13 toks/s, output: 69.12 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:12<00:02, 70.28it/s, est. speed input: 70794.86 toks/s, output: 69.14 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:12<00:02, 70.28it/s, est. speed input: 70805.53 toks/s, output: 69.15 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:12<00:02, 70.18it/s, est. speed input: 70812.71 toks/s, output: 69.15 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:12<00:01, 70.19it/s, est. speed input: 70822.31 toks/s, output: 69.16 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:12<00:01, 70.17it/s, est. speed input: 70830.97 toks/s, output: 69.17 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:13<00:01, 70.15it/s, est. speed input: 70839.34 toks/s, output: 69.18 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:13<00:01, 70.19it/s, est. speed input: 70848.99 toks/s, output: 69.19 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:13<00:01, 70.16it/s, est. speed input: 70856.96 toks/s, output: 69.20 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:13<00:01, 70.16it/s, est. speed input: 70865.34 toks/s, output: 69.20 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:13<00:01, 70.13it/s, est. speed input: 70872.83 toks/s, output: 69.21 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:13<00:01, 70.14it/s, est. speed input: 70880.91 toks/s, output: 69.22 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:13<00:00, 70.24it/s, est. speed input: 70891.35 toks/s, output: 69.23 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:13<00:00, 70.29it/s, est. speed input: 70901.21 toks/s, output: 69.24 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:14<00:00, 70.25it/s, est. speed input: 70908.79 toks/s, output: 69.25 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:14<00:00, 70.22it/s, est. speed input: 70916.35 toks/s, output: 69.25 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:14<00:00, 72.41it/s, est. speed input: 70981.63 toks/s, output: 69.32 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:14<00:00, 71.79it/s, est. speed input: 70990.30 toks/s, output: 69.33 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:14<00:00, 71.31it/s, est. speed input: 70997.40 toks/s, output: 69.33 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:14<00:00, 70.99it/s, est. speed input: 71004.74 toks/s, output: 69.34 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:14<00:00, 73.38it/s, est. speed input: 71076.97 toks/s, output: 69.41 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:14<00:00, 73.38it/s, est. speed input: 71494.69 toks/s, output: 69.82 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:14<00:00, 69.82it/s, est. speed input: 71494.69 toks/s, output: 69.82 toks/s]
[rank0]:[W128 11:14:15.432488833 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 62.8s

测试结果:
  Requests/s:   68.58
  Tokens/s:     70299.44
  Total Reqs:   1024
  Elapsed:      14.93s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     70230.85

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:14:34 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:14:35 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=11362) WARNING 01-28 11:14:44 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=11362) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=11362) WARNING 01-28 11:14:54 [backends.py:609] Failed to read file <frozen os>
Throughput: 67.29 requests/s, 68968.98 total tokens/s, 67.29 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:14:34] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:14:34] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:14:34] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:14:34] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:34] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:34] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:34] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:34] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:34] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:14:34] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:14:34] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:14:34] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:14:34] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:14:34] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:14:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:14:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:14:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:14:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:14:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:14:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:14:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:14:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:14:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:14:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:45] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:45] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:45] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:45] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:45] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:45] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=11362) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=11362) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.90it/s]
(EngineCore_DP0 pid=11362) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.90it/s]
(EngineCore_DP0 pid=11362) 
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=11362) [2026-01-28 11:14:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=11362) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.98it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  8.28it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.60it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.83it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  9.05it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.41it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.58it/s]
(EngineCore_DP0 pid=11362) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.40it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  8.30it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.78it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  9.07it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  9.20it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.89it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 33/2048 [00:00<00:06, 322.07it/s]
Adding requests:   3%|▎         | 67/2048 [00:00<00:06, 327.27it/s]
Adding requests:   5%|▌         | 104/2048 [00:00<00:05, 345.11it/s]
Adding requests:   7%|▋         | 143/2048 [00:00<00:05, 360.71it/s]
Adding requests:   9%|▉         | 182/2048 [00:00<00:05, 368.09it/s]
Adding requests:  11%|█         | 219/2048 [00:00<00:04, 366.50it/s]
Adding requests:  13%|█▎        | 257/2048 [00:00<00:04, 369.36it/s]
Adding requests:  14%|█▍        | 295/2048 [00:00<00:04, 372.66it/s]
Adding requests:  16%|█▋        | 334/2048 [00:00<00:04, 377.20it/s]
Adding requests:  18%|█▊        | 374/2048 [00:01<00:04, 382.50it/s]
Adding requests:  20%|██        | 413/2048 [00:01<00:04, 382.47it/s]
Adding requests:  22%|██▏       | 453/2048 [00:01<00:04, 383.24it/s]
Adding requests:  24%|██▍       | 492/2048 [00:01<00:04, 378.85it/s]
Adding requests:  26%|██▌       | 530/2048 [00:01<00:04, 362.77it/s]
Adding requests:  28%|██▊       | 568/2048 [00:01<00:04, 366.95it/s]
Adding requests:  30%|██▉       | 605/2048 [00:01<00:03, 367.67it/s]
Adding requests:  31%|███▏      | 644/2048 [00:01<00:03, 372.15it/s]
Adding requests:  33%|███▎      | 686/2048 [00:01<00:03, 384.18it/s]
Adding requests:  36%|███▌      | 728/2048 [00:01<00:03, 392.49it/s]
Adding requests:  38%|███▊      | 768/2048 [00:02<00:03, 384.52it/s]
Adding requests:  39%|███▉      | 807/2048 [00:02<00:03, 382.91it/s]
Adding requests:  41%|████▏     | 846/2048 [00:02<00:03, 374.97it/s]
Adding requests:  43%|████▎     | 886/2048 [00:02<00:03, 380.75it/s]
Adding requests:  45%|████▌     | 927/2048 [00:02<00:02, 387.21it/s]
Adding requests:  47%|████▋     | 966/2048 [00:02<00:02, 387.13it/s]
Adding requests:  49%|████▉     | 1006/2048 [00:02<00:02, 389.69it/s]
Adding requests:  51%|█████     | 1046/2048 [00:02<00:02, 390.49it/s]
Adding requests:  53%|█████▎    | 1086/2048 [00:02<00:02, 391.08it/s]
Adding requests:  55%|█████▍    | 1126/2048 [00:02<00:02, 390.99it/s]
Adding requests:  57%|█████▋    | 1168/2048 [00:03<00:02, 398.92it/s]
Adding requests:  59%|█████▉    | 1210/2048 [00:03<00:02, 403.59it/s]
Adding requests:  61%|██████    | 1251/2048 [00:03<00:02, 393.67it/s]
Adding requests:  63%|██████▎   | 1291/2048 [00:03<00:01, 395.49it/s]
Adding requests:  65%|██████▌   | 1332/2048 [00:03<00:01, 398.43it/s]
Adding requests:  67%|██████▋   | 1373/2048 [00:03<00:01, 401.33it/s]
Adding requests:  69%|██████▉   | 1414/2048 [00:03<00:01, 398.45it/s]
Adding requests:  71%|███████   | 1454/2048 [00:03<00:01, 392.47it/s]
Adding requests:  73%|███████▎  | 1495/2048 [00:03<00:01, 395.51it/s]
Adding requests:  75%|███████▌  | 1536/2048 [00:04<00:01, 397.79it/s]
Adding requests:  77%|███████▋  | 1577/2048 [00:04<00:01, 399.99it/s]
Adding requests:  79%|███████▉  | 1618/2048 [00:04<00:01, 399.51it/s]
Adding requests:  81%|████████  | 1658/2048 [00:04<00:00, 398.97it/s]
Adding requests:  83%|████████▎ | 1698/2048 [00:04<00:00, 394.91it/s]
Adding requests:  85%|████████▍ | 1739/2048 [00:04<00:00, 397.56it/s]
Adding requests:  87%|████████▋ | 1779/2048 [00:04<00:00, 393.81it/s]
Adding requests:  89%|████████▉ | 1819/2048 [00:04<00:00, 393.99it/s]
Adding requests:  91%|█████████ | 1860/2048 [00:04<00:00, 394.22it/s]
Adding requests:  93%|█████████▎| 1900/2048 [00:04<00:00, 383.44it/s]
Adding requests:  95%|█████████▍| 1940/2048 [00:05<00:00, 388.06it/s]
Adding requests:  97%|█████████▋| 1980/2048 [00:05<00:00, 389.37it/s]
Adding requests:  99%|█████████▊| 2019/2048 [00:05<00:00, 388.47it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 385.24it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:00<00:01, 1589.13it/s, est. speed input: 1627445.12 toks/s, output: 1589.18 toks/s]
Processed prompts:  24%|██▍       | 497/2048 [00:04<00:17, 89.49it/s, est. speed input: 113493.03 toks/s, output: 110.83 toks/s]    
Processed prompts:  28%|██▊       | 565/2048 [00:05<00:18, 79.82it/s, est. speed input: 101301.69 toks/s, output: 98.93 toks/s] 
Processed prompts:  30%|██▉       | 605/2048 [00:06<00:17, 80.23it/s, est. speed input: 100014.87 toks/s, output: 97.67 toks/s]
Processed prompts:  31%|███       | 633/2048 [00:06<00:18, 76.58it/s, est. speed input: 97076.64 toks/s, output: 94.80 toks/s] 
Processed prompts:  32%|███▏      | 653/2048 [00:06<00:18, 77.23it/s, est. speed input: 96645.77 toks/s, output: 94.38 toks/s]
Processed prompts:  33%|███▎      | 669/2048 [00:07<00:18, 75.79it/s, est. speed input: 95673.87 toks/s, output: 93.43 toks/s]
Processed prompts:  33%|███▎      | 682/2048 [00:07<00:18, 72.35it/s, est. speed input: 94352.77 toks/s, output: 92.14 toks/s]
Processed prompts:  34%|███▍      | 693/2048 [00:07<00:20, 67.45it/s, est. speed input: 92848.06 toks/s, output: 90.67 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:07<00:20, 64.65it/s, est. speed input: 91698.03 toks/s, output: 89.55 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:08<00:20, 64.98it/s, est. speed input: 90983.07 toks/s, output: 88.85 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:08<00:20, 65.29it/s, est. speed input: 90314.78 toks/s, output: 88.20 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:08<00:19, 65.54it/s, est. speed input: 89684.46 toks/s, output: 87.58 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:08<00:19, 65.73it/s, est. speed input: 89088.17 toks/s, output: 87.00 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:09<00:19, 65.86it/s, est. speed input: 88521.41 toks/s, output: 86.45 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:09<00:18, 65.97it/s, est. speed input: 87986.61 toks/s, output: 85.92 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:09<00:18, 66.04it/s, est. speed input: 87477.38 toks/s, output: 85.43 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:09<00:18, 66.11it/s, est. speed input: 86995.45 toks/s, output: 84.96 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:10<00:18, 66.14it/s, est. speed input: 86533.54 toks/s, output: 84.51 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:10<00:17, 66.16it/s, est. speed input: 86093.95 toks/s, output: 84.08 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:10<00:17, 66.18it/s, est. speed input: 85674.79 toks/s, output: 83.67 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:10<00:17, 66.20it/s, est. speed input: 85275.54 toks/s, output: 83.28 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:11<00:17, 66.20it/s, est. speed input: 84892.49 toks/s, output: 82.90 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:11<00:16, 66.28it/s, est. speed input: 84532.95 toks/s, output: 82.55 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:11<00:16, 66.19it/s, est. speed input: 84174.86 toks/s, output: 82.20 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:11<00:16, 66.19it/s, est. speed input: 83837.34 toks/s, output: 81.87 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:11<00:15, 67.30it/s, est. speed input: 83606.75 toks/s, output: 81.65 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:12<00:15, 66.95it/s, est. speed input: 83292.27 toks/s, output: 81.34 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:12<00:15, 66.72it/s, est. speed input: 82991.22 toks/s, output: 81.05 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:12<00:15, 66.55it/s, est. speed input: 82701.19 toks/s, output: 80.76 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:12<00:15, 66.42it/s, est. speed input: 82420.48 toks/s, output: 80.49 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:13<00:14, 67.10it/s, est. speed input: 82207.95 toks/s, output: 80.28 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:13<00:14, 67.76it/s, est. speed input: 82015.46 toks/s, output: 80.09 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:13<00:14, 68.21it/s, est. speed input: 81828.35 toks/s, output: 79.91 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:13<00:13, 68.55it/s, est. speed input: 81648.69 toks/s, output: 79.73 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:14<00:13, 68.77it/s, est. speed input: 81473.72 toks/s, output: 79.56 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:14<00:13, 68.93it/s, est. speed input: 81304.11 toks/s, output: 79.40 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:14<00:12, 70.28it/s, est. speed input: 81216.24 toks/s, output: 79.31 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:14<00:12, 69.99it/s, est. speed input: 81056.66 toks/s, output: 79.16 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:15<00:12, 69.78it/s, est. speed input: 80901.13 toks/s, output: 79.00 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:15<00:12, 69.62it/s, est. speed input: 80750.04 toks/s, output: 78.86 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:15<00:11, 69.53it/s, est. speed input: 80604.25 toks/s, output: 78.71 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:15<00:11, 69.44it/s, est. speed input: 80461.16 toks/s, output: 78.58 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:15<00:11, 69.37it/s, est. speed input: 80322.23 toks/s, output: 78.44 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:16<00:11, 69.34it/s, est. speed input: 80188.19 toks/s, output: 78.31 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:16<00:11, 69.36it/s, est. speed input: 80060.10 toks/s, output: 78.18 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:16<00:10, 69.25it/s, est. speed input: 79928.88 toks/s, output: 78.06 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:16<00:10, 69.20it/s, est. speed input: 79802.76 toks/s, output: 77.93 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:17<00:10, 69.23it/s, est. speed input: 79682.97 toks/s, output: 77.82 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:17<00:10, 69.23it/s, est. speed input: 79566.06 toks/s, output: 77.70 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:17<00:09, 69.25it/s, est. speed input: 79452.50 toks/s, output: 77.59 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:17<00:09, 69.22it/s, est. speed input: 79340.35 toks/s, output: 77.48 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:18<00:09, 69.24it/s, est. speed input: 79232.65 toks/s, output: 77.38 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:18<00:09, 69.23it/s, est. speed input: 79126.68 toks/s, output: 77.27 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:18<00:08, 69.20it/s, est. speed input: 79022.38 toks/s, output: 77.17 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:18<00:08, 69.21it/s, est. speed input: 78921.68 toks/s, output: 77.07 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:18<00:08, 69.20it/s, est. speed input: 78823.19 toks/s, output: 76.98 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:19<00:08, 69.18it/s, est. speed input: 78726.18 toks/s, output: 76.88 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:19<00:08, 69.08it/s, est. speed input: 78627.81 toks/s, output: 76.78 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:19<00:07, 69.14it/s, est. speed input: 78537.25 toks/s, output: 76.70 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:19<00:07, 69.14it/s, est. speed input: 78447.09 toks/s, output: 76.61 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:20<00:07, 69.13it/s, est. speed input: 78358.72 toks/s, output: 76.52 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:20<00:07, 69.14it/s, est. speed input: 78273.00 toks/s, output: 76.44 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:20<00:06, 69.15it/s, est. speed input: 78189.26 toks/s, output: 76.36 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:20<00:06, 69.15it/s, est. speed input: 78107.26 toks/s, output: 76.28 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:21<00:06, 69.15it/s, est. speed input: 78027.03 toks/s, output: 76.20 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:21<00:06, 69.17it/s, est. speed input: 77949.06 toks/s, output: 76.12 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:21<00:05, 69.16it/s, est. speed input: 77872.25 toks/s, output: 76.05 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:21<00:05, 69.17it/s, est. speed input: 77797.47 toks/s, output: 75.97 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:21<00:05, 69.15it/s, est. speed input: 77723.24 toks/s, output: 75.90 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:22<00:05, 69.14it/s, est. speed input: 77650.51 toks/s, output: 75.83 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:22<00:05, 69.14it/s, est. speed input: 77579.76 toks/s, output: 75.76 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:22<00:04, 69.13it/s, est. speed input: 77510.15 toks/s, output: 75.69 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:22<00:04, 69.22it/s, est. speed input: 77445.44 toks/s, output: 75.63 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:23<00:04, 69.14it/s, est. speed input: 77376.75 toks/s, output: 75.56 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:23<00:04, 69.14it/s, est. speed input: 77311.63 toks/s, output: 75.50 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:23<00:03, 69.15it/s, est. speed input: 77248.15 toks/s, output: 75.44 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:23<00:03, 69.18it/s, est. speed input: 77186.51 toks/s, output: 75.38 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:24<00:03, 69.19it/s, est. speed input: 77125.89 toks/s, output: 75.32 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:24<00:03, 69.22it/s, est. speed input: 77066.94 toks/s, output: 75.26 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:24<00:02, 69.19it/s, est. speed input: 77007.63 toks/s, output: 75.20 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:24<00:02, 69.17it/s, est. speed input: 76949.37 toks/s, output: 75.15 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:24<00:02, 70.39it/s, est. speed input: 76933.70 toks/s, output: 75.13 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:25<00:02, 70.02it/s, est. speed input: 76877.83 toks/s, output: 75.08 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:25<00:02, 69.74it/s, est. speed input: 76822.04 toks/s, output: 75.02 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:25<00:01, 69.56it/s, est. speed input: 76767.49 toks/s, output: 74.97 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:25<00:01, 69.42it/s, est. speed input: 76713.66 toks/s, output: 74.92 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:26<00:01, 69.34it/s, est. speed input: 76661.50 toks/s, output: 74.86 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:26<00:01, 69.28it/s, est. speed input: 76609.80 toks/s, output: 74.81 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:26<00:00, 69.24it/s, est. speed input: 76559.39 toks/s, output: 74.76 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:26<00:00, 69.19it/s, est. speed input: 76508.99 toks/s, output: 74.72 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:27<00:00, 69.18it/s, est. speed input: 76460.35 toks/s, output: 74.67 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:27<00:00, 70.58it/s, est. speed input: 76455.35 toks/s, output: 74.66 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:27<00:00, 70.58it/s, est. speed input: 76980.48 toks/s, output: 75.18 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:27<00:00, 75.18it/s, est. speed input: 76980.48 toks/s, output: 75.18 toks/s]
[rank0]:[W128 11:15:39.958736131 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 83.9s

测试结果:
  Requests/s:   67.29
  Tokens/s:     68968.98
  Total Reqs:   2048
  Elapsed:      30.44s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     68901.70

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:16:11 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:16:12 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=12723) WARNING 01-28 11:16:19 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=12723) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=12723) WARNING 01-28 11:16:31 [backends.py:609] Failed to read file <frozen os>
Throughput: 69.74 requests/s, 71486.47 total tokens/s, 69.74 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:16:11] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:16:11] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:16:11] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:16:11] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:11] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:11] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:11] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:11] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:11] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:16:11] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:16:11] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:16:11] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:16:11] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:16:11] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:16:18] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:16:18] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:16:18] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:16:18] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:18] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:18] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:18] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:18] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:16:18] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:16:18] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:16:18] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:16:18] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:16:18] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:16:18] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=12723) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=12723) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.97it/s]
(EngineCore_DP0 pid=12723) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.97it/s]
(EngineCore_DP0 pid=12723) 
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=12723) [2026-01-28 11:16:20] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=12723) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  8.13it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  8.40it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.69it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.89it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.99it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  9.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  9.15it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  9.22it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  9.12it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  9.16it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.53it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.83it/s]
(EngineCore_DP0 pid=12723) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.67it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.68it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  9.13it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  9.23it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  9.16it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  9.27it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.35it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.14it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 38/4096 [00:00<00:10, 372.13it/s]
Adding requests:   2%|▏         | 78/4096 [00:00<00:10, 384.18it/s]
Adding requests:   3%|▎         | 119/4096 [00:00<00:10, 394.03it/s]
Adding requests:   4%|▍         | 159/4096 [00:00<00:09, 395.35it/s]
Adding requests:   5%|▍         | 199/4096 [00:00<00:09, 392.89it/s]
Adding requests:   6%|▌         | 240/4096 [00:00<00:09, 397.29it/s]
Adding requests:   7%|▋         | 281/4096 [00:00<00:09, 399.73it/s]
Adding requests:   8%|▊         | 321/4096 [00:00<00:09, 397.41it/s]
Adding requests:   9%|▉         | 363/4096 [00:00<00:09, 402.51it/s]
Adding requests:  10%|▉         | 404/4096 [00:01<00:09, 400.03it/s]
Adding requests:  11%|█         | 445/4096 [00:01<00:09, 398.54it/s]
Adding requests:  12%|█▏        | 485/4096 [00:01<00:09, 396.85it/s]
Adding requests:  13%|█▎        | 525/4096 [00:01<00:09, 386.97it/s]
Adding requests:  14%|█▍        | 568/4096 [00:01<00:08, 397.74it/s]
Adding requests:  15%|█▍        | 609/4096 [00:01<00:08, 400.49it/s]
Adding requests:  16%|█▌        | 652/4096 [00:01<00:08, 407.11it/s]
Adding requests:  17%|█▋        | 695/4096 [00:01<00:08, 412.85it/s]
Adding requests:  18%|█▊        | 737/4096 [00:01<00:08, 413.26it/s]
Adding requests:  19%|█▉        | 779/4096 [00:01<00:08, 409.87it/s]
Adding requests:  20%|██        | 821/4096 [00:02<00:08, 403.93it/s]
Adding requests:  21%|██        | 863/4096 [00:02<00:07, 407.56it/s]
Adding requests:  22%|██▏       | 905/4096 [00:02<00:07, 410.35it/s]
Adding requests:  23%|██▎       | 947/4096 [00:02<00:07, 408.72it/s]
Adding requests:  24%|██▍       | 989/4096 [00:02<00:07, 411.87it/s]
Adding requests:  25%|██▌       | 1031/4096 [00:02<00:07, 414.04it/s]
Adding requests:  26%|██▌       | 1073/4096 [00:02<00:07, 397.46it/s]
Adding requests:  27%|██▋       | 1115/4096 [00:02<00:07, 401.58it/s]
Adding requests:  28%|██▊       | 1159/4096 [00:02<00:07, 412.48it/s]
Adding requests:  29%|██▉       | 1201/4096 [00:02<00:07, 404.32it/s]
Adding requests:  30%|███       | 1244/4096 [00:03<00:06, 409.12it/s]
Adding requests:  31%|███▏      | 1286/4096 [00:03<00:06, 410.05it/s]
Adding requests:  32%|███▏      | 1329/4096 [00:03<00:06, 414.68it/s]
Adding requests:  33%|███▎      | 1371/4096 [00:03<00:06, 414.29it/s]
Adding requests:  35%|███▍      | 1414/4096 [00:03<00:06, 418.28it/s]
Adding requests:  36%|███▌      | 1457/4096 [00:03<00:06, 420.09it/s]
Adding requests:  37%|███▋      | 1501/4096 [00:03<00:06, 422.89it/s]
Adding requests:  38%|███▊      | 1544/4096 [00:03<00:06, 419.24it/s]
Adding requests:  39%|███▊      | 1586/4096 [00:03<00:06, 415.05it/s]
Adding requests:  40%|███▉      | 1629/4096 [00:04<00:05, 418.82it/s]
Adding requests:  41%|████      | 1671/4096 [00:04<00:05, 415.15it/s]
Adding requests:  42%|████▏     | 1715/4096 [00:04<00:05, 420.07it/s]
Adding requests:  43%|████▎     | 1758/4096 [00:04<00:05, 414.82it/s]
Adding requests:  44%|████▍     | 1801/4096 [00:04<00:05, 417.09it/s]
Adding requests:  45%|████▌     | 1845/4096 [00:04<00:05, 422.14it/s]
Adding requests:  46%|████▌     | 1888/4096 [00:04<00:05, 420.00it/s]
Adding requests:  47%|████▋     | 1931/4096 [00:04<00:05, 410.18it/s]
Adding requests:  48%|████▊     | 1973/4096 [00:04<00:05, 412.44it/s]
Adding requests:  49%|████▉     | 2015/4096 [00:04<00:05, 410.50it/s]
Adding requests:  50%|█████     | 2057/4096 [00:05<00:04, 412.31it/s]
Adding requests:  51%|█████▏    | 2100/4096 [00:05<00:04, 415.24it/s]
Adding requests:  52%|█████▏    | 2142/4096 [00:05<00:04, 408.87it/s]
Adding requests:  53%|█████▎    | 2183/4096 [00:05<00:04, 406.71it/s]
Adding requests:  54%|█████▍    | 2226/4096 [00:05<00:04, 413.38it/s]
Adding requests:  55%|█████▌    | 2269/4096 [00:05<00:04, 415.40it/s]
Adding requests:  56%|█████▋    | 2312/4096 [00:05<00:04, 417.82it/s]
Adding requests:  57%|█████▋    | 2354/4096 [00:05<00:04, 414.84it/s]
Adding requests:  58%|█████▊    | 2396/4096 [00:05<00:04, 400.14it/s]
Adding requests:  60%|█████▉    | 2438/4096 [00:05<00:04, 405.14it/s]
Adding requests:  61%|██████    | 2481/4096 [00:06<00:03, 410.57it/s]
Adding requests:  62%|██████▏   | 2523/4096 [00:06<00:03, 407.59it/s]
Adding requests:  63%|██████▎   | 2566/4096 [00:06<00:03, 411.62it/s]
Adding requests:  64%|██████▎   | 2608/4096 [00:06<00:03, 413.26it/s]
Adding requests:  65%|██████▍   | 2650/4096 [00:06<00:03, 411.86it/s]
Adding requests:  66%|██████▌   | 2692/4096 [00:06<00:03, 408.91it/s]
Adding requests:  67%|██████▋   | 2733/4096 [00:06<00:03, 405.35it/s]
Adding requests:  68%|██████▊   | 2775/4096 [00:06<00:03, 407.48it/s]
Adding requests:  69%|██████▉   | 2817/4096 [00:06<00:03, 409.41it/s]
Adding requests:  70%|██████▉   | 2859/4096 [00:06<00:03, 410.48it/s]
Adding requests:  71%|███████   | 2902/4096 [00:07<00:02, 413.48it/s]
Adding requests:  72%|███████▏  | 2944/4096 [00:07<00:02, 412.14it/s]
Adding requests:  73%|███████▎  | 2986/4096 [00:07<00:02, 412.93it/s]
Adding requests:  74%|███████▍  | 3028/4096 [00:07<00:02, 412.15it/s]
Adding requests:  75%|███████▍  | 3070/4096 [00:07<00:02, 410.50it/s]
Adding requests:  76%|███████▌  | 3112/4096 [00:07<00:02, 410.97it/s]
Adding requests:  77%|███████▋  | 3154/4096 [00:07<00:02, 412.06it/s]
Adding requests:  78%|███████▊  | 3196/4096 [00:07<00:02, 410.36it/s]
Adding requests:  79%|███████▉  | 3238/4096 [00:07<00:02, 412.87it/s]
Adding requests:  80%|████████  | 3280/4096 [00:08<00:01, 410.32it/s]
Adding requests:  81%|████████  | 3322/4096 [00:08<00:01, 411.27it/s]
Adding requests:  82%|████████▏ | 3366/4096 [00:08<00:01, 417.80it/s]
Adding requests:  83%|████████▎ | 3408/4096 [00:08<00:01, 412.89it/s]
Adding requests:  84%|████████▍ | 3450/4096 [00:08<00:01, 410.31it/s]
Adding requests:  85%|████████▌ | 3492/4096 [00:08<00:01, 407.21it/s]
Adding requests:  86%|████████▋ | 3534/4096 [00:08<00:01, 408.01it/s]
Adding requests:  87%|████████▋ | 3576/4096 [00:08<00:01, 408.99it/s]
Adding requests:  88%|████████▊ | 3617/4096 [00:08<00:01, 400.60it/s]
Adding requests:  89%|████████▉ | 3658/4096 [00:08<00:01, 401.34it/s]
Adding requests:  90%|█████████ | 3701/4096 [00:09<00:00, 407.74it/s]
Adding requests:  91%|█████████▏| 3742/4096 [00:09<00:00, 392.54it/s]
Adding requests:  92%|█████████▏| 3784/4096 [00:09<00:00, 397.66it/s]
Adding requests:  93%|█████████▎| 3825/4096 [00:09<00:00, 399.83it/s]
Adding requests:  94%|█████████▍| 3866/4096 [00:09<00:00, 402.36it/s]
Adding requests:  95%|█████████▌| 3908/4096 [00:09<00:00, 405.61it/s]
Adding requests:  96%|█████████▋| 3949/4096 [00:09<00:00, 406.84it/s]
Adding requests:  97%|█████████▋| 3990/4096 [00:09<00:00, 404.64it/s]
Adding requests:  98%|█████████▊| 4032/4096 [00:09<00:00, 407.63it/s]
Adding requests:  99%|█████████▉| 4073/4096 [00:09<00:00, 403.86it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 408.36it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:00<00:02, 1382.03it/s, est. speed input: 1415342.57 toks/s, output: 1382.12 toks/s]
Processed prompts:  21%|██        | 845/4096 [00:02<00:11, 274.98it/s, est. speed input: 352323.94 toks/s, output: 344.07 toks/s]   
Processed prompts:  22%|██▏       | 907/4096 [00:03<00:16, 197.50it/s, est. speed input: 272985.92 toks/s, output: 266.59 toks/s]
Processed prompts:  23%|██▎       | 944/4096 [00:06<00:36, 86.65it/s, est. speed input: 157942.74 toks/s, output: 154.24 toks/s] 
Processed prompts:  24%|██▎       | 967/4096 [00:06<00:38, 82.28it/s, est. speed input: 150779.41 toks/s, output: 147.25 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:07<00:39, 78.65it/s, est. speed input: 144848.76 toks/s, output: 141.45 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:07<00:39, 77.00it/s, est. speed input: 140320.07 toks/s, output: 137.03 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:07<00:40, 75.46it/s, est. speed input: 136314.53 toks/s, output: 133.12 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:08<00:40, 74.16it/s, est. speed input: 132770.09 toks/s, output: 129.66 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:08<00:40, 73.01it/s, est. speed input: 129565.30 toks/s, output: 126.53 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:09<00:40, 72.21it/s, est. speed input: 126718.91 toks/s, output: 123.75 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:09<00:41, 70.29it/s, est. speed input: 123743.64 toks/s, output: 120.84 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:10<00:41, 68.97it/s, est. speed input: 121071.22 toks/s, output: 118.23 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:10<00:41, 68.02it/s, est. speed input: 118642.50 toks/s, output: 115.86 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:11<00:41, 67.22it/s, est. speed input: 116394.03 toks/s, output: 113.67 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:11<00:41, 66.68it/s, est. speed input: 114337.71 toks/s, output: 111.66 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:12<00:41, 66.38it/s, est. speed input: 112466.52 toks/s, output: 109.83 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:12<00:41, 66.17it/s, est. speed input: 110737.82 toks/s, output: 108.14 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:13<00:40, 66.09it/s, est. speed input: 109149.46 toks/s, output: 106.59 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:13<00:39, 67.65it/s, est. speed input: 107979.63 toks/s, output: 105.45 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:14<00:38, 68.79it/s, est. speed input: 106883.79 toks/s, output: 104.38 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:14<00:37, 69.60it/s, est. speed input: 105853.71 toks/s, output: 103.37 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:15<00:36, 70.19it/s, est. speed input: 104886.27 toks/s, output: 102.43 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:15<00:35, 70.61it/s, est. speed input: 103974.63 toks/s, output: 101.54 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:15<00:35, 70.91it/s, est. speed input: 103113.57 toks/s, output: 100.70 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:16<00:34, 71.11it/s, est. speed input: 102298.41 toks/s, output: 99.90 toks/s] 
Processed prompts:  41%|████      | 1666/4096 [00:16<00:34, 71.25it/s, est. speed input: 101526.77 toks/s, output: 99.15 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:17<00:33, 71.34it/s, est. speed input: 100794.30 toks/s, output: 98.43 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:17<00:33, 71.39it/s, est. speed input: 100096.67 toks/s, output: 97.75 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:18<00:32, 71.45it/s, est. speed input: 99437.07 toks/s, output: 97.11 toks/s] 
Processed prompts:  44%|████▍     | 1794/4096 [00:18<00:32, 71.47it/s, est. speed input: 98806.99 toks/s, output: 96.49 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:19<00:31, 71.49it/s, est. speed input: 98205.92 toks/s, output: 95.90 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:19<00:31, 72.12it/s, est. speed input: 97697.32 toks/s, output: 95.41 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:19<00:30, 71.94it/s, est. speed input: 97147.98 toks/s, output: 94.87 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:20<00:30, 71.83it/s, est. speed input: 96624.75 toks/s, output: 94.36 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:20<00:29, 71.82it/s, est. speed input: 96130.12 toks/s, output: 93.88 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:21<00:29, 71.76it/s, est. speed input: 95651.09 toks/s, output: 93.41 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:21<00:29, 71.60it/s, est. speed input: 95181.06 toks/s, output: 92.95 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:22<00:28, 71.59it/s, est. speed input: 94738.90 toks/s, output: 92.52 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:22<00:28, 71.56it/s, est. speed input: 94312.80 toks/s, output: 92.10 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:23<00:27, 71.55it/s, est. speed input: 93903.62 toks/s, output: 91.70 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:23<00:27, 71.55it/s, est. speed input: 93510.79 toks/s, output: 91.32 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:23<00:26, 71.52it/s, est. speed input: 93130.43 toks/s, output: 90.95 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:24<00:26, 71.50it/s, est. speed input: 92763.69 toks/s, output: 90.59 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:24<00:25, 71.51it/s, est. speed input: 92412.28 toks/s, output: 90.25 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:25<00:25, 72.15it/s, est. speed input: 92120.91 toks/s, output: 89.96 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:25<00:24, 71.96it/s, est. speed input: 91792.97 toks/s, output: 89.64 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:26<00:24, 71.83it/s, est. speed input: 91475.93 toks/s, output: 89.33 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:26<00:24, 71.74it/s, est. speed input: 91169.67 toks/s, output: 89.03 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:27<00:23, 71.68it/s, est. speed input: 90873.59 toks/s, output: 88.74 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:27<00:23, 71.62it/s, est. speed input: 90585.81 toks/s, output: 88.46 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:27<00:22, 71.59it/s, est. speed input: 90308.45 toks/s, output: 88.19 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:28<00:22, 72.19it/s, est. speed input: 90080.25 toks/s, output: 87.97 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:28<00:21, 71.99it/s, est. speed input: 89818.85 toks/s, output: 87.71 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:29<00:21, 71.84it/s, est. speed input: 89565.08 toks/s, output: 87.47 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:29<00:20, 71.74it/s, est. speed input: 89319.34 toks/s, output: 87.23 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:30<00:20, 71.67it/s, est. speed input: 89080.56 toks/s, output: 86.99 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:30<00:20, 71.62it/s, est. speed input: 88848.74 toks/s, output: 86.77 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:31<00:19, 71.56it/s, est. speed input: 88622.49 toks/s, output: 86.55 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:31<00:19, 71.54it/s, est. speed input: 88403.81 toks/s, output: 86.33 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:31<00:18, 71.54it/s, est. speed input: 88191.79 toks/s, output: 86.12 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:32<00:18, 71.53it/s, est. speed input: 87984.98 toks/s, output: 85.92 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:32<00:17, 71.53it/s, est. speed input: 87784.66 toks/s, output: 85.73 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:33<00:17, 71.52it/s, est. speed input: 87589.05 toks/s, output: 85.54 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:33<00:16, 71.52it/s, est. speed input: 87398.69 toks/s, output: 85.35 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:34<00:16, 71.52it/s, est. speed input: 87213.47 toks/s, output: 85.17 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:34<00:16, 71.51it/s, est. speed input: 87032.78 toks/s, output: 84.99 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:35<00:15, 70.34it/s, est. speed input: 86795.41 toks/s, output: 84.76 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:35<00:15, 68.82it/s, est. speed input: 86525.14 toks/s, output: 84.50 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:36<00:15, 67.78it/s, est. speed input: 86261.56 toks/s, output: 84.24 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:36<00:15, 67.08it/s, est. speed input: 86005.54 toks/s, output: 83.99 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:37<00:14, 66.60it/s, est. speed input: 85755.82 toks/s, output: 83.75 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:37<00:14, 67.47it/s, est. speed input: 85578.76 toks/s, output: 83.57 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:37<00:13, 68.62it/s, est. speed input: 85432.69 toks/s, output: 83.43 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:38<00:12, 69.47it/s, est. speed input: 85290.90 toks/s, output: 83.29 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:41<00:30, 28.20it/s, est. speed input: 80474.59 toks/s, output: 78.59 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:41<00:24, 34.46it/s, est. speed input: 80396.56 toks/s, output: 78.51 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:42<00:19, 40.52it/s, est. speed input: 80285.80 toks/s, output: 78.40 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:42<00:16, 45.77it/s, est. speed input: 80135.60 toks/s, output: 78.26 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:43<00:14, 50.33it/s, est. speed input: 79987.97 toks/s, output: 78.11 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:43<00:12, 54.10it/s, est. speed input: 79843.79 toks/s, output: 77.97 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:44<00:11, 57.08it/s, est. speed input: 79702.36 toks/s, output: 77.83 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:44<00:10, 59.38it/s, est. speed input: 79564.00 toks/s, output: 77.70 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:44<00:09, 61.10it/s, est. speed input: 79428.82 toks/s, output: 77.57 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [00:45<00:09, 62.41it/s, est. speed input: 79298.41 toks/s, output: 77.44 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [00:45<00:08, 63.23it/s, est. speed input: 79165.32 toks/s, output: 77.31 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [00:46<00:07, 63.90it/s, est. speed input: 79038.42 toks/s, output: 77.19 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [00:46<00:07, 64.40it/s, est. speed input: 78914.96 toks/s, output: 77.07 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [00:47<00:06, 64.73it/s, est. speed input: 78793.27 toks/s, output: 76.95 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [00:47<00:06, 66.40it/s, est. speed input: 78732.41 toks/s, output: 76.89 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [00:48<00:05, 68.42it/s, est. speed input: 78702.30 toks/s, output: 76.86 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [00:48<00:05, 69.31it/s, est. speed input: 78651.94 toks/s, output: 76.81 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [00:49<00:04, 69.97it/s, est. speed input: 78603.19 toks/s, output: 76.76 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [00:49<00:04, 70.42it/s, est. speed input: 78554.62 toks/s, output: 76.71 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [00:50<00:03, 70.74it/s, est. speed input: 78506.89 toks/s, output: 76.67 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [00:50<00:03, 70.97it/s, est. speed input: 78460.14 toks/s, output: 76.62 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [00:51<00:02, 71.13it/s, est. speed input: 78414.09 toks/s, output: 76.58 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [00:51<00:02, 71.23it/s, est. speed input: 78368.44 toks/s, output: 76.53 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [00:51<00:01, 71.30it/s, est. speed input: 78323.91 toks/s, output: 76.49 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [00:52<00:01, 71.36it/s, est. speed input: 78280.12 toks/s, output: 76.45 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [00:52<00:00, 72.03it/s, est. speed input: 78256.43 toks/s, output: 76.42 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [00:53<00:00, 72.73it/s, est. speed input: 78239.91 toks/s, output: 76.41 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [00:53<00:00, 72.73it/s, est. speed input: 78816.32 toks/s, output: 76.97 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [00:53<00:00, 76.97it/s, est. speed input: 78816.32 toks/s, output: 76.97 toks/s]
[rank0]:[W128 11:17:47.602806581 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 128.6s

测试结果:
  Requests/s:   69.74
  Tokens/s:     71486.47
  Total Reqs:   4096
  Elapsed:      58.73s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     71416.72


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_4/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.8477,8642.8955,7.5975
1024,1024,1,128,128,17.3271,17760.2494,7.3873
2048,1024,2,256,128,34.2721,35128.9511,7.4696
4096,1024,4,512,128,65.8633,67509.8330,7.7737
8192,1024,8,1024,128,68.5848,70299.4358,14.9304
16384,1024,16,2048,128,67.2868,68968.9825,30.4369
32768,1024,32,4096,128,69.7429,71486.4664,58.7300

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_6) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_6
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_6

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:17:56 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:17:57 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=13610) WARNING 01-28 11:18:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=13610) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=13610) WARNING 01-28 11:18:18 [backends.py:609] Failed to read file <frozen os>
Throughput: 17.37 requests/s, 8910.05 total tokens/s, 17.37 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:17:56] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:17:56] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:17:56] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:17:56] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:17:56] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:17:56] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:17:56] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:17:56] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:17:56] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:17:56] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:17:56] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:17:56] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:17:56] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:17:56] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:18:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:18:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:18:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:18:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:18:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:18:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:18:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:18:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:18:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:05] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:05] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:05] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:05] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:05] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:05] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=13610) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=13610) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:04<00:00,  4.86s/it]
(EngineCore_DP0 pid=13610) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:04<00:00,  4.86s/it]
(EngineCore_DP0 pid=13610) 
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=13610) [2026-01-28 11:18:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=13610) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  8.12it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.23it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.20it/s]
(EngineCore_DP0 pid=13610) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.82it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.81it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  55%|█████▍    | 70/128 [00:00<00:00, 698.31it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 701.75it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 37.24it/s, est. speed input: 19074.50 toks/s, output: 37.25 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:05, 22.56it/s, est. speed input: 12279.93 toks/s, output: 23.98 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:05, 20.46it/s, est. speed input: 11220.28 toks/s, output: 21.91 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:05, 19.37it/s, est. speed input: 10672.37 toks/s, output: 20.84 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:05, 18.64it/s, est. speed input: 10304.21 toks/s, output: 20.12 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:00<00:05, 18.38it/s, est. speed input: 10152.89 toks/s, output: 19.83 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:05, 18.23it/s, est. speed input: 10044.42 toks/s, output: 19.62 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:05, 18.17it/s, est. speed input: 9967.67 toks/s, output: 19.47 toks/s] 
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 18.10it/s, est. speed input: 9898.40 toks/s, output: 19.33 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 17.98it/s, est. speed input: 9830.40 toks/s, output: 19.20 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.94it/s, est. speed input: 9779.76 toks/s, output: 19.10 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 17.93it/s, est. speed input: 9738.14 toks/s, output: 19.02 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 17.90it/s, est. speed input: 9698.96 toks/s, output: 18.94 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 17.89it/s, est. speed input: 9665.14 toks/s, output: 18.88 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:01<00:05, 17.89it/s, est. speed input: 9636.38 toks/s, output: 18.82 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:04, 17.84it/s, est. speed input: 9606.02 toks/s, output: 18.76 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:04, 17.77it/s, est. speed input: 9575.82 toks/s, output: 18.70 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:04, 17.83it/s, est. speed input: 9557.16 toks/s, output: 18.67 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 17.83it/s, est. speed input: 9537.54 toks/s, output: 18.63 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 17.87it/s, est. speed input: 9522.16 toks/s, output: 18.60 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 17.90it/s, est. speed input: 9508.73 toks/s, output: 18.57 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:02<00:04, 17.87it/s, est. speed input: 9492.44 toks/s, output: 18.54 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:02<00:04, 17.77it/s, est. speed input: 9472.59 toks/s, output: 18.50 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:02<00:04, 17.77it/s, est. speed input: 9458.09 toks/s, output: 18.47 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:03, 17.75it/s, est. speed input: 9443.80 toks/s, output: 18.44 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:03, 17.63it/s, est. speed input: 9423.64 toks/s, output: 18.41 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 17.47it/s, est. speed input: 9400.36 toks/s, output: 18.36 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 17.43it/s, est. speed input: 9382.88 toks/s, output: 18.33 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 17.37it/s, est. speed input: 9364.64 toks/s, output: 18.29 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 17.41it/s, est. speed input: 9352.18 toks/s, output: 18.27 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:03<00:03, 17.44it/s, est. speed input: 9340.26 toks/s, output: 18.24 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:03<00:03, 17.46it/s, est. speed input: 9329.51 toks/s, output: 18.22 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 17.45it/s, est. speed input: 9317.63 toks/s, output: 18.20 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 17.39it/s, est. speed input: 9303.91 toks/s, output: 18.17 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:02, 17.31it/s, est. speed input: 9289.51 toks/s, output: 18.14 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 17.34it/s, est. speed input: 9279.64 toks/s, output: 18.12 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 17.34it/s, est. speed input: 9269.07 toks/s, output: 18.10 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 17.36it/s, est. speed input: 9260.02 toks/s, output: 18.09 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:04<00:02, 17.40it/s, est. speed input: 9252.79 toks/s, output: 18.07 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:04<00:02, 17.37it/s, est. speed input: 9243.43 toks/s, output: 18.05 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:04<00:02, 17.36it/s, est. speed input: 9234.66 toks/s, output: 18.04 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 17.37it/s, est. speed input: 9227.11 toks/s, output: 18.02 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 17.33it/s, est. speed input: 9218.10 toks/s, output: 18.00 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 17.28it/s, est. speed input: 9208.85 toks/s, output: 17.99 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 17.30it/s, est. speed input: 9201.58 toks/s, output: 17.97 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 17.33it/s, est. speed input: 9195.48 toks/s, output: 17.96 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 17.39it/s, est. speed input: 9191.11 toks/s, output: 17.95 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:05<00:01, 17.39it/s, est. speed input: 9185.32 toks/s, output: 17.94 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:05<00:01, 17.40it/s, est. speed input: 9180.00 toks/s, output: 17.93 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:05<00:01, 17.39it/s, est. speed input: 9174.38 toks/s, output: 17.92 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 17.31it/s, est. speed input: 9166.82 toks/s, output: 17.90 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:00, 17.28it/s, est. speed input: 9160.24 toks/s, output: 17.89 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 17.19it/s, est. speed input: 9151.44 toks/s, output: 17.87 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 17.19it/s, est. speed input: 9145.29 toks/s, output: 17.86 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 17.27it/s, est. speed input: 9141.53 toks/s, output: 17.85 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 17.32it/s, est. speed input: 9137.80 toks/s, output: 17.85 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:06<00:00, 17.31it/s, est. speed input: 9132.96 toks/s, output: 17.84 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:06<00:00, 17.28it/s, est. speed input: 9127.66 toks/s, output: 17.83 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 17.29it/s, est. speed input: 9123.25 toks/s, output: 17.82 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 17.37it/s, est. speed input: 9121.18 toks/s, output: 17.81 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.37it/s, est. speed input: 9120.27 toks/s, output: 17.81 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.81it/s, est. speed input: 9120.27 toks/s, output: 17.81 toks/s]
[rank0]:[W128 11:18:37.565609216 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 49.2s

测试结果:
  Requests/s:   17.37
  Tokens/s:     8910.05
  Total Reqs:   128
  Elapsed:      7.37s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8892.68

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:18:49 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:18:50 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=14147) WARNING 01-28 11:18:56 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=14147) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=14147) WARNING 01-28 11:19:06 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.61 requests/s, 17024.56 total tokens/s, 16.61 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:18:49] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:18:49] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:18:49] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:18:49] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:49] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:49] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:49] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:49] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:49] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:18:49] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:18:49] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:18:49] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:18:49] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:18:49] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:18:56] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:18:56] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:18:56] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:18:56] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:56] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:56] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:56] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:56] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:18:56] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:18:56] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:18:56] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:18:56] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:18:56] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:18:56] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:57] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:57] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:57] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:57] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:57] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:57] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=14147) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=14147) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.61it/s]
(EngineCore_DP0 pid=14147) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.61it/s]
(EngineCore_DP0 pid=14147) 
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=14147) [2026-01-28 11:18:58] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=14147) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  4.51it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.31it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  5.95it/s]
(EngineCore_DP0 pid=14147) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.89it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.88it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  28%|██▊       | 36/128 [00:00<00:00, 354.18it/s]
Adding requests:  59%|█████▉    | 76/128 [00:00<00:00, 379.36it/s]
Adding requests:  91%|█████████ | 116/128 [00:00<00:00, 385.64it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 382.62it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:02, 46.81it/s, est. speed input: 47940.48 toks/s, output: 46.81 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:04, 25.06it/s, est. speed input: 27937.46 toks/s, output: 27.28 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:05, 21.49it/s, est. speed input: 24564.09 toks/s, output: 23.99 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:00<00:05, 19.56it/s, est. speed input: 22735.62 toks/s, output: 22.20 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:00<00:05, 18.59it/s, est. speed input: 21707.43 toks/s, output: 21.20 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:05, 18.10it/s, est. speed input: 21193.80 toks/s, output: 20.70 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 17.73it/s, est. speed input: 20791.83 toks/s, output: 20.30 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 17.45it/s, est. speed input: 20461.05 toks/s, output: 19.98 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.19it/s, est. speed input: 20168.80 toks/s, output: 19.70 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 16.99it/s, est. speed input: 19919.14 toks/s, output: 19.45 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 16.84it/s, est. speed input: 19703.89 toks/s, output: 19.24 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 16.74it/s, est. speed input: 19517.97 toks/s, output: 19.06 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:01<00:05, 16.72it/s, est. speed input: 19368.40 toks/s, output: 18.91 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.65it/s, est. speed input: 19222.33 toks/s, output: 18.77 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.55it/s, est. speed input: 19081.80 toks/s, output: 18.63 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.55it/s, est. speed input: 18971.35 toks/s, output: 18.53 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:05, 16.51it/s, est. speed input: 18863.23 toks/s, output: 18.42 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 16.45it/s, est. speed input: 18760.16 toks/s, output: 18.32 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 16.37it/s, est. speed input: 18659.83 toks/s, output: 18.22 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:02<00:04, 16.38it/s, est. speed input: 18578.97 toks/s, output: 18.14 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:02<00:04, 16.44it/s, est. speed input: 18512.79 toks/s, output: 18.08 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.23it/s, est. speed input: 18413.97 toks/s, output: 17.98 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.06it/s, est. speed input: 18320.11 toks/s, output: 17.89 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.10it/s, est. speed input: 18254.49 toks/s, output: 17.83 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:04, 16.14it/s, est. speed input: 18196.35 toks/s, output: 17.77 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:04, 16.13it/s, est. speed input: 18137.02 toks/s, output: 17.71 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 16.18it/s, est. speed input: 18088.87 toks/s, output: 17.66 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 16.19it/s, est. speed input: 18041.08 toks/s, output: 17.62 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:03<00:03, 16.17it/s, est. speed input: 17992.00 toks/s, output: 17.57 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.19it/s, est. speed input: 17950.93 toks/s, output: 17.53 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.16it/s, est. speed input: 17906.69 toks/s, output: 17.49 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.13it/s, est. speed input: 17864.76 toks/s, output: 17.45 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.11it/s, est. speed input: 17824.76 toks/s, output: 17.41 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:03, 16.10it/s, est. speed input: 17787.60 toks/s, output: 17.37 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 16.13it/s, est. speed input: 17755.36 toks/s, output: 17.34 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 16.19it/s, est. speed input: 17729.06 toks/s, output: 17.31 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:04<00:02, 16.55it/s, est. speed input: 17732.66 toks/s, output: 17.32 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.83it/s, est. speed input: 17737.51 toks/s, output: 17.32 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 17.03it/s, est. speed input: 17742.20 toks/s, output: 17.33 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 17.20it/s, est. speed input: 17748.48 toks/s, output: 17.33 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 17.26it/s, est. speed input: 17749.88 toks/s, output: 17.33 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 17.28it/s, est. speed input: 17750.05 toks/s, output: 17.33 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 17.29it/s, est. speed input: 17749.68 toks/s, output: 17.33 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 17.29it/s, est. speed input: 17748.80 toks/s, output: 17.33 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 17.37it/s, est. speed input: 17753.23 toks/s, output: 17.34 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:05<00:01, 17.42it/s, est. speed input: 17757.30 toks/s, output: 17.34 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 17.45it/s, est. speed input: 17760.68 toks/s, output: 17.34 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 17.47it/s, est. speed input: 17764.17 toks/s, output: 17.35 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 17.39it/s, est. speed input: 17761.41 toks/s, output: 17.35 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:00, 17.42it/s, est. speed input: 17763.97 toks/s, output: 17.35 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 17.42it/s, est. speed input: 17765.44 toks/s, output: 17.35 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 17.46it/s, est. speed input: 17768.88 toks/s, output: 17.35 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 17.44it/s, est. speed input: 17769.86 toks/s, output: 17.35 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 17.40it/s, est. speed input: 17769.06 toks/s, output: 17.35 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:06<00:00, 17.42it/s, est. speed input: 17770.72 toks/s, output: 17.35 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 17.46it/s, est. speed input: 17773.98 toks/s, output: 17.36 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 17.47it/s, est. speed input: 17776.49 toks/s, output: 17.36 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 17.51it/s, est. speed input: 17780.30 toks/s, output: 17.36 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.51it/s, est. speed input: 17783.32 toks/s, output: 17.37 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.37it/s, est. speed input: 17783.32 toks/s, output: 17.37 toks/s]
[rank0]:[W128 11:19:27.450498808 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 50.5s

测试结果:
  Requests/s:   16.61
  Tokens/s:     17024.56
  Total Reqs:   128
  Elapsed:      7.71s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     17007.95

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:19:37 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:19:38 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=14745) WARNING 01-28 11:19:45 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=14745) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=14745) WARNING 01-28 11:19:57 [backends.py:609] Failed to read file <frozen os>
Throughput: 34.81 requests/s, 35684.14 total tokens/s, 34.81 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:19:37] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:19:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:19:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:19:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:19:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:19:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:19:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:19:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:19:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:19:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:19:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:19:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:19:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:19:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:19:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:19:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:19:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:19:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:19:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:45] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:45] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:45] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:45] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:45] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:45] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=14745) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=14745) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.69it/s]
(EngineCore_DP0 pid=14745) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.69it/s]
(EngineCore_DP0 pid=14745) 
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=14745) [2026-01-28 11:19:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=14745) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  8.05it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.97it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  8.07it/s]
(EngineCore_DP0 pid=14745) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.54it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.35it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.22it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  15%|█▌        | 39/256 [00:00<00:00, 381.90it/s]
Adding requests:  31%|███       | 79/256 [00:00<00:00, 389.30it/s]
Adding requests:  46%|████▌     | 118/256 [00:00<00:00, 389.54it/s]
Adding requests:  62%|██████▏   | 158/256 [00:00<00:00, 391.59it/s]
Adding requests:  77%|███████▋  | 198/256 [00:00<00:00, 379.75it/s]
Adding requests:  94%|█████████▍| 240/256 [00:00<00:00, 390.12it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 389.07it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:00<00:01, 168.15it/s, est. speed input: 172218.91 toks/s, output: 168.16 toks/s]
Processed prompts:  14%|█▎        | 35/256 [00:00<00:03, 56.19it/s, est. speed input: 64123.51 toks/s, output: 62.62 toks/s]   
Processed prompts:  18%|█▊        | 45/256 [00:00<00:04, 47.46it/s, est. speed input: 55021.50 toks/s, output: 53.73 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:04, 42.24it/s, est. speed input: 50277.33 toks/s, output: 49.10 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:04, 40.35it/s, est. speed input: 48290.88 toks/s, output: 47.16 toks/s]
Processed prompts:  25%|██▍       | 63/256 [00:01<00:04, 41.13it/s, est. speed input: 48034.75 toks/s, output: 46.91 toks/s]
Processed prompts:  27%|██▋       | 68/256 [00:01<00:04, 38.00it/s, est. speed input: 46205.78 toks/s, output: 45.12 toks/s]
Processed prompts:  29%|██▊       | 73/256 [00:01<00:04, 39.58it/s, est. speed input: 46206.50 toks/s, output: 45.12 toks/s]
Processed prompts:  30%|███       | 78/256 [00:01<00:04, 36.62it/s, est. speed input: 44804.13 toks/s, output: 43.75 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:01<00:04, 36.63it/s, est. speed input: 44386.02 toks/s, output: 43.35 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:04, 36.64it/s, est. speed input: 44012.64 toks/s, output: 42.98 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:04, 36.53it/s, est. speed input: 43652.19 toks/s, output: 42.63 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:04, 36.39it/s, est. speed input: 43314.41 toks/s, output: 42.30 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 36.08it/s, est. speed input: 42967.03 toks/s, output: 41.96 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 36.08it/s, est. speed input: 42693.62 toks/s, output: 41.69 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:02<00:04, 36.22it/s, est. speed input: 42469.30 toks/s, output: 41.47 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:02<00:04, 36.37it/s, est. speed input: 42270.49 toks/s, output: 41.28 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:02<00:03, 36.43it/s, est. speed input: 42080.70 toks/s, output: 41.09 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:02<00:03, 36.49it/s, est. speed input: 41907.20 toks/s, output: 40.92 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:02<00:03, 36.54it/s, est. speed input: 41748.93 toks/s, output: 40.77 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:03<00:03, 36.51it/s, est. speed input: 41591.29 toks/s, output: 40.62 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:03<00:03, 36.35it/s, est. speed input: 41426.78 toks/s, output: 40.46 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:03<00:03, 36.15it/s, est. speed input: 41262.56 toks/s, output: 40.30 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:03<00:03, 36.12it/s, est. speed input: 41121.84 toks/s, output: 40.16 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:03<00:03, 36.05it/s, est. speed input: 40984.95 toks/s, output: 40.02 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:03<00:03, 36.02it/s, est. speed input: 40857.84 toks/s, output: 39.90 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:03<00:02, 36.10it/s, est. speed input: 40749.26 toks/s, output: 39.79 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:03<00:02, 36.15it/s, est. speed input: 40646.92 toks/s, output: 39.69 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:03<00:02, 36.23it/s, est. speed input: 40554.36 toks/s, output: 39.60 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:04<00:02, 36.13it/s, est. speed input: 40451.08 toks/s, output: 39.50 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:04<00:02, 36.23it/s, est. speed input: 40370.18 toks/s, output: 39.42 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:04<00:02, 36.27it/s, est. speed input: 40290.66 toks/s, output: 39.35 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:04<00:02, 36.20it/s, est. speed input: 40205.65 toks/s, output: 39.26 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:04<00:02, 36.28it/s, est. speed input: 40136.70 toks/s, output: 39.20 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:04<00:02, 36.35it/s, est. speed input: 40071.55 toks/s, output: 39.13 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:04<00:01, 36.43it/s, est. speed input: 40012.33 toks/s, output: 39.07 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:04<00:01, 36.49it/s, est. speed input: 39956.28 toks/s, output: 39.02 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:04<00:01, 36.57it/s, est. speed input: 39905.70 toks/s, output: 38.97 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:05<00:01, 36.46it/s, est. speed input: 39844.68 toks/s, output: 38.91 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:05<00:01, 36.37it/s, est. speed input: 39784.24 toks/s, output: 38.85 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:05<00:01, 36.23it/s, est. speed input: 39720.86 toks/s, output: 38.79 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:05<00:01, 36.33it/s, est. speed input: 39675.40 toks/s, output: 38.75 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:05<00:01, 36.30it/s, est. speed input: 39623.81 toks/s, output: 38.69 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:05<00:01, 36.27it/s, est. speed input: 39574.04 toks/s, output: 38.65 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:05<00:00, 36.01it/s, est. speed input: 39509.04 toks/s, output: 38.58 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:05<00:00, 36.19it/s, est. speed input: 39471.25 toks/s, output: 38.55 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:05<00:00, 36.10it/s, est. speed input: 39420.64 toks/s, output: 38.50 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:06<00:00, 36.00it/s, est. speed input: 39369.48 toks/s, output: 38.45 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:06<00:00, 36.06it/s, est. speed input: 39328.25 toks/s, output: 38.41 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:06<00:00, 36.00it/s, est. speed input: 39282.26 toks/s, output: 38.36 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:06<00:00, 36.09it/s, est. speed input: 39246.09 toks/s, output: 38.33 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:06<00:00, 36.16it/s, est. speed input: 39211.76 toks/s, output: 38.29 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:06<00:00, 36.20it/s, est. speed input: 39177.47 toks/s, output: 38.26 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 36.20it/s, est. speed input: 39160.85 toks/s, output: 38.24 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 38.24it/s, est. speed input: 39160.85 toks/s, output: 38.24 toks/s]
[rank0]:[W128 11:20:15.395376694 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 48.3s

测试结果:
  Requests/s:   34.81
  Tokens/s:     35684.14
  Total Reqs:   256
  Elapsed:      7.35s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     35649.32

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:20:29 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:20:30 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=15271) WARNING 01-28 11:20:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=15271) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=15271) WARNING 01-28 11:20:47 [backends.py:609] Failed to read file <frozen os>
Throughput: 53.25 requests/s, 54579.34 total tokens/s, 53.25 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:20:29] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:20:29] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:20:29] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:20:29] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:29] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:29] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:29] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:29] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:29] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:20:29] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:20:29] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:20:29] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:20:29] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:20:29] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:20:37] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:20:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:20:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:20:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:20:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:20:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:20:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:20:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:20:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:20:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:38] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:38] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:38] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:38] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:38] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:38] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=15271) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=15271) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.62it/s]
(EngineCore_DP0 pid=15271) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.62it/s]
(EngineCore_DP0 pid=15271) 
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=15271) [2026-01-28 11:20:39] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=15271) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  8.22it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.76it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.89it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.20it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.38it/s]
(EngineCore_DP0 pid=15271) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.63it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.63it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  9.08it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.83it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 35/512 [00:00<00:01, 344.87it/s]
Adding requests:  14%|█▍        | 73/512 [00:00<00:01, 360.88it/s]
Adding requests:  21%|██▏       | 110/512 [00:00<00:01, 364.32it/s]
Adding requests:  29%|██▊       | 147/512 [00:00<00:01, 363.87it/s]
Adding requests:  36%|███▌      | 184/512 [00:00<00:00, 361.51it/s]
Adding requests:  43%|████▎     | 221/512 [00:00<00:00, 358.15it/s]
Adding requests:  51%|█████     | 259/512 [00:00<00:00, 363.50it/s]
Adding requests:  58%|█████▊    | 296/512 [00:00<00:00, 352.47it/s]
Adding requests:  65%|██████▍   | 332/512 [00:00<00:00, 352.22it/s]
Adding requests:  72%|███████▏  | 369/512 [00:01<00:00, 355.22it/s]
Adding requests:  79%|███████▉  | 405/512 [00:01<00:00, 352.78it/s]
Adding requests:  86%|████████▌ | 441/512 [00:01<00:00, 352.53it/s]
Adding requests:  93%|█████████▎| 478/512 [00:01<00:00, 357.09it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 357.14it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:00<00:00, 496.58it/s, est. speed input: 508590.21 toks/s, output: 496.60 toks/s]
Processed prompts:  23%|██▎       | 116/512 [00:01<00:04, 98.29it/s, est. speed input: 116617.28 toks/s, output: 113.88 toks/s]
Processed prompts:  27%|██▋       | 140/512 [00:01<00:04, 81.07it/s, est. speed input: 98184.87 toks/s, output: 95.88 toks/s]  
Processed prompts:  30%|███       | 156/512 [00:01<00:04, 73.79it/s, est. speed input: 91037.01 toks/s, output: 88.90 toks/s]
Processed prompts:  33%|███▎      | 168/512 [00:04<00:15, 21.91it/s, est. speed input: 41978.66 toks/s, output: 40.99 toks/s]
Processed prompts:  34%|███▍      | 176/512 [00:04<00:14, 23.97it/s, est. speed input: 42449.10 toks/s, output: 41.45 toks/s]
Processed prompts:  36%|███▌      | 183/512 [00:04<00:12, 25.93it/s, est. speed input: 42659.52 toks/s, output: 41.66 toks/s]
Processed prompts:  37%|███▋      | 190/512 [00:04<00:11, 28.21it/s, est. speed input: 42850.38 toks/s, output: 41.84 toks/s]
Processed prompts:  39%|███▊      | 198/512 [00:04<00:09, 31.62it/s, est. speed input: 43240.87 toks/s, output: 42.23 toks/s]
Processed prompts:  40%|████      | 206/512 [00:04<00:08, 35.18it/s, est. speed input: 43609.84 toks/s, output: 42.59 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:04<00:07, 38.68it/s, est. speed input: 43962.56 toks/s, output: 42.93 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:05<00:06, 41.91it/s, est. speed input: 44292.10 toks/s, output: 43.25 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:05<00:06, 44.73it/s, est. speed input: 44604.63 toks/s, output: 43.56 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:05<00:05, 47.02it/s, est. speed input: 44895.74 toks/s, output: 43.84 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:05<00:05, 48.87it/s, est. speed input: 45174.31 toks/s, output: 44.12 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:05<00:05, 50.32it/s, est. speed input: 45440.55 toks/s, output: 44.38 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:05<00:04, 51.41it/s, est. speed input: 45694.03 toks/s, output: 44.62 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:06<00:04, 52.20it/s, est. speed input: 45935.46 toks/s, output: 44.86 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:06<00:04, 52.76it/s, est. speed input: 46161.66 toks/s, output: 45.08 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:06<00:04, 53.18it/s, est. speed input: 46380.18 toks/s, output: 45.29 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:06<00:04, 53.49it/s, est. speed input: 46589.66 toks/s, output: 45.50 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:06<00:03, 53.69it/s, est. speed input: 46787.61 toks/s, output: 45.69 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:06<00:03, 53.85it/s, est. speed input: 46978.30 toks/s, output: 45.88 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:06<00:03, 53.91it/s, est. speed input: 47157.69 toks/s, output: 46.05 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:07<00:03, 53.97it/s, est. speed input: 47330.49 toks/s, output: 46.22 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:07<00:03, 54.03it/s, est. speed input: 47497.32 toks/s, output: 46.38 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:07<00:03, 54.89it/s, est. speed input: 47705.19 toks/s, output: 46.59 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:07<00:02, 54.66it/s, est. speed input: 47857.71 toks/s, output: 46.74 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:07<00:02, 54.47it/s, est. speed input: 48002.80 toks/s, output: 46.88 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:07<00:02, 54.36it/s, est. speed input: 48143.07 toks/s, output: 47.01 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:07<00:02, 54.72it/s, est. speed input: 48302.35 toks/s, output: 47.17 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:08<00:02, 55.45it/s, est. speed input: 48480.63 toks/s, output: 47.34 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:08<00:02, 55.93it/s, est. speed input: 48651.02 toks/s, output: 47.51 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:08<00:02, 56.29it/s, est. speed input: 48816.39 toks/s, output: 47.67 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:08<00:01, 56.59it/s, est. speed input: 48978.67 toks/s, output: 47.83 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:08<00:01, 56.75it/s, est. speed input: 49133.18 toks/s, output: 47.98 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:08<00:01, 56.79it/s, est. speed input: 49279.57 toks/s, output: 48.12 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:08<00:01, 56.93it/s, est. speed input: 49425.95 toks/s, output: 48.27 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:09<00:01, 56.99it/s, est. speed input: 49566.49 toks/s, output: 48.40 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:09<00:01, 57.02it/s, est. speed input: 49702.28 toks/s, output: 48.54 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:09<00:01, 57.06it/s, est. speed input: 49834.60 toks/s, output: 48.67 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:09<00:00, 57.02it/s, est. speed input: 49959.94 toks/s, output: 48.79 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:09<00:00, 57.07it/s, est. speed input: 50085.17 toks/s, output: 48.91 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:09<00:00, 57.03it/s, est. speed input: 50203.73 toks/s, output: 49.03 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:09<00:00, 57.03it/s, est. speed input: 50320.31 toks/s, output: 49.14 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:10<00:00, 57.05it/s, est. speed input: 50433.58 toks/s, output: 49.25 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:10<00:00, 57.09it/s, est. speed input: 50545.58 toks/s, output: 49.36 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:10<00:00, 58.15it/s, est. speed input: 50695.09 toks/s, output: 49.51 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:10<00:00, 58.15it/s, est. speed input: 50892.99 toks/s, output: 49.70 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:10<00:00, 49.70it/s, est. speed input: 50892.99 toks/s, output: 49.70 toks/s]
[rank0]:[W128 11:21:10.412359074 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 54.7s

测试结果:
  Requests/s:   53.25
  Tokens/s:     54579.34
  Total Reqs:   512
  Elapsed:      9.62s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     54526.09

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:21:24 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:21:25 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=15835) WARNING 01-28 11:21:32 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=15835) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=15835) WARNING 01-28 11:21:44 [backends.py:609] Failed to read file <frozen os>
Throughput: 55.31 requests/s, 56696.32 total tokens/s, 55.31 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:21:24] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:21:24] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:21:24] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:21:24] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:24] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:24] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:24] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:24] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:24] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:21:24] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:21:24] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:21:24] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:21:24] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:21:24] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:21:31] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:21:31] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:21:31] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:21:31] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:31] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:31] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:31] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:31] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:21:31] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:21:31] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:21:31] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:21:31] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:21:31] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:21:31] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:33] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:33] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:33] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:33] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:33] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:33] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=15835) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=15835) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.64it/s]
(EngineCore_DP0 pid=15835) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.64it/s]
(EngineCore_DP0 pid=15835) 
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=15835) [2026-01-28 11:21:34] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=15835) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  8.26it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  8.49it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  8.82it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  8.93it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.26it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.45it/s]
(EngineCore_DP0 pid=15835) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.50it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.54it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  8.88it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  9.02it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.80it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 37/1024 [00:00<00:02, 362.20it/s]
Adding requests:   7%|▋         | 75/1024 [00:00<00:02, 370.30it/s]
Adding requests:  11%|█         | 114/1024 [00:00<00:02, 374.91it/s]
Adding requests:  15%|█▍        | 152/1024 [00:00<00:02, 372.69it/s]
Adding requests:  19%|█▊        | 191/1024 [00:00<00:02, 376.03it/s]
Adding requests:  22%|██▏       | 230/1024 [00:00<00:02, 379.30it/s]
Adding requests:  26%|██▋       | 269/1024 [00:00<00:01, 380.10it/s]
Adding requests:  30%|███       | 308/1024 [00:00<00:01, 376.40it/s]
Adding requests:  34%|███▍      | 347/1024 [00:00<00:01, 377.88it/s]
Adding requests:  38%|███▊      | 386/1024 [00:01<00:01, 380.78it/s]
Adding requests:  42%|████▏     | 426/1024 [00:01<00:01, 382.92it/s]
Adding requests:  45%|████▌     | 465/1024 [00:01<00:01, 380.52it/s]
Adding requests:  49%|████▉     | 504/1024 [00:01<00:01, 380.18it/s]
Adding requests:  53%|█████▎    | 543/1024 [00:01<00:01, 371.12it/s]
Adding requests:  57%|█████▋    | 582/1024 [00:01<00:01, 375.92it/s]
Adding requests:  61%|██████    | 620/1024 [00:01<00:01, 369.61it/s]
Adding requests:  64%|██████▍   | 659/1024 [00:01<00:00, 373.41it/s]
Adding requests:  68%|██████▊   | 697/1024 [00:01<00:00, 374.40it/s]
Adding requests:  72%|███████▏  | 737/1024 [00:01<00:00, 380.33it/s]
Adding requests:  76%|███████▌  | 776/1024 [00:02<00:00, 378.86it/s]
Adding requests:  79%|███████▉  | 814/1024 [00:02<00:00, 375.04it/s]
Adding requests:  83%|████████▎ | 853/1024 [00:02<00:00, 377.48it/s]
Adding requests:  87%|████████▋ | 894/1024 [00:02<00:00, 386.90it/s]
Adding requests:  91%|█████████▏| 935/1024 [00:02<00:00, 391.30it/s]
Adding requests:  95%|█████████▌| 975/1024 [00:02<00:00, 393.48it/s]
Adding requests:  99%|█████████▉| 1015/1024 [00:02<00:00, 394.95it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 380.60it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  14%|█▍        | 146/1024 [00:00<00:01, 675.71it/s, est. speed input: 692008.11 toks/s, output: 675.73 toks/s]
Processed prompts:  21%|██        | 214/1024 [00:01<00:06, 131.39it/s, est. speed input: 161101.01 toks/s, output: 157.32 toks/s]
Processed prompts:  24%|██▍       | 246/1024 [00:01<00:07, 102.09it/s, est. speed input: 130257.72 toks/s, output: 127.20 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:02<00:08, 85.78it/s, est. speed input: 115215.05 toks/s, output: 112.51 toks/s] 
Processed prompts:  27%|██▋       | 280/1024 [00:02<00:08, 87.23it/s, est. speed input: 114342.23 toks/s, output: 111.66 toks/s]
Processed prompts:  29%|██▊       | 293/1024 [00:02<00:09, 76.40it/s, est. speed input: 107391.95 toks/s, output: 104.87 toks/s]
Processed prompts:  30%|██▉       | 303/1024 [00:02<00:09, 75.36it/s, est. speed input: 105636.47 toks/s, output: 103.16 toks/s]
Processed prompts:  30%|███       | 312/1024 [00:03<00:09, 73.08it/s, est. speed input: 103718.11 toks/s, output: 101.29 toks/s]
Processed prompts:  31%|███▏      | 320/1024 [00:03<00:10, 69.52it/s, est. speed input: 101652.53 toks/s, output: 99.27 toks/s] 
Processed prompts:  32%|███▏      | 328/1024 [00:03<00:10, 66.39it/s, est. speed input: 99755.43 toks/s, output: 97.42 toks/s] 
Processed prompts:  33%|███▎      | 335/1024 [00:03<00:11, 62.01it/s, est. speed input: 97707.92 toks/s, output: 95.42 toks/s]
Processed prompts:  33%|███▎      | 342/1024 [00:03<00:11, 58.57it/s, est. speed input: 95832.60 toks/s, output: 93.59 toks/s]
Processed prompts:  34%|███▍      | 348/1024 [00:03<00:12, 54.06it/s, est. speed input: 93835.61 toks/s, output: 91.64 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:03<00:13, 50.68it/s, est. speed input: 91987.68 toks/s, output: 89.83 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:04<00:12, 52.17it/s, est. speed input: 90771.00 toks/s, output: 88.64 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:04<00:12, 53.22it/s, est. speed input: 89630.23 toks/s, output: 87.53 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:04<00:11, 53.90it/s, est. speed input: 88549.86 toks/s, output: 86.47 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:04<00:11, 54.46it/s, est. speed input: 87552.91 toks/s, output: 85.50 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:04<00:11, 54.84it/s, est. speed input: 86614.24 toks/s, output: 84.58 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:04<00:11, 55.11it/s, est. speed input: 85731.41 toks/s, output: 83.72 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:04<00:11, 55.29it/s, est. speed input: 84898.37 toks/s, output: 82.91 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:10, 55.43it/s, est. speed input: 84114.54 toks/s, output: 82.14 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:10, 55.53it/s, est. speed input: 83373.57 toks/s, output: 81.42 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:05<00:10, 55.60it/s, est. speed input: 82673.00 toks/s, output: 80.74 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:05<00:10, 55.62it/s, est. speed input: 82003.92 toks/s, output: 80.08 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:05<00:10, 55.64it/s, est. speed input: 81370.40 toks/s, output: 79.46 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:05<00:10, 55.67it/s, est. speed input: 80769.69 toks/s, output: 78.88 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:05<00:10, 55.71it/s, est. speed input: 80200.76 toks/s, output: 78.32 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:09, 55.75it/s, est. speed input: 79659.78 toks/s, output: 77.79 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:09, 55.78it/s, est. speed input: 79143.52 toks/s, output: 77.29 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:06<00:09, 55.79it/s, est. speed input: 78649.03 toks/s, output: 76.81 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:06<00:09, 55.79it/s, est. speed input: 78176.49 toks/s, output: 76.34 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:06<00:09, 55.78it/s, est. speed input: 77722.95 toks/s, output: 75.90 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:06<00:09, 55.78it/s, est. speed input: 77289.14 toks/s, output: 75.48 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:06<00:08, 55.79it/s, est. speed input: 76874.08 toks/s, output: 75.07 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:08, 55.82it/s, est. speed input: 76477.53 toks/s, output: 74.68 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:07<00:08, 55.86it/s, est. speed input: 76099.07 toks/s, output: 74.32 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:07<00:08, 55.87it/s, est. speed input: 75733.33 toks/s, output: 73.96 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:07<00:08, 55.86it/s, est. speed input: 75379.97 toks/s, output: 73.61 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:07<00:08, 55.84it/s, est. speed input: 75038.86 toks/s, output: 73.28 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:07<00:08, 55.83it/s, est. speed input: 74710.10 toks/s, output: 72.96 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:07<00:07, 55.85it/s, est. speed input: 74396.04 toks/s, output: 72.65 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:07, 55.85it/s, est. speed input: 74092.00 toks/s, output: 72.36 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:08<00:07, 55.86it/s, est. speed input: 73798.86 toks/s, output: 72.07 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:08<00:07, 55.85it/s, est. speed input: 73514.39 toks/s, output: 71.79 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:08<00:07, 55.87it/s, est. speed input: 73241.73 toks/s, output: 71.52 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:08<00:07, 55.85it/s, est. speed input: 72975.80 toks/s, output: 71.27 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:08<00:07, 55.84it/s, est. speed input: 72718.39 toks/s, output: 71.01 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:08<00:06, 55.82it/s, est. speed input: 72468.57 toks/s, output: 70.77 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:06, 55.85it/s, est. speed input: 72229.60 toks/s, output: 70.54 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:09<00:06, 55.85it/s, est. speed input: 71996.46 toks/s, output: 70.31 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:09<00:06, 55.88it/s, est. speed input: 71772.35 toks/s, output: 70.09 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:09<00:06, 55.86it/s, est. speed input: 71552.95 toks/s, output: 69.88 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:09<00:06, 55.81it/s, est. speed input: 71337.30 toks/s, output: 69.67 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:09<00:06, 55.83it/s, est. speed input: 71131.52 toks/s, output: 69.46 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:09<00:05, 55.85it/s, est. speed input: 70931.73 toks/s, output: 69.27 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:10<00:05, 55.85it/s, est. speed input: 70736.77 toks/s, output: 69.08 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:10<00:05, 55.84it/s, est. speed input: 70546.72 toks/s, output: 68.89 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:10<00:05, 55.79it/s, est. speed input: 70359.63 toks/s, output: 68.71 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:10<00:05, 55.76it/s, est. speed input: 70178.06 toks/s, output: 68.53 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:10<00:05, 55.73it/s, est. speed input: 70000.53 toks/s, output: 68.36 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:10<00:05, 55.75it/s, est. speed input: 69829.87 toks/s, output: 68.19 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:10<00:04, 55.79it/s, est. speed input: 69665.68 toks/s, output: 68.03 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:11<00:04, 55.81it/s, est. speed input: 69504.55 toks/s, output: 67.88 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:11<00:04, 55.80it/s, est. speed input: 69346.52 toks/s, output: 67.72 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:11<00:04, 55.81it/s, est. speed input: 69193.62 toks/s, output: 67.57 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:11<00:04, 55.83it/s, est. speed input: 69044.93 toks/s, output: 67.43 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:11<00:04, 55.79it/s, est. speed input: 68897.48 toks/s, output: 67.28 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:11<00:04, 55.74it/s, est. speed input: 68751.94 toks/s, output: 67.14 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:11<00:03, 55.75it/s, est. speed input: 68612.77 toks/s, output: 67.00 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:17, 12.11it/s, est. speed input: 59942.39 toks/s, output: 58.54 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:13, 15.82it/s, est. speed input: 59914.00 toks/s, output: 58.51 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:14<00:09, 20.16it/s, est. speed input: 59886.61 toks/s, output: 58.48 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:14<00:07, 24.94it/s, est. speed input: 59858.87 toks/s, output: 58.46 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:14<00:06, 29.89it/s, est. speed input: 59831.16 toks/s, output: 58.43 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:14<00:05, 34.73it/s, est. speed input: 59804.67 toks/s, output: 58.40 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:14<00:04, 39.17it/s, est. speed input: 59778.84 toks/s, output: 58.38 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:14<00:03, 43.00it/s, est. speed input: 59752.61 toks/s, output: 58.35 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:03, 46.16it/s, est. speed input: 59726.63 toks/s, output: 58.33 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:15<00:02, 48.64it/s, est. speed input: 59700.21 toks/s, output: 58.30 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:15<00:02, 50.56it/s, est. speed input: 59675.16 toks/s, output: 58.28 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:15<00:02, 52.01it/s, est. speed input: 59650.77 toks/s, output: 58.25 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:15<00:02, 53.04it/s, est. speed input: 59625.85 toks/s, output: 58.23 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:15<00:02, 53.81it/s, est. speed input: 59602.13 toks/s, output: 58.21 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:15<00:01, 54.40it/s, est. speed input: 59580.12 toks/s, output: 58.18 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 54.77it/s, est. speed input: 59556.69 toks/s, output: 58.16 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:16<00:01, 55.03it/s, est. speed input: 59533.79 toks/s, output: 58.14 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:16<00:01, 55.23it/s, est. speed input: 59511.80 toks/s, output: 58.12 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:16<00:01, 55.41it/s, est. speed input: 59491.26 toks/s, output: 58.10 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:16<00:01, 55.49it/s, est. speed input: 59469.97 toks/s, output: 58.08 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:16<00:00, 55.47it/s, est. speed input: 59446.48 toks/s, output: 58.05 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 55.36it/s, est. speed input: 59420.48 toks/s, output: 58.03 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 57.21it/s, est. speed input: 59451.60 toks/s, output: 58.06 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:17<00:00, 56.61it/s, est. speed input: 59427.42 toks/s, output: 58.03 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:17<00:00, 56.17it/s, est. speed input: 59402.90 toks/s, output: 58.01 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:17<00:00, 55.90it/s, est. speed input: 59379.60 toks/s, output: 57.99 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:17<00:00, 57.79it/s, est. speed input: 59414.88 toks/s, output: 58.02 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 57.79it/s, est. speed input: 59764.27 toks/s, output: 58.36 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 58.36it/s, est. speed input: 59764.27 toks/s, output: 58.36 toks/s]
[rank0]:[W128 11:22:16.959794254 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 65.9s

测试结果:
  Requests/s:   55.31
  Tokens/s:     56696.32
  Total Reqs:   1024
  Elapsed:      18.51s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     56641.01

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:22:36 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:22:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=16518) WARNING 01-28 11:22:44 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=16518) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=16518) WARNING 01-28 11:22:55 [backends.py:609] Failed to read file <frozen os>
Throughput: 55.37 requests/s, 56756.52 total tokens/s, 55.37 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:22:36] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:22:36] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:22:36] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:22:36] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:36] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:36] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:36] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:36] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:36] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:22:36] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:22:36] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:22:36] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:22:36] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:22:36] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:22:43] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:22:43] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:22:43] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:22:43] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:43] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:43] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:43] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:43] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:22:43] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:22:43] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:22:43] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:22:43] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:22:43] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:22:43] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:44] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:44] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:44] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:44] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:44] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:44] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=16518) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=16518) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.38s/it]
(EngineCore_DP0 pid=16518) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.38s/it]
(EngineCore_DP0 pid=16518) 
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=16518) [2026-01-28 11:22:47] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=16518) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  8.11it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  8.27it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.83it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.98it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.37it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.56it/s]
(EngineCore_DP0 pid=16518) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.52it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  8.50it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.96it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  9.21it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  9.36it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  9.05it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 36/2048 [00:00<00:05, 357.94it/s]
Adding requests:   4%|▎         | 75/2048 [00:00<00:05, 372.59it/s]
Adding requests:   6%|▌         | 115/2048 [00:00<00:05, 381.67it/s]
Adding requests:   8%|▊         | 154/2048 [00:00<00:04, 382.15it/s]
Adding requests:   9%|▉         | 193/2048 [00:00<00:04, 381.09it/s]
Adding requests:  11%|█▏        | 234/2048 [00:00<00:04, 387.46it/s]
Adding requests:  13%|█▎        | 274/2048 [00:00<00:04, 391.29it/s]
Adding requests:  15%|█▌        | 314/2048 [00:00<00:04, 387.49it/s]
Adding requests:  17%|█▋        | 354/2048 [00:00<00:04, 390.43it/s]
Adding requests:  19%|█▉        | 394/2048 [00:01<00:04, 391.35it/s]
Adding requests:  21%|██        | 434/2048 [00:01<00:04, 388.92it/s]
Adding requests:  23%|██▎       | 474/2048 [00:01<00:04, 391.27it/s]
Adding requests:  25%|██▌       | 514/2048 [00:01<00:03, 390.83it/s]
Adding requests:  27%|██▋       | 554/2048 [00:01<00:03, 386.68it/s]
Adding requests:  29%|██▉       | 596/2048 [00:01<00:03, 392.13it/s]
Adding requests:  31%|███       | 636/2048 [00:01<00:03, 389.21it/s]
Adding requests:  33%|███▎      | 676/2048 [00:01<00:03, 391.07it/s]
Adding requests:  35%|███▍      | 716/2048 [00:01<00:03, 393.02it/s]
Adding requests:  37%|███▋      | 756/2048 [00:01<00:03, 386.17it/s]
Adding requests:  39%|███▉      | 795/2048 [00:02<00:03, 385.69it/s]
Adding requests:  41%|████      | 834/2048 [00:02<00:03, 383.07it/s]
Adding requests:  43%|████▎     | 873/2048 [00:02<00:03, 380.55it/s]
Adding requests:  45%|████▍     | 915/2048 [00:02<00:02, 391.13it/s]
Adding requests:  47%|████▋     | 956/2048 [00:02<00:02, 395.26it/s]
Adding requests:  49%|████▊     | 996/2048 [00:02<00:02, 395.91it/s]
Adding requests:  51%|█████     | 1038/2048 [00:02<00:02, 401.12it/s]
Adding requests:  53%|█████▎    | 1079/2048 [00:02<00:02, 401.18it/s]
Adding requests:  55%|█████▍    | 1120/2048 [00:02<00:02, 398.00it/s]
Adding requests:  57%|█████▋    | 1163/2048 [00:02<00:02, 404.69it/s]
Adding requests:  59%|█████▉    | 1206/2048 [00:03<00:02, 411.29it/s]
Adding requests:  61%|██████    | 1248/2048 [00:03<00:01, 405.07it/s]
Adding requests:  63%|██████▎   | 1289/2048 [00:03<00:01, 404.28it/s]
Adding requests:  65%|██████▍   | 1331/2048 [00:03<00:01, 406.29it/s]
Adding requests:  67%|██████▋   | 1373/2048 [00:03<00:01, 408.10it/s]
Adding requests:  69%|██████▉   | 1415/2048 [00:03<00:01, 410.57it/s]
Adding requests:  71%|███████   | 1457/2048 [00:03<00:01, 407.79it/s]
Adding requests:  73%|███████▎  | 1499/2048 [00:03<00:01, 410.68it/s]
Adding requests:  75%|███████▌  | 1541/2048 [00:03<00:01, 409.54it/s]
Adding requests:  77%|███████▋  | 1582/2048 [00:04<00:01, 404.36it/s]
Adding requests:  79%|███████▉  | 1624/2048 [00:04<00:01, 407.38it/s]
Adding requests:  81%|████████▏ | 1665/2048 [00:04<00:00, 407.62it/s]
Adding requests:  83%|████████▎ | 1706/2048 [00:04<00:00, 406.50it/s]
Adding requests:  85%|████████▌ | 1747/2048 [00:04<00:00, 406.74it/s]
Adding requests:  87%|████████▋ | 1788/2048 [00:04<00:00, 402.44it/s]
Adding requests:  89%|████████▉ | 1829/2048 [00:04<00:00, 400.94it/s]
Adding requests:  91%|█████████▏| 1870/2048 [00:04<00:00, 399.27it/s]
Adding requests:  93%|█████████▎| 1911/2048 [00:04<00:00, 400.61it/s]
Adding requests:  95%|█████████▌| 1952/2048 [00:04<00:00, 402.93it/s]
Adding requests:  97%|█████████▋| 1993/2048 [00:05<00:00, 403.36it/s]
Adding requests:  99%|█████████▉| 2034/2048 [00:05<00:00, 393.28it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 396.49it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:00<00:01, 1418.99it/s, est. speed input: 1453310.44 toks/s, output: 1419.11 toks/s]
Processed prompts:  20%|██        | 416/2048 [00:02<00:11, 137.44it/s, est. speed input: 171305.61 toks/s, output: 167.29 toks/s]   
Processed prompts:  23%|██▎       | 479/2048 [00:03<00:15, 103.91it/s, est. speed input: 134694.18 toks/s, output: 131.54 toks/s]
Processed prompts:  25%|██▌       | 516/2048 [00:04<00:17, 85.58it/s, est. speed input: 117370.42 toks/s, output: 114.62 toks/s] 
Processed prompts:  26%|██▋       | 540/2048 [00:04<00:17, 85.33it/s, est. speed input: 115463.32 toks/s, output: 112.76 toks/s]
Processed prompts:  27%|██▋       | 559/2048 [00:05<00:18, 82.40it/s, est. speed input: 112758.08 toks/s, output: 110.12 toks/s]
Processed prompts:  28%|██▊       | 574/2048 [00:05<00:19, 77.01it/s, est. speed input: 109578.92 toks/s, output: 107.01 toks/s]
Processed prompts:  29%|██▊       | 586/2048 [00:05<00:20, 69.86it/s, est. speed input: 106185.69 toks/s, output: 103.70 toks/s]
Processed prompts:  29%|██▉       | 596/2048 [00:05<00:23, 61.97it/s, est. speed input: 102773.52 toks/s, output: 100.36 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:06<00:24, 58.74it/s, est. speed input: 100329.49 toks/s, output: 97.98 toks/s] 
Processed prompts:  31%|███       | 626/2048 [00:08<01:03, 22.23it/s, est. speed input: 77199.50 toks/s, output: 75.39 toks/s] 
Processed prompts:  31%|███▏      | 642/2048 [00:08<00:53, 26.37it/s, est. speed input: 76522.32 toks/s, output: 74.73 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:08<00:45, 30.77it/s, est. speed input: 75887.89 toks/s, output: 74.11 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:09<00:39, 35.17it/s, est. speed input: 75295.02 toks/s, output: 73.53 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:09<00:34, 39.29it/s, est. speed input: 74735.40 toks/s, output: 72.98 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:09<00:31, 42.94it/s, est. speed input: 74208.73 toks/s, output: 72.47 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:10<00:28, 45.98it/s, est. speed input: 73708.23 toks/s, output: 71.98 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:10<00:27, 48.33it/s, est. speed input: 73220.26 toks/s, output: 71.50 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:10<00:25, 50.14it/s, est. speed input: 72758.79 toks/s, output: 71.05 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:10<00:24, 51.51it/s, est. speed input: 72321.56 toks/s, output: 70.63 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:11<00:24, 52.50it/s, est. speed input: 71905.11 toks/s, output: 70.22 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:11<00:23, 53.25it/s, est. speed input: 71513.89 toks/s, output: 69.84 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:11<00:22, 53.79it/s, est. speed input: 71141.70 toks/s, output: 69.47 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:12<00:22, 54.18it/s, est. speed input: 70787.98 toks/s, output: 69.13 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:12<00:22, 54.44it/s, est. speed input: 70448.93 toks/s, output: 68.80 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:12<00:21, 54.63it/s, est. speed input: 70126.49 toks/s, output: 68.48 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:12<00:21, 54.76it/s, est. speed input: 69817.44 toks/s, output: 68.18 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:13<00:20, 54.86it/s, est. speed input: 69522.97 toks/s, output: 67.89 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:13<00:20, 54.93it/s, est. speed input: 69242.04 toks/s, output: 67.62 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:13<00:20, 54.97it/s, est. speed input: 68971.31 toks/s, output: 67.35 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:14<00:20, 55.01it/s, est. speed input: 68712.72 toks/s, output: 67.10 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:14<00:19, 55.03it/s, est. speed input: 68464.60 toks/s, output: 66.86 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:14<00:19, 55.96it/s, est. speed input: 68299.45 toks/s, output: 66.70 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:14<00:18, 55.68it/s, est. speed input: 68067.13 toks/s, output: 66.47 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:15<00:18, 55.49it/s, est. speed input: 67844.39 toks/s, output: 66.25 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:15<00:18, 55.36it/s, est. speed input: 67629.78 toks/s, output: 66.04 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:15<00:18, 55.25it/s, est. speed input: 67421.52 toks/s, output: 65.84 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:16<00:17, 55.18it/s, est. speed input: 67221.87 toks/s, output: 65.65 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:16<00:17, 55.11it/s, est. speed input: 67027.57 toks/s, output: 65.46 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:16<00:17, 55.07it/s, est. speed input: 66840.68 toks/s, output: 65.27 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:16<00:17, 55.04it/s, est. speed input: 66659.56 toks/s, output: 65.10 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:17<00:16, 55.01it/s, est. speed input: 66484.42 toks/s, output: 64.93 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:17<00:16, 55.00it/s, est. speed input: 66315.77 toks/s, output: 64.76 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:17<00:15, 55.96it/s, est. speed input: 66214.35 toks/s, output: 64.66 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:18<00:15, 55.82it/s, est. speed input: 66065.13 toks/s, output: 64.52 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:18<00:15, 55.88it/s, est. speed input: 65930.37 toks/s, output: 64.39 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:18<00:15, 55.95it/s, est. speed input: 65801.13 toks/s, output: 64.26 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:18<00:14, 55.98it/s, est. speed input: 65674.77 toks/s, output: 64.14 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:19<00:14, 56.00it/s, est. speed input: 65552.39 toks/s, output: 64.02 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:19<00:14, 56.02it/s, est. speed input: 65433.40 toks/s, output: 63.90 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:19<00:13, 56.06it/s, est. speed input: 65319.82 toks/s, output: 63.79 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:20<00:13, 56.02it/s, est. speed input: 65205.47 toks/s, output: 63.68 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:20<00:13, 56.04it/s, est. speed input: 65096.81 toks/s, output: 63.57 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:20<00:13, 56.05it/s, est. speed input: 64990.69 toks/s, output: 63.47 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:20<00:12, 56.03it/s, est. speed input: 64886.48 toks/s, output: 63.37 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:21<00:12, 56.02it/s, est. speed input: 64785.24 toks/s, output: 63.27 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:21<00:12, 56.02it/s, est. speed input: 64687.08 toks/s, output: 63.17 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:21<00:11, 56.01it/s, est. speed input: 64590.57 toks/s, output: 63.08 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:22<00:11, 56.01it/s, est. speed input: 64497.02 toks/s, output: 62.99 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:22<00:11, 56.01it/s, est. speed input: 64406.23 toks/s, output: 62.90 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:22<00:11, 56.00it/s, est. speed input: 64317.20 toks/s, output: 62.81 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:22<00:10, 56.00it/s, est. speed input: 64230.57 toks/s, output: 62.73 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:23<00:10, 56.00it/s, est. speed input: 64145.77 toks/s, output: 62.64 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:23<00:10, 56.00it/s, est. speed input: 64063.51 toks/s, output: 62.56 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:23<00:09, 55.99it/s, est. speed input: 63982.64 toks/s, output: 62.48 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:24<00:09, 55.99it/s, est. speed input: 63903.97 toks/s, output: 62.41 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:24<00:09, 56.01it/s, est. speed input: 63827.62 toks/s, output: 62.33 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:24<00:09, 56.00it/s, est. speed input: 63752.67 toks/s, output: 62.26 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:24<00:08, 55.98it/s, est. speed input: 63678.58 toks/s, output: 62.19 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:25<00:08, 55.99it/s, est. speed input: 63606.94 toks/s, output: 62.12 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:25<00:08, 55.98it/s, est. speed input: 63536.46 toks/s, output: 62.05 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:25<00:07, 55.97it/s, est. speed input: 63467.17 toks/s, output: 61.98 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:26<00:07, 55.89it/s, est. speed input: 63396.51 toks/s, output: 61.91 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:26<00:07, 55.75it/s, est. speed input: 63324.09 toks/s, output: 61.84 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:26<00:07, 55.63it/s, est. speed input: 63252.35 toks/s, output: 61.77 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:27<00:06, 55.57it/s, est. speed input: 63182.72 toks/s, output: 61.70 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:27<00:06, 55.53it/s, est. speed input: 63114.85 toks/s, output: 61.64 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:27<00:06, 55.47it/s, est. speed input: 63047.40 toks/s, output: 61.57 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:27<00:06, 55.45it/s, est. speed input: 62981.75 toks/s, output: 61.51 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:28<00:05, 55.45it/s, est. speed input: 62918.11 toks/s, output: 61.44 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:28<00:05, 55.44it/s, est. speed input: 62855.55 toks/s, output: 61.38 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:28<00:05, 55.44it/s, est. speed input: 62794.29 toks/s, output: 61.32 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:29<00:04, 55.44it/s, est. speed input: 62734.57 toks/s, output: 61.26 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:29<00:04, 55.43it/s, est. speed input: 62675.34 toks/s, output: 61.21 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:29<00:04, 55.40it/s, est. speed input: 62616.66 toks/s, output: 61.15 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:29<00:04, 55.38it/s, est. speed input: 62559.18 toks/s, output: 61.09 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:30<00:03, 55.44it/s, est. speed input: 62505.22 toks/s, output: 61.04 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:30<00:03, 55.37it/s, est. speed input: 62448.44 toks/s, output: 60.98 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:30<00:03, 56.33it/s, est. speed input: 62427.55 toks/s, output: 60.96 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:31<00:02, 56.05it/s, est. speed input: 62374.83 toks/s, output: 60.91 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:31<00:02, 55.85it/s, est. speed input: 62322.53 toks/s, output: 60.86 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:31<00:02, 55.72it/s, est. speed input: 62271.66 toks/s, output: 60.81 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:31<00:01, 55.62it/s, est. speed input: 62221.47 toks/s, output: 60.76 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:32<00:01, 55.57it/s, est. speed input: 62172.54 toks/s, output: 60.72 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:32<00:01, 55.52it/s, est. speed input: 62124.24 toks/s, output: 60.67 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:32<00:01, 55.50it/s, est. speed input: 62077.05 toks/s, output: 60.62 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:33<00:00, 55.46it/s, est. speed input: 62030.02 toks/s, output: 60.58 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:33<00:00, 55.45it/s, est. speed input: 61984.27 toks/s, output: 60.53 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:33<00:00, 56.52it/s, est. speed input: 61973.42 toks/s, output: 60.52 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:33<00:00, 56.52it/s, est. speed input: 62399.33 toks/s, output: 60.94 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:33<00:00, 60.94it/s, est. speed input: 62399.33 toks/s, output: 60.94 toks/s]
[rank0]:[W128 11:23:46.741363310 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 90.3s

测试结果:
  Requests/s:   55.37
  Tokens/s:     56756.52
  Total Reqs:   2048
  Elapsed:      36.99s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     56701.14

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:24:18 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:24:19 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=17383) WARNING 01-28 11:24:26 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=17383) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=17383) WARNING 01-28 11:24:38 [backends.py:609] Failed to read file <frozen os>
Throughput: 59.23 requests/s, 60713.72 total tokens/s, 59.23 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:24:18] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:24:18] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:24:18] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:24:18] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:18] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:18] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:18] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:18] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:18] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:24:18] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:24:18] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:24:18] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:24:18] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:24:18] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:24:26] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:24:26] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:24:26] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:24:26] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:26] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:26] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:26] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:26] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:24:26] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:24:26] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:24:26] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:24:26] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:24:26] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:24:26] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:27] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:27] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:27] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:27] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:27] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:27] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=17383) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=17383) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.46s/it]
(EngineCore_DP0 pid=17383) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.46s/it]
(EngineCore_DP0 pid=17383) 
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=17383) [2026-01-28 11:24:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=17383) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.64it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  7.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.29it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.50it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.57it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  8.64it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.70it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  8.84it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  8.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.88it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.30it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.49it/s]
(EngineCore_DP0 pid=17383) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.47it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.48it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.86it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  9.13it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  9.16it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  9.27it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.30it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.06it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 35/4096 [00:00<00:11, 342.98it/s]
Adding requests:   2%|▏         | 72/4096 [00:00<00:11, 356.46it/s]
Adding requests:   3%|▎         | 110/4096 [00:00<00:10, 363.91it/s]
Adding requests:   4%|▎         | 148/4096 [00:00<00:10, 368.86it/s]
Adding requests:   5%|▍         | 187/4096 [00:00<00:10, 375.12it/s]
Adding requests:   5%|▌         | 225/4096 [00:00<00:10, 375.90it/s]
Adding requests:   6%|▋         | 265/4096 [00:00<00:10, 380.95it/s]
Adding requests:   7%|▋         | 304/4096 [00:00<00:10, 374.83it/s]
Adding requests:   8%|▊         | 342/4096 [00:00<00:10, 373.95it/s]
Adding requests:   9%|▉         | 382/4096 [00:01<00:09, 380.76it/s]
Adding requests:  10%|█         | 422/4096 [00:01<00:09, 384.08it/s]
Adding requests:  11%|█▏        | 461/4096 [00:01<00:09, 385.49it/s]
Adding requests:  12%|█▏        | 500/4096 [00:01<00:09, 384.89it/s]
Adding requests:  13%|█▎        | 539/4096 [00:01<00:09, 375.32it/s]
Adding requests:  14%|█▍        | 580/4096 [00:01<00:09, 384.86it/s]
Adding requests:  15%|█▌        | 620/4096 [00:01<00:08, 389.13it/s]
Adding requests:  16%|█▌        | 661/4096 [00:01<00:08, 393.95it/s]
Adding requests:  17%|█▋        | 702/4096 [00:01<00:08, 398.47it/s]
Adding requests:  18%|█▊        | 742/4096 [00:01<00:08, 391.45it/s]
Adding requests:  19%|█▉        | 782/4096 [00:02<00:08, 393.26it/s]
Adding requests:  20%|██        | 822/4096 [00:02<00:08, 385.81it/s]
Adding requests:  21%|██        | 863/4096 [00:02<00:08, 391.35it/s]
Adding requests:  22%|██▏       | 905/4096 [00:02<00:08, 397.08it/s]
Adding requests:  23%|██▎       | 945/4096 [00:02<00:07, 397.17it/s]
Adding requests:  24%|██▍       | 986/4096 [00:02<00:07, 398.56it/s]
Adding requests:  25%|██▌       | 1026/4096 [00:02<00:07, 396.84it/s]
Adding requests:  26%|██▌       | 1066/4096 [00:02<00:07, 397.57it/s]
Adding requests:  27%|██▋       | 1106/4096 [00:02<00:07, 388.37it/s]
Adding requests:  28%|██▊       | 1145/4096 [00:02<00:07, 387.36it/s]
Adding requests:  29%|██▉       | 1184/4096 [00:03<00:07, 380.18it/s]
Adding requests:  30%|██▉       | 1225/4096 [00:03<00:07, 386.23it/s]
Adding requests:  31%|███       | 1265/4096 [00:03<00:07, 388.29it/s]
Adding requests:  32%|███▏      | 1305/4096 [00:03<00:07, 390.72it/s]
Adding requests:  33%|███▎      | 1346/4096 [00:03<00:06, 395.06it/s]
Adding requests:  34%|███▍      | 1386/4096 [00:03<00:06, 396.28it/s]
Adding requests:  35%|███▍      | 1427/4096 [00:03<00:06, 399.66it/s]
Adding requests:  36%|███▌      | 1469/4096 [00:03<00:06, 404.06it/s]
Adding requests:  37%|███▋      | 1510/4096 [00:03<00:06, 405.47it/s]
Adding requests:  38%|███▊      | 1551/4096 [00:03<00:06, 406.30it/s]
Adding requests:  39%|███▉      | 1592/4096 [00:04<00:06, 405.58it/s]
Adding requests:  40%|███▉      | 1634/4096 [00:04<00:06, 408.37it/s]
Adding requests:  41%|████      | 1675/4096 [00:04<00:05, 403.85it/s]
Adding requests:  42%|████▏     | 1717/4096 [00:04<00:05, 406.09it/s]
Adding requests:  43%|████▎     | 1758/4096 [00:04<00:05, 405.64it/s]
Adding requests:  44%|████▍     | 1799/4096 [00:04<00:05, 404.05it/s]
Adding requests:  45%|████▍     | 1840/4096 [00:04<00:05, 398.50it/s]
Adding requests:  46%|████▌     | 1880/4096 [00:04<00:05, 395.74it/s]
Adding requests:  47%|████▋     | 1920/4096 [00:04<00:05, 394.75it/s]
Adding requests:  48%|████▊     | 1960/4096 [00:05<00:05, 396.10it/s]
Adding requests:  49%|████▉     | 2001/4096 [00:05<00:05, 398.57it/s]
Adding requests:  50%|████▉     | 2041/4096 [00:05<00:05, 397.26it/s]
Adding requests:  51%|█████     | 2083/4096 [00:05<00:05, 402.03it/s]
Adding requests:  52%|█████▏    | 2124/4096 [00:05<00:04, 400.29it/s]
Adding requests:  53%|█████▎    | 2165/4096 [00:05<00:04, 395.43it/s]
Adding requests:  54%|█████▍    | 2205/4096 [00:05<00:04, 391.38it/s]
Adding requests:  55%|█████▍    | 2245/4096 [00:05<00:04, 390.43it/s]
Adding requests:  56%|█████▌    | 2285/4096 [00:05<00:04, 389.66it/s]
Adding requests:  57%|█████▋    | 2325/4096 [00:05<00:04, 389.90it/s]
Adding requests:  58%|█████▊    | 2365/4096 [00:06<00:04, 389.89it/s]
Adding requests:  59%|█████▊    | 2404/4096 [00:06<00:04, 380.41it/s]
Adding requests:  60%|█████▉    | 2445/4096 [00:06<00:04, 387.11it/s]
Adding requests:  61%|██████    | 2486/4096 [00:06<00:04, 391.65it/s]
Adding requests:  62%|██████▏   | 2526/4096 [00:06<00:03, 392.61it/s]
Adding requests:  63%|██████▎   | 2568/4096 [00:06<00:03, 398.18it/s]
Adding requests:  64%|██████▎   | 2608/4096 [00:06<00:03, 397.97it/s]
Adding requests:  65%|██████▍   | 2648/4096 [00:06<00:03, 394.36it/s]
Adding requests:  66%|██████▌   | 2688/4096 [00:06<00:03, 390.77it/s]
Adding requests:  67%|██████▋   | 2728/4096 [00:06<00:03, 385.78it/s]
Adding requests:  68%|██████▊   | 2768/4096 [00:07<00:03, 388.64it/s]
Adding requests:  69%|██████▊   | 2808/4096 [00:07<00:03, 389.37it/s]
Adding requests:  70%|██████▉   | 2848/4096 [00:07<00:03, 391.46it/s]
Adding requests:  71%|███████   | 2889/4096 [00:07<00:03, 394.80it/s]
Adding requests:  72%|███████▏  | 2929/4096 [00:07<00:02, 389.64it/s]
Adding requests:  72%|███████▏  | 2969/4096 [00:07<00:02, 391.70it/s]
Adding requests:  73%|███████▎  | 3010/4096 [00:07<00:02, 395.59it/s]
Adding requests:  74%|███████▍  | 3050/4096 [00:07<00:02, 395.44it/s]
Adding requests:  75%|███████▌  | 3090/4096 [00:07<00:02, 387.51it/s]
Adding requests:  76%|███████▋  | 3131/4096 [00:07<00:02, 391.22it/s]
Adding requests:  77%|███████▋  | 3171/4096 [00:08<00:02, 390.87it/s]
Adding requests:  78%|███████▊  | 3211/4096 [00:08<00:02, 390.99it/s]
Adding requests:  79%|███████▉  | 3252/4096 [00:08<00:02, 395.92it/s]
Adding requests:  80%|████████  | 3292/4096 [00:08<00:02, 394.12it/s]
Adding requests:  81%|████████▏ | 3332/4096 [00:08<00:01, 395.28it/s]
Adding requests:  82%|████████▏ | 3372/4096 [00:08<00:01, 391.44it/s]
Adding requests:  83%|████████▎ | 3412/4096 [00:08<00:01, 392.28it/s]
Adding requests:  84%|████████▍ | 3452/4096 [00:08<00:01, 384.22it/s]
Adding requests:  85%|████████▌ | 3491/4096 [00:08<00:01, 382.20it/s]
Adding requests:  86%|████████▌ | 3530/4096 [00:09<00:01, 381.45it/s]
Adding requests:  87%|████████▋ | 3570/4096 [00:09<00:01, 385.85it/s]
Adding requests:  88%|████████▊ | 3611/4096 [00:09<00:01, 390.80it/s]
Adding requests:  89%|████████▉ | 3651/4096 [00:09<00:01, 391.03it/s]
Adding requests:  90%|█████████ | 3691/4096 [00:09<00:01, 391.99it/s]
Adding requests:  91%|█████████ | 3731/4096 [00:09<00:00, 391.44it/s]
Adding requests:  92%|█████████▏| 3771/4096 [00:09<00:00, 382.29it/s]
Adding requests:  93%|█████████▎| 3812/4096 [00:09<00:00, 389.37it/s]
Adding requests:  94%|█████████▍| 3853/4096 [00:09<00:00, 394.43it/s]
Adding requests:  95%|█████████▌| 3894/4096 [00:09<00:00, 396.57it/s]
Adding requests:  96%|█████████▌| 3934/4096 [00:10<00:00, 394.73it/s]
Adding requests:  97%|█████████▋| 3974/4096 [00:10<00:00, 396.17it/s]
Adding requests:  98%|█████████▊| 4015/4096 [00:10<00:00, 397.17it/s]
Adding requests:  99%|█████████▉| 4055/4096 [00:10<00:00, 394.26it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 396.47it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 391.55it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:02<00:13, 255.63it/s, est. speed input: 261764.80 toks/s, output: 255.63 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:02<00:16, 207.48it/s, est. speed input: 224512.53 toks/s, output: 219.25 toks/s]
Processed prompts:  16%|█▋        | 674/4096 [00:03<00:20, 168.85it/s, est. speed input: 198784.24 toks/s, output: 194.12 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:04<00:24, 138.77it/s, est. speed input: 179835.95 toks/s, output: 175.62 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:04<00:28, 116.37it/s, est. speed input: 165500.95 toks/s, output: 161.62 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:05<00:33, 99.88it/s, est. speed input: 154225.08 toks/s, output: 150.61 toks/s] 
Processed prompts:  20%|█▉        | 802/4096 [00:05<00:37, 87.91it/s, est. speed input: 145122.89 toks/s, output: 141.72 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:06<00:41, 79.30it/s, est. speed input: 137614.06 toks/s, output: 134.39 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:06<00:44, 73.19it/s, est. speed input: 131328.71 toks/s, output: 128.25 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:07<00:46, 68.84it/s, est. speed input: 125981.10 toks/s, output: 123.03 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:07<00:48, 65.76it/s, est. speed input: 121371.08 toks/s, output: 118.53 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:08<00:48, 64.12it/s, est. speed input: 117575.53 toks/s, output: 114.82 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:08<00:49, 62.41it/s, est. speed input: 114035.26 toks/s, output: 111.36 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:09<00:50, 61.22it/s, est. speed input: 110902.44 toks/s, output: 108.30 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:10<00:50, 60.37it/s, est. speed input: 108108.92 toks/s, output: 105.57 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:10<00:50, 59.78it/s, est. speed input: 105603.08 toks/s, output: 103.13 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:11<00:49, 59.88it/s, est. speed input: 103493.51 toks/s, output: 101.07 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:11<00:48, 60.57it/s, est. speed input: 101734.26 toks/s, output: 99.35 toks/s] 
Processed prompts:  29%|██▉       | 1186/4096 [00:12<00:48, 60.53it/s, est. speed input: 99998.58 toks/s, output: 97.65 toks/s] 
Processed prompts:  30%|██▉       | 1218/4096 [00:12<00:47, 60.51it/s, est. speed input: 98406.68 toks/s, output: 96.10 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:13<00:47, 60.50it/s, est. speed input: 96944.67 toks/s, output: 94.67 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:13<00:46, 60.48it/s, est. speed input: 95592.52 toks/s, output: 93.35 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:14<00:46, 60.46it/s, est. speed input: 94341.13 toks/s, output: 92.13 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:14<00:45, 60.45it/s, est. speed input: 93178.00 toks/s, output: 90.99 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:15<00:44, 60.45it/s, est. speed input: 92097.08 toks/s, output: 89.94 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:15<00:44, 60.43it/s, est. speed input: 91085.45 toks/s, output: 88.95 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:16<00:43, 60.42it/s, est. speed input: 90139.49 toks/s, output: 88.03 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:16<00:43, 60.40it/s, est. speed input: 89252.02 toks/s, output: 87.16 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:17<00:42, 60.39it/s, est. speed input: 88418.03 toks/s, output: 86.35 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:17<00:42, 60.37it/s, est. speed input: 87631.25 toks/s, output: 85.58 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:18<00:41, 60.36it/s, est. speed input: 86890.64 toks/s, output: 84.85 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:19<00:41, 60.14it/s, est. speed input: 86161.92 toks/s, output: 84.14 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:19<00:41, 59.81it/s, est. speed input: 85452.00 toks/s, output: 83.45 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:20<00:40, 59.59it/s, est. speed input: 84780.28 toks/s, output: 82.79 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:20<00:40, 59.52it/s, est. speed input: 84154.23 toks/s, output: 82.18 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:21<00:39, 59.47it/s, est. speed input: 83559.23 toks/s, output: 81.60 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:21<00:39, 59.42it/s, est. speed input: 82992.83 toks/s, output: 81.05 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:22<00:38, 59.39it/s, est. speed input: 82454.52 toks/s, output: 80.52 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:22<00:38, 59.38it/s, est. speed input: 81942.20 toks/s, output: 80.02 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:23<00:37, 59.88it/s, est. speed input: 81507.16 toks/s, output: 79.60 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:23<00:36, 59.72it/s, est. speed input: 81039.05 toks/s, output: 79.14 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:24<00:36, 59.61it/s, est. speed input: 80591.23 toks/s, output: 78.70 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:24<00:35, 59.52it/s, est. speed input: 80162.02 toks/s, output: 78.28 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:25<00:35, 59.45it/s, est. speed input: 79750.44 toks/s, output: 77.88 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:26<00:34, 59.40it/s, est. speed input: 79355.83 toks/s, output: 77.50 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:26<00:34, 59.37it/s, est. speed input: 78977.04 toks/s, output: 77.13 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:27<00:34, 59.21it/s, est. speed input: 78601.69 toks/s, output: 76.76 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:27<00:33, 59.07it/s, est. speed input: 78238.57 toks/s, output: 76.40 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:28<00:33, 58.97it/s, est. speed input: 77889.74 toks/s, output: 76.06 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:28<00:32, 58.91it/s, est. speed input: 77554.04 toks/s, output: 75.74 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:29<00:32, 58.87it/s, est. speed input: 77231.44 toks/s, output: 75.42 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:29<00:31, 58.83it/s, est. speed input: 76919.82 toks/s, output: 75.12 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:30<00:30, 59.32it/s, est. speed input: 76659.10 toks/s, output: 74.86 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:30<00:30, 59.16it/s, est. speed input: 76369.19 toks/s, output: 74.58 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:31<00:29, 59.05it/s, est. speed input: 76089.30 toks/s, output: 74.31 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:32<00:29, 58.96it/s, est. speed input: 75818.85 toks/s, output: 74.04 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:32<00:28, 58.90it/s, est. speed input: 75557.07 toks/s, output: 73.79 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:33<00:28, 58.86it/s, est. speed input: 75303.94 toks/s, output: 73.54 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:33<00:27, 58.83it/s, est. speed input: 75059.22 toks/s, output: 73.30 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:34<00:26, 59.33it/s, est. speed input: 74856.45 toks/s, output: 73.10 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:36<00:53, 29.39it/s, est. speed input: 70896.71 toks/s, output: 69.24 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:37<00:44, 34.45it/s, est. speed input: 70717.44 toks/s, output: 69.06 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:37<00:38, 39.19it/s, est. speed input: 70547.45 toks/s, output: 68.89 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:38<00:33, 43.38it/s, est. speed input: 70381.94 toks/s, output: 68.73 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:38<00:30, 46.87it/s, est. speed input: 70220.67 toks/s, output: 68.57 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:39<00:28, 49.73it/s, est. speed input: 70068.49 toks/s, output: 68.43 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:39<00:26, 51.84it/s, est. speed input: 69913.18 toks/s, output: 68.27 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:40<00:25, 53.50it/s, est. speed input: 69766.17 toks/s, output: 68.13 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:40<00:23, 54.77it/s, est. speed input: 69626.04 toks/s, output: 67.99 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:41<00:22, 55.59it/s, est. speed input: 69483.89 toks/s, output: 67.86 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:42<00:22, 56.24it/s, est. speed input: 69348.77 toks/s, output: 67.72 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:42<00:21, 56.69it/s, est. speed input: 69216.49 toks/s, output: 67.59 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:43<00:20, 57.02it/s, est. speed input: 69087.92 toks/s, output: 67.47 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:43<00:20, 57.25it/s, est. speed input: 68962.53 toks/s, output: 67.35 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:44<00:19, 57.41it/s, est. speed input: 68839.90 toks/s, output: 67.23 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:44<00:18, 58.09it/s, est. speed input: 68748.55 toks/s, output: 67.14 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:45<00:17, 58.95it/s, est. speed input: 68676.52 toks/s, output: 67.07 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:45<00:17, 59.56it/s, est. speed input: 68605.82 toks/s, output: 67.00 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:46<00:16, 60.00it/s, est. speed input: 68536.97 toks/s, output: 66.93 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:46<00:15, 60.31it/s, est. speed input: 68469.71 toks/s, output: 66.86 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:47<00:15, 60.53it/s, est. speed input: 68404.14 toks/s, output: 66.80 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:47<00:14, 60.69it/s, est. speed input: 68340.05 toks/s, output: 66.74 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:48<00:14, 60.80it/s, est. speed input: 68277.25 toks/s, output: 66.68 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:49<00:13, 60.88it/s, est. speed input: 68215.62 toks/s, output: 66.62 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:49<00:13, 60.94it/s, est. speed input: 68155.69 toks/s, output: 66.56 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:50<00:12, 60.97it/s, est. speed input: 68096.56 toks/s, output: 66.50 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:50<00:12, 61.00it/s, est. speed input: 68038.82 toks/s, output: 66.44 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:51<00:11, 61.02it/s, est. speed input: 67982.57 toks/s, output: 66.39 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:51<00:10, 61.02it/s, est. speed input: 67926.80 toks/s, output: 66.33 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:52<00:10, 61.04it/s, est. speed input: 67872.81 toks/s, output: 66.28 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:52<00:09, 60.91it/s, est. speed input: 67814.70 toks/s, output: 66.23 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [00:53<00:09, 60.57it/s, est. speed input: 67748.41 toks/s, output: 66.16 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [00:53<00:08, 60.33it/s, est. speed input: 67683.26 toks/s, output: 66.10 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [00:54<00:08, 60.16it/s, est. speed input: 67619.34 toks/s, output: 66.03 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [00:54<00:07, 60.04it/s, est. speed input: 67556.80 toks/s, output: 65.97 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [00:55<00:07, 60.01it/s, est. speed input: 67497.28 toks/s, output: 65.92 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [00:55<00:06, 59.86it/s, est. speed input: 67434.23 toks/s, output: 65.85 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [00:56<00:06, 60.35it/s, est. speed input: 67393.38 toks/s, output: 65.81 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [00:56<00:05, 60.17it/s, est. speed input: 67334.95 toks/s, output: 65.76 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [00:57<00:05, 60.05it/s, est. speed input: 67277.94 toks/s, output: 65.70 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [00:58<00:04, 59.97it/s, est. speed input: 67222.05 toks/s, output: 65.65 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [00:58<00:04, 59.91it/s, est. speed input: 67166.91 toks/s, output: 65.59 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [00:59<00:03, 59.86it/s, est. speed input: 67112.90 toks/s, output: 65.54 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [00:59<00:03, 59.83it/s, est. speed input: 67059.80 toks/s, output: 65.49 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:00<00:02, 59.81it/s, est. speed input: 67007.69 toks/s, output: 65.44 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:00<00:02, 59.65it/s, est. speed input: 66951.53 toks/s, output: 65.38 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:01<00:01, 59.27it/s, est. speed input: 66887.50 toks/s, output: 65.32 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:01<00:01, 59.52it/s, est. speed input: 66841.57 toks/s, output: 65.27 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:02<00:00, 59.86it/s, est. speed input: 66801.71 toks/s, output: 65.24 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:02<00:00, 59.86it/s, est. speed input: 67293.98 toks/s, output: 65.72 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:02<00:00, 65.72it/s, est. speed input: 67293.98 toks/s, output: 65.72 toks/s]
[rank0]:[W128 11:26:04.142898497 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 137.8s

测试结果:
  Requests/s:   59.23
  Tokens/s:     60713.72
  Total Reqs:   4096
  Elapsed:      69.15s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     60654.49


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_6/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,17.3685,8910.0510,7.3697
1024,1024,1,128,128,16.6093,17024.5643,7.7065
2048,1024,2,256,128,34.8138,35684.1369,7.3534
4096,1024,4,512,128,53.2481,54579.3410,9.6154
8192,1024,8,1024,128,55.3135,56696.3207,18.5127
16384,1024,16,2048,128,55.3722,56756.5172,36.9861
32768,1024,32,4096,128,59.2329,60713.7236,69.1508

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_8) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_8

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:26:15 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:26:16 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=18341) WARNING 01-28 11:26:23 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=18341) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=18341) WARNING 01-28 11:26:35 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.70 requests/s, 8569.15 total tokens/s, 16.70 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:26:15] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:26:15] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:26:15] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:26:15] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:15] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:15] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:15] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:15] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:15] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:26:15] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:26:15] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:26:15] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:26:15] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:26:15] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:26:22] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:26:22] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:26:22] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:26:22] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:22] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:22] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:22] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:22] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:26:22] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:26:22] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:26:22] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:26:22] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:26:22] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:26:22] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:23] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:23] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:23] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:23] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:23] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:23] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=18341) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=18341) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.04s/it]
(EngineCore_DP0 pid=18341) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.04s/it]
(EngineCore_DP0 pid=18341) 
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=18341) [2026-01-28 11:26:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=18341) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:02<00:02,  2.20s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:02<00:00,  1.02it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:02<00:00,  1.16s/it]
(EngineCore_DP0 pid=18341) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.37it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.36it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  50%|█████     | 64/128 [00:00<00:00, 638.05it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 657.50it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 38.60it/s, est. speed input: 19768.33 toks/s, output: 38.61 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:05, 21.90it/s, est. speed input: 11992.43 toks/s, output: 23.42 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:05, 19.58it/s, est. speed input: 10817.85 toks/s, output: 21.13 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:06, 18.22it/s, est. speed input: 10154.72 toks/s, output: 19.83 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 17.87it/s, est. speed input: 9938.59 toks/s, output: 19.41 toks/s] 
Processed prompts:  14%|█▍        | 18/128 [00:00<00:06, 17.62it/s, est. speed input: 9781.36 toks/s, output: 19.10 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 17.41it/s, est. speed input: 9655.28 toks/s, output: 18.86 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.25it/s, est. speed input: 9551.44 toks/s, output: 18.65 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 17.13it/s, est. speed input: 9466.85 toks/s, output: 18.49 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.98it/s, est. speed input: 9386.38 toks/s, output: 18.33 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:05, 16.90it/s, est. speed input: 9321.77 toks/s, output: 18.21 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.71it/s, est. speed input: 9248.71 toks/s, output: 18.06 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.69it/s, est. speed input: 9199.74 toks/s, output: 17.97 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:01<00:05, 16.68it/s, est. speed input: 9156.89 toks/s, output: 17.88 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 16.73it/s, est. speed input: 9126.31 toks/s, output: 17.82 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.76it/s, est. speed input: 9098.05 toks/s, output: 17.77 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.72it/s, est. speed input: 9066.21 toks/s, output: 17.71 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 16.71it/s, est. speed input: 9040.15 toks/s, output: 17.66 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 16.73it/s, est. speed input: 9018.54 toks/s, output: 17.61 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:04, 16.69it/s, est. speed input: 8994.67 toks/s, output: 17.57 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:04, 16.71it/s, est. speed input: 8976.38 toks/s, output: 17.53 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:02<00:04, 16.76it/s, est. speed input: 8962.41 toks/s, output: 17.50 toks/s]
Processed prompts:  41%|████      | 52/128 [00:02<00:04, 16.80it/s, est. speed input: 8949.85 toks/s, output: 17.48 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 16.83it/s, est. speed input: 8938.51 toks/s, output: 17.46 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.79it/s, est. speed input: 8923.86 toks/s, output: 17.43 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 16.76it/s, est. speed input: 8910.69 toks/s, output: 17.40 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 16.69it/s, est. speed input: 8894.84 toks/s, output: 17.37 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:03, 16.56it/s, est. speed input: 8875.56 toks/s, output: 17.33 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:03, 16.60it/s, est. speed input: 8864.74 toks/s, output: 17.31 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 16.62it/s, est. speed input: 8854.33 toks/s, output: 17.29 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:03<00:03, 16.54it/s, est. speed input: 8839.31 toks/s, output: 17.26 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 16.53it/s, est. speed input: 8827.87 toks/s, output: 17.24 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 16.48it/s, est. speed input: 8814.75 toks/s, output: 17.22 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 16.51it/s, est. speed input: 8805.49 toks/s, output: 17.20 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 16.50it/s, est. speed input: 8795.50 toks/s, output: 17.18 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 16.51it/s, est. speed input: 8786.71 toks/s, output: 17.16 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:02, 16.48it/s, est. speed input: 8776.73 toks/s, output: 17.14 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 16.51it/s, est. speed input: 8769.42 toks/s, output: 17.13 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:04<00:02, 16.54it/s, est. speed input: 8762.74 toks/s, output: 17.11 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 16.53it/s, est. speed input: 8755.28 toks/s, output: 17.10 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 16.72it/s, est. speed input: 8756.30 toks/s, output: 17.10 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 16.91it/s, est. speed input: 8759.19 toks/s, output: 17.11 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 17.04it/s, est. speed input: 8761.94 toks/s, output: 17.11 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:01, 17.09it/s, est. speed input: 8763.01 toks/s, output: 17.12 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 17.17it/s, est. speed input: 8765.66 toks/s, output: 17.12 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 17.25it/s, est. speed input: 8768.83 toks/s, output: 17.13 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:05<00:01, 17.30it/s, est. speed input: 8771.80 toks/s, output: 17.13 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:05<00:01, 17.28it/s, est. speed input: 8772.94 toks/s, output: 17.13 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 17.24it/s, est. speed input: 8773.00 toks/s, output: 17.13 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 17.18it/s, est. speed input: 8771.98 toks/s, output: 17.13 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 17.16it/s, est. speed input: 8771.89 toks/s, output: 17.13 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 17.15it/s, est. speed input: 8771.74 toks/s, output: 17.13 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:00, 17.13it/s, est. speed input: 8771.22 toks/s, output: 17.13 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 17.10it/s, est. speed input: 8770.34 toks/s, output: 17.13 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:06<00:00, 17.07it/s, est. speed input: 8769.20 toks/s, output: 17.13 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:06<00:00, 17.22it/s, est. speed input: 8773.01 toks/s, output: 17.13 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 17.32it/s, est. speed input: 8776.65 toks/s, output: 17.14 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 17.28it/s, est. speed input: 8776.97 toks/s, output: 17.14 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 17.23it/s, est. speed input: 8776.64 toks/s, output: 17.14 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 17.21it/s, est. speed input: 8776.84 toks/s, output: 17.14 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.20it/s, est. speed input: 8777.12 toks/s, output: 17.14 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.20it/s, est. speed input: 8777.12 toks/s, output: 17.14 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.14it/s, est. speed input: 8777.12 toks/s, output: 17.14 toks/s]
[rank0]:[W128 11:26:56.662011514 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 52.2s

测试结果:
  Requests/s:   16.70
  Tokens/s:     8569.15
  Total Reqs:   128
  Elapsed:      7.66s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8552.45

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:27:06 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:27:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=18885) WARNING 01-28 11:27:13 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=18885) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=18885) WARNING 01-28 11:27:26 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.74 requests/s, 17155.58 total tokens/s, 16.74 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:27:06] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:27:06] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:27:06] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:27:06] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:06] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:06] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:06] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:06] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:06] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:27:06] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:27:06] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:27:06] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:27:06] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:27:06] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:27:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:27:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:27:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:27:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:27:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:27:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:27:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:27:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:27:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:14] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:14] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:14] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:14] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:14] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:14] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=18885) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=18885) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.46it/s]
(EngineCore_DP0 pid=18885) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.46it/s]
(EngineCore_DP0 pid=18885) 
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=18885) [2026-01-28 11:27:15] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=18885) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.17it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.85it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.73it/s]
(EngineCore_DP0 pid=18885) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.21it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.20it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  30%|██▉       | 38/128 [00:00<00:00, 377.78it/s]
Adding requests:  62%|██████▏   | 79/128 [00:00<00:00, 393.65it/s]
Adding requests:  93%|█████████▎| 119/128 [00:00<00:00, 388.09it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 388.26it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:03, 38.33it/s, est. speed input: 39251.70 toks/s, output: 38.33 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:04, 24.37it/s, est. speed input: 26702.64 toks/s, output: 26.08 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:05, 21.38it/s, est. speed input: 23911.65 toks/s, output: 23.35 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:05, 19.90it/s, est. speed input: 22482.00 toks/s, output: 21.95 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:00<00:05, 18.92it/s, est. speed input: 21526.54 toks/s, output: 21.02 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:05, 18.45it/s, est. speed input: 21060.81 toks/s, output: 20.57 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:05, 17.96it/s, est. speed input: 20633.82 toks/s, output: 20.15 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 17.66it/s, est. speed input: 20319.19 toks/s, output: 19.84 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 17.47it/s, est. speed input: 20069.34 toks/s, output: 19.60 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.36it/s, est. speed input: 19866.31 toks/s, output: 19.40 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 17.30it/s, est. speed input: 19700.44 toks/s, output: 19.24 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 17.24it/s, est. speed input: 19553.32 toks/s, output: 19.09 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 17.20it/s, est. speed input: 19422.16 toks/s, output: 18.97 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:01<00:05, 17.13it/s, est. speed input: 19299.35 toks/s, output: 18.85 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 17.10it/s, est. speed input: 19195.29 toks/s, output: 18.75 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 17.15it/s, est. speed input: 19114.03 toks/s, output: 18.67 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:04, 17.17it/s, est. speed input: 19039.81 toks/s, output: 18.59 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 17.08it/s, est. speed input: 18954.08 toks/s, output: 18.51 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 17.06it/s, est. speed input: 18883.41 toks/s, output: 18.44 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 17.11it/s, est. speed input: 18828.57 toks/s, output: 18.39 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:02<00:04, 17.14it/s, est. speed input: 18779.33 toks/s, output: 18.34 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:02<00:04, 17.19it/s, est. speed input: 18736.18 toks/s, output: 18.30 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 17.17it/s, est. speed input: 18690.21 toks/s, output: 18.25 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 17.17it/s, est. speed input: 18648.67 toks/s, output: 18.21 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 17.11it/s, est. speed input: 18603.30 toks/s, output: 18.17 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 17.11it/s, est. speed input: 18564.67 toks/s, output: 18.13 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 17.09it/s, est. speed input: 18528.05 toks/s, output: 18.09 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 17.10it/s, est. speed input: 18495.65 toks/s, output: 18.06 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 17.13it/s, est. speed input: 18467.71 toks/s, output: 18.03 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:03<00:03, 17.19it/s, est. speed input: 18445.92 toks/s, output: 18.01 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:03<00:03, 17.26it/s, est. speed input: 18428.28 toks/s, output: 18.00 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 17.26it/s, est. speed input: 18406.58 toks/s, output: 17.98 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 17.28it/s, est. speed input: 18388.30 toks/s, output: 17.96 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:02, 17.28it/s, est. speed input: 18370.09 toks/s, output: 17.94 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 17.27it/s, est. speed input: 18350.75 toks/s, output: 17.92 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 17.18it/s, est. speed input: 18326.18 toks/s, output: 17.90 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 17.13it/s, est. speed input: 18303.17 toks/s, output: 17.87 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:04<00:02, 17.10it/s, est. speed input: 18281.94 toks/s, output: 17.85 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:04<00:02, 17.13it/s, est. speed input: 18265.48 toks/s, output: 17.84 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:04<00:02, 17.18it/s, est. speed input: 18252.54 toks/s, output: 17.82 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 17.19it/s, est. speed input: 18238.87 toks/s, output: 17.81 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 17.23it/s, est. speed input: 18227.24 toks/s, output: 17.80 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 17.15it/s, est. speed input: 18208.63 toks/s, output: 17.78 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 17.17it/s, est. speed input: 18196.22 toks/s, output: 17.77 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 17.18it/s, est. speed input: 18183.97 toks/s, output: 17.76 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 17.22it/s, est. speed input: 18175.19 toks/s, output: 17.75 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:05<00:01, 17.35it/s, est. speed input: 18173.03 toks/s, output: 17.75 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:05<00:01, 17.36it/s, est. speed input: 18166.11 toks/s, output: 17.74 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.74it/s, est. speed input: 18115.51 toks/s, output: 17.69 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.44it/s, est. speed input: 18075.77 toks/s, output: 17.65 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.27it/s, est. speed input: 18039.26 toks/s, output: 17.62 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 16.11it/s, est. speed input: 18001.89 toks/s, output: 17.58 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 16.04it/s, est. speed input: 17968.44 toks/s, output: 17.55 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 16.02it/s, est. speed input: 17937.81 toks/s, output: 17.52 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 16.36it/s, est. speed input: 17932.39 toks/s, output: 17.51 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:06<00:00, 16.66it/s, est. speed input: 17930.82 toks/s, output: 17.51 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.84it/s, est. speed input: 17927.06 toks/s, output: 17.51 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.96it/s, est. speed input: 17922.38 toks/s, output: 17.50 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 17.04it/s, est. speed input: 17917.81 toks/s, output: 17.50 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.04it/s, est. speed input: 17914.78 toks/s, output: 17.49 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.49it/s, est. speed input: 17914.78 toks/s, output: 17.49 toks/s]
[rank0]:[W128 11:27:45.897150993 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 48.3s

测试结果:
  Requests/s:   16.74
  Tokens/s:     17155.58
  Total Reqs:   128
  Elapsed:      7.65s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     17138.84

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:27:57 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:27:58 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=19415) WARNING 01-28 11:28:05 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=19415) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=19415) WARNING 01-28 11:28:15 [backends.py:609] Failed to read file <frozen os>
Throughput: 32.91 requests/s, 33736.67 total tokens/s, 32.91 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:27:57] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:27:57] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:27:57] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:27:57] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:57] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:57] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:57] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:57] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:27:57] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:27:57] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:27:57] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:27:57] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:27:57] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:27:57] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:28:04] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:28:04] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:28:04] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:28:04] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:04] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:04] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:04] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:04] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:04] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:28:04] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:28:04] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:28:04] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:28:04] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:28:04] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:05] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:05] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:05] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:05] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:05] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:05] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=19415) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=19415) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.50it/s]
(EngineCore_DP0 pid=19415) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.50it/s]
(EngineCore_DP0 pid=19415) 
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=19415) [2026-01-28 11:28:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=19415) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.52it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.45it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.55it/s]
(EngineCore_DP0 pid=19415) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.02it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.80it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  13%|█▎        | 34/256 [00:00<00:00, 339.23it/s]
Adding requests:  29%|██▊       | 73/256 [00:00<00:00, 367.05it/s]
Adding requests:  44%|████▍     | 112/256 [00:00<00:00, 374.31it/s]
Adding requests:  59%|█████▊    | 150/256 [00:00<00:00, 374.18it/s]
Adding requests:  74%|███████▍  | 189/256 [00:00<00:00, 379.46it/s]
Adding requests:  89%|████████▉ | 229/256 [00:00<00:00, 386.00it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 379.79it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   8%|▊         | 20/256 [00:00<00:01, 156.10it/s, est. speed input: 159872.52 toks/s, output: 156.11 toks/s]
Processed prompts:  14%|█▍        | 36/256 [00:00<00:03, 56.45it/s, est. speed input: 64687.79 toks/s, output: 63.17 toks/s]   
Processed prompts:  18%|█▊        | 45/256 [00:00<00:04, 50.51it/s, est. speed input: 58192.90 toks/s, output: 56.83 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:04, 44.00it/s, est. speed input: 52594.45 toks/s, output: 51.36 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:04, 41.92it/s, est. speed input: 50433.59 toks/s, output: 49.25 toks/s]
Processed prompts:  25%|██▍       | 63/256 [00:01<00:04, 42.59it/s, est. speed input: 50071.63 toks/s, output: 48.90 toks/s]
Processed prompts:  27%|██▋       | 68/256 [00:01<00:04, 38.81it/s, est. speed input: 47895.17 toks/s, output: 46.77 toks/s]
Processed prompts:  29%|██▊       | 73/256 [00:01<00:04, 40.10it/s, est. speed input: 47724.46 toks/s, output: 46.61 toks/s]
Processed prompts:  30%|███       | 78/256 [00:03<00:25,  7.09it/s, est. speed input: 20614.48 toks/s, output: 20.13 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:03<00:19,  8.72it/s, est. speed input: 21068.83 toks/s, output: 20.57 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:04<00:15, 10.73it/s, est. speed input: 21472.78 toks/s, output: 20.97 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:04<00:12, 13.03it/s, est. speed input: 21820.21 toks/s, output: 21.31 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:04<00:10, 15.61it/s, est. speed input: 22154.29 toks/s, output: 21.63 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:04<00:08, 18.30it/s, est. speed input: 22466.24 toks/s, output: 21.94 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:04<00:07, 20.98it/s, est. speed input: 22765.97 toks/s, output: 22.23 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:04<00:06, 23.43it/s, est. speed input: 23046.15 toks/s, output: 22.51 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:04<00:05, 25.60it/s, est. speed input: 23315.68 toks/s, output: 22.77 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:04<00:05, 27.32it/s, est. speed input: 23563.43 toks/s, output: 23.01 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:05<00:04, 28.79it/s, est. speed input: 23807.69 toks/s, output: 23.25 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:05<00:04, 29.99it/s, est. speed input: 24045.10 toks/s, output: 23.48 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:05<00:04, 30.86it/s, est. speed input: 24269.42 toks/s, output: 23.70 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:05<00:03, 31.63it/s, est. speed input: 24491.11 toks/s, output: 23.92 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:05<00:03, 32.17it/s, est. speed input: 24702.61 toks/s, output: 24.12 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:05<00:03, 32.49it/s, est. speed input: 24901.02 toks/s, output: 24.32 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:05<00:03, 32.66it/s, est. speed input: 25087.53 toks/s, output: 24.50 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:05<00:03, 32.86it/s, est. speed input: 25271.04 toks/s, output: 24.68 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:06<00:03, 32.94it/s, est. speed input: 25444.34 toks/s, output: 24.85 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:06<00:03, 32.87it/s, est. speed input: 25604.24 toks/s, output: 25.00 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:06<00:02, 32.94it/s, est. speed input: 25763.57 toks/s, output: 25.16 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:06<00:02, 33.02it/s, est. speed input: 25918.77 toks/s, output: 25.31 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:06<00:02, 33.02it/s, est. speed input: 26065.60 toks/s, output: 25.45 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:06<00:02, 33.05it/s, est. speed input: 26208.07 toks/s, output: 25.59 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:06<00:02, 33.09it/s, est. speed input: 26346.51 toks/s, output: 25.73 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:06<00:02, 33.23it/s, est. speed input: 26485.45 toks/s, output: 25.86 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:07<00:02, 33.06it/s, est. speed input: 26607.12 toks/s, output: 25.98 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:07<00:02, 33.10it/s, est. speed input: 26732.22 toks/s, output: 26.11 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:07<00:01, 33.14it/s, est. speed input: 26853.51 toks/s, output: 26.22 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:07<00:01, 33.15it/s, est. speed input: 26969.80 toks/s, output: 26.34 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:07<00:01, 33.01it/s, est. speed input: 27076.19 toks/s, output: 26.44 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:07<00:01, 32.93it/s, est. speed input: 27179.86 toks/s, output: 26.54 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:07<00:01, 32.56it/s, est. speed input: 27266.39 toks/s, output: 26.63 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:07<00:01, 32.62it/s, est. speed input: 27363.70 toks/s, output: 26.72 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:07<00:01, 32.76it/s, est. speed input: 27462.67 toks/s, output: 26.82 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:08<00:01, 32.91it/s, est. speed input: 27560.79 toks/s, output: 26.91 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:08<00:01, 33.02it/s, est. speed input: 27656.11 toks/s, output: 27.01 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:08<00:00, 33.19it/s, est. speed input: 27752.26 toks/s, output: 27.10 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:08<00:00, 33.26it/s, est. speed input: 27843.99 toks/s, output: 27.19 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:08<00:00, 33.30it/s, est. speed input: 27932.50 toks/s, output: 27.28 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:08<00:00, 33.21it/s, est. speed input: 28014.38 toks/s, output: 27.36 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:08<00:00, 33.19it/s, est. speed input: 28095.29 toks/s, output: 27.44 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:08<00:00, 33.17it/s, est. speed input: 28173.92 toks/s, output: 27.51 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:09<00:00, 33.03it/s, est. speed input: 28245.58 toks/s, output: 27.58 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:09<00:00, 33.10it/s, est. speed input: 28321.76 toks/s, output: 27.66 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 33.10it/s, est. speed input: 28359.83 toks/s, output: 27.70 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 27.69it/s, est. speed input: 28359.83 toks/s, output: 27.70 toks/s]
[rank0]:[W128 11:28:36.054795518 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.4s

测试结果:
  Requests/s:   32.91
  Tokens/s:     33736.67
  Total Reqs:   256
  Elapsed:      7.78s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     33703.76

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:28:48 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:28:48 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=19958) WARNING 01-28 11:28:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=19958) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=19958) WARNING 01-28 11:29:07 [backends.py:609] Failed to read file <frozen os>
Throughput: 56.66 requests/s, 58071.79 total tokens/s, 56.66 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:28:47] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:28:48] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:28:48] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:28:48] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:48] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:48] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:48] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:48] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:48] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:28:48] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:28:48] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:28:48] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:28:48] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:28:48] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:28:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:28:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:28:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:28:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:28:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:28:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:28:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:28:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:28:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:28:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:55] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:55] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:55] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:55] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:55] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:55] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=19958) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=19958) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.57it/s]
(EngineCore_DP0 pid=19958) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.57it/s]
(EngineCore_DP0 pid=19958) 
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=19958) [2026-01-28 11:28:56] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=19958) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  8.35it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.95it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  9.21it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.44it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.61it/s]
(EngineCore_DP0 pid=19958) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.75it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.82it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  9.20it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.96it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 38/512 [00:00<00:01, 374.49it/s]
Adding requests:  15%|█▌        | 78/512 [00:00<00:01, 387.85it/s]
Adding requests:  23%|██▎       | 118/512 [00:00<00:01, 389.67it/s]
Adding requests:  31%|███       | 157/512 [00:00<00:00, 387.12it/s]
Adding requests:  38%|███▊      | 196/512 [00:00<00:00, 384.05it/s]
Adding requests:  46%|████▌     | 235/512 [00:00<00:00, 382.78it/s]
Adding requests:  54%|█████▎    | 275/512 [00:00<00:00, 385.54it/s]
Adding requests:  61%|██████▏   | 314/512 [00:00<00:00, 385.64it/s]
Adding requests:  69%|██████▉   | 354/512 [00:00<00:00, 387.78it/s]
Adding requests:  77%|███████▋  | 393/512 [00:01<00:00, 387.77it/s]
Adding requests:  85%|████████▍ | 433/512 [00:01<00:00, 389.29it/s]
Adding requests:  92%|█████████▏| 473/512 [00:01<00:00, 390.07it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 387.61it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   9%|▉         | 46/512 [00:00<00:01, 455.64it/s, est. speed input: 466689.88 toks/s, output: 455.68 toks/s]
Processed prompts:  18%|█▊        | 92/512 [00:00<00:04, 98.76it/s, est. speed input: 114599.33 toks/s, output: 111.91 toks/s] 
Processed prompts:  22%|██▏       | 115/512 [00:01<00:04, 82.01it/s, est. speed input: 96863.84 toks/s, output: 94.59 toks/s] 
Processed prompts:  25%|██▌       | 130/512 [00:01<00:05, 74.91it/s, est. speed input: 90017.68 toks/s, output: 87.91 toks/s]
Processed prompts:  28%|██▊       | 142/512 [00:01<00:05, 71.69it/s, est. speed input: 86794.69 toks/s, output: 84.76 toks/s]
Processed prompts:  30%|██▉       | 152/512 [00:01<00:04, 72.53it/s, est. speed input: 86166.06 toks/s, output: 84.15 toks/s]
Processed prompts:  31%|███▏      | 161/512 [00:01<00:04, 71.74it/s, est. speed input: 85093.31 toks/s, output: 83.10 toks/s]
Processed prompts:  33%|███▎      | 170/512 [00:02<00:05, 63.73it/s, est. speed input: 81549.42 toks/s, output: 79.64 toks/s]
Processed prompts:  35%|███▍      | 178/512 [00:02<00:05, 63.05it/s, est. speed input: 80421.99 toks/s, output: 78.54 toks/s]
Processed prompts:  36%|███▋      | 186/512 [00:02<00:05, 62.56it/s, est. speed input: 79443.02 toks/s, output: 77.58 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:02<00:05, 62.16it/s, est. speed input: 78564.27 toks/s, output: 76.72 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:02<00:05, 61.88it/s, est. speed input: 77778.14 toks/s, output: 75.95 toks/s]
Processed prompts:  41%|████      | 210/512 [00:02<00:04, 61.65it/s, est. speed input: 77061.22 toks/s, output: 75.25 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:02<00:04, 61.44it/s, est. speed input: 76401.83 toks/s, output: 74.61 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:03<00:04, 61.28it/s, est. speed input: 75795.60 toks/s, output: 74.02 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:03<00:04, 61.19it/s, est. speed input: 75245.06 toks/s, output: 73.48 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:03<00:04, 61.13it/s, est. speed input: 74739.00 toks/s, output: 72.99 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:03<00:04, 61.01it/s, est. speed input: 74258.62 toks/s, output: 72.52 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:03<00:04, 61.01it/s, est. speed input: 73826.94 toks/s, output: 72.10 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:03<00:04, 61.01it/s, est. speed input: 73425.84 toks/s, output: 71.70 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:03<00:03, 60.97it/s, est. speed input: 73046.37 toks/s, output: 71.33 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:03<00:03, 60.91it/s, est. speed input: 72687.96 toks/s, output: 70.98 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:04<00:03, 60.89it/s, est. speed input: 72355.30 toks/s, output: 70.66 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:04<00:03, 60.87it/s, est. speed input: 72042.10 toks/s, output: 70.35 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:04<00:03, 60.87it/s, est. speed input: 71749.50 toks/s, output: 70.07 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:04<00:03, 60.91it/s, est. speed input: 71479.45 toks/s, output: 69.80 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:04<00:03, 60.92it/s, est. speed input: 71221.81 toks/s, output: 69.55 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:04<00:02, 60.88it/s, est. speed input: 70973.98 toks/s, output: 69.31 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:04<00:02, 60.88it/s, est. speed input: 70741.99 toks/s, output: 69.08 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:05<00:02, 60.89it/s, est. speed input: 70523.05 toks/s, output: 68.87 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:05<00:02, 60.90it/s, est. speed input: 70316.25 toks/s, output: 68.67 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:05<00:02, 60.89it/s, est. speed input: 70118.40 toks/s, output: 68.47 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:05<00:02, 60.91it/s, est. speed input: 69930.88 toks/s, output: 68.29 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:05<00:02, 60.87it/s, est. speed input: 69748.74 toks/s, output: 68.11 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:05<00:02, 60.81it/s, est. speed input: 69572.01 toks/s, output: 67.94 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:05<00:01, 60.85it/s, est. speed input: 69409.63 toks/s, output: 67.78 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:05<00:01, 60.87it/s, est. speed input: 69254.37 toks/s, output: 67.63 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:06<00:01, 60.88it/s, est. speed input: 69105.16 toks/s, output: 67.49 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:06<00:01, 60.87it/s, est. speed input: 68961.00 toks/s, output: 67.34 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:06<00:01, 60.87it/s, est. speed input: 68823.44 toks/s, output: 67.21 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:06<00:01, 60.86it/s, est. speed input: 68691.26 toks/s, output: 67.08 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:06<00:01, 60.85it/s, est. speed input: 68563.38 toks/s, output: 66.96 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:06<00:01, 60.81it/s, est. speed input: 68438.62 toks/s, output: 66.83 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:06<00:00, 60.79it/s, est. speed input: 68318.55 toks/s, output: 66.72 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:06<00:00, 60.75it/s, est. speed input: 68202.01 toks/s, output: 66.60 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:07<00:00, 60.74it/s, est. speed input: 68090.34 toks/s, output: 66.49 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:07<00:00, 60.72it/s, est. speed input: 67981.98 toks/s, output: 66.39 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:07<00:00, 60.79it/s, est. speed input: 67883.12 toks/s, output: 66.29 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:07<00:00, 60.78it/s, est. speed input: 67783.98 toks/s, output: 66.20 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:07<00:00, 60.77it/s, est. speed input: 67688.10 toks/s, output: 66.10 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 60.77it/s, est. speed input: 67960.55 toks/s, output: 66.37 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 66.37it/s, est. speed input: 67960.55 toks/s, output: 66.37 toks/s]
[rank0]:[W128 11:29:28.680752613 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.8s

测试结果:
  Requests/s:   56.66
  Tokens/s:     58071.79
  Total Reqs:   512
  Elapsed:      9.04s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     58015.13

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:29:45 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:29:45 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=20527) WARNING 01-28 11:29:52 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=20527) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=20527) WARNING 01-28 11:30:02 [backends.py:609] Failed to read file <frozen os>
Throughput: 54.76 requests/s, 56132.09 total tokens/s, 54.76 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:29:45] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:29:45] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:29:45] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:29:45] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:45] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:45] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:45] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:45] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:45] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:29:45] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:29:45] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:29:45] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:29:45] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:29:45] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:29:51] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:29:51] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:29:51] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:29:51] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:51] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:51] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:51] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:51] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:29:51] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:29:51] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:29:51] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:29:51] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:29:51] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:29:51] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:53] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:53] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:53] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:53] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:53] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:53] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=20527) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=20527) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.56it/s]
(EngineCore_DP0 pid=20527) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.56it/s]
(EngineCore_DP0 pid=20527) 
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=20527) [2026-01-28 11:29:54] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=20527) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  8.01it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  8.23it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  8.59it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  8.79it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.14it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.29it/s]
(EngineCore_DP0 pid=20527) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.45it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:02<00:02,  1.23s/it]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:02<00:00,  1.39it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:02<00:00,  2.09it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:02<00:00,  1.70it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 33/1024 [00:00<00:03, 326.01it/s]
Adding requests:   7%|▋         | 68/1024 [00:00<00:02, 335.41it/s]
Adding requests:  10%|█         | 103/1024 [00:00<00:02, 341.72it/s]
Adding requests:  14%|█▎        | 139/1024 [00:00<00:02, 346.20it/s]
Adding requests:  17%|█▋        | 174/1024 [00:00<00:02, 342.05it/s]
Adding requests:  21%|██        | 211/1024 [00:00<00:02, 348.85it/s]
Adding requests:  24%|██▍       | 249/1024 [00:00<00:02, 356.53it/s]
Adding requests:  28%|██▊       | 286/1024 [00:00<00:02, 358.52it/s]
Adding requests:  31%|███▏      | 322/1024 [00:00<00:01, 356.73it/s]
Adding requests:  35%|███▌      | 359/1024 [00:01<00:01, 359.01it/s]
Adding requests:  39%|███▊      | 395/1024 [00:01<00:01, 357.25it/s]
Adding requests:  42%|████▏     | 432/1024 [00:01<00:01, 359.61it/s]
Adding requests:  46%|████▌     | 468/1024 [00:01<00:01, 357.76it/s]
Adding requests:  49%|████▉     | 504/1024 [00:01<00:01, 354.05it/s]
Adding requests:  53%|█████▎    | 540/1024 [00:01<00:01, 350.16it/s]
Adding requests:  56%|█████▋    | 578/1024 [00:01<00:01, 358.41it/s]
Adding requests:  60%|██████    | 615/1024 [00:01<00:01, 359.34it/s]
Adding requests:  64%|██████▎   | 651/1024 [00:01<00:01, 357.57it/s]
Adding requests:  67%|██████▋   | 690/1024 [00:01<00:00, 365.87it/s]
Adding requests:  71%|███████   | 727/1024 [00:02<00:00, 366.25it/s]
Adding requests:  75%|███████▍  | 764/1024 [00:02<00:00, 363.13it/s]
Adding requests:  78%|███████▊  | 801/1024 [00:02<00:00, 364.33it/s]
Adding requests:  82%|████████▏ | 838/1024 [00:02<00:00, 358.60it/s]
Adding requests:  86%|████████▌ | 876/1024 [00:02<00:00, 362.21it/s]
Adding requests:  89%|████████▉ | 914/1024 [00:02<00:00, 367.35it/s]
Adding requests:  93%|█████████▎| 953/1024 [00:02<00:00, 372.47it/s]
Adding requests:  97%|█████████▋| 995/1024 [00:02<00:00, 384.65it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 361.95it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:00<00:01, 775.25it/s, est. speed input: 793973.90 toks/s, output: 775.28 toks/s]
Processed prompts:  21%|██        | 216/1024 [00:01<00:06, 125.53it/s, est. speed input: 153140.48 toks/s, output: 149.55 toks/s]
Processed prompts:  25%|██▍       | 252/1024 [00:02<00:08, 94.31it/s, est. speed input: 120113.21 toks/s, output: 117.30 toks/s] 
Processed prompts:  27%|██▋       | 274/1024 [00:02<00:09, 83.15it/s, est. speed input: 109154.36 toks/s, output: 106.59 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:02<00:09, 77.85it/s, est. speed input: 104123.69 toks/s, output: 101.68 toks/s]
Processed prompts:  29%|██▉       | 302/1024 [00:02<00:09, 78.79it/s, est. speed input: 103331.24 toks/s, output: 100.91 toks/s]
Processed prompts:  31%|███       | 313/1024 [00:03<00:09, 78.65it/s, est. speed input: 102268.87 toks/s, output: 99.87 toks/s] 
Processed prompts:  32%|███▏      | 323/1024 [00:03<00:10, 65.53it/s, est. speed input: 96817.57 toks/s, output: 94.55 toks/s] 
Processed prompts:  32%|███▏      | 331/1024 [00:03<00:10, 63.92it/s, est. speed input: 95266.03 toks/s, output: 93.03 toks/s]
Processed prompts:  33%|███▎      | 339/1024 [00:03<00:10, 62.45it/s, est. speed input: 93845.83 toks/s, output: 91.65 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:03<00:11, 59.61it/s, est. speed input: 92275.32 toks/s, output: 90.11 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:03<00:11, 58.91it/s, est. speed input: 91064.01 toks/s, output: 88.93 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:04<00:11, 58.31it/s, est. speed input: 89931.06 toks/s, output: 87.82 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:04<00:11, 57.91it/s, est. speed input: 88879.04 toks/s, output: 86.80 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:04<00:11, 57.57it/s, est. speed input: 87890.97 toks/s, output: 85.83 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:04<00:11, 57.28it/s, est. speed input: 86959.76 toks/s, output: 84.92 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:04<00:11, 57.14it/s, est. speed input: 86092.84 toks/s, output: 84.07 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:04<00:10, 57.05it/s, est. speed input: 85279.76 toks/s, output: 83.28 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:04<00:10, 56.97it/s, est. speed input: 84509.44 toks/s, output: 82.53 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:10, 56.92it/s, est. speed input: 83783.48 toks/s, output: 81.82 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:10, 56.83it/s, est. speed input: 83089.04 toks/s, output: 81.14 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:05<00:10, 56.84it/s, est. speed input: 82439.81 toks/s, output: 80.51 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:05<00:10, 56.77it/s, est. speed input: 81814.11 toks/s, output: 79.90 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:05<00:10, 56.72it/s, est. speed input: 81221.11 toks/s, output: 79.32 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:05<00:09, 56.70it/s, est. speed input: 80658.91 toks/s, output: 78.77 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:05<00:09, 56.68it/s, est. speed input: 80118.65 toks/s, output: 78.24 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:09, 56.64it/s, est. speed input: 79603.90 toks/s, output: 77.74 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:09, 56.63it/s, est. speed input: 79113.94 toks/s, output: 77.26 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:06<00:09, 56.61it/s, est. speed input: 78643.75 toks/s, output: 76.80 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:06<00:09, 56.65it/s, est. speed input: 78200.36 toks/s, output: 76.37 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:06<00:09, 56.69it/s, est. speed input: 77775.64 toks/s, output: 75.95 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:06<00:08, 56.70it/s, est. speed input: 77367.73 toks/s, output: 75.55 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:06<00:08, 56.67it/s, est. speed input: 76973.64 toks/s, output: 75.17 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:08, 56.64it/s, est. speed input: 76592.01 toks/s, output: 74.80 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:07<00:08, 56.67it/s, est. speed input: 76231.66 toks/s, output: 74.44 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:07<00:08, 55.99it/s, est. speed input: 75824.70 toks/s, output: 74.05 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:07<00:08, 54.92it/s, est. speed input: 75379.42 toks/s, output: 73.61 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:07<00:08, 54.15it/s, est. speed input: 74949.05 toks/s, output: 73.19 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:07<00:08, 53.83it/s, est. speed input: 74553.94 toks/s, output: 72.81 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:07<00:08, 54.40it/s, est. speed input: 74239.35 toks/s, output: 72.50 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:07, 54.84it/s, est. speed input: 73938.99 toks/s, output: 72.21 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:08<00:07, 55.09it/s, est. speed input: 73644.34 toks/s, output: 71.92 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:08<00:07, 55.33it/s, est. speed input: 73365.35 toks/s, output: 71.65 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:08<00:07, 55.49it/s, est. speed input: 73094.73 toks/s, output: 71.38 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:08<00:07, 55.54it/s, est. speed input: 72828.45 toks/s, output: 71.12 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:08<00:07, 55.52it/s, est. speed input: 72566.60 toks/s, output: 70.87 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:08<00:07, 55.58it/s, est. speed input: 72318.66 toks/s, output: 70.62 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:06, 55.58it/s, est. speed input: 72076.04 toks/s, output: 70.39 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:09<00:06, 55.63it/s, est. speed input: 71844.68 toks/s, output: 70.16 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:09<00:06, 55.65it/s, est. speed input: 71617.17 toks/s, output: 69.94 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:09<00:06, 55.68it/s, est. speed input: 71398.98 toks/s, output: 69.73 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:09<00:06, 55.66it/s, est. speed input: 71184.85 toks/s, output: 69.52 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:09<00:06, 55.67it/s, est. speed input: 70979.14 toks/s, output: 69.31 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:09<00:06, 55.63it/s, est. speed input: 70774.47 toks/s, output: 69.12 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:10<00:05, 55.65it/s, est. speed input: 70579.62 toks/s, output: 68.93 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:10<00:05, 55.69it/s, est. speed input: 70391.50 toks/s, output: 68.74 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:10<00:05, 55.66it/s, est. speed input: 70205.22 toks/s, output: 68.56 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:10<00:05, 55.67it/s, est. speed input: 70026.37 toks/s, output: 68.38 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:10<00:05, 55.63it/s, est. speed input: 69848.86 toks/s, output: 68.21 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:10<00:05, 55.62it/s, est. speed input: 69677.77 toks/s, output: 68.04 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:10<00:04, 55.66it/s, est. speed input: 69513.11 toks/s, output: 67.88 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:11<00:04, 55.70it/s, est. speed input: 69354.51 toks/s, output: 67.73 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:11<00:04, 55.72it/s, est. speed input: 69198.27 toks/s, output: 67.58 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:11<00:04, 55.66it/s, est. speed input: 69042.58 toks/s, output: 67.42 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:11<00:04, 55.68it/s, est. speed input: 68893.46 toks/s, output: 67.28 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:11<00:04, 55.59it/s, est. speed input: 68744.44 toks/s, output: 67.13 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:11<00:04, 55.54it/s, est. speed input: 68597.43 toks/s, output: 66.99 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:11<00:03, 55.53it/s, est. speed input: 68455.81 toks/s, output: 66.85 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:12<00:03, 55.50it/s, est. speed input: 68316.87 toks/s, output: 66.72 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:12<00:03, 55.46it/s, est. speed input: 68180.16 toks/s, output: 66.58 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:12<00:03, 55.48it/s, est. speed input: 68049.19 toks/s, output: 66.45 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:12<00:03, 55.49it/s, est. speed input: 67920.36 toks/s, output: 66.33 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:12<00:03, 55.47it/s, est. speed input: 67793.73 toks/s, output: 66.20 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:12<00:03, 55.45it/s, est. speed input: 67669.70 toks/s, output: 66.08 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:13<00:02, 55.49it/s, est. speed input: 67550.53 toks/s, output: 65.97 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:13<00:02, 55.53it/s, est. speed input: 67434.77 toks/s, output: 65.85 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:13<00:02, 55.56it/s, est. speed input: 67321.37 toks/s, output: 65.74 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:13<00:02, 55.52it/s, est. speed input: 67208.22 toks/s, output: 65.63 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:13<00:02, 55.52it/s, est. speed input: 67098.15 toks/s, output: 65.53 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:13<00:02, 55.49it/s, est. speed input: 66989.47 toks/s, output: 65.42 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:13<00:02, 55.50it/s, est. speed input: 66883.79 toks/s, output: 65.32 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:14<00:01, 55.53it/s, est. speed input: 66782.11 toks/s, output: 65.22 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:14<00:01, 55.53it/s, est. speed input: 66680.82 toks/s, output: 65.12 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:14<00:01, 55.46it/s, est. speed input: 66579.06 toks/s, output: 65.02 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:14<00:01, 55.46it/s, est. speed input: 66481.59 toks/s, output: 64.92 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:14<00:01, 55.44it/s, est. speed input: 66384.61 toks/s, output: 64.83 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:14<00:01, 55.42it/s, est. speed input: 66289.69 toks/s, output: 64.74 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:14<00:01, 55.45it/s, est. speed input: 66198.35 toks/s, output: 64.65 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:15<00:00, 55.45it/s, est. speed input: 66108.02 toks/s, output: 64.56 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:15<00:00, 55.46it/s, est. speed input: 66019.55 toks/s, output: 64.47 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:15<00:00, 57.28it/s, est. speed input: 65998.65 toks/s, output: 64.45 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:15<00:00, 56.75it/s, est. speed input: 65913.72 toks/s, output: 64.37 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:15<00:00, 56.39it/s, est. speed input: 65830.33 toks/s, output: 64.29 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:15<00:00, 55.63it/s, est. speed input: 65730.55 toks/s, output: 64.19 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:15<00:00, 56.92it/s, est. speed input: 65696.08 toks/s, output: 64.16 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:15<00:00, 56.92it/s, est. speed input: 66082.02 toks/s, output: 64.53 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:15<00:00, 64.53it/s, est. speed input: 66082.02 toks/s, output: 64.53 toks/s]
[rank0]:[W128 11:30:35.528034893 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 67.0s

测试结果:
  Requests/s:   54.76
  Tokens/s:     56132.09
  Total Reqs:   1024
  Elapsed:      18.70s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     56077.32

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:30:56 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:30:57 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=21204) WARNING 01-28 11:31:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=21204) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=21204) WARNING 01-28 11:31:14 [backends.py:609] Failed to read file <frozen os>
Throughput: 58.97 requests/s, 60445.26 total tokens/s, 58.97 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:30:56] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:30:56] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:30:56] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:30:56] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:30:56] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:30:56] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:30:56] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:30:56] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:30:56] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:30:56] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:30:56] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:30:56] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:30:56] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:30:56] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:31:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:31:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:31:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:31:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:31:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:31:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:31:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:31:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:31:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:31:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:31:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:31:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:31:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:31:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:04] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:04] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:04] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:04] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:04] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:04] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=21204) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=21204) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.54it/s]
(EngineCore_DP0 pid=21204) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.53it/s]
(EngineCore_DP0 pid=21204) 
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=21204) [2026-01-28 11:31:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=21204) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  8.02it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  8.31it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.72it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.69it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.66it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.02it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.32it/s]
(EngineCore_DP0 pid=21204) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.03it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  7.88it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.33it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.77it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.46it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 35/2048 [00:00<00:05, 342.70it/s]
Adding requests:   3%|▎         | 71/2048 [00:00<00:05, 352.02it/s]
Adding requests:   5%|▌         | 109/2048 [00:00<00:05, 362.02it/s]
Adding requests:   7%|▋         | 147/2048 [00:00<00:05, 366.25it/s]
Adding requests:   9%|▉         | 184/2048 [00:00<00:05, 367.32it/s]
Adding requests:  11%|█         | 223/2048 [00:00<00:04, 374.03it/s]
Adding requests:  13%|█▎        | 263/2048 [00:00<00:04, 380.34it/s]
Adding requests:  15%|█▍        | 302/2048 [00:00<00:04, 378.87it/s]
Adding requests:  17%|█▋        | 341/2048 [00:00<00:04, 381.91it/s]
Adding requests:  19%|█▊        | 380/2048 [00:01<00:04, 384.12it/s]
Adding requests:  20%|██        | 419/2048 [00:01<00:04, 381.44it/s]
Adding requests:  22%|██▏       | 458/2048 [00:01<00:04, 378.57it/s]
Adding requests:  24%|██▍       | 497/2048 [00:01<00:04, 380.17it/s]
Adding requests:  26%|██▌       | 536/2048 [00:01<00:04, 375.52it/s]
Adding requests:  28%|██▊       | 577/2048 [00:01<00:03, 383.69it/s]
Adding requests:  30%|███       | 616/2048 [00:01<00:03, 385.13it/s]
Adding requests:  32%|███▏      | 656/2048 [00:01<00:03, 388.52it/s]
Adding requests:  34%|███▍      | 697/2048 [00:01<00:03, 393.54it/s]
Adding requests:  36%|███▌      | 738/2048 [00:01<00:03, 397.00it/s]
Adding requests:  38%|███▊      | 778/2048 [00:02<00:03, 383.92it/s]
Adding requests:  40%|███▉      | 817/2048 [00:02<00:03, 381.04it/s]
Adding requests:  42%|████▏     | 856/2048 [00:02<00:03, 377.34it/s]
Adding requests:  44%|████▍     | 897/2048 [00:02<00:02, 386.39it/s]
Adding requests:  46%|████▌     | 937/2048 [00:02<00:02, 388.28it/s]
Adding requests:  48%|████▊     | 978/2048 [00:02<00:02, 392.21it/s]
Adding requests:  50%|████▉     | 1020/2048 [00:02<00:02, 397.80it/s]
Adding requests:  52%|█████▏    | 1060/2048 [00:02<00:02, 391.28it/s]
Adding requests:  54%|█████▎    | 1100/2048 [00:02<00:02, 391.68it/s]
Adding requests:  56%|█████▌    | 1140/2048 [00:02<00:02, 381.58it/s]
Adding requests:  58%|█████▊    | 1182/2048 [00:03<00:02, 390.83it/s]
Adding requests:  60%|█████▉    | 1222/2048 [00:03<00:02, 392.21it/s]
Adding requests:  62%|██████▏   | 1262/2048 [00:03<00:02, 386.56it/s]
Adding requests:  64%|██████▎   | 1303/2048 [00:03<00:01, 392.39it/s]
Adding requests:  66%|██████▌   | 1344/2048 [00:03<00:01, 395.85it/s]
Adding requests:  68%|██████▊   | 1385/2048 [00:03<00:01, 398.79it/s]
Adding requests:  70%|██████▉   | 1426/2048 [00:03<00:01, 401.30it/s]
Adding requests:  72%|███████▏  | 1468/2048 [00:03<00:01, 403.92it/s]
Adding requests:  74%|███████▎  | 1510/2048 [00:03<00:01, 407.03it/s]
Adding requests:  76%|███████▌  | 1551/2048 [00:04<00:01, 402.09it/s]
Adding requests:  78%|███████▊  | 1593/2048 [00:04<00:01, 405.02it/s]
Adding requests:  80%|███████▉  | 1634/2048 [00:04<00:01, 405.96it/s]
Adding requests:  82%|████████▏ | 1675/2048 [00:04<00:00, 396.95it/s]
Adding requests:  84%|████████▍ | 1716/2048 [00:04<00:00, 398.65it/s]
Adding requests:  86%|████████▌ | 1757/2048 [00:04<00:00, 401.08it/s]
Adding requests:  88%|████████▊ | 1798/2048 [00:04<00:00, 401.80it/s]
Adding requests:  90%|████████▉ | 1839/2048 [00:04<00:00, 403.26it/s]
Adding requests:  92%|█████████▏| 1880/2048 [00:04<00:00, 404.31it/s]
Adding requests:  94%|█████████▍| 1921/2048 [00:04<00:00, 388.42it/s]
Adding requests:  96%|█████████▌| 1962/2048 [00:05<00:00, 392.86it/s]
Adding requests:  98%|█████████▊| 2003/2048 [00:05<00:00, 396.54it/s]
Adding requests: 100%|█████████▉| 2043/2048 [00:05<00:00, 396.22it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 389.80it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:00<00:00, 2666.16it/s, est. speed input: 2730670.02 toks/s, output: 2666.33 toks/s]
Processed prompts:  27%|██▋       | 557/2048 [00:04<00:13, 108.42it/s, est. speed input: 130584.59 toks/s, output: 127.52 toks/s]   
Processed prompts:  33%|███▎      | 671/2048 [00:06<00:15, 90.71it/s, est. speed input: 110526.07 toks/s, output: 107.94 toks/s] 
Processed prompts:  36%|███▌      | 736/2048 [00:07<00:15, 83.77it/s, est. speed input: 103580.16 toks/s, output: 101.15 toks/s]
Processed prompts:  38%|███▊      | 778/2048 [00:08<00:16, 77.54it/s, est. speed input: 98728.12 toks/s, output: 96.41 toks/s]  
Processed prompts:  39%|███▉      | 807/2048 [00:08<00:16, 73.86it/s, est. speed input: 96102.09 toks/s, output: 93.85 toks/s]
Processed prompts:  40%|████      | 828/2048 [00:08<00:16, 74.42it/s, est. speed input: 95655.50 toks/s, output: 93.41 toks/s]
Processed prompts:  41%|████▏     | 845/2048 [00:09<00:16, 73.11it/s, est. speed input: 94789.44 toks/s, output: 92.57 toks/s]
Processed prompts:  42%|████▏     | 859/2048 [00:09<00:17, 69.82it/s, est. speed input: 93608.08 toks/s, output: 91.41 toks/s]
Processed prompts:  42%|████▏     | 870/2048 [00:09<00:18, 64.32it/s, est. speed input: 92127.64 toks/s, output: 89.97 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:09<00:19, 60.04it/s, est. speed input: 90832.56 toks/s, output: 88.70 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:10<00:19, 59.69it/s, est. speed input: 90005.29 toks/s, output: 87.90 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:10<00:19, 59.40it/s, est. speed input: 89220.78 toks/s, output: 87.13 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:10<00:18, 59.17it/s, est. speed input: 88477.29 toks/s, output: 86.40 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:11<00:18, 59.01it/s, est. speed input: 87772.14 toks/s, output: 85.71 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:11<00:18, 58.86it/s, est. speed input: 87096.73 toks/s, output: 85.06 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:11<00:17, 59.65it/s, est. speed input: 86562.26 toks/s, output: 84.53 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:11<00:17, 59.30it/s, est. speed input: 85945.26 toks/s, output: 83.93 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:12<00:17, 59.06it/s, est. speed input: 85356.42 toks/s, output: 83.36 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:12<00:17, 58.90it/s, est. speed input: 84795.36 toks/s, output: 82.81 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:12<00:17, 58.75it/s, est. speed input: 84254.66 toks/s, output: 82.28 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:12<00:16, 58.66it/s, est. speed input: 83738.27 toks/s, output: 81.78 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:13<00:16, 58.59it/s, est. speed input: 83242.40 toks/s, output: 81.29 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:13<00:16, 58.54it/s, est. speed input: 82766.71 toks/s, output: 80.83 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:13<00:16, 58.52it/s, est. speed input: 82311.24 toks/s, output: 80.38 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:14<00:15, 58.50it/s, est. speed input: 81873.84 toks/s, output: 79.95 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:14<00:15, 58.48it/s, est. speed input: 81452.22 toks/s, output: 79.54 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:14<00:15, 59.43it/s, est. speed input: 81128.77 toks/s, output: 79.23 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:14<00:14, 59.11it/s, est. speed input: 80733.84 toks/s, output: 78.84 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:15<00:14, 58.90it/s, est. speed input: 80354.64 toks/s, output: 78.47 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:15<00:14, 58.76it/s, est. speed input: 79989.44 toks/s, output: 78.11 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:15<00:14, 58.65it/s, est. speed input: 79636.65 toks/s, output: 77.77 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:15<00:13, 58.58it/s, est. speed input: 79295.93 toks/s, output: 77.44 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:16<00:13, 58.53it/s, est. speed input: 78966.65 toks/s, output: 77.12 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:16<00:13, 58.48it/s, est. speed input: 78647.46 toks/s, output: 76.80 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:16<00:13, 58.48it/s, est. speed input: 78340.73 toks/s, output: 76.50 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:17<00:12, 58.49it/s, est. speed input: 78045.08 toks/s, output: 76.22 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:17<00:12, 58.49it/s, est. speed input: 77758.43 toks/s, output: 75.94 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:17<00:12, 58.82it/s, est. speed input: 77502.49 toks/s, output: 75.69 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:17<00:11, 59.05it/s, est. speed input: 77254.46 toks/s, output: 75.44 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:18<00:11, 59.20it/s, est. speed input: 77013.54 toks/s, output: 75.21 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:18<00:11, 59.31it/s, est. speed input: 76779.21 toks/s, output: 74.98 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:18<00:11, 59.38it/s, est. speed input: 76551.53 toks/s, output: 74.76 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:18<00:10, 59.43it/s, est. speed input: 76330.47 toks/s, output: 74.54 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:19<00:10, 59.49it/s, est. speed input: 76116.60 toks/s, output: 74.33 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:19<00:10, 59.50it/s, est. speed input: 75906.89 toks/s, output: 74.13 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:19<00:09, 59.49it/s, est. speed input: 75702.34 toks/s, output: 73.93 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:19<00:09, 59.51it/s, est. speed input: 75504.54 toks/s, output: 73.73 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:20<00:09, 59.51it/s, est. speed input: 75310.99 toks/s, output: 73.55 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:20<00:09, 59.49it/s, est. speed input: 75121.85 toks/s, output: 73.36 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:20<00:08, 59.49it/s, est. speed input: 74938.10 toks/s, output: 73.18 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:21<00:08, 59.49it/s, est. speed input: 74759.28 toks/s, output: 73.01 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:21<00:08, 59.48it/s, est. speed input: 74584.36 toks/s, output: 72.84 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:21<00:08, 59.47it/s, est. speed input: 74413.37 toks/s, output: 72.67 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:21<00:07, 59.47it/s, est. speed input: 74247.11 toks/s, output: 72.51 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:22<00:07, 59.48it/s, est. speed input: 74085.33 toks/s, output: 72.35 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:24<00:22, 19.01it/s, est. speed input: 68125.76 toks/s, output: 66.53 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:24<00:17, 23.89it/s, est. speed input: 68046.69 toks/s, output: 66.45 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:24<00:13, 29.11it/s, est. speed input: 67969.32 toks/s, output: 66.38 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:25<00:11, 34.37it/s, est. speed input: 67892.59 toks/s, output: 66.30 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:25<00:09, 39.35it/s, est. speed input: 67818.33 toks/s, output: 66.23 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:25<00:07, 43.80it/s, est. speed input: 67746.02 toks/s, output: 66.16 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:25<00:07, 47.56it/s, est. speed input: 67675.36 toks/s, output: 66.09 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:26<00:06, 50.60it/s, est. speed input: 67605.75 toks/s, output: 66.02 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:26<00:05, 52.96it/s, est. speed input: 67537.01 toks/s, output: 65.95 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:26<00:05, 54.75it/s, est. speed input: 67469.96 toks/s, output: 65.89 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:27<00:04, 55.76it/s, est. speed input: 67390.71 toks/s, output: 65.81 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:27<00:04, 56.03it/s, est. speed input: 67293.88 toks/s, output: 65.72 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:27<00:04, 56.72it/s, est. speed input: 67219.25 toks/s, output: 65.64 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:27<00:03, 57.20it/s, est. speed input: 67145.62 toks/s, output: 65.57 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:28<00:03, 57.53it/s, est. speed input: 67073.20 toks/s, output: 65.50 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:28<00:03, 57.76it/s, est. speed input: 67002.15 toks/s, output: 65.43 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:28<00:02, 58.88it/s, est. speed input: 66967.25 toks/s, output: 65.40 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:28<00:02, 58.72it/s, est. speed input: 66898.90 toks/s, output: 65.33 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:29<00:02, 58.59it/s, est. speed input: 66831.22 toks/s, output: 65.26 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:29<00:02, 58.52it/s, est. speed input: 66765.34 toks/s, output: 65.20 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:29<00:01, 58.47it/s, est. speed input: 66700.73 toks/s, output: 65.14 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:30<00:01, 58.43it/s, est. speed input: 66637.07 toks/s, output: 65.08 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:30<00:01, 58.41it/s, est. speed input: 66574.92 toks/s, output: 65.01 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:30<00:01, 58.40it/s, est. speed input: 66513.83 toks/s, output: 64.95 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:30<00:00, 58.37it/s, est. speed input: 66453.19 toks/s, output: 64.90 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:31<00:00, 58.36it/s, est. speed input: 66394.02 toks/s, output: 64.84 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:31<00:00, 59.48it/s, est. speed input: 66372.49 toks/s, output: 64.82 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:31<00:00, 59.48it/s, est. speed input: 66828.52 toks/s, output: 65.26 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:31<00:00, 65.26it/s, est. speed input: 66828.52 toks/s, output: 65.26 toks/s]
[rank0]:[W128 11:32:05.759448831 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 90.0s

测试结果:
  Requests/s:   58.97
  Tokens/s:     60445.26
  Total Reqs:   2048
  Elapsed:      34.73s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     60386.28

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:32:37 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:32:38 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=22060) WARNING 01-28 11:32:45 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=22060) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=22060) WARNING 01-28 11:32:55 [backends.py:609] Failed to read file <frozen os>
Throughput: 58.89 requests/s, 60364.02 total tokens/s, 58.89 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:32:37] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:32:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:32:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:32:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:32:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:32:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:32:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:32:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:32:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:32:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:32:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:32:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:32:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:32:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:32:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:32:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:32:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:32:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:32:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:45] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:45] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:45] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:45] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:45] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:45] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=22060) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=22060) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=22060) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=22060) 
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=22060) [2026-01-28 11:32:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=22060) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.86it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  8.14it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:02<00:08,  1.00s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:02<00:04,  1.53it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:02<00:02,  2.19it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:02<00:01,  2.94it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:02<00:01,  3.77it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:02<00:00,  4.63it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:02<00:00,  5.42it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:03<00:00,  6.16it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:03<00:00,  6.45it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:03<00:00,  3.41it/s]
(EngineCore_DP0 pid=22060) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.28it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.36it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.82it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  9.01it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  9.10it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  9.21it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.32it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.01it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 34/4096 [00:00<00:12, 335.65it/s]
Adding requests:   2%|▏         | 70/4096 [00:00<00:11, 348.51it/s]
Adding requests:   3%|▎         | 109/4096 [00:00<00:10, 363.51it/s]
Adding requests:   4%|▎         | 146/4096 [00:00<00:10, 361.31it/s]
Adding requests:   4%|▍         | 183/4096 [00:00<00:10, 362.43it/s]
Adding requests:   5%|▌         | 220/4096 [00:00<00:10, 363.50it/s]
Adding requests:   6%|▋         | 259/4096 [00:00<00:10, 370.69it/s]
Adding requests:   7%|▋         | 297/4096 [00:00<00:10, 372.50it/s]
Adding requests:   8%|▊         | 335/4096 [00:00<00:10, 368.71it/s]
Adding requests:   9%|▉         | 374/4096 [00:01<00:09, 375.10it/s]
Adding requests:  10%|█         | 412/4096 [00:01<00:09, 376.22it/s]
Adding requests:  11%|█         | 450/4096 [00:01<00:09, 375.23it/s]
Adding requests:  12%|█▏        | 489/4096 [00:01<00:09, 377.37it/s]
Adding requests:  13%|█▎        | 527/4096 [00:01<00:09, 367.39it/s]
Adding requests:  14%|█▍        | 567/4096 [00:01<00:09, 376.45it/s]
Adding requests:  15%|█▍        | 605/4096 [00:01<00:09, 377.19it/s]
Adding requests:  16%|█▌        | 646/4096 [00:01<00:08, 384.82it/s]
Adding requests:  17%|█▋        | 686/4096 [00:01<00:08, 386.94it/s]
Adding requests:  18%|█▊        | 725/4096 [00:01<00:08, 386.86it/s]
Adding requests:  19%|█▊        | 764/4096 [00:02<00:08, 384.86it/s]
Adding requests:  20%|█▉        | 803/4096 [00:02<00:08, 381.79it/s]
Adding requests:  21%|██        | 842/4096 [00:02<00:08, 377.48it/s]
Adding requests:  22%|██▏       | 883/4096 [00:02<00:08, 385.10it/s]
Adding requests:  23%|██▎       | 923/4096 [00:02<00:08, 388.52it/s]
Adding requests:  23%|██▎       | 962/4096 [00:02<00:08, 388.59it/s]
Adding requests:  24%|██▍       | 1002/4096 [00:02<00:07, 390.24it/s]
Adding requests:  25%|██▌       | 1043/4096 [00:02<00:07, 393.72it/s]
Adding requests:  26%|██▋       | 1083/4096 [00:02<00:07, 392.22it/s]
Adding requests:  27%|██▋       | 1123/4096 [00:02<00:07, 390.25it/s]
Adding requests:  28%|██▊       | 1163/4096 [00:03<00:07, 392.73it/s]
Adding requests:  29%|██▉       | 1203/4096 [00:03<00:07, 384.32it/s]
Adding requests:  30%|███       | 1242/4096 [00:03<00:07, 376.09it/s]
Adding requests:  31%|███▏      | 1280/4096 [00:03<00:07, 376.21it/s]
Adding requests:  32%|███▏      | 1320/4096 [00:03<00:07, 379.89it/s]
Adding requests:  33%|███▎      | 1359/4096 [00:03<00:07, 379.98it/s]
Adding requests:  34%|███▍      | 1400/4096 [00:03<00:06, 387.58it/s]
Adding requests:  35%|███▌      | 1440/4096 [00:03<00:06, 390.67it/s]
Adding requests:  36%|███▌      | 1480/4096 [00:03<00:06, 388.44it/s]
Adding requests:  37%|███▋      | 1521/4096 [00:03<00:06, 392.61it/s]
Adding requests:  38%|███▊      | 1562/4096 [00:04<00:06, 394.63it/s]
Adding requests:  39%|███▉      | 1602/4096 [00:04<00:06, 395.97it/s]
Adding requests:  40%|████      | 1642/4096 [00:04<00:06, 394.19it/s]
Adding requests:  41%|████      | 1682/4096 [00:04<00:06, 389.97it/s]
Adding requests:  42%|████▏     | 1723/4096 [00:04<00:06, 394.06it/s]
Adding requests:  43%|████▎     | 1763/4096 [00:04<00:05, 394.35it/s]
Adding requests:  44%|████▍     | 1803/4096 [00:04<00:05, 392.64it/s]
Adding requests:  45%|████▌     | 1844/4096 [00:04<00:05, 396.45it/s]
Adding requests:  46%|████▌     | 1884/4096 [00:04<00:05, 392.98it/s]
Adding requests:  47%|████▋     | 1924/4096 [00:05<00:05, 394.27it/s]
Adding requests:  48%|████▊     | 1964/4096 [00:05<00:05, 391.84it/s]
Adding requests:  49%|████▉     | 2005/4096 [00:05<00:05, 395.05it/s]
Adding requests:  50%|████▉     | 2045/4096 [00:05<00:05, 391.13it/s]
Adding requests:  51%|█████     | 2085/4096 [00:05<00:05, 389.83it/s]
Adding requests:  52%|█████▏    | 2124/4096 [00:05<00:05, 388.90it/s]
Adding requests:  53%|█████▎    | 2163/4096 [00:05<00:05, 384.80it/s]
Adding requests:  54%|█████▍    | 2202/4096 [00:05<00:04, 384.12it/s]
Adding requests:  55%|█████▍    | 2242/4096 [00:05<00:04, 388.48it/s]
Adding requests:  56%|█████▌    | 2281/4096 [00:05<00:04, 386.08it/s]
Adding requests:  57%|█████▋    | 2321/4096 [00:06<00:04, 387.41it/s]
Adding requests:  58%|█████▊    | 2360/4096 [00:06<00:04, 383.83it/s]
Adding requests:  59%|█████▊    | 2399/4096 [00:06<00:04, 372.77it/s]
Adding requests:  59%|█████▉    | 2437/4096 [00:06<00:04, 372.02it/s]
Adding requests:  60%|██████    | 2476/4096 [00:06<00:04, 376.06it/s]
Adding requests:  61%|██████▏   | 2515/4096 [00:06<00:04, 378.83it/s]
Adding requests:  62%|██████▏   | 2555/4096 [00:06<00:04, 384.80it/s]
Adding requests:  63%|██████▎   | 2596/4096 [00:06<00:03, 390.17it/s]
Adding requests:  64%|██████▍   | 2637/4096 [00:06<00:03, 394.91it/s]
Adding requests:  65%|██████▌   | 2678/4096 [00:06<00:03, 397.00it/s]
Adding requests:  66%|██████▋   | 2718/4096 [00:07<00:03, 397.49it/s]
Adding requests:  67%|██████▋   | 2758/4096 [00:07<00:03, 398.12it/s]
Adding requests:  68%|██████▊   | 2798/4096 [00:07<00:03, 397.65it/s]
Adding requests:  69%|██████▉   | 2838/4096 [00:07<00:03, 396.18it/s]
Adding requests:  70%|███████   | 2878/4096 [00:07<00:03, 395.57it/s]
Adding requests:  71%|███████▏  | 2919/4096 [00:07<00:02, 399.09it/s]
Adding requests:  72%|███████▏  | 2959/4096 [00:07<00:02, 396.37it/s]
Adding requests:  73%|███████▎  | 3000/4096 [00:07<00:02, 398.03it/s]
Adding requests:  74%|███████▍  | 3041/4096 [00:07<00:02, 399.87it/s]
Adding requests:  75%|███████▌  | 3081/4096 [00:07<00:02, 391.38it/s]
Adding requests:  76%|███████▌  | 3122/4096 [00:08<00:02, 396.03it/s]
Adding requests:  77%|███████▋  | 3162/4096 [00:08<00:02, 396.46it/s]
Adding requests:  78%|███████▊  | 3202/4096 [00:08<00:02, 395.28it/s]
Adding requests:  79%|███████▉  | 3243/4096 [00:08<00:02, 398.47it/s]
Adding requests:  80%|████████  | 3284/4096 [00:08<00:02, 399.17it/s]
Adding requests:  81%|████████  | 3324/4096 [00:08<00:01, 396.49it/s]
Adding requests:  82%|████████▏ | 3366/4096 [00:08<00:01, 402.96it/s]
Adding requests:  83%|████████▎ | 3407/4096 [00:08<00:01, 401.55it/s]
Adding requests:  84%|████████▍ | 3448/4096 [00:08<00:01, 393.73it/s]
Adding requests:  85%|████████▌ | 3488/4096 [00:09<00:01, 387.63it/s]
Adding requests:  86%|████████▌ | 3527/4096 [00:09<00:01, 387.00it/s]
Adding requests:  87%|████████▋ | 3566/4096 [00:09<00:01, 386.31it/s]
Adding requests:  88%|████████▊ | 3607/4096 [00:09<00:01, 392.44it/s]
Adding requests:  89%|████████▉ | 3647/4096 [00:09<00:01, 389.79it/s]
Adding requests:  90%|█████████ | 3687/4096 [00:09<00:01, 392.50it/s]
Adding requests:  91%|█████████ | 3727/4096 [00:09<00:00, 393.88it/s]
Adding requests:  92%|█████████▏| 3767/4096 [00:09<00:00, 384.32it/s]
Adding requests:  93%|█████████▎| 3809/4096 [00:09<00:00, 392.52it/s]
Adding requests:  94%|█████████▍| 3850/4096 [00:09<00:00, 396.68it/s]
Adding requests:  95%|█████████▍| 3890/4096 [00:10<00:00, 393.27it/s]
Adding requests:  96%|█████████▌| 3931/4096 [00:10<00:00, 396.40it/s]
Adding requests:  97%|█████████▋| 3972/4096 [00:10<00:00, 398.16it/s]
Adding requests:  98%|█████████▊| 4013/4096 [00:10<00:00, 400.17it/s]
Adding requests:  99%|█████████▉| 4054/4096 [00:10<00:00, 397.34it/s]
Adding requests: 100%|█████████▉| 4095/4096 [00:10<00:00, 398.46it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 388.07it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:00<00:03, 1146.38it/s, est. speed input: 1174016.29 toks/s, output: 1146.39 toks/s]
Processed prompts:  18%|█▊        | 725/4096 [00:02<00:12, 275.91it/s, est. speed input: 349522.08 toks/s, output: 341.33 toks/s]   
Processed prompts:  19%|█▉        | 777/4096 [00:03<00:18, 177.14it/s, est. speed input: 249860.86 toks/s, output: 244.00 toks/s]
Processed prompts:  20%|█▉        | 808/4096 [00:03<00:22, 148.81it/s, est. speed input: 222587.91 toks/s, output: 217.37 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:04<00:26, 123.37it/s, est. speed input: 200905.54 toks/s, output: 196.20 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:04<00:30, 105.89it/s, est. speed input: 184908.02 toks/s, output: 180.57 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:05<00:34, 92.75it/s, est. speed input: 172181.10 toks/s, output: 168.14 toks/s] 
Processed prompts:  23%|██▎       | 930/4096 [00:05<00:38, 83.05it/s, est. speed input: 161799.42 toks/s, output: 158.01 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:06<00:40, 76.50it/s, est. speed input: 153467.12 toks/s, output: 149.87 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:06<00:43, 71.20it/s, est. speed input: 146122.97 toks/s, output: 142.70 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:07<00:45, 67.50it/s, est. speed input: 139873.31 toks/s, output: 136.59 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:08<00:46, 64.85it/s, est. speed input: 134460.74 toks/s, output: 131.31 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:08<00:47, 63.01it/s, est. speed input: 129742.48 toks/s, output: 126.70 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:09<00:48, 61.71it/s, est. speed input: 125586.35 toks/s, output: 122.64 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:09<00:47, 61.35it/s, est. speed input: 122106.50 toks/s, output: 119.24 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:10<00:48, 60.54it/s, est. speed input: 118797.10 toks/s, output: 116.01 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:10<00:47, 59.98it/s, est. speed input: 115821.71 toks/s, output: 113.11 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:11<00:47, 59.58it/s, est. speed input: 113134.26 toks/s, output: 110.48 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:11<00:47, 59.29it/s, est. speed input: 110688.51 toks/s, output: 108.09 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:12<00:47, 59.18it/s, est. speed input: 108483.39 toks/s, output: 105.94 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:12<00:46, 59.20it/s, est. speed input: 106487.40 toks/s, output: 103.99 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:13<00:45, 59.21it/s, est. speed input: 104651.94 toks/s, output: 102.20 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:14<00:45, 59.22it/s, est. speed input: 102956.70 toks/s, output: 100.54 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:14<00:44, 59.22it/s, est. speed input: 101386.71 toks/s, output: 99.01 toks/s] 
Processed prompts:  36%|███▌      | 1474/4096 [00:15<00:44, 59.22it/s, est. speed input: 99929.14 toks/s, output: 97.59 toks/s] 
Processed prompts:  37%|███▋      | 1506/4096 [00:15<00:43, 59.23it/s, est. speed input: 98573.50 toks/s, output: 96.26 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:16<00:43, 59.23it/s, est. speed input: 97307.86 toks/s, output: 95.03 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:16<00:42, 59.23it/s, est. speed input: 96123.12 toks/s, output: 93.87 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:17<00:42, 59.23it/s, est. speed input: 95013.02 toks/s, output: 92.79 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:17<00:41, 59.16it/s, est. speed input: 93960.04 toks/s, output: 91.76 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:18<00:41, 59.10it/s, est. speed input: 92966.01 toks/s, output: 90.79 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:20<01:24, 28.41it/s, est. speed input: 83423.88 toks/s, output: 81.47 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:21<01:10, 33.66it/s, est. speed input: 82848.94 toks/s, output: 80.91 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:21<01:00, 38.66it/s, est. speed input: 82299.29 toks/s, output: 80.37 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:22<00:53, 43.06it/s, est. speed input: 81759.02 toks/s, output: 79.84 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:23<00:48, 46.72it/s, est. speed input: 81232.06 toks/s, output: 79.33 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:23<00:44, 50.03it/s, est. speed input: 80782.52 toks/s, output: 78.89 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:24<00:42, 52.25it/s, est. speed input: 80302.04 toks/s, output: 78.42 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:24<00:40, 53.92it/s, est. speed input: 79841.65 toks/s, output: 77.97 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:25<00:38, 55.16it/s, est. speed input: 79402.46 toks/s, output: 77.54 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:25<00:37, 56.05it/s, est. speed input: 78980.49 toks/s, output: 77.13 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:26<00:36, 56.69it/s, est. speed input: 78576.50 toks/s, output: 76.73 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:26<00:35, 57.15it/s, est. speed input: 78189.09 toks/s, output: 76.36 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:27<00:35, 57.48it/s, est. speed input: 77817.72 toks/s, output: 75.99 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:27<00:34, 57.72it/s, est. speed input: 77461.48 toks/s, output: 75.65 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:28<00:33, 57.88it/s, est. speed input: 77118.52 toks/s, output: 75.31 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:29<00:33, 57.99it/s, est. speed input: 76787.60 toks/s, output: 74.99 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:29<00:32, 58.06it/s, est. speed input: 76469.38 toks/s, output: 74.68 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:30<00:31, 58.15it/s, est. speed input: 76165.46 toks/s, output: 74.38 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:30<00:30, 59.19it/s, est. speed input: 75947.36 toks/s, output: 74.17 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:31<00:30, 59.44it/s, est. speed input: 75700.15 toks/s, output: 73.93 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:31<00:29, 59.61it/s, est. speed input: 75460.23 toks/s, output: 73.69 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:32<00:28, 59.73it/s, est. speed input: 75229.09 toks/s, output: 73.47 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:32<00:28, 59.82it/s, est. speed input: 75005.06 toks/s, output: 73.25 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:33<00:27, 59.87it/s, est. speed input: 74787.81 toks/s, output: 73.03 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:33<00:27, 59.90it/s, est. speed input: 74577.19 toks/s, output: 72.83 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:34<00:26, 60.46it/s, est. speed input: 74407.18 toks/s, output: 72.66 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:34<00:25, 60.33it/s, est. speed input: 74209.43 toks/s, output: 72.47 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:35<00:25, 60.23it/s, est. speed input: 74017.34 toks/s, output: 72.28 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:35<00:24, 60.16it/s, est. speed input: 73831.08 toks/s, output: 72.10 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:36<00:24, 60.11it/s, est. speed input: 73649.78 toks/s, output: 71.92 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:37<00:23, 60.07it/s, est. speed input: 73473.88 toks/s, output: 71.75 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:37<00:23, 60.05it/s, est. speed input: 73303.04 toks/s, output: 71.58 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:38<00:22, 60.03it/s, est. speed input: 73136.97 toks/s, output: 71.42 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:38<00:22, 59.61it/s, est. speed input: 72952.29 toks/s, output: 71.24 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:39<00:22, 59.34it/s, est. speed input: 72773.76 toks/s, output: 71.07 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:39<00:21, 59.13it/s, est. speed input: 72598.99 toks/s, output: 70.90 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:40<00:21, 58.98it/s, est. speed input: 72428.80 toks/s, output: 70.73 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:40<00:20, 58.88it/s, est. speed input: 72263.63 toks/s, output: 70.57 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:41<00:20, 58.82it/s, est. speed input: 72103.15 toks/s, output: 70.41 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:41<00:19, 58.78it/s, est. speed input: 71946.85 toks/s, output: 70.26 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:42<00:19, 58.74it/s, est. speed input: 71794.34 toks/s, output: 70.11 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:43<00:18, 58.72it/s, est. speed input: 71645.71 toks/s, output: 69.97 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:43<00:17, 58.70it/s, est. speed input: 71500.83 toks/s, output: 69.82 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:44<00:17, 58.69it/s, est. speed input: 71359.48 toks/s, output: 69.69 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:44<00:16, 58.68it/s, est. speed input: 71221.31 toks/s, output: 69.55 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:45<00:16, 58.67it/s, est. speed input: 71086.74 toks/s, output: 69.42 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:45<00:15, 58.67it/s, est. speed input: 70955.41 toks/s, output: 69.29 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:46<00:15, 58.70it/s, est. speed input: 70828.44 toks/s, output: 69.17 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:46<00:14, 58.83it/s, est. speed input: 70709.73 toks/s, output: 69.05 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:47<00:14, 58.94it/s, est. speed input: 70594.54 toks/s, output: 68.94 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:47<00:13, 58.99it/s, est. speed input: 70481.07 toks/s, output: 68.83 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:48<00:12, 59.04it/s, est. speed input: 70370.22 toks/s, output: 68.72 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:48<00:12, 59.06it/s, est. speed input: 70261.64 toks/s, output: 68.61 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:49<00:11, 59.10it/s, est. speed input: 70156.29 toks/s, output: 68.51 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:50<00:11, 59.12it/s, est. speed input: 70052.97 toks/s, output: 68.41 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:50<00:10, 59.14it/s, est. speed input: 69951.95 toks/s, output: 68.31 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:51<00:10, 59.15it/s, est. speed input: 69853.17 toks/s, output: 68.22 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [00:51<00:09, 59.16it/s, est. speed input: 69756.24 toks/s, output: 68.12 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [00:52<00:09, 59.17it/s, est. speed input: 69661.92 toks/s, output: 68.03 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [00:52<00:08, 59.17it/s, est. speed input: 69568.93 toks/s, output: 67.94 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [00:55<00:16, 28.36it/s, est. speed input: 67016.23 toks/s, output: 65.45 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [00:55<00:13, 33.61it/s, est. speed input: 66953.83 toks/s, output: 65.38 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [00:56<00:10, 38.55it/s, est. speed input: 66887.79 toks/s, output: 65.32 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [00:56<00:08, 43.20it/s, est. speed input: 66837.51 toks/s, output: 65.27 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [00:57<00:07, 46.83it/s, est. speed input: 66769.25 toks/s, output: 65.20 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [00:57<00:06, 49.77it/s, est. speed input: 66702.05 toks/s, output: 65.14 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [00:58<00:05, 52.06it/s, est. speed input: 66636.63 toks/s, output: 65.07 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [00:59<00:04, 53.78it/s, est. speed input: 66571.83 toks/s, output: 65.01 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [00:59<00:04, 55.05it/s, est. speed input: 66508.36 toks/s, output: 64.95 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:00<00:03, 55.97it/s, est. speed input: 66445.77 toks/s, output: 64.89 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:00<00:02, 56.65it/s, est. speed input: 66384.58 toks/s, output: 64.83 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:01<00:02, 57.13it/s, est. speed input: 66324.54 toks/s, output: 64.77 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:01<00:01, 57.48it/s, est. speed input: 66265.94 toks/s, output: 64.71 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:02<00:01, 58.22it/s, est. speed input: 66224.86 toks/s, output: 64.67 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:02<00:00, 58.91it/s, est. speed input: 66189.89 toks/s, output: 64.64 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:02<00:00, 58.91it/s, est. speed input: 66677.73 toks/s, output: 65.11 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:02<00:00, 65.11it/s, est. speed input: 66677.73 toks/s, output: 65.11 toks/s]
[rank0]:[W128 11:34:23.587381967 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 138.6s

测试结果:
  Requests/s:   58.89
  Tokens/s:     60364.02
  Total Reqs:   4096
  Elapsed:      69.55s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     60305.13


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_8/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.7040,8569.1519,7.6628
1024,1024,1,128,128,16.7371,17155.5756,7.6477
2048,1024,2,256,128,32.9138,33736.6717,7.7779
4096,1024,4,512,128,56.6554,58071.7878,9.0371
8192,1024,8,1024,128,54.7630,56132.0866,18.6988
16384,1024,16,2048,128,58.9710,60445.2554,34.7289
32768,1024,32,4096,128,58.8917,60364.0182,69.5514

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_10) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_10
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_10

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:34:33 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:34:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=23050) WARNING 01-28 11:34:41 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=23050) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=23050) WARNING 01-28 11:34:55 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.94 requests/s, 8688.70 total tokens/s, 16.94 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:34:33] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:34:33] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:34:33] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:34:33] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:33] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:33] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:33] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:33] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:33] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:34:33] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:34:33] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:34:33] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:34:33] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:34:33] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:34:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:34:40] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:34:40] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:34:40] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:40] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:40] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:40] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:40] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:34:40] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:34:40] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:34:40] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:34:40] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:34:40] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:34:40] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:41] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:41] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:41] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:41] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:41] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:41] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=23050) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=23050) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.09s/it]
(EngineCore_DP0 pid=23050) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.09s/it]
(EngineCore_DP0 pid=23050) 
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:44] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:44] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:44] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:44] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=23050) [2026-01-28 11:34:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=23050) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.25it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.77it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.68it/s]
(EngineCore_DP0 pid=23050) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.60it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.59it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  52%|█████▏    | 67/128 [00:00<00:00, 669.51it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 690.65it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 38.28it/s, est. speed input: 19605.95 toks/s, output: 38.29 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:05, 21.75it/s, est. speed input: 11907.22 toks/s, output: 23.25 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:06, 19.42it/s, est. speed input: 10731.95 toks/s, output: 20.96 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:06, 18.37it/s, est. speed input: 10180.19 toks/s, output: 19.88 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 18.03it/s, est. speed input: 9976.21 toks/s, output: 19.48 toks/s] 
Processed prompts:  14%|█▍        | 18/128 [00:00<00:06, 17.74it/s, est. speed input: 9817.51 toks/s, output: 19.17 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 17.55it/s, est. speed input: 9696.09 toks/s, output: 18.94 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.42it/s, est. speed input: 9602.86 toks/s, output: 18.76 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:05, 17.37it/s, est. speed input: 9533.13 toks/s, output: 18.62 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:05, 17.35it/s, est. speed input: 9477.31 toks/s, output: 18.51 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:05, 17.31it/s, est. speed input: 9427.46 toks/s, output: 18.41 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 17.26it/s, est. speed input: 9381.28 toks/s, output: 18.32 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 17.26it/s, est. speed input: 9344.67 toks/s, output: 18.25 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:01<00:05, 17.18it/s, est. speed input: 9304.65 toks/s, output: 18.17 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:01<00:05, 17.11it/s, est. speed input: 9266.94 toks/s, output: 18.10 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 17.13it/s, est. speed input: 9240.79 toks/s, output: 18.05 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 17.16it/s, est. speed input: 9218.73 toks/s, output: 18.01 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 17.18it/s, est. speed input: 9199.51 toks/s, output: 17.97 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:04, 17.07it/s, est. speed input: 9170.38 toks/s, output: 17.91 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:04, 17.06it/s, est. speed input: 9150.26 toks/s, output: 17.87 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:04, 17.10it/s, est. speed input: 9134.93 toks/s, output: 17.84 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:02<00:04, 17.09it/s, est. speed input: 9118.51 toks/s, output: 17.81 toks/s]
Processed prompts:  41%|████      | 52/128 [00:02<00:04, 17.05it/s, est. speed input: 9100.73 toks/s, output: 17.77 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 17.03it/s, est. speed input: 9084.94 toks/s, output: 17.74 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 17.03it/s, est. speed input: 9071.66 toks/s, output: 17.72 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 17.03it/s, est. speed input: 9059.11 toks/s, output: 17.69 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:03, 17.04it/s, est. speed input: 9047.93 toks/s, output: 17.67 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:03, 17.04it/s, est. speed input: 9036.88 toks/s, output: 17.65 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:03, 17.07it/s, est. speed input: 9028.55 toks/s, output: 17.63 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 17.11it/s, est. speed input: 9021.87 toks/s, output: 17.62 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:03<00:03, 17.08it/s, est. speed input: 9012.38 toks/s, output: 17.60 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:03<00:03, 17.03it/s, est. speed input: 9001.66 toks/s, output: 17.58 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 17.07it/s, est. speed input: 8995.87 toks/s, output: 17.57 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 17.15it/s, est. speed input: 8992.47 toks/s, output: 17.56 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 17.21it/s, est. speed input: 8989.56 toks/s, output: 17.56 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:02, 17.23it/s, est. speed input: 8985.94 toks/s, output: 17.55 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:02, 17.14it/s, est. speed input: 8977.71 toks/s, output: 17.53 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 17.13it/s, est. speed input: 8972.12 toks/s, output: 17.52 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:04<00:02, 17.15it/s, est. speed input: 8968.04 toks/s, output: 17.52 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:04<00:02, 17.07it/s, est. speed input: 8960.22 toks/s, output: 17.50 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 17.08it/s, est. speed input: 8955.40 toks/s, output: 17.49 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 17.12it/s, est. speed input: 8952.27 toks/s, output: 17.48 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 17.14it/s, est. speed input: 8948.93 toks/s, output: 17.48 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:01, 17.20it/s, est. speed input: 8947.32 toks/s, output: 17.48 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 17.23it/s, est. speed input: 8945.36 toks/s, output: 17.47 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 17.24it/s, est. speed input: 8943.16 toks/s, output: 17.47 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:05<00:01, 17.24it/s, est. speed input: 8940.99 toks/s, output: 17.46 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:05<00:01, 17.05it/s, est. speed input: 8931.91 toks/s, output: 17.45 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:05<00:01, 16.94it/s, est. speed input: 8924.12 toks/s, output: 17.43 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 16.91it/s, est. speed input: 8918.15 toks/s, output: 17.42 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 16.99it/s, est. speed input: 8915.89 toks/s, output: 17.41 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 17.06it/s, est. speed input: 8914.23 toks/s, output: 17.41 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:00, 17.07it/s, est. speed input: 8911.18 toks/s, output: 17.40 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 17.02it/s, est. speed input: 8906.67 toks/s, output: 17.40 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:06<00:00, 17.04it/s, est. speed input: 8903.72 toks/s, output: 17.39 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:06<00:00, 17.08it/s, est. speed input: 8901.96 toks/s, output: 17.39 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:06<00:00, 17.04it/s, est. speed input: 8898.03 toks/s, output: 17.38 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 17.04it/s, est. speed input: 8895.09 toks/s, output: 17.37 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 17.09it/s, est. speed input: 8893.67 toks/s, output: 17.37 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 17.14it/s, est. speed input: 8892.84 toks/s, output: 17.37 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.16it/s, est. speed input: 8891.59 toks/s, output: 17.37 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.16it/s, est. speed input: 8891.59 toks/s, output: 17.37 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.37it/s, est. speed input: 8891.59 toks/s, output: 17.37 toks/s]
[rank0]:[W128 11:35:13.852533854 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 50.1s

测试结果:
  Requests/s:   16.94
  Tokens/s:     8688.70
  Total Reqs:   128
  Elapsed:      7.56s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8671.76

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:35:25 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:35:26 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=23588) WARNING 01-28 11:35:33 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=23588) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=23588) WARNING 01-28 11:35:43 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.27 requests/s, 16681.55 total tokens/s, 16.27 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:35:25] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:35:25] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:35:25] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:35:25] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:25] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:25] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:25] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:25] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:25] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:35:25] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:35:25] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:35:25] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:35:25] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:35:25] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:35:32] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:35:32] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:35:32] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:35:32] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:32] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:32] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:32] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:32] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:35:32] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:35:32] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:35:32] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:35:32] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:35:32] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:35:32] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:33] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:33] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:33] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:33] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:33] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:33] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=23588) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=23588) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=23588) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=23588) 
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=23588) [2026-01-28 11:35:35] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=23588) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  4.72it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.28it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  5.98it/s]
(EngineCore_DP0 pid=23588) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.41it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.40it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  29%|██▉       | 37/128 [00:00<00:00, 369.80it/s]
Adding requests:  59%|█████▉    | 76/128 [00:00<00:00, 380.59it/s]
Adding requests:  90%|████████▉ | 115/128 [00:00<00:00, 379.92it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 379.80it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:02, 42.97it/s, est. speed input: 44007.80 toks/s, output: 42.97 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:05, 22.51it/s, est. speed input: 24826.01 toks/s, output: 24.24 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:05, 20.23it/s, est. speed input: 22537.62 toks/s, output: 22.01 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:05, 18.91it/s, est. speed input: 21252.40 toks/s, output: 20.75 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:00<00:05, 18.18it/s, est. speed input: 20488.35 toks/s, output: 20.01 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 17.81it/s, est. speed input: 20104.49 toks/s, output: 19.63 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:05, 17.55it/s, est. speed input: 19813.57 toks/s, output: 19.35 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 17.29it/s, est. speed input: 19555.20 toks/s, output: 19.10 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 17.13it/s, est. speed input: 19350.41 toks/s, output: 18.90 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.03it/s, est. speed input: 19183.89 toks/s, output: 18.73 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 16.91it/s, est. speed input: 19026.46 toks/s, output: 18.58 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 16.79it/s, est. speed input: 18882.82 toks/s, output: 18.44 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 16.70it/s, est. speed input: 18757.16 toks/s, output: 18.32 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.66it/s, est. speed input: 18648.74 toks/s, output: 18.21 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.50it/s, est. speed input: 18527.71 toks/s, output: 18.09 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:04<00:30,  2.81it/s, est. speed input: 9847.63 toks/s, output: 9.62 toks/s]  
Processed prompts:  34%|███▎      | 43/128 [00:04<00:22,  3.73it/s, est. speed input: 10042.40 toks/s, output: 9.81 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:04<00:17,  4.86it/s, est. speed input: 10228.79 toks/s, output: 9.99 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:04<00:13,  6.16it/s, est. speed input: 10404.84 toks/s, output: 10.16 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:04<00:10,  7.58it/s, est. speed input: 10570.68 toks/s, output: 10.32 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:04<00:08,  9.05it/s, est. speed input: 10728.83 toks/s, output: 10.48 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:04<00:07, 10.49it/s, est. speed input: 10881.61 toks/s, output: 10.63 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:05<00:06, 11.78it/s, est. speed input: 11024.88 toks/s, output: 10.77 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:05<00:05, 12.93it/s, est. speed input: 11164.58 toks/s, output: 10.90 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:05<00:04, 13.83it/s, est. speed input: 11294.63 toks/s, output: 11.03 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:05<00:04, 14.56it/s, est. speed input: 11420.61 toks/s, output: 11.15 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:05<00:04, 15.16it/s, est. speed input: 11543.39 toks/s, output: 11.27 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:05<00:04, 15.54it/s, est. speed input: 11656.81 toks/s, output: 11.38 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:05<00:03, 15.82it/s, est. speed input: 11766.22 toks/s, output: 11.49 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:05<00:03, 16.09it/s, est. speed input: 11874.34 toks/s, output: 11.60 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:06<00:03, 16.28it/s, est. speed input: 11978.11 toks/s, output: 11.70 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:06<00:03, 16.42it/s, est. speed input: 12077.70 toks/s, output: 11.79 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:06<00:03, 16.50it/s, est. speed input: 12173.14 toks/s, output: 11.89 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:06<00:03, 16.55it/s, est. speed input: 12264.27 toks/s, output: 11.98 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:06<00:02, 16.57it/s, est. speed input: 12351.85 toks/s, output: 12.06 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:06<00:02, 16.52it/s, est. speed input: 12433.13 toks/s, output: 12.14 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:06<00:02, 16.50it/s, est. speed input: 12511.85 toks/s, output: 12.22 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:06<00:02, 16.50it/s, est. speed input: 12588.67 toks/s, output: 12.29 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:07<00:02, 16.47it/s, est. speed input: 12661.52 toks/s, output: 12.36 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:07<00:02, 16.54it/s, est. speed input: 12736.02 toks/s, output: 12.44 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:07<00:02, 16.57it/s, est. speed input: 12807.18 toks/s, output: 12.51 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:07<00:02, 16.50it/s, est. speed input: 12871.91 toks/s, output: 12.57 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:07<00:02, 16.49it/s, est. speed input: 12936.26 toks/s, output: 12.63 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:07<00:01, 16.42it/s, est. speed input: 12996.26 toks/s, output: 12.69 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:07<00:01, 16.41it/s, est. speed input: 13055.50 toks/s, output: 12.75 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:07<00:01, 16.46it/s, est. speed input: 13115.70 toks/s, output: 12.81 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:08<00:01, 16.54it/s, est. speed input: 13175.56 toks/s, output: 12.87 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:08<00:01, 16.49it/s, est. speed input: 13229.60 toks/s, output: 12.92 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:08<00:01, 16.55it/s, est. speed input: 13285.86 toks/s, output: 12.97 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:08<00:01, 16.61it/s, est. speed input: 13340.79 toks/s, output: 13.03 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:08<00:01, 16.66it/s, est. speed input: 13394.97 toks/s, output: 13.08 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:08<00:00, 16.68it/s, est. speed input: 13446.67 toks/s, output: 13.13 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:08<00:00, 16.65it/s, est. speed input: 13495.72 toks/s, output: 13.18 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:08<00:00, 16.56it/s, est. speed input: 13540.41 toks/s, output: 13.22 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:08<00:00, 16.62it/s, est. speed input: 13588.88 toks/s, output: 13.27 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:09<00:00, 16.62it/s, est. speed input: 13634.17 toks/s, output: 13.31 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:09<00:00, 16.64it/s, est. speed input: 13678.95 toks/s, output: 13.36 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:09<00:00, 16.60it/s, est. speed input: 13720.87 toks/s, output: 13.40 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:09<00:00, 16.54it/s, est. speed input: 13760.66 toks/s, output: 13.44 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 16.54it/s, est. speed input: 13779.21 toks/s, output: 13.46 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 13.46it/s, est. speed input: 13779.21 toks/s, output: 13.46 toks/s]
[rank0]:[W128 11:36:04.371275209 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 50.5s

测试结果:
  Requests/s:   16.27
  Tokens/s:     16681.55
  Total Reqs:   128
  Elapsed:      7.86s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16665.27

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:36:14 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:36:15 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=24114) WARNING 01-28 11:36:22 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=24114) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=24114) WARNING 01-28 11:36:34 [backends.py:609] Failed to read file <frozen os>
Throughput: 34.60 requests/s, 35462.85 total tokens/s, 34.60 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:36:14] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:36:14] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:36:14] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:36:14] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:14] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:14] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:14] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:14] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:14] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:36:14] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:36:14] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:36:14] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:36:14] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:36:14] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:36:21] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:36:21] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:36:21] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:36:21] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:21] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:21] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:21] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:21] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:36:21] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:36:21] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:36:21] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:36:21] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:36:21] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:36:21] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:22] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:22] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:22] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:22] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:22] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:22] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=24114) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=24114) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.44it/s]
(EngineCore_DP0 pid=24114) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.44it/s]
(EngineCore_DP0 pid=24114) 
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:23] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=24114) [2026-01-28 11:36:24] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=24114) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  8.26it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.79it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  8.11it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  8.23it/s]
(EngineCore_DP0 pid=24114) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.42it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.55it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.36it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 37/256 [00:00<00:00, 362.54it/s]
Adding requests:  30%|███       | 77/256 [00:00<00:00, 382.28it/s]
Adding requests:  45%|████▌     | 116/256 [00:00<00:00, 372.27it/s]
Adding requests:  60%|██████    | 154/256 [00:00<00:00, 370.29it/s]
Adding requests:  75%|███████▌  | 192/256 [00:00<00:00, 368.35it/s]
Adding requests:  90%|████████▉ | 230/256 [00:00<00:00, 371.72it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 373.70it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   8%|▊         | 20/256 [00:00<00:01, 147.82it/s, est. speed input: 151399.70 toks/s, output: 147.83 toks/s]
Processed prompts:  14%|█▎        | 35/256 [00:00<00:03, 59.37it/s, est. speed input: 67743.54 toks/s, output: 66.16 toks/s]   
Processed prompts:  17%|█▋        | 44/256 [00:00<00:04, 47.00it/s, est. speed input: 55587.21 toks/s, output: 54.28 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:00<00:04, 43.96it/s, est. speed input: 52398.12 toks/s, output: 51.17 toks/s]
Processed prompts:  22%|██▏       | 56/256 [00:01<00:04, 41.81it/s, est. speed input: 50195.73 toks/s, output: 49.02 toks/s]
Processed prompts:  24%|██▍       | 61/256 [00:01<00:04, 42.56it/s, est. speed input: 49864.69 toks/s, output: 48.70 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:04, 38.75it/s, est. speed input: 47676.17 toks/s, output: 46.56 toks/s]
Processed prompts:  28%|██▊       | 71/256 [00:01<00:04, 40.08it/s, est. speed input: 47518.82 toks/s, output: 46.40 toks/s]
Processed prompts:  30%|██▉       | 76/256 [00:01<00:04, 36.72it/s, est. speed input: 45857.17 toks/s, output: 44.78 toks/s]
Processed prompts:  31%|███▏      | 80/256 [00:01<00:04, 36.51it/s, est. speed input: 45293.57 toks/s, output: 44.23 toks/s]
Processed prompts:  33%|███▎      | 84/256 [00:01<00:04, 36.34it/s, est. speed input: 44793.19 toks/s, output: 43.74 toks/s]
Processed prompts:  34%|███▍      | 88/256 [00:02<00:04, 36.32it/s, est. speed input: 44376.37 toks/s, output: 43.34 toks/s]
Processed prompts:  36%|███▌      | 92/256 [00:02<00:04, 36.12it/s, est. speed input: 43961.61 toks/s, output: 42.93 toks/s]
Processed prompts:  38%|███▊      | 96/256 [00:02<00:04, 35.92it/s, est. speed input: 43576.08 toks/s, output: 42.55 toks/s]
Processed prompts:  39%|███▉      | 100/256 [00:02<00:04, 35.75it/s, est. speed input: 43222.17 toks/s, output: 42.21 toks/s]
Processed prompts:  41%|████      | 104/256 [00:02<00:04, 35.67it/s, est. speed input: 42909.21 toks/s, output: 41.90 toks/s]
Processed prompts:  42%|████▏     | 108/256 [00:02<00:04, 35.73it/s, est. speed input: 42644.26 toks/s, output: 41.64 toks/s]
Processed prompts:  44%|████▍     | 112/256 [00:02<00:04, 35.72it/s, est. speed input: 42391.36 toks/s, output: 41.40 toks/s]
Processed prompts:  45%|████▌     | 116/256 [00:02<00:03, 35.84it/s, est. speed input: 42179.70 toks/s, output: 41.19 toks/s]
Processed prompts:  47%|████▋     | 120/256 [00:02<00:03, 35.95it/s, est. speed input: 41987.14 toks/s, output: 41.00 toks/s]
Processed prompts:  48%|████▊     | 124/256 [00:03<00:03, 36.08it/s, est. speed input: 41815.95 toks/s, output: 40.84 toks/s]
Processed prompts:  50%|█████     | 128/256 [00:03<00:03, 36.18it/s, est. speed input: 41657.64 toks/s, output: 40.68 toks/s]
Processed prompts:  52%|█████▏    | 132/256 [00:03<00:03, 36.23it/s, est. speed input: 41508.17 toks/s, output: 40.54 toks/s]
Processed prompts:  53%|█████▎    | 136/256 [00:03<00:03, 36.22it/s, est. speed input: 41362.09 toks/s, output: 40.39 toks/s]
Processed prompts:  55%|█████▍    | 140/256 [00:03<00:03, 36.14it/s, est. speed input: 41216.97 toks/s, output: 40.25 toks/s]
Processed prompts:  56%|█████▋    | 144/256 [00:03<00:03, 35.72it/s, est. speed input: 41037.01 toks/s, output: 40.07 toks/s]
Processed prompts:  58%|█████▊    | 148/256 [00:03<00:03, 35.74it/s, est. speed input: 40905.13 toks/s, output: 39.95 toks/s]
Processed prompts:  59%|█████▉    | 152/256 [00:03<00:02, 35.85it/s, est. speed input: 40790.34 toks/s, output: 39.83 toks/s]
Processed prompts:  61%|██████    | 156/256 [00:03<00:02, 35.50it/s, est. speed input: 40636.92 toks/s, output: 39.68 toks/s]
Processed prompts:  62%|██████▎   | 160/256 [00:04<00:02, 35.63it/s, est. speed input: 40530.95 toks/s, output: 39.58 toks/s]
Processed prompts:  64%|██████▍   | 164/256 [00:04<00:02, 35.82it/s, est. speed input: 40440.58 toks/s, output: 39.49 toks/s]
Processed prompts:  66%|██████▌   | 168/256 [00:04<00:02, 35.91it/s, est. speed input: 40351.11 toks/s, output: 39.41 toks/s]
Processed prompts:  67%|██████▋   | 172/256 [00:04<00:02, 35.85it/s, est. speed input: 40254.38 toks/s, output: 39.31 toks/s]
Processed prompts:  69%|██████▉   | 176/256 [00:04<00:02, 35.89it/s, est. speed input: 40170.38 toks/s, output: 39.23 toks/s]
Processed prompts:  70%|███████   | 180/256 [00:04<00:02, 35.95it/s, est. speed input: 40093.09 toks/s, output: 39.15 toks/s]
Processed prompts:  72%|███████▏  | 184/256 [00:04<00:01, 36.02it/s, est. speed input: 40020.92 toks/s, output: 39.08 toks/s]
Processed prompts:  73%|███████▎  | 188/256 [00:04<00:01, 36.08it/s, est. speed input: 39953.83 toks/s, output: 39.02 toks/s]
Processed prompts:  75%|███████▌  | 192/256 [00:04<00:01, 36.20it/s, est. speed input: 39896.11 toks/s, output: 38.96 toks/s]
Processed prompts:  77%|███████▋  | 196/256 [00:05<00:01, 36.26it/s, est. speed input: 39839.40 toks/s, output: 38.91 toks/s]
Processed prompts:  78%|███████▊  | 200/256 [00:05<00:01, 36.05it/s, est. speed input: 39764.88 toks/s, output: 38.83 toks/s]
Processed prompts:  80%|███████▉  | 204/256 [00:05<00:01, 35.99it/s, est. speed input: 39699.68 toks/s, output: 38.77 toks/s]
Processed prompts:  81%|████████▏ | 208/256 [00:05<00:01, 35.93it/s, est. speed input: 39636.12 toks/s, output: 38.71 toks/s]
Processed prompts:  83%|████████▎ | 212/256 [00:05<00:01, 35.84it/s, est. speed input: 39571.62 toks/s, output: 38.64 toks/s]
Processed prompts:  84%|████████▍ | 216/256 [00:05<00:01, 35.76it/s, est. speed input: 39508.49 toks/s, output: 38.58 toks/s]
Processed prompts:  86%|████████▌ | 220/256 [00:05<00:01, 35.78it/s, est. speed input: 39453.63 toks/s, output: 38.53 toks/s]
Processed prompts:  88%|████████▊ | 224/256 [00:05<00:00, 35.87it/s, est. speed input: 39405.56 toks/s, output: 38.48 toks/s]
Processed prompts:  89%|████████▉ | 228/256 [00:05<00:00, 35.75it/s, est. speed input: 39347.36 toks/s, output: 38.43 toks/s]
Processed prompts:  91%|█████████ | 232/256 [00:06<00:00, 35.79it/s, est. speed input: 39299.29 toks/s, output: 38.38 toks/s]
Processed prompts:  92%|█████████▏| 236/256 [00:06<00:00, 35.88it/s, est. speed input: 39257.35 toks/s, output: 38.34 toks/s]
Processed prompts:  94%|█████████▍| 240/256 [00:06<00:00, 36.02it/s, est. speed input: 39221.72 toks/s, output: 38.30 toks/s]
Processed prompts:  95%|█████████▌| 244/256 [00:06<00:00, 36.06it/s, est. speed input: 39183.11 toks/s, output: 38.26 toks/s]
Processed prompts:  97%|█████████▋| 248/256 [00:06<00:00, 36.09it/s, est. speed input: 39146.32 toks/s, output: 38.23 toks/s]
Processed prompts:  98%|█████████▊| 252/256 [00:06<00:00, 36.00it/s, est. speed input: 39104.41 toks/s, output: 38.19 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 35.76it/s, est. speed input: 39052.54 toks/s, output: 38.14 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 35.76it/s, est. speed input: 39052.54 toks/s, output: 38.14 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:06<00:00, 38.14it/s, est. speed input: 39052.54 toks/s, output: 38.14 toks/s]
[rank0]:[W128 11:36:53.021953597 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 48.6s

测试结果:
  Requests/s:   34.60
  Tokens/s:     35462.85
  Total Reqs:   256
  Elapsed:      7.40s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     35428.25

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:37:05 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:37:05 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=24646) WARNING 01-28 11:37:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=24646) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=24646) WARNING 01-28 11:37:24 [backends.py:609] Failed to read file <frozen os>
Throughput: 52.02 requests/s, 53319.95 total tokens/s, 52.02 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:37:04] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:37:04] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:37:04] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:37:04] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:04] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:04] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:04] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:04] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:04] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:37:04] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:37:04] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:37:04] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:37:04] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:37:04] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:37:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:37:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:37:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:37:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:37:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:37:14] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:37:14] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:37:14] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:37:14] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:37:14] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:15] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:15] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:15] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:15] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:15] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:15] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=24646) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=24646) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=24646) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=24646) 
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=24646) [2026-01-28 11:37:16] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=24646) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  7.93it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.38it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.89it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.05it/s]
(EngineCore_DP0 pid=24646) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.27it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.19it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.36it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 356.14it/s]
Adding requests:  15%|█▍        | 75/512 [00:00<00:01, 372.50it/s]
Adding requests:  22%|██▏       | 113/512 [00:00<00:01, 369.90it/s]
Adding requests:  29%|██▉       | 150/512 [00:00<00:00, 369.04it/s]
Adding requests:  37%|███▋      | 187/512 [00:00<00:00, 368.39it/s]
Adding requests:  44%|████▍     | 224/512 [00:00<00:00, 368.51it/s]
Adding requests:  51%|█████     | 262/512 [00:00<00:00, 369.41it/s]
Adding requests:  58%|█████▊    | 299/512 [00:00<00:00, 368.50it/s]
Adding requests:  66%|██████▌   | 336/512 [00:00<00:00, 368.87it/s]
Adding requests:  73%|███████▎  | 374/512 [00:01<00:00, 372.15it/s]
Adding requests:  80%|████████  | 412/512 [00:01<00:00, 373.30it/s]
Adding requests:  88%|████████▊ | 450/512 [00:01<00:00, 374.04it/s]
Adding requests:  95%|█████████▌| 488/512 [00:01<00:00, 370.00it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 368.90it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:00<00:00, 520.83it/s, est. speed input: 533430.89 toks/s, output: 520.86 toks/s]
Processed prompts:  23%|██▎       | 119/512 [00:01<00:04, 93.42it/s, est. speed input: 110795.31 toks/s, output: 108.20 toks/s]
Processed prompts:  28%|██▊       | 144/512 [00:01<00:04, 79.20it/s, est. speed input: 95194.49 toks/s, output: 92.96 toks/s]  
Processed prompts:  31%|███▏      | 160/512 [00:01<00:04, 72.48it/s, est. speed input: 88702.15 toks/s, output: 86.62 toks/s]
Processed prompts:  34%|███▎      | 172/512 [00:02<00:04, 68.25it/s, est. speed input: 85000.32 toks/s, output: 83.01 toks/s]
Processed prompts:  36%|███▌      | 182/512 [00:02<00:05, 62.61it/s, est. speed input: 81173.10 toks/s, output: 79.27 toks/s]
Processed prompts:  37%|███▋      | 190/512 [00:02<00:05, 60.96it/s, est. speed input: 79575.43 toks/s, output: 77.71 toks/s]
Processed prompts:  39%|███▊      | 198/512 [00:02<00:05, 59.43it/s, est. speed input: 78159.76 toks/s, output: 76.33 toks/s]
Processed prompts:  40%|████      | 206/512 [00:02<00:05, 58.12it/s, est. speed input: 76902.85 toks/s, output: 75.10 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:02<00:05, 56.98it/s, est. speed input: 75762.25 toks/s, output: 73.99 toks/s]
Processed prompts:  43%|████▎     | 220/512 [00:05<00:24, 11.72it/s, est. speed input: 44761.39 toks/s, output: 43.71 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:05<00:20, 13.91it/s, est. speed input: 44652.75 toks/s, output: 43.61 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:05<00:15, 17.83it/s, est. speed input: 44941.33 toks/s, output: 43.89 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:05<00:12, 22.26it/s, est. speed input: 45211.04 toks/s, output: 44.15 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:05<00:09, 26.97it/s, est. speed input: 45469.21 toks/s, output: 44.40 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:05<00:08, 31.68it/s, est. speed input: 45712.91 toks/s, output: 44.64 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:05<00:06, 36.10it/s, est. speed input: 45944.29 toks/s, output: 44.87 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:06<00:05, 39.99it/s, est. speed input: 46160.24 toks/s, output: 45.08 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:06<00:05, 43.21it/s, est. speed input: 46361.60 toks/s, output: 45.27 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:06<00:04, 45.81it/s, est. speed input: 46555.19 toks/s, output: 45.46 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:06<00:04, 47.89it/s, est. speed input: 46745.36 toks/s, output: 45.65 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:06<00:04, 49.49it/s, est. speed input: 46928.57 toks/s, output: 45.83 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:06<00:03, 50.66it/s, est. speed input: 47102.90 toks/s, output: 46.00 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:06<00:03, 51.51it/s, est. speed input: 47269.84 toks/s, output: 46.16 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:07<00:03, 52.12it/s, est. speed input: 47428.96 toks/s, output: 46.32 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:07<00:03, 52.56it/s, est. speed input: 47582.76 toks/s, output: 46.47 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:07<00:03, 52.78it/s, est. speed input: 47724.14 toks/s, output: 46.61 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:07<00:02, 53.04it/s, est. speed input: 47866.08 toks/s, output: 46.74 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:07<00:02, 53.21it/s, est. speed input: 48001.92 toks/s, output: 46.88 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:07<00:02, 53.31it/s, est. speed input: 48131.81 toks/s, output: 47.00 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:08<00:02, 53.41it/s, est. speed input: 48258.29 toks/s, output: 47.13 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:08<00:02, 53.31it/s, est. speed input: 48371.49 toks/s, output: 47.24 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:08<00:02, 53.32it/s, est. speed input: 48483.28 toks/s, output: 47.35 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:08<00:02, 53.38it/s, est. speed input: 48594.94 toks/s, output: 47.46 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:08<00:01, 53.43it/s, est. speed input: 48702.95 toks/s, output: 47.56 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:08<00:01, 53.47it/s, est. speed input: 48807.67 toks/s, output: 47.66 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:08<00:01, 53.50it/s, est. speed input: 48908.84 toks/s, output: 47.76 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:09<00:01, 53.38it/s, est. speed input: 48999.94 toks/s, output: 47.85 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:09<00:01, 53.37it/s, est. speed input: 49091.11 toks/s, output: 47.94 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:09<00:01, 53.40it/s, est. speed input: 49181.56 toks/s, output: 48.03 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:09<00:01, 53.43it/s, est. speed input: 49269.68 toks/s, output: 48.11 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:09<00:00, 52.87it/s, est. speed input: 49326.85 toks/s, output: 48.17 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:09<00:00, 52.38it/s, est. speed input: 49377.25 toks/s, output: 48.22 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:09<00:00, 52.01it/s, est. speed input: 49424.73 toks/s, output: 48.27 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:10<00:00, 51.79it/s, est. speed input: 49472.15 toks/s, output: 48.31 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:10<00:00, 51.53it/s, est. speed input: 49513.22 toks/s, output: 48.35 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:10<00:00, 51.42it/s, est. speed input: 49556.14 toks/s, output: 48.39 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:10<00:00, 51.42it/s, est. speed input: 49842.94 toks/s, output: 48.67 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:10<00:00, 48.67it/s, est. speed input: 49842.94 toks/s, output: 48.67 toks/s]
[rank0]:[W128 11:37:48.125875636 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 55.1s

测试结果:
  Requests/s:   52.02
  Tokens/s:     53319.95
  Total Reqs:   512
  Elapsed:      9.84s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     53267.93

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:38:02 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:38:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=25211) WARNING 01-28 11:38:09 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=25211) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=25211) WARNING 01-28 11:38:22 [backends.py:609] Failed to read file <frozen os>
Throughput: 54.22 requests/s, 55572.99 total tokens/s, 54.22 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:38:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:38:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:38:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:38:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:38:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:38:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:38:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:38:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:38:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:38:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:38:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:38:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:38:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:38:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:38:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:38:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:38:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:38:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:38:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:10] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:10] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:10] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:10] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:10] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:10] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=25211) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=25211) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=25211) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=25211) 
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=25211) [2026-01-28 11:38:11] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=25211) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  8.11it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  8.47it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  8.89it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  9.09it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.47it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.58it/s]
(EngineCore_DP0 pid=25211) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.77it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.80it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  9.21it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  9.34it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  9.11it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 38/1024 [00:00<00:02, 378.43it/s]
Adding requests:   8%|▊         | 79/1024 [00:00<00:02, 394.30it/s]
Adding requests:  12%|█▏        | 119/1024 [00:00<00:02, 395.00it/s]
Adding requests:  16%|█▌        | 159/1024 [00:00<00:02, 390.72it/s]
Adding requests:  19%|█▉        | 199/1024 [00:00<00:02, 389.37it/s]
Adding requests:  23%|██▎       | 239/1024 [00:00<00:02, 390.64it/s]
Adding requests:  27%|██▋       | 280/1024 [00:00<00:01, 394.48it/s]
Adding requests:  31%|███▏      | 321/1024 [00:00<00:01, 396.63it/s]
Adding requests:  35%|███▌      | 362/1024 [00:00<00:01, 400.44it/s]
Adding requests:  39%|███▉      | 404/1024 [00:01<00:01, 404.62it/s]
Adding requests:  43%|████▎     | 445/1024 [00:01<00:01, 404.42it/s]
Adding requests:  48%|████▊     | 487/1024 [00:01<00:01, 404.72it/s]
Adding requests:  52%|█████▏    | 528/1024 [00:01<00:01, 393.80it/s]
Adding requests:  56%|█████▌    | 571/1024 [00:01<00:01, 402.49it/s]
Adding requests:  60%|█████▉    | 612/1024 [00:01<00:01, 402.45it/s]
Adding requests:  64%|██████▍   | 653/1024 [00:01<00:00, 393.68it/s]
Adding requests:  68%|██████▊   | 696/1024 [00:01<00:00, 402.37it/s]
Adding requests:  72%|███████▏  | 739/1024 [00:01<00:00, 408.15it/s]
Adding requests:  76%|███████▌  | 780/1024 [00:01<00:00, 405.37it/s]
Adding requests:  80%|████████  | 821/1024 [00:02<00:00, 395.47it/s]
Adding requests:  84%|████████▍ | 863/1024 [00:02<00:00, 400.16it/s]
Adding requests:  88%|████████▊ | 906/1024 [00:02<00:00, 408.11it/s]
Adding requests:  92%|█████████▏| 947/1024 [00:02<00:00, 407.03it/s]
Adding requests:  96%|█████████▋| 988/1024 [00:02<00:00, 407.15it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 400.91it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:00<00:00, 988.96it/s, est. speed input: 1012960.31 toks/s, output: 989.08 toks/s]
Processed prompts:  22%|██▏       | 229/1024 [00:01<00:07, 105.40it/s, est. speed input: 127302.96 toks/s, output: 124.32 toks/s] 
Processed prompts:  27%|██▋       | 274/1024 [00:02<00:08, 84.08it/s, est. speed input: 104019.77 toks/s, output: 101.58 toks/s] 
Processed prompts:  29%|██▉       | 301/1024 [00:03<00:09, 79.35it/s, est. speed input: 98602.92 toks/s, output: 96.29 toks/s]  
Processed prompts:  31%|███▏      | 320/1024 [00:03<00:09, 77.07it/s, est. speed input: 96036.93 toks/s, output: 93.79 toks/s]
Processed prompts:  33%|███▎      | 335/1024 [00:03<00:09, 72.14it/s, est. speed input: 92775.10 toks/s, output: 90.60 toks/s]
Processed prompts:  34%|███▍      | 347/1024 [00:03<00:10, 65.41it/s, est. speed input: 89201.22 toks/s, output: 87.11 toks/s]
Processed prompts:  35%|███▍      | 356/1024 [00:04<00:10, 65.09it/s, est. speed input: 88351.18 toks/s, output: 86.28 toks/s]
Processed prompts:  36%|███▌      | 365/1024 [00:04<00:10, 64.76it/s, est. speed input: 87555.80 toks/s, output: 85.50 toks/s]
Processed prompts:  36%|███▋      | 373/1024 [00:04<00:10, 63.13it/s, est. speed input: 86585.65 toks/s, output: 84.56 toks/s]
Processed prompts:  37%|███▋      | 380/1024 [00:04<00:10, 60.12it/s, est. speed input: 85444.39 toks/s, output: 83.44 toks/s]
Processed prompts:  38%|███▊      | 387/1024 [00:04<00:11, 57.52it/s, est. speed input: 84372.92 toks/s, output: 82.40 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:04<00:11, 55.40it/s, est. speed input: 83365.48 toks/s, output: 81.41 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:04<00:11, 55.57it/s, est. speed input: 82620.75 toks/s, output: 80.68 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:05<00:11, 55.69it/s, est. speed input: 81917.37 toks/s, output: 80.00 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:10, 55.73it/s, est. speed input: 81244.38 toks/s, output: 79.34 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:10, 55.78it/s, est. speed input: 80610.20 toks/s, output: 78.72 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:05<00:10, 55.82it/s, est. speed input: 80008.39 toks/s, output: 78.13 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:05<00:10, 55.83it/s, est. speed input: 79435.26 toks/s, output: 77.57 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:05<00:10, 55.85it/s, est. speed input: 78891.01 toks/s, output: 77.04 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:05<00:10, 55.88it/s, est. speed input: 78375.36 toks/s, output: 76.54 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:06<00:09, 55.91it/s, est. speed input: 77883.70 toks/s, output: 76.06 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:09, 55.96it/s, est. speed input: 77418.94 toks/s, output: 75.60 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:09, 55.97it/s, est. speed input: 76971.09 toks/s, output: 75.17 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:06<00:09, 56.03it/s, est. speed input: 76548.03 toks/s, output: 74.75 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:06<00:09, 56.02it/s, est. speed input: 76138.28 toks/s, output: 74.35 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:06<00:09, 56.00it/s, est. speed input: 75744.81 toks/s, output: 73.97 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:06<00:09, 55.98it/s, est. speed input: 75366.55 toks/s, output: 73.60 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:07<00:08, 55.97it/s, est. speed input: 75003.34 toks/s, output: 73.25 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:08, 55.95it/s, est. speed input: 74653.91 toks/s, output: 72.90 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:07<00:08, 55.95it/s, est. speed input: 74319.25 toks/s, output: 72.58 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:07<00:08, 55.96it/s, est. speed input: 73997.64 toks/s, output: 72.26 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:07<00:08, 55.98it/s, est. speed input: 73689.30 toks/s, output: 71.96 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:07<00:08, 55.98it/s, est. speed input: 73390.90 toks/s, output: 71.67 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:07<00:08, 55.95it/s, est. speed input: 73100.86 toks/s, output: 71.39 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:08<00:07, 55.95it/s, est. speed input: 72823.06 toks/s, output: 71.12 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:07, 55.92it/s, est. speed input: 72552.00 toks/s, output: 70.85 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:08<00:07, 55.90it/s, est. speed input: 72290.35 toks/s, output: 70.60 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:08<00:07, 55.89it/s, est. speed input: 72037.92 toks/s, output: 70.35 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:08<00:07, 55.93it/s, est. speed input: 71797.05 toks/s, output: 70.11 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:08<00:07, 55.93it/s, est. speed input: 71562.45 toks/s, output: 69.89 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:08<00:07, 55.94it/s, est. speed input: 71335.48 toks/s, output: 69.66 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:09<00:06, 55.94it/s, est. speed input: 71115.13 toks/s, output: 69.45 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:06, 55.92it/s, est. speed input: 70900.41 toks/s, output: 69.24 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:09<00:06, 54.55it/s, est. speed input: 70603.65 toks/s, output: 68.95 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:09<00:06, 53.51it/s, est. speed input: 70308.14 toks/s, output: 68.66 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:09<00:06, 52.77it/s, est. speed input: 70019.73 toks/s, output: 68.38 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:09<00:06, 52.27it/s, est. speed input: 69740.45 toks/s, output: 68.11 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:10<00:06, 51.94it/s, est. speed input: 69471.03 toks/s, output: 67.84 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:10<00:06, 51.72it/s, est. speed input: 69210.44 toks/s, output: 67.59 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:10<00:06, 51.58it/s, est. speed input: 68958.36 toks/s, output: 67.34 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:10<00:06, 51.71it/s, est. speed input: 68728.99 toks/s, output: 67.12 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:10<00:05, 52.86it/s, est. speed input: 68572.60 toks/s, output: 66.97 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:10<00:05, 53.71it/s, est. speed input: 68420.78 toks/s, output: 66.82 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:10<00:05, 54.30it/s, est. speed input: 68272.12 toks/s, output: 66.67 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:11<00:05, 54.72it/s, est. speed input: 68126.89 toks/s, output: 66.53 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:11<00:05, 54.98it/s, est. speed input: 67983.35 toks/s, output: 66.39 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:11<00:04, 55.15it/s, est. speed input: 67842.90 toks/s, output: 66.25 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:11<00:04, 55.27it/s, est. speed input: 67706.09 toks/s, output: 66.12 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:11<00:04, 55.35it/s, est. speed input: 67572.32 toks/s, output: 65.99 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:11<00:04, 55.45it/s, est. speed input: 67443.74 toks/s, output: 65.86 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:11<00:04, 55.53it/s, est. speed input: 67318.97 toks/s, output: 65.74 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:12<00:04, 55.58it/s, est. speed input: 67196.77 toks/s, output: 65.62 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:12<00:03, 55.56it/s, est. speed input: 67075.24 toks/s, output: 65.50 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:12<00:03, 55.62it/s, est. speed input: 66959.40 toks/s, output: 65.39 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:12<00:03, 55.64it/s, est. speed input: 66845.68 toks/s, output: 65.28 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:12<00:03, 55.66it/s, est. speed input: 66734.61 toks/s, output: 65.17 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:12<00:03, 55.67it/s, est. speed input: 66625.68 toks/s, output: 65.06 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:12<00:03, 55.67it/s, est. speed input: 66519.25 toks/s, output: 64.96 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:13<00:03, 55.67it/s, est. speed input: 66415.06 toks/s, output: 64.86 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:15<00:17,  9.41it/s, est. speed input: 56305.15 toks/s, output: 54.99 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:15<00:12, 12.53it/s, est. speed input: 56311.73 toks/s, output: 54.99 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:15<00:09, 16.28it/s, est. speed input: 56300.50 toks/s, output: 54.98 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:16<00:06, 20.46it/s, est. speed input: 56260.31 toks/s, output: 54.94 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:16<00:05, 24.93it/s, est. speed input: 56220.22 toks/s, output: 54.90 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:16<00:04, 29.44it/s, est. speed input: 56181.34 toks/s, output: 54.86 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:16<00:03, 33.71it/s, est. speed input: 56142.90 toks/s, output: 54.83 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:16<00:02, 37.52it/s, est. speed input: 56105.78 toks/s, output: 54.79 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:16<00:02, 40.75it/s, est. speed input: 56069.55 toks/s, output: 54.76 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:16<00:02, 43.37it/s, est. speed input: 56034.42 toks/s, output: 54.72 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:17<00:01, 45.40it/s, est. speed input: 55999.31 toks/s, output: 54.69 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:17<00:01, 46.95it/s, est. speed input: 55965.23 toks/s, output: 54.65 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:17<00:01, 48.09it/s, est. speed input: 55931.52 toks/s, output: 54.62 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:17<00:01, 48.94it/s, est. speed input: 55898.97 toks/s, output: 54.59 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:17<00:01, 49.57it/s, est. speed input: 55867.33 toks/s, output: 54.56 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:17<00:00, 49.95it/s, est. speed input: 55834.31 toks/s, output: 54.53 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:18<00:00, 51.85it/s, est. speed input: 55853.11 toks/s, output: 54.54 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:18<00:00, 51.58it/s, est. speed input: 55821.55 toks/s, output: 54.51 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:18<00:00, 51.40it/s, est. speed input: 55790.65 toks/s, output: 54.48 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:18<00:00, 51.27it/s, est. speed input: 55760.37 toks/s, output: 54.45 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:18<00:00, 53.14it/s, est. speed input: 55787.59 toks/s, output: 54.48 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:18<00:00, 53.14it/s, est. speed input: 56115.33 toks/s, output: 54.80 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:18<00:00, 54.80it/s, est. speed input: 56115.33 toks/s, output: 54.80 toks/s]
[rank0]:[W128 11:38:55.729972614 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 67.2s

测试结果:
  Requests/s:   54.22
  Tokens/s:     55572.99
  Total Reqs:   1024
  Elapsed:      18.89s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     55518.78

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:39:14 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:39:15 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=25888) WARNING 01-28 11:39:22 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=25888) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=25888) WARNING 01-28 11:39:34 [backends.py:609] Failed to read file <frozen os>
Throughput: 55.74 requests/s, 57135.06 total tokens/s, 55.74 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:39:14] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:39:14] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:39:14] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:39:14] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:14] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:14] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:14] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:14] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:14] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:39:14] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:39:14] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:39:14] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:39:14] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:39:14] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:39:21] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:39:21] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:39:21] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:39:21] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:21] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:21] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:21] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:21] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:39:21] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:39:21] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:39:21] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:39:21] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:39:21] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:39:21] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:22] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:22] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:22] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:22] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:22] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:22] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=25888) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=25888) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.31it/s]
(EngineCore_DP0 pid=25888) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.31it/s]
(EngineCore_DP0 pid=25888) 
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=25888) [2026-01-28 11:39:23] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=25888) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.90it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.98it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.28it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.44it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.72it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.16it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.29it/s]
(EngineCore_DP0 pid=25888) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.38it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  8.20it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.68it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  8.84it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  9.05it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.76it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 34/2048 [00:00<00:06, 334.49it/s]
Adding requests:   3%|▎         | 71/2048 [00:00<00:05, 350.71it/s]
Adding requests:   5%|▌         | 108/2048 [00:00<00:05, 359.36it/s]
Adding requests:   7%|▋         | 145/2048 [00:00<00:05, 359.50it/s]
Adding requests:   9%|▉         | 181/2048 [00:00<00:05, 357.53it/s]
Adding requests:  11%|█         | 217/2048 [00:00<00:05, 355.69it/s]
Adding requests:  12%|█▎        | 256/2048 [00:00<00:04, 364.11it/s]
Adding requests:  14%|█▍        | 293/2048 [00:00<00:04, 364.07it/s]
Adding requests:  16%|█▌        | 330/2048 [00:00<00:04, 365.37it/s]
Adding requests:  18%|█▊        | 370/2048 [00:01<00:04, 375.31it/s]
Adding requests:  20%|██        | 410/2048 [00:01<00:04, 382.35it/s]
Adding requests:  22%|██▏       | 450/2048 [00:01<00:04, 384.88it/s]
Adding requests:  24%|██▍       | 490/2048 [00:01<00:04, 388.07it/s]
Adding requests:  26%|██▌       | 529/2048 [00:01<00:03, 381.28it/s]
Adding requests:  28%|██▊       | 569/2048 [00:01<00:03, 384.73it/s]
Adding requests:  30%|██▉       | 608/2048 [00:01<00:03, 384.85it/s]
Adding requests:  32%|███▏      | 649/2048 [00:01<00:03, 390.93it/s]
Adding requests:  34%|███▎      | 689/2048 [00:01<00:03, 392.06it/s]
Adding requests:  36%|███▌      | 730/2048 [00:01<00:03, 396.32it/s]
Adding requests:  38%|███▊      | 770/2048 [00:02<00:03, 389.83it/s]
Adding requests:  40%|███▉      | 810/2048 [00:02<00:03, 384.43it/s]
Adding requests:  41%|████▏     | 849/2048 [00:02<00:03, 375.71it/s]
Adding requests:  43%|████▎     | 890/2048 [00:02<00:03, 385.44it/s]
Adding requests:  45%|████▌     | 931/2048 [00:02<00:02, 392.49it/s]
Adding requests:  47%|████▋     | 971/2048 [00:02<00:02, 391.35it/s]
Adding requests:  49%|████▉     | 1011/2048 [00:02<00:02, 390.72it/s]
Adding requests:  51%|█████▏    | 1051/2048 [00:02<00:02, 388.76it/s]
Adding requests:  53%|█████▎    | 1090/2048 [00:02<00:02, 384.72it/s]
Adding requests:  55%|█████▌    | 1130/2048 [00:02<00:02, 386.51it/s]
Adding requests:  57%|█████▋    | 1173/2048 [00:03<00:02, 396.94it/s]
Adding requests:  59%|█████▉    | 1216/2048 [00:03<00:02, 404.79it/s]
Adding requests:  61%|██████▏   | 1257/2048 [00:03<00:01, 400.28it/s]
Adding requests:  63%|██████▎   | 1298/2048 [00:03<00:01, 402.78it/s]
Adding requests:  65%|██████▌   | 1339/2048 [00:03<00:01, 404.58it/s]
Adding requests:  67%|██████▋   | 1380/2048 [00:03<00:01, 401.45it/s]
Adding requests:  69%|██████▉   | 1421/2048 [00:03<00:01, 399.31it/s]
Adding requests:  71%|███████▏  | 1462/2048 [00:03<00:01, 401.34it/s]
Adding requests:  73%|███████▎  | 1503/2048 [00:03<00:01, 403.06it/s]
Adding requests:  75%|███████▌  | 1544/2048 [00:03<00:01, 402.03it/s]
Adding requests:  77%|███████▋  | 1585/2048 [00:04<00:01, 404.13it/s]
Adding requests:  79%|███████▉  | 1628/2048 [00:04<00:01, 409.53it/s]
Adding requests:  81%|████████▏ | 1669/2048 [00:04<00:00, 402.93it/s]
Adding requests:  83%|████████▎ | 1710/2048 [00:04<00:00, 401.88it/s]
Adding requests:  85%|████████▌ | 1751/2048 [00:04<00:00, 403.99it/s]
Adding requests:  88%|████████▊ | 1792/2048 [00:04<00:00, 399.47it/s]
Adding requests:  89%|████████▉ | 1832/2048 [00:04<00:00, 396.62it/s]
Adding requests:  91%|█████████▏| 1873/2048 [00:04<00:00, 397.59it/s]
Adding requests:  93%|█████████▎| 1913/2048 [00:04<00:00, 390.72it/s]
Adding requests:  95%|█████████▌| 1954/2048 [00:05<00:00, 395.38it/s]
Adding requests:  97%|█████████▋| 1995/2048 [00:05<00:00, 399.17it/s]
Adding requests:  99%|█████████▉| 2035/2048 [00:05<00:00, 389.54it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 389.09it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:00<00:00, 2441.40it/s, est. speed input: 2500538.73 toks/s, output: 2441.57 toks/s]
Processed prompts:  25%|██▌       | 519/2048 [00:04<00:15, 100.30it/s, est. speed input: 121097.02 toks/s, output: 118.26 toks/s]   
Processed prompts:  30%|███       | 623/2048 [00:06<00:16, 86.17it/s, est. speed input: 104657.01 toks/s, output: 102.20 toks/s] 
Processed prompts:  33%|███▎      | 683/2048 [00:07<00:17, 77.63it/s, est. speed input: 96671.63 toks/s, output: 94.41 toks/s]  
Processed prompts:  35%|███▌      | 721/2048 [00:09<00:25, 51.06it/s, est. speed input: 76858.73 toks/s, output: 75.06 toks/s]
Processed prompts:  36%|███▋      | 746/2048 [00:10<00:25, 50.13it/s, est. speed input: 75070.12 toks/s, output: 73.31 toks/s]
Processed prompts:  37%|███▋      | 764/2048 [00:10<00:25, 51.23it/s, est. speed input: 74786.77 toks/s, output: 73.03 toks/s]
Processed prompts:  38%|███▊      | 779/2048 [00:10<00:24, 51.39it/s, est. speed input: 74233.89 toks/s, output: 72.49 toks/s]
Processed prompts:  39%|███▊      | 791/2048 [00:11<00:25, 50.15it/s, est. speed input: 73430.63 toks/s, output: 71.71 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:11<00:25, 48.31it/s, est. speed input: 72576.60 toks/s, output: 70.88 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:11<00:24, 49.76it/s, est. speed input: 72205.19 toks/s, output: 70.51 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:11<00:24, 50.49it/s, est. speed input: 71752.90 toks/s, output: 70.07 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:12<00:23, 51.10it/s, est. speed input: 71322.00 toks/s, output: 69.65 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:12<00:22, 51.59it/s, est. speed input: 70911.27 toks/s, output: 69.25 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:12<00:22, 51.96it/s, est. speed input: 70518.22 toks/s, output: 68.87 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:13<00:22, 52.24it/s, est. speed input: 70143.16 toks/s, output: 68.50 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:13<00:21, 52.48it/s, est. speed input: 69788.38 toks/s, output: 68.15 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:13<00:20, 53.51it/s, est. speed input: 69534.72 toks/s, output: 67.90 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:13<00:20, 54.26it/s, est. speed input: 69289.66 toks/s, output: 67.67 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:14<00:19, 54.82it/s, est. speed input: 69055.37 toks/s, output: 67.44 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:14<00:19, 56.11it/s, est. speed input: 68903.72 toks/s, output: 67.29 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:14<00:18, 56.14it/s, est. speed input: 68685.80 toks/s, output: 67.08 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:15<00:18, 56.17it/s, est. speed input: 68477.12 toks/s, output: 66.87 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:15<00:18, 56.16it/s, est. speed input: 68273.53 toks/s, output: 66.67 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:15<00:17, 56.17it/s, est. speed input: 68078.09 toks/s, output: 66.48 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:15<00:17, 56.18it/s, est. speed input: 67890.29 toks/s, output: 66.30 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:16<00:17, 56.20it/s, est. speed input: 67709.88 toks/s, output: 66.12 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:16<00:17, 56.19it/s, est. speed input: 67534.35 toks/s, output: 65.95 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:16<00:16, 56.19it/s, est. speed input: 67365.06 toks/s, output: 65.79 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:17<00:16, 56.19it/s, est. speed input: 67201.32 toks/s, output: 65.63 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:17<00:16, 56.17it/s, est. speed input: 67042.06 toks/s, output: 65.47 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:17<00:15, 57.15it/s, est. speed input: 66949.95 toks/s, output: 65.38 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:17<00:15, 56.87it/s, est. speed input: 66801.02 toks/s, output: 65.24 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:18<00:15, 56.67it/s, est. speed input: 66656.50 toks/s, output: 65.09 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:18<00:14, 56.51it/s, est. speed input: 66515.63 toks/s, output: 64.96 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:18<00:14, 56.42it/s, est. speed input: 66379.65 toks/s, output: 64.82 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:19<00:14, 56.34it/s, est. speed input: 66247.41 toks/s, output: 64.69 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:19<00:14, 56.31it/s, est. speed input: 66119.79 toks/s, output: 64.57 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:19<00:13, 56.27it/s, est. speed input: 65995.07 toks/s, output: 64.45 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:19<00:13, 56.24it/s, est. speed input: 65874.11 toks/s, output: 64.33 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:20<00:13, 56.23it/s, est. speed input: 65757.14 toks/s, output: 64.22 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:20<00:13, 56.20it/s, est. speed input: 65642.08 toks/s, output: 64.10 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:20<00:12, 56.18it/s, est. speed input: 65530.19 toks/s, output: 63.99 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:21<00:12, 56.19it/s, est. speed input: 65422.27 toks/s, output: 63.89 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:21<00:12, 56.18it/s, est. speed input: 65316.82 toks/s, output: 63.79 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:21<00:11, 56.26it/s, est. speed input: 65218.54 toks/s, output: 63.69 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:21<00:11, 56.36it/s, est. speed input: 65124.88 toks/s, output: 63.60 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:22<00:11, 56.42it/s, est. speed input: 65032.95 toks/s, output: 63.51 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:22<00:11, 56.47it/s, est. speed input: 64943.89 toks/s, output: 63.42 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:22<00:10, 56.49it/s, est. speed input: 64856.32 toks/s, output: 63.34 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:23<00:10, 56.51it/s, est. speed input: 64771.20 toks/s, output: 63.25 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:23<00:10, 56.54it/s, est. speed input: 64688.69 toks/s, output: 63.17 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:23<00:09, 56.54it/s, est. speed input: 64607.43 toks/s, output: 63.09 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:23<00:09, 56.54it/s, est. speed input: 64528.09 toks/s, output: 63.02 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:24<00:09, 56.55it/s, est. speed input: 64450.87 toks/s, output: 62.94 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:24<00:09, 56.58it/s, est. speed input: 64376.24 toks/s, output: 62.87 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:24<00:08, 56.56it/s, est. speed input: 64302.00 toks/s, output: 62.79 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:25<00:08, 56.57it/s, est. speed input: 64230.04 toks/s, output: 62.72 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:25<00:08, 56.58it/s, est. speed input: 64160.39 toks/s, output: 62.66 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:25<00:07, 56.59it/s, est. speed input: 64092.00 toks/s, output: 62.59 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:25<00:07, 56.63it/s, est. speed input: 64026.58 toks/s, output: 62.53 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:26<00:07, 56.57it/s, est. speed input: 63958.89 toks/s, output: 62.46 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:26<00:07, 56.58it/s, est. speed input: 63894.67 toks/s, output: 62.40 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:26<00:06, 56.56it/s, est. speed input: 63830.83 toks/s, output: 62.33 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:27<00:06, 56.54it/s, est. speed input: 63768.31 toks/s, output: 62.27 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:27<00:06, 56.56it/s, est. speed input: 63708.23 toks/s, output: 62.21 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:27<00:05, 56.57it/s, est. speed input: 63649.03 toks/s, output: 62.16 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:27<00:05, 56.57it/s, est. speed input: 63591.13 toks/s, output: 62.10 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:28<00:05, 56.56it/s, est. speed input: 63533.70 toks/s, output: 62.04 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:28<00:05, 56.54it/s, est. speed input: 63477.25 toks/s, output: 61.99 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:28<00:04, 56.55it/s, est. speed input: 63422.56 toks/s, output: 61.94 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:28<00:04, 56.55it/s, est. speed input: 63368.79 toks/s, output: 61.88 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:29<00:04, 56.56it/s, est. speed input: 63316.13 toks/s, output: 61.83 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:29<00:03, 56.39it/s, est. speed input: 63258.34 toks/s, output: 61.78 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:29<00:03, 56.10it/s, est. speed input: 63195.47 toks/s, output: 61.71 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:30<00:03, 55.90it/s, est. speed input: 63134.20 toks/s, output: 61.65 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:30<00:03, 56.72it/s, est. speed input: 63107.28 toks/s, output: 61.63 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:30<00:02, 56.31it/s, est. speed input: 63047.07 toks/s, output: 61.57 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:30<00:02, 56.04it/s, est. speed input: 62988.46 toks/s, output: 61.51 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:31<00:02, 55.87it/s, est. speed input: 62931.36 toks/s, output: 61.46 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:31<00:01, 55.73it/s, est. speed input: 62874.75 toks/s, output: 61.40 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:31<00:01, 55.64it/s, est. speed input: 62819.38 toks/s, output: 61.35 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:32<00:01, 55.57it/s, est. speed input: 62764.53 toks/s, output: 61.29 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:32<00:01, 55.51it/s, est. speed input: 62710.63 toks/s, output: 61.24 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:32<00:00, 55.48it/s, est. speed input: 62657.90 toks/s, output: 61.19 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:33<00:00, 55.46it/s, est. speed input: 62606.30 toks/s, output: 61.14 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:33<00:00, 56.54it/s, est. speed input: 62590.49 toks/s, output: 61.12 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:33<00:00, 56.54it/s, est. speed input: 63020.62 toks/s, output: 61.54 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:33<00:00, 61.54it/s, est. speed input: 63020.62 toks/s, output: 61.54 toks/s]
[rank0]:[W128 11:40:25.859146389 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 90.1s

测试结果:
  Requests/s:   55.74
  Tokens/s:     57135.06
  Total Reqs:   2048
  Elapsed:      36.74s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     57079.32

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:40:58 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:40:58 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=26753) WARNING 01-28 11:41:05 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=26753) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=26753) WARNING 01-28 11:41:17 [backends.py:609] Failed to read file <frozen os>
Throughput: 57.59 requests/s, 59026.51 total tokens/s, 57.59 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:40:58] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:40:58] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:40:58] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:40:58] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:40:58] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:40:58] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:40:58] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:40:58] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:40:58] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:40:58] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:40:58] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:40:58] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:40:58] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:40:58] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:41:05] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:41:05] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 11:41:05] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 11:41:05] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:41:05] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:41:05] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:41:05] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:41:05] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 11:41:05] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 11:41:05] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:41:05] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:41:05] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:41:05] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:41:05] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:06] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:06] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:06] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:06] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:06] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:06] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=26753) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=26753) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.47it/s]
(EngineCore_DP0 pid=26753) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.47it/s]
(EngineCore_DP0 pid=26753) 
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=26753) [2026-01-28 11:41:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=26753) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  8.15it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.46it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.64it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.72it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  8.77it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.68it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  8.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  8.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.91it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.30it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.55it/s]
(EngineCore_DP0 pid=26753) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.35it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.35it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.80it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  8.95it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.98it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  9.08it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.17it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.92it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 36/4096 [00:00<00:11, 351.76it/s]
Adding requests:   2%|▏         | 72/4096 [00:00<00:11, 350.16it/s]
Adding requests:   3%|▎         | 110/4096 [00:00<00:11, 361.25it/s]
Adding requests:   4%|▎         | 147/4096 [00:00<00:10, 363.42it/s]
Adding requests:   5%|▍         | 185/4096 [00:00<00:10, 368.56it/s]
Adding requests:   5%|▌         | 224/4096 [00:00<00:10, 373.43it/s]
Adding requests:   6%|▋         | 264/4096 [00:00<00:10, 379.31it/s]
Adding requests:   7%|▋         | 302/4096 [00:00<00:10, 378.62it/s]
Adding requests:   8%|▊         | 340/4096 [00:00<00:09, 377.76it/s]
Adding requests:   9%|▉         | 380/4096 [00:01<00:09, 384.40it/s]
Adding requests:  10%|█         | 420/4096 [00:01<00:09, 386.90it/s]
Adding requests:  11%|█         | 459/4096 [00:01<00:09, 387.20it/s]
Adding requests:  12%|█▏        | 498/4096 [00:01<00:10, 344.21it/s]
Adding requests:  13%|█▎        | 534/4096 [00:01<00:10, 343.65it/s]
Adding requests:  14%|█▍        | 574/4096 [00:01<00:09, 358.79it/s]
Adding requests:  15%|█▍        | 612/4096 [00:01<00:09, 364.17it/s]
Adding requests:  16%|█▌        | 653/4096 [00:01<00:09, 375.24it/s]
Adding requests:  17%|█▋        | 694/4096 [00:01<00:08, 385.33it/s]
Adding requests:  18%|█▊        | 733/4096 [00:01<00:08, 385.84it/s]
Adding requests:  19%|█▉        | 772/4096 [00:02<00:08, 381.45it/s]
Adding requests:  20%|█▉        | 811/4096 [00:02<00:08, 377.78it/s]
Adding requests:  21%|██        | 849/4096 [00:02<00:08, 375.05it/s]
Adding requests:  22%|██▏       | 890/4096 [00:02<00:08, 383.55it/s]
Adding requests:  23%|██▎       | 930/4096 [00:02<00:08, 387.38it/s]
Adding requests:  24%|██▎       | 969/4096 [00:02<00:08, 388.06it/s]
Adding requests:  25%|██▍       | 1009/4096 [00:02<00:07, 390.81it/s]
Adding requests:  26%|██▌       | 1049/4096 [00:02<00:07, 391.27it/s]
Adding requests:  27%|██▋       | 1089/4096 [00:02<00:08, 375.84it/s]
Adding requests:  28%|██▊       | 1128/4096 [00:03<00:07, 378.09it/s]
Adding requests:  29%|██▊       | 1168/4096 [00:03<00:07, 382.99it/s]
Adding requests:  30%|██▉       | 1210/4096 [00:03<00:07, 390.67it/s]
Adding requests:  31%|███       | 1250/4096 [00:03<00:07, 391.44it/s]
Adding requests:  31%|███▏      | 1290/4096 [00:03<00:07, 389.80it/s]
Adding requests:  32%|███▏      | 1331/4096 [00:03<00:06, 395.41it/s]
Adding requests:  33%|███▎      | 1371/4096 [00:03<00:06, 395.59it/s]
Adding requests:  34%|███▍      | 1412/4096 [00:03<00:06, 398.12it/s]
Adding requests:  35%|███▌      | 1452/4096 [00:03<00:06, 396.51it/s]
Adding requests:  36%|███▋      | 1494/4096 [00:03<00:06, 400.75it/s]
Adding requests:  37%|███▋      | 1535/4096 [00:04<00:06, 397.62it/s]
Adding requests:  38%|███▊      | 1575/4096 [00:04<00:06, 396.23it/s]
Adding requests:  39%|███▉      | 1616/4096 [00:04<00:06, 397.69it/s]
Adding requests:  40%|████      | 1656/4096 [00:04<00:06, 396.10it/s]
Adding requests:  41%|████▏     | 1696/4096 [00:04<00:06, 393.47it/s]
Adding requests:  42%|████▏     | 1736/4096 [00:04<00:06, 389.96it/s]
Adding requests:  43%|████▎     | 1776/4096 [00:04<00:06, 386.51it/s]
Adding requests:  44%|████▍     | 1816/4096 [00:04<00:05, 389.20it/s]
Adding requests:  45%|████▌     | 1855/4096 [00:04<00:05, 381.77it/s]
Adding requests:  46%|████▌     | 1894/4096 [00:04<00:05, 378.65it/s]
Adding requests:  47%|████▋     | 1932/4096 [00:05<00:05, 372.07it/s]
Adding requests:  48%|████▊     | 1970/4096 [00:05<00:05, 365.40it/s]
Adding requests:  49%|████▉     | 2009/4096 [00:05<00:05, 371.77it/s]
Adding requests:  50%|████▉     | 2047/4096 [00:05<00:05, 371.35it/s]
Adding requests:  51%|█████     | 2085/4096 [00:05<00:05, 373.69it/s]
Adding requests:  52%|█████▏    | 2123/4096 [00:05<00:05, 367.89it/s]
Adding requests:  53%|█████▎    | 2160/4096 [00:05<00:05, 361.00it/s]
Adding requests:  54%|█████▎    | 2197/4096 [00:05<00:05, 361.46it/s]
Adding requests:  55%|█████▍    | 2235/4096 [00:05<00:05, 365.60it/s]
Adding requests:  55%|█████▌    | 2273/4096 [00:05<00:04, 369.04it/s]
Adding requests:  56%|█████▋    | 2310/4096 [00:06<00:04, 359.17it/s]
Adding requests:  57%|█████▋    | 2348/4096 [00:06<00:04, 362.15it/s]
Adding requests:  58%|█████▊    | 2386/4096 [00:06<00:04, 366.68it/s]
Adding requests:  59%|█████▉    | 2423/4096 [00:06<00:04, 367.54it/s]
Adding requests:  60%|██████    | 2461/4096 [00:06<00:04, 368.76it/s]
Adding requests:  61%|██████    | 2500/4096 [00:06<00:04, 371.31it/s]
Adding requests:  62%|██████▏   | 2539/4096 [00:06<00:04, 374.35it/s]
Adding requests:  63%|██████▎   | 2579/4096 [00:06<00:03, 381.53it/s]
Adding requests:  64%|██████▍   | 2618/4096 [00:06<00:03, 381.67it/s]
Adding requests:  65%|██████▍   | 2657/4096 [00:07<00:03, 379.11it/s]
Adding requests:  66%|██████▌   | 2695/4096 [00:07<00:03, 375.52it/s]
Adding requests:  67%|██████▋   | 2733/4096 [00:07<00:03, 375.06it/s]
Adding requests:  68%|██████▊   | 2772/4096 [00:07<00:03, 376.04it/s]
Adding requests:  69%|██████▊   | 2810/4096 [00:07<00:03, 372.55it/s]
Adding requests:  70%|██████▉   | 2848/4096 [00:07<00:03, 371.75it/s]
Adding requests:  70%|███████   | 2886/4096 [00:07<00:03, 371.68it/s]
Adding requests:  71%|███████▏  | 2924/4096 [00:07<00:03, 367.90it/s]
Adding requests:  72%|███████▏  | 2961/4096 [00:07<00:03, 363.96it/s]
Adding requests:  73%|███████▎  | 3000/4096 [00:07<00:02, 368.92it/s]
Adding requests:  74%|███████▍  | 3039/4096 [00:08<00:02, 374.90it/s]
Adding requests:  75%|███████▌  | 3077/4096 [00:08<00:02, 370.29it/s]
Adding requests:  76%|███████▌  | 3119/4096 [00:08<00:02, 382.29it/s]
Adding requests:  77%|███████▋  | 3159/4096 [00:08<00:02, 385.68it/s]
Adding requests:  78%|███████▊  | 3198/4096 [00:08<00:02, 381.60it/s]
Adding requests:  79%|███████▉  | 3238/4096 [00:08<00:02, 386.00it/s]
Adding requests:  80%|████████  | 3277/4096 [00:08<00:02, 385.24it/s]
Adding requests:  81%|████████  | 3316/4096 [00:08<00:02, 384.39it/s]
Adding requests:  82%|████████▏ | 3357/4096 [00:08<00:01, 389.73it/s]
Adding requests:  83%|████████▎ | 3396/4096 [00:08<00:01, 386.99it/s]
Adding requests:  84%|████████▍ | 3437/4096 [00:09<00:01, 392.63it/s]
Adding requests:  85%|████████▍ | 3477/4096 [00:09<00:01, 386.16it/s]
Adding requests:  86%|████████▌ | 3517/4096 [00:09<00:01, 388.61it/s]
Adding requests:  87%|████████▋ | 3557/4096 [00:09<00:01, 391.20it/s]
Adding requests:  88%|████████▊ | 3597/4096 [00:09<00:01, 392.57it/s]
Adding requests:  89%|████████▉ | 3637/4096 [00:09<00:01, 376.76it/s]
Adding requests:  90%|████████▉ | 3677/4096 [00:09<00:01, 381.58it/s]
Adding requests:  91%|█████████ | 3717/4096 [00:09<00:00, 386.63it/s]
Adding requests:  92%|█████████▏| 3757/4096 [00:09<00:00, 390.45it/s]
Adding requests:  93%|█████████▎| 3800/4096 [00:10<00:00, 399.13it/s]
Adding requests:  94%|█████████▍| 3842/4096 [00:10<00:00, 402.33it/s]
Adding requests:  95%|█████████▍| 3883/4096 [00:10<00:00, 400.56it/s]
Adding requests:  96%|█████████▌| 3924/4096 [00:10<00:00, 401.46it/s]
Adding requests:  97%|█████████▋| 3965/4096 [00:10<00:00, 400.98it/s]
Adding requests:  98%|█████████▊| 4006/4096 [00:10<00:00, 396.66it/s]
Adding requests:  99%|█████████▉| 4046/4096 [00:10<00:00, 392.37it/s]
Adding requests: 100%|█████████▉| 4087/4096 [00:10<00:00, 395.22it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 380.89it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:00<00:03, 1017.63it/s, est. speed input: 1042107.04 toks/s, output: 1017.64 toks/s]
Processed prompts:  17%|█▋        | 712/4096 [00:04<00:25, 133.78it/s, est. speed input: 176356.15 toks/s, output: 172.22 toks/s]   
Processed prompts:  18%|█▊        | 756/4096 [00:04<00:26, 124.76it/s, est. speed input: 165167.18 toks/s, output: 161.30 toks/s]
Processed prompts:  19%|█▉        | 784/4096 [00:05<00:29, 110.59it/s, est. speed input: 153270.58 toks/s, output: 149.68 toks/s]
Processed prompts:  20%|█▉        | 803/4096 [00:05<00:34, 94.23it/s, est. speed input: 142036.64 toks/s, output: 138.71 toks/s] 
Processed prompts:  20%|██        | 834/4096 [00:06<00:38, 84.97it/s, est. speed input: 134499.93 toks/s, output: 131.35 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:06<00:41, 77.90it/s, est. speed input: 128336.93 toks/s, output: 125.33 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:07<00:44, 72.37it/s, est. speed input: 123095.20 toks/s, output: 120.21 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:08<00:46, 68.21it/s, est. speed input: 118606.82 toks/s, output: 115.83 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:08<00:48, 65.01it/s, est. speed input: 114657.80 toks/s, output: 111.97 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:09<00:49, 62.74it/s, est. speed input: 111216.48 toks/s, output: 108.61 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:09<00:50, 61.09it/s, est. speed input: 108170.26 toks/s, output: 105.63 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:10<00:50, 59.90it/s, est. speed input: 105453.87 toks/s, output: 102.98 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:10<00:50, 59.06it/s, est. speed input: 103020.23 toks/s, output: 100.61 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:11<00:50, 58.46it/s, est. speed input: 100822.56 toks/s, output: 98.46 toks/s] 
Processed prompts:  28%|██▊       | 1154/4096 [00:11<00:50, 58.53it/s, est. speed input: 98965.25 toks/s, output: 96.65 toks/s] 
Processed prompts:  29%|██▉       | 1186/4096 [00:12<00:50, 58.09it/s, est. speed input: 97146.66 toks/s, output: 94.87 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:13<00:49, 57.78it/s, est. speed input: 95482.94 toks/s, output: 93.24 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:13<00:49, 57.54it/s, est. speed input: 93953.60 toks/s, output: 91.75 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:14<00:48, 57.71it/s, est. speed input: 92615.49 toks/s, output: 90.44 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:14<00:47, 57.98it/s, est. speed input: 91407.07 toks/s, output: 89.26 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:15<00:47, 58.18it/s, est. speed input: 90286.31 toks/s, output: 88.17 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:15<00:46, 58.32it/s, est. speed input: 89243.36 toks/s, output: 87.15 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:16<00:45, 58.42it/s, est. speed input: 88269.46 toks/s, output: 86.20 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:16<00:45, 58.48it/s, est. speed input: 87357.22 toks/s, output: 85.31 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:17<00:44, 58.52it/s, est. speed input: 86502.85 toks/s, output: 84.48 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:17<00:44, 58.55it/s, est. speed input: 85699.65 toks/s, output: 83.69 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:18<00:43, 58.58it/s, est. speed input: 84945.10 toks/s, output: 82.95 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:19<00:43, 58.61it/s, est. speed input: 84234.84 toks/s, output: 82.26 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:19<00:42, 58.63it/s, est. speed input: 83563.75 toks/s, output: 81.61 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:20<00:42, 58.57it/s, est. speed input: 82919.95 toks/s, output: 80.98 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:20<00:41, 58.53it/s, est. speed input: 82310.13 toks/s, output: 80.38 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:21<00:40, 58.59it/s, est. speed input: 81741.78 toks/s, output: 79.83 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:21<00:40, 58.61it/s, est. speed input: 81199.61 toks/s, output: 79.30 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:22<00:40, 58.22it/s, est. speed input: 80638.14 toks/s, output: 78.75 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:22<00:39, 57.95it/s, est. speed input: 80105.01 toks/s, output: 78.23 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:23<00:39, 57.76it/s, est. speed input: 79595.98 toks/s, output: 77.73 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:24<00:38, 58.15it/s, est. speed input: 79165.72 toks/s, output: 77.31 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:24<00:38, 57.88it/s, est. speed input: 78699.49 toks/s, output: 76.85 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:25<00:37, 57.72it/s, est. speed input: 78255.69 toks/s, output: 76.42 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:25<00:37, 57.59it/s, est. speed input: 77830.55 toks/s, output: 76.01 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:26<00:36, 57.51it/s, est. speed input: 77424.06 toks/s, output: 75.61 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:26<00:36, 57.46it/s, est. speed input: 77034.50 toks/s, output: 75.23 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:27<00:35, 57.42it/s, est. speed input: 76661.02 toks/s, output: 74.86 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:27<00:35, 57.39it/s, est. speed input: 76302.43 toks/s, output: 74.51 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:28<00:34, 57.39it/s, est. speed input: 75958.81 toks/s, output: 74.18 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:29<00:33, 57.38it/s, est. speed input: 75628.27 toks/s, output: 73.86 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:29<00:33, 57.37it/s, est. speed input: 75309.92 toks/s, output: 73.54 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:30<00:32, 57.47it/s, est. speed input: 75011.91 toks/s, output: 73.25 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:30<00:32, 57.59it/s, est. speed input: 74728.24 toks/s, output: 72.98 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:31<00:31, 58.19it/s, est. speed input: 74493.44 toks/s, output: 72.75 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:31<00:30, 58.09it/s, est. speed input: 74228.66 toks/s, output: 72.49 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:32<00:30, 58.03it/s, est. speed input: 73973.43 toks/s, output: 72.24 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:32<00:29, 57.99it/s, est. speed input: 73726.89 toks/s, output: 72.00 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:33<00:29, 57.97it/s, est. speed input: 73488.97 toks/s, output: 71.77 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:34<00:28, 57.94it/s, est. speed input: 73257.57 toks/s, output: 71.54 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:34<00:28, 57.92it/s, est. speed input: 73033.62 toks/s, output: 71.32 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:35<00:27, 58.42it/s, est. speed input: 72850.47 toks/s, output: 71.14 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:37<00:54, 28.59it/s, est. speed input: 68965.65 toks/s, output: 67.35 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:38<00:45, 33.72it/s, est. speed input: 68827.77 toks/s, output: 67.21 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:38<00:38, 38.52it/s, est. speed input: 68687.72 toks/s, output: 67.08 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:39<00:34, 42.81it/s, est. speed input: 68554.23 toks/s, output: 66.95 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:39<00:30, 46.40it/s, est. speed input: 68422.21 toks/s, output: 66.82 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:40<00:28, 49.14it/s, est. speed input: 68282.19 toks/s, output: 66.68 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:40<00:26, 51.26it/s, est. speed input: 68145.63 toks/s, output: 66.55 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:41<00:25, 52.85it/s, est. speed input: 68012.73 toks/s, output: 66.42 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:42<00:24, 54.02it/s, est. speed input: 67883.65 toks/s, output: 66.29 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:42<00:23, 54.88it/s, est. speed input: 67758.01 toks/s, output: 66.17 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:43<00:22, 55.50it/s, est. speed input: 67635.69 toks/s, output: 66.05 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:43<00:21, 55.93it/s, est. speed input: 67516.28 toks/s, output: 65.93 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:44<00:21, 56.24it/s, est. speed input: 67399.97 toks/s, output: 65.82 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:44<00:20, 56.44it/s, est. speed input: 67285.65 toks/s, output: 65.71 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:45<00:19, 56.60it/s, est. speed input: 67174.99 toks/s, output: 65.60 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:45<00:19, 56.71it/s, est. speed input: 67067.05 toks/s, output: 65.50 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:46<00:18, 56.79it/s, est. speed input: 66961.46 toks/s, output: 65.39 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:47<00:17, 56.85it/s, est. speed input: 66859.07 toks/s, output: 65.29 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:47<00:17, 56.89it/s, est. speed input: 66758.88 toks/s, output: 65.19 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:48<00:16, 57.32it/s, est. speed input: 66678.97 toks/s, output: 65.12 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:48<00:16, 57.69it/s, est. speed input: 66603.97 toks/s, output: 65.04 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:49<00:15, 58.01it/s, est. speed input: 66532.73 toks/s, output: 64.97 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:49<00:14, 58.12it/s, est. speed input: 66458.42 toks/s, output: 64.90 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:50<00:14, 58.25it/s, est. speed input: 66388.04 toks/s, output: 64.83 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:50<00:13, 58.34it/s, est. speed input: 66319.11 toks/s, output: 64.76 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:51<00:13, 58.42it/s, est. speed input: 66252.06 toks/s, output: 64.70 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:52<00:12, 58.48it/s, est. speed input: 66186.63 toks/s, output: 64.64 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:52<00:12, 58.49it/s, est. speed input: 66121.41 toks/s, output: 64.57 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:53<00:11, 58.51it/s, est. speed input: 66058.27 toks/s, output: 64.51 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:53<00:10, 58.52it/s, est. speed input: 65995.91 toks/s, output: 64.45 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:54<00:10, 58.53it/s, est. speed input: 65934.92 toks/s, output: 64.39 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [00:54<00:09, 58.54it/s, est. speed input: 65875.31 toks/s, output: 64.33 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [00:55<00:09, 58.57it/s, est. speed input: 65818.06 toks/s, output: 64.28 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [00:55<00:08, 58.47it/s, est. speed input: 65757.18 toks/s, output: 64.22 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [00:56<00:08, 58.12it/s, est. speed input: 65687.22 toks/s, output: 64.15 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [00:56<00:07, 57.90it/s, est. speed input: 65619.46 toks/s, output: 64.08 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [00:57<00:07, 57.72it/s, est. speed input: 65552.19 toks/s, output: 64.02 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [00:58<00:06, 58.12it/s, est. speed input: 65504.83 toks/s, output: 63.97 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [00:58<00:06, 57.88it/s, est. speed input: 65440.02 toks/s, output: 63.91 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [00:59<00:05, 57.72it/s, est. speed input: 65376.70 toks/s, output: 63.84 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [00:59<00:04, 57.62it/s, est. speed input: 65314.90 toks/s, output: 63.78 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:00<00:04, 57.53it/s, est. speed input: 65253.70 toks/s, output: 63.72 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:00<00:03, 57.48it/s, est. speed input: 65193.91 toks/s, output: 63.67 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:01<00:03, 57.44it/s, est. speed input: 65135.21 toks/s, output: 63.61 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:01<00:02, 57.40it/s, est. speed input: 65077.20 toks/s, output: 63.55 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:02<00:02, 57.39it/s, est. speed input: 65020.71 toks/s, output: 63.50 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:03<00:01, 57.38it/s, est. speed input: 64965.05 toks/s, output: 63.44 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:03<00:01, 57.90it/s, est. speed input: 64927.53 toks/s, output: 63.41 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:04<00:00, 58.52it/s, est. speed input: 64898.90 toks/s, output: 63.38 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:04<00:00, 58.52it/s, est. speed input: 65377.24 toks/s, output: 63.84 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:04<00:00, 63.84it/s, est. speed input: 65377.24 toks/s, output: 63.84 toks/s]
[rank0]:[W128 11:42:45.605607369 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 140.2s

测试结果:
  Requests/s:   57.59
  Tokens/s:     59026.51
  Total Reqs:   4096
  Elapsed:      71.13s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     58968.92


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_10/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.9370,8688.7018,7.5574
1024,1024,1,128,128,16.2747,16681.5491,7.8650
2048,1024,2,256,128,34.5979,35462.8504,7.3993
4096,1024,4,512,128,52.0195,53319.9513,9.8425
8192,1024,8,1024,128,54.2176,55572.9931,18.8869
16384,1024,16,2048,128,55.7415,57135.0572,36.7410
32768,1024,32,4096,128,57.5868,59026.5074,71.1274

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败


============================================================
  Benchmark 完成!
============================================================


总计: 35 成功, 0 失败
============================================================
