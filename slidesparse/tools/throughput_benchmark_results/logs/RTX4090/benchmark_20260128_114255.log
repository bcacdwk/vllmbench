======================================================================
SlideSparse vLLM Throughput Benchmark Log
Created: 2026-01-28 11:42:55
======================================================================

原始命令:
  /root/vllmbench/slidesparse/tools/throughput_benchmark.py --model bitnet1.58-2b-fp8 --backend cublaslt,cusparselt --stage prefill --sparsity 2_4,2_6,2_8,2_10 --M 512,1024,2048,4096,8192,16384,32768

命令行参数:
  --model: bitnet1.58-2b-fp8
  --backend: cublaslt,cusparselt
  --sparsity: 2_4,2_6,2_8,2_10
  --stage: prefill
  --M: 512,1024,2048,4096,8192,16384,32768
  --N: None
  --inner-32: False
  --eager: False
  --gpu-id: 0
  --gpu-mem: 0.8
  --dry-run: False
  --list-models: False

硬件信息:
  GPU: RTX4090
  Compute Capability: cc89
  VRAM: 24.0 GB
  CUDA: 12.9
  Python: py312

Backend 环境变量 (初始状态):
  DISABLE_SLIDESPARSE: 未设置
  USE_CUBLASLT: 未设置
  USE_CUSPARSELT: 未设置
  SPARSITY: 未设置
  INNER_DTYPE_32: 未设置

======================================================================


============================================================
  BitNet-2B-FP8 | cuBLASLt | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints/BitNet-2B-FP8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cublaslt

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:43:03 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:43:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=27819) WARNING 01-28 11:43:10 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=27819) WARNING 01-28 11:43:20 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.72 requests/s, 8064.80 total tokens/s, 15.72 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:43:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:43:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:43:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:43:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:43:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:43:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:43:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:43:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:43:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:43:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:43:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:43:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:43:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:43:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:43:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:43:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:43:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:43:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=27819) [2026-01-28 11:43:10] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=27819) [2026-01-28 11:43:10] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=27819) [2026-01-28 11:43:10] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=27819) [2026-01-28 11:43:10] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=27819) [2026-01-28 11:43:10] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=27819) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=27819) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=27819) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=27819) 
(EngineCore_DP0 pid=27819) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.30it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.40it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.38it/s]
(EngineCore_DP0 pid=27819) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.94it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.94it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  49%|████▉     | 63/128 [00:00<00:00, 627.00it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 660.72it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 31.40it/s, est. speed input: 16079.40 toks/s, output: 31.40 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:06, 19.80it/s, est. speed input: 10732.77 toks/s, output: 20.96 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:06, 17.92it/s, est. speed input: 9808.05 toks/s, output: 19.16 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:06, 17.28it/s, est. speed input: 9490.97 toks/s, output: 18.54 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:06, 16.80it/s, est. speed input: 9265.60 toks/s, output: 18.10 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:06, 16.46it/s, est. speed input: 9098.26 toks/s, output: 17.77 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.21it/s, est. speed input: 8968.09 toks/s, output: 17.52 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 15.95it/s, est. speed input: 8850.81 toks/s, output: 17.29 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 15.94it/s, est. speed input: 8784.32 toks/s, output: 17.16 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 15.83it/s, est. speed input: 8713.85 toks/s, output: 17.02 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 15.80it/s, est. speed input: 8661.76 toks/s, output: 16.92 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:06, 15.75it/s, est. speed input: 8612.35 toks/s, output: 16.82 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:06, 15.77it/s, est. speed input: 8577.59 toks/s, output: 16.75 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:06, 15.73it/s, est. speed input: 8540.48 toks/s, output: 16.68 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 15.78it/s, est. speed input: 8516.43 toks/s, output: 16.63 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 15.82it/s, est. speed input: 8495.66 toks/s, output: 16.59 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 15.84it/s, est. speed input: 8476.96 toks/s, output: 16.56 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 15.82it/s, est. speed input: 8455.69 toks/s, output: 16.51 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 15.74it/s, est. speed input: 8431.60 toks/s, output: 16.47 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:05, 15.71it/s, est. speed input: 8412.01 toks/s, output: 16.43 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:05, 15.75it/s, est. speed input: 8398.84 toks/s, output: 16.40 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:05, 15.77it/s, est. speed input: 8386.06 toks/s, output: 16.38 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 15.80it/s, est. speed input: 8375.70 toks/s, output: 16.36 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 15.86it/s, est. speed input: 8368.54 toks/s, output: 16.34 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 15.86it/s, est. speed input: 8359.37 toks/s, output: 16.33 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 15.90it/s, est. speed input: 8353.20 toks/s, output: 16.31 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.03it/s, est. speed input: 8353.52 toks/s, output: 16.32 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:04, 16.07it/s, est. speed input: 8351.16 toks/s, output: 16.31 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:04, 16.04it/s, est. speed input: 8345.67 toks/s, output: 16.30 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 16.04it/s, est. speed input: 8341.60 toks/s, output: 16.29 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 16.04it/s, est. speed input: 8337.44 toks/s, output: 16.28 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.11it/s, est. speed input: 8337.47 toks/s, output: 16.28 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.16it/s, est. speed input: 8337.28 toks/s, output: 16.28 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.17it/s, est. speed input: 8336.11 toks/s, output: 16.28 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.18it/s, est. speed input: 8334.98 toks/s, output: 16.28 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.15it/s, est. speed input: 8332.27 toks/s, output: 16.27 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:03, 15.91it/s, est. speed input: 8319.96 toks/s, output: 16.25 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 15.96it/s, est. speed input: 8317.82 toks/s, output: 16.25 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:05<00:02, 16.04it/s, est. speed input: 8317.75 toks/s, output: 16.25 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 15.85it/s, est. speed input: 8307.10 toks/s, output: 16.22 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 15.89it/s, est. speed input: 8304.46 toks/s, output: 16.22 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 15.96it/s, est. speed input: 8303.32 toks/s, output: 16.22 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 15.96it/s, est. speed input: 8300.50 toks/s, output: 16.21 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.03it/s, est. speed input: 8300.07 toks/s, output: 16.21 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:02, 16.04it/s, est. speed input: 8298.49 toks/s, output: 16.21 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 16.10it/s, est. speed input: 8298.89 toks/s, output: 16.21 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:06<00:01, 16.05it/s, est. speed input: 8295.95 toks/s, output: 16.20 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 15.95it/s, est. speed input: 8291.09 toks/s, output: 16.19 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 15.86it/s, est. speed input: 8285.59 toks/s, output: 16.18 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 15.71it/s, est. speed input: 8277.17 toks/s, output: 16.17 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 15.64it/s, est. speed input: 8270.36 toks/s, output: 16.15 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 15.53it/s, est. speed input: 8261.62 toks/s, output: 16.14 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 15.59it/s, est. speed input: 8257.76 toks/s, output: 16.13 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:07<00:00, 15.69it/s, est. speed input: 8255.85 toks/s, output: 16.12 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:07<00:00, 15.76it/s, est. speed input: 8254.24 toks/s, output: 16.12 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 15.79it/s, est. speed input: 8251.86 toks/s, output: 16.12 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 15.83it/s, est. speed input: 8250.05 toks/s, output: 16.11 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 15.80it/s, est. speed input: 8246.68 toks/s, output: 16.11 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 15.83it/s, est. speed input: 8244.99 toks/s, output: 16.10 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 15.91it/s, est. speed input: 8245.06 toks/s, output: 16.10 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.00it/s, est. speed input: 8245.92 toks/s, output: 16.11 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.00it/s, est. speed input: 8246.86 toks/s, output: 16.11 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.11it/s, est. speed input: 8246.86 toks/s, output: 16.11 toks/s]
[rank0]:[W128 11:43:41.572699397 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 47.8s

测试结果:
  Requests/s:   15.72
  Tokens/s:     8064.80
  Total Reqs:   128
  Elapsed:      8.14s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8049.08

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:43:51 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:43:52 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=28481) WARNING 01-28 11:43:58 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=28481) WARNING 01-28 11:44:10 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.64 requests/s, 16029.04 total tokens/s, 15.64 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:43:51] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:43:51] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:43:51] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:43:51] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:51] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:51] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:51] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:51] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:51] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:43:51] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:43:51] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:43:51] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:43:51] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:43:51] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:43:58] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:43:58] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:43:58] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:43:58] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:58] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:58] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:58] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:58] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:43:58] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:43:58] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:43:58] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:43:58] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:43:58] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:43:58] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=28481) [2026-01-28 11:43:59] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=28481) [2026-01-28 11:43:59] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=28481) [2026-01-28 11:43:59] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=28481) [2026-01-28 11:43:59] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=28481) [2026-01-28 11:43:59] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=28481) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=28481) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.46s/it]
(EngineCore_DP0 pid=28481) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.46s/it]
(EngineCore_DP0 pid=28481) 
(EngineCore_DP0 pid=28481) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  5.18it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.37it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.16it/s]
(EngineCore_DP0 pid=28481) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.88it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  6.87it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  27%|██▋       | 34/128 [00:00<00:00, 339.84it/s]
Adding requests:  57%|█████▋    | 73/128 [00:00<00:00, 367.48it/s]
Adding requests:  87%|████████▋ | 111/128 [00:00<00:00, 370.98it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 370.32it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:02, 49.60it/s, est. speed input: 50819.90 toks/s, output: 49.61 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:05, 22.82it/s, est. speed input: 25632.26 toks/s, output: 25.03 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:05, 20.05it/s, est. speed input: 22823.29 toks/s, output: 22.29 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:06, 18.45it/s, est. speed input: 21245.76 toks/s, output: 20.75 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 17.53it/s, est. speed input: 20283.74 toks/s, output: 19.81 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.00it/s, est. speed input: 19772.12 toks/s, output: 19.31 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.72it/s, est. speed input: 19425.92 toks/s, output: 18.97 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.46it/s, est. speed input: 19127.94 toks/s, output: 18.68 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:06, 16.28it/s, est. speed input: 18881.68 toks/s, output: 18.44 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:06, 16.14it/s, est. speed input: 18674.65 toks/s, output: 18.24 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.02it/s, est. speed input: 18487.86 toks/s, output: 18.05 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:01<00:05, 15.97it/s, est. speed input: 18339.46 toks/s, output: 17.91 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 15.95it/s, est. speed input: 18210.29 toks/s, output: 17.78 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 15.94it/s, est. speed input: 18099.71 toks/s, output: 17.68 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 15.92it/s, est. speed input: 17997.47 toks/s, output: 17.58 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 15.84it/s, est. speed input: 17891.84 toks/s, output: 17.47 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 15.86it/s, est. speed input: 17812.15 toks/s, output: 17.39 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:05, 15.82it/s, est. speed input: 17731.24 toks/s, output: 17.32 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:05, 15.78it/s, est. speed input: 17654.97 toks/s, output: 17.24 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:02<00:04, 15.77it/s, est. speed input: 17587.84 toks/s, output: 17.18 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 15.72it/s, est. speed input: 17520.76 toks/s, output: 17.11 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 15.74it/s, est. speed input: 17466.31 toks/s, output: 17.06 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 15.68it/s, est. speed input: 17406.14 toks/s, output: 17.00 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 15.73it/s, est. speed input: 17361.71 toks/s, output: 16.95 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 15.78it/s, est. speed input: 17323.68 toks/s, output: 16.92 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:04, 15.84it/s, est. speed input: 17291.13 toks/s, output: 16.89 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:04, 15.80it/s, est. speed input: 17250.91 toks/s, output: 16.85 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 15.74it/s, est. speed input: 17209.62 toks/s, output: 16.81 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 15.80it/s, est. speed input: 17181.94 toks/s, output: 16.78 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 15.84it/s, est. speed input: 17155.83 toks/s, output: 16.75 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 15.85it/s, est. speed input: 17129.04 toks/s, output: 16.73 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 15.89it/s, est. speed input: 17107.95 toks/s, output: 16.71 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 15.89it/s, est. speed input: 17085.02 toks/s, output: 16.68 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 15.89it/s, est. speed input: 17063.02 toks/s, output: 16.66 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:03, 15.93it/s, est. speed input: 17045.73 toks/s, output: 16.65 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 15.91it/s, est. speed input: 17025.75 toks/s, output: 16.63 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 15.93it/s, est. speed input: 17009.26 toks/s, output: 16.61 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 15.83it/s, est. speed input: 16983.74 toks/s, output: 16.59 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 15.80it/s, est. speed input: 16962.78 toks/s, output: 16.57 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 15.77it/s, est. speed input: 16941.89 toks/s, output: 16.54 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 15.82it/s, est. speed input: 16927.62 toks/s, output: 16.53 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 15.85it/s, est. speed input: 16914.34 toks/s, output: 16.52 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:02, 15.82it/s, est. speed input: 16896.67 toks/s, output: 16.50 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 15.82it/s, est. speed input: 16881.84 toks/s, output: 16.49 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 15.87it/s, est. speed input: 16871.29 toks/s, output: 16.48 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 15.88it/s, est. speed input: 16859.51 toks/s, output: 16.46 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 15.89it/s, est. speed input: 16848.62 toks/s, output: 16.45 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 15.88it/s, est. speed input: 16836.23 toks/s, output: 16.44 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 15.89it/s, est. speed input: 16825.91 toks/s, output: 16.43 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 15.92it/s, est. speed input: 16817.23 toks/s, output: 16.42 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:01, 15.91it/s, est. speed input: 16807.30 toks/s, output: 16.41 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 15.89it/s, est. speed input: 16796.68 toks/s, output: 16.40 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 15.89it/s, est. speed input: 16787.30 toks/s, output: 16.39 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 15.66it/s, est. speed input: 16764.07 toks/s, output: 16.37 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 15.64it/s, est. speed input: 16750.03 toks/s, output: 16.36 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 15.73it/s, est. speed input: 16743.22 toks/s, output: 16.35 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 15.79it/s, est. speed input: 16736.08 toks/s, output: 16.34 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 15.85it/s, est. speed input: 16730.05 toks/s, output: 16.34 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 15.87it/s, est. speed input: 16723.09 toks/s, output: 16.33 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 15.87it/s, est. speed input: 16723.09 toks/s, output: 16.33 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.33it/s, est. speed input: 16723.09 toks/s, output: 16.33 toks/s]
[rank0]:[W128 11:44:29.112805439 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 48.5s

测试结果:
  Requests/s:   15.64
  Tokens/s:     16029.04
  Total Reqs:   128
  Elapsed:      8.19s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16013.40

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:44:42 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:44:43 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=29488) WARNING 01-28 11:44:49 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=29488) WARNING 01-28 11:44:59 [backends.py:609] Failed to read file <frozen os>
Throughput: 30.42 requests/s, 31178.52 total tokens/s, 30.42 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:44:42] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:44:42] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:44:42] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:44:42] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:42] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:42] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:42] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:42] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:42] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:44:42] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:44:42] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:44:42] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:44:42] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:44:42] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:44:49] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:44:49] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:44:49] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:44:49] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:49] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:49] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:49] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:49] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:44:49] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:44:49] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:44:49] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:44:49] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:44:49] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:44:49] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=29488) [2026-01-28 11:44:50] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=29488) [2026-01-28 11:44:50] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=29488) [2026-01-28 11:44:50] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=29488) [2026-01-28 11:44:50] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=29488) [2026-01-28 11:44:50] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=29488) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=29488) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.01it/s]
(EngineCore_DP0 pid=29488) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.01it/s]
(EngineCore_DP0 pid=29488) 
(EngineCore_DP0 pid=29488) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.14it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:02<00:00,  1.03s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:02<00:00,  1.27it/s]
(EngineCore_DP0 pid=29488) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  6.87it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.70it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.56it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 36/256 [00:00<00:00, 359.08it/s]
Adding requests:  29%|██▉       | 74/256 [00:00<00:00, 371.10it/s]
Adding requests:  44%|████▍     | 112/256 [00:00<00:00, 373.12it/s]
Adding requests:  59%|█████▊    | 150/256 [00:00<00:00, 370.08it/s]
Adding requests:  73%|███████▎  | 188/256 [00:00<00:00, 368.94it/s]
Adding requests:  88%|████████▊ | 225/256 [00:00<00:00, 368.57it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 369.95it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:00<00:02, 117.62it/s, est. speed input: 120468.99 toks/s, output: 117.63 toks/s]
Processed prompts:  12%|█▏        | 30/256 [00:00<00:04, 49.12it/s, est. speed input: 56194.61 toks/s, output: 54.87 toks/s]   
Processed prompts:  14%|█▍        | 37/256 [00:00<00:04, 44.54it/s, est. speed input: 51205.01 toks/s, output: 50.00 toks/s]
Processed prompts:  17%|█▋        | 43/256 [00:00<00:05, 40.19it/s, est. speed input: 47326.29 toks/s, output: 46.22 toks/s]
Processed prompts:  19%|█▉        | 48/256 [00:01<00:05, 35.74it/s, est. speed input: 43884.84 toks/s, output: 42.86 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:05, 34.76it/s, est. speed input: 42711.20 toks/s, output: 41.71 toks/s]
Processed prompts:  22%|██▏       | 56/256 [00:01<00:05, 33.87it/s, est. speed input: 41710.53 toks/s, output: 40.73 toks/s]
Processed prompts:  23%|██▎       | 60/256 [00:01<00:05, 33.14it/s, est. speed input: 40870.57 toks/s, output: 39.91 toks/s]
Processed prompts:  25%|██▌       | 64/256 [00:01<00:05, 32.71it/s, est. speed input: 40207.68 toks/s, output: 39.26 toks/s]
Processed prompts:  27%|██▋       | 68/256 [00:01<00:05, 32.38it/s, est. speed input: 39634.86 toks/s, output: 38.71 toks/s]
Processed prompts:  28%|██▊       | 72/256 [00:01<00:05, 32.22it/s, est. speed input: 39164.57 toks/s, output: 38.25 toks/s]
Processed prompts:  30%|██▉       | 76/256 [00:02<00:05, 32.12it/s, est. speed input: 38755.94 toks/s, output: 37.85 toks/s]
Processed prompts:  31%|███▏      | 80/256 [00:02<00:05, 31.84it/s, est. speed input: 38345.30 toks/s, output: 37.45 toks/s]
Processed prompts:  33%|███▎      | 84/256 [00:02<00:05, 31.68it/s, est. speed input: 37989.69 toks/s, output: 37.10 toks/s]
Processed prompts:  34%|███▍      | 88/256 [00:02<00:05, 31.67it/s, est. speed input: 37694.20 toks/s, output: 36.81 toks/s]
Processed prompts:  36%|███▌      | 92/256 [00:02<00:05, 31.59it/s, est. speed input: 37414.42 toks/s, output: 36.54 toks/s]
Processed prompts:  38%|███▊      | 96/256 [00:02<00:05, 31.58it/s, est. speed input: 37169.32 toks/s, output: 36.30 toks/s]
Processed prompts:  39%|███▉      | 100/256 [00:02<00:04, 31.44it/s, est. speed input: 36922.86 toks/s, output: 36.06 toks/s]
Processed prompts:  41%|████      | 104/256 [00:02<00:04, 31.24it/s, est. speed input: 36680.78 toks/s, output: 35.82 toks/s]
Processed prompts:  42%|████▏     | 108/256 [00:03<00:04, 31.21it/s, est. speed input: 36478.60 toks/s, output: 35.62 toks/s]
Processed prompts:  44%|████▍     | 112/256 [00:03<00:04, 31.18it/s, est. speed input: 36289.70 toks/s, output: 35.44 toks/s]
Processed prompts:  45%|████▌     | 116/256 [00:03<00:04, 30.91it/s, est. speed input: 36079.67 toks/s, output: 35.23 toks/s]
Processed prompts:  47%|████▋     | 120/256 [00:03<00:04, 30.67it/s, est. speed input: 35875.73 toks/s, output: 35.03 toks/s]
Processed prompts:  48%|████▊     | 124/256 [00:03<00:04, 30.54it/s, est. speed input: 35694.35 toks/s, output: 34.86 toks/s]
Processed prompts:  50%|█████     | 128/256 [00:03<00:04, 30.43it/s, est. speed input: 35521.43 toks/s, output: 34.69 toks/s]
Processed prompts:  52%|█████▏    | 132/256 [00:03<00:04, 30.45it/s, est. speed input: 35373.86 toks/s, output: 34.54 toks/s]
Processed prompts:  53%|█████▎    | 136/256 [00:03<00:03, 30.46it/s, est. speed input: 35235.44 toks/s, output: 34.41 toks/s]
Processed prompts:  55%|█████▍    | 140/256 [00:04<00:03, 30.56it/s, est. speed input: 35117.53 toks/s, output: 34.29 toks/s]
Processed prompts:  56%|█████▋    | 144/256 [00:04<00:03, 30.69it/s, est. speed input: 35013.95 toks/s, output: 34.19 toks/s]
Processed prompts:  58%|█████▊    | 148/256 [00:04<00:03, 30.84it/s, est. speed input: 34924.08 toks/s, output: 34.11 toks/s]
Processed prompts:  59%|█████▉    | 152/256 [00:04<00:03, 31.02it/s, est. speed input: 34846.16 toks/s, output: 34.03 toks/s]
Processed prompts:  61%|██████    | 156/256 [00:04<00:03, 31.16it/s, est. speed input: 34774.75 toks/s, output: 33.96 toks/s]
Processed prompts:  62%|██████▎   | 160/256 [00:04<00:03, 31.21it/s, est. speed input: 34701.42 toks/s, output: 33.89 toks/s]
Processed prompts:  64%|██████▍   | 164/256 [00:04<00:02, 31.34it/s, est. speed input: 34641.63 toks/s, output: 33.83 toks/s]
Processed prompts:  66%|██████▌   | 168/256 [00:04<00:02, 31.44it/s, est. speed input: 34585.69 toks/s, output: 33.77 toks/s]
Processed prompts:  67%|██████▋   | 172/256 [00:05<00:02, 31.52it/s, est. speed input: 34533.53 toks/s, output: 33.72 toks/s]
Processed prompts:  69%|██████▉   | 176/256 [00:05<00:02, 31.54it/s, est. speed input: 34480.39 toks/s, output: 33.67 toks/s]
Processed prompts:  70%|███████   | 180/256 [00:05<00:02, 31.52it/s, est. speed input: 34426.64 toks/s, output: 33.62 toks/s]
Processed prompts:  72%|███████▏  | 184/256 [00:05<00:02, 31.31it/s, est. speed input: 34358.98 toks/s, output: 33.55 toks/s]
Processed prompts:  73%|███████▎  | 188/256 [00:05<00:02, 31.02it/s, est. speed input: 34282.45 toks/s, output: 33.48 toks/s]
Processed prompts:  75%|███████▌  | 192/256 [00:05<00:02, 31.38it/s, est. speed input: 34255.15 toks/s, output: 33.45 toks/s]
Processed prompts:  77%|███████▋  | 196/256 [00:05<00:01, 31.74it/s, est. speed input: 34237.15 toks/s, output: 33.43 toks/s]
Processed prompts:  78%|███████▊  | 200/256 [00:05<00:01, 32.03it/s, est. speed input: 34222.48 toks/s, output: 33.42 toks/s]
Processed prompts:  80%|███████▉  | 204/256 [00:06<00:01, 32.18it/s, est. speed input: 34204.07 toks/s, output: 33.40 toks/s]
Processed prompts:  81%|████████▏ | 208/256 [00:06<00:01, 32.06it/s, est. speed input: 34170.65 toks/s, output: 33.37 toks/s]
Processed prompts:  83%|████████▎ | 212/256 [00:06<00:01, 32.08it/s, est. speed input: 34145.43 toks/s, output: 33.35 toks/s]
Processed prompts:  84%|████████▍ | 216/256 [00:06<00:01, 32.06it/s, est. speed input: 34119.21 toks/s, output: 33.32 toks/s]
Processed prompts:  86%|████████▌ | 220/256 [00:06<00:01, 32.11it/s, est. speed input: 34098.48 toks/s, output: 33.30 toks/s]
Processed prompts:  88%|████████▊ | 224/256 [00:06<00:00, 32.15it/s, est. speed input: 34078.16 toks/s, output: 33.28 toks/s]
Processed prompts:  89%|████████▉ | 228/256 [00:06<00:00, 32.12it/s, est. speed input: 34055.48 toks/s, output: 33.26 toks/s]
Processed prompts:  91%|█████████ | 232/256 [00:06<00:00, 32.20it/s, est. speed input: 34039.83 toks/s, output: 33.24 toks/s]
Processed prompts:  92%|█████████▏| 236/256 [00:07<00:00, 32.29it/s, est. speed input: 34026.50 toks/s, output: 33.23 toks/s]
Processed prompts:  94%|█████████▍| 240/256 [00:07<00:00, 32.22it/s, est. speed input: 34006.06 toks/s, output: 33.21 toks/s]
Processed prompts:  95%|█████████▌| 244/256 [00:07<00:00, 32.34it/s, est. speed input: 33995.66 toks/s, output: 33.20 toks/s]
Processed prompts:  97%|█████████▋| 248/256 [00:07<00:00, 32.34it/s, est. speed input: 33981.52 toks/s, output: 33.18 toks/s]
Processed prompts:  98%|█████████▊| 252/256 [00:07<00:00, 32.22it/s, est. speed input: 33960.57 toks/s, output: 33.16 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 32.23it/s, est. speed input: 33945.72 toks/s, output: 33.15 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 32.23it/s, est. speed input: 33945.72 toks/s, output: 33.15 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 33.15it/s, est. speed input: 33945.72 toks/s, output: 33.15 toks/s]
[rank0]:[W128 11:45:20.281776022 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.0s

测试结果:
  Requests/s:   30.42
  Tokens/s:     31178.52
  Total Reqs:   256
  Elapsed:      8.42s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     31148.10

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:45:32 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:45:33 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=30051) WARNING 01-28 11:45:39 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=30051) WARNING 01-28 11:45:51 [backends.py:609] Failed to read file <frozen os>
Throughput: 45.01 requests/s, 46134.76 total tokens/s, 45.01 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:45:32] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:45:32] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:45:32] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:45:32] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:32] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:32] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:32] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:32] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:32] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:45:32] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:45:32] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:45:32] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:45:32] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:45:32] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:45:39] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:45:39] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:45:39] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:45:39] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:39] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:39] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:39] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:39] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:45:39] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:45:39] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:45:39] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:45:39] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:45:39] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:45:39] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=30051) [2026-01-28 11:45:40] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=30051) [2026-01-28 11:45:40] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=30051) [2026-01-28 11:45:40] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=30051) [2026-01-28 11:45:40] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=30051) [2026-01-28 11:45:40] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=30051) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=30051) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.84it/s]
(EngineCore_DP0 pid=30051) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.83it/s]
(EngineCore_DP0 pid=30051) 
(EngineCore_DP0 pid=30051) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  7.88it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.17it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.42it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.82it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.96it/s]
(EngineCore_DP0 pid=30051) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.22it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.14it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.52it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.30it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 37/512 [00:00<00:01, 363.69it/s]
Adding requests:  15%|█▌        | 77/512 [00:00<00:01, 382.94it/s]
Adding requests:  23%|██▎       | 116/512 [00:00<00:01, 384.95it/s]
Adding requests:  30%|███       | 155/512 [00:00<00:00, 378.72it/s]
Adding requests:  38%|███▊      | 193/512 [00:00<00:00, 376.33it/s]
Adding requests:  45%|████▌     | 231/512 [00:00<00:00, 366.91it/s]
Adding requests:  53%|█████▎    | 269/512 [00:00<00:00, 369.48it/s]
Adding requests:  60%|█████▉    | 306/512 [00:00<00:00, 367.20it/s]
Adding requests:  67%|██████▋   | 345/512 [00:00<00:00, 373.85it/s]
Adding requests:  75%|███████▌  | 385/512 [00:01<00:00, 379.35it/s]
Adding requests:  83%|████████▎ | 425/512 [00:01<00:00, 383.68it/s]
Adding requests:  91%|█████████ | 464/512 [00:01<00:00, 383.07it/s]
Adding requests:  98%|█████████▊| 503/512 [00:01<00:00, 384.34it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 378.43it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  11%|█         | 54/512 [00:00<00:01, 437.53it/s, est. speed input: 448117.68 toks/s, output: 437.56 toks/s]
Processed prompts:  19%|█▉        | 98/512 [00:01<00:05, 80.43it/s, est. speed input: 95217.96 toks/s, output: 92.98 toks/s]   
Processed prompts:  23%|██▎       | 119/512 [00:01<00:05, 68.98it/s, est. speed input: 82524.75 toks/s, output: 80.59 toks/s]
Processed prompts:  26%|██▌       | 133/512 [00:01<00:05, 65.65it/s, est. speed input: 78714.09 toks/s, output: 76.87 toks/s]
Processed prompts:  28%|██▊       | 144/512 [00:01<00:06, 59.87it/s, est. speed input: 74293.49 toks/s, output: 72.55 toks/s]
Processed prompts:  30%|██▉       | 153/512 [00:02<00:06, 58.51it/s, est. speed input: 72712.93 toks/s, output: 71.01 toks/s]
Processed prompts:  31%|███▏      | 161/512 [00:02<00:06, 55.94it/s, est. speed input: 70899.24 toks/s, output: 69.24 toks/s]
Processed prompts:  33%|███▎      | 168/512 [00:02<00:06, 52.44it/s, est. speed input: 68952.82 toks/s, output: 67.34 toks/s]
Processed prompts:  34%|███▍      | 174/512 [00:02<00:07, 48.13it/s, est. speed input: 66879.00 toks/s, output: 65.31 toks/s]
Processed prompts:  36%|███▌      | 182/512 [00:02<00:06, 47.86it/s, est. speed input: 65761.96 toks/s, output: 64.22 toks/s]
Processed prompts:  37%|███▋      | 190/512 [00:03<00:06, 47.71it/s, est. speed input: 64786.55 toks/s, output: 63.27 toks/s]
Processed prompts:  39%|███▊      | 198/512 [00:03<00:06, 47.61it/s, est. speed input: 63920.10 toks/s, output: 62.42 toks/s]
Processed prompts:  40%|████      | 206/512 [00:03<00:06, 47.51it/s, est. speed input: 63133.79 toks/s, output: 61.65 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:03<00:06, 47.40it/s, est. speed input: 62414.02 toks/s, output: 60.95 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:03<00:06, 47.33it/s, est. speed input: 61763.15 toks/s, output: 60.32 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:03<00:05, 47.29it/s, est. speed input: 61171.94 toks/s, output: 59.74 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:04<00:05, 46.38it/s, est. speed input: 60467.39 toks/s, output: 59.05 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:04<00:05, 45.43it/s, est. speed input: 59764.71 toks/s, output: 58.36 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:04<00:05, 44.77it/s, est. speed input: 59115.48 toks/s, output: 57.73 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:04<00:05, 44.68it/s, est. speed input: 58582.69 toks/s, output: 57.21 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:04<00:05, 44.78it/s, est. speed input: 58115.37 toks/s, output: 56.75 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:04<00:05, 44.87it/s, est. speed input: 57684.50 toks/s, output: 56.33 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:05<00:05, 45.00it/s, est. speed input: 57295.03 toks/s, output: 55.95 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:05<00:04, 45.10it/s, est. speed input: 56931.27 toks/s, output: 55.60 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:05<00:04, 45.19it/s, est. speed input: 56597.43 toks/s, output: 55.27 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:05<00:04, 45.20it/s, est. speed input: 56272.53 toks/s, output: 54.95 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:05<00:04, 45.27it/s, est. speed input: 55977.04 toks/s, output: 54.66 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:05<00:04, 45.22it/s, est. speed input: 55688.17 toks/s, output: 54.38 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:06<00:03, 45.28it/s, est. speed input: 55426.20 toks/s, output: 54.13 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:06<00:03, 46.44it/s, est. speed input: 55302.15 toks/s, output: 54.01 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:06<00:03, 46.12it/s, est. speed input: 55063.55 toks/s, output: 53.77 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:06<00:03, 45.88it/s, est. speed input: 54834.89 toks/s, output: 53.55 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:06<00:03, 45.68it/s, est. speed input: 54614.43 toks/s, output: 53.33 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:07<00:03, 45.57it/s, est. speed input: 54409.87 toks/s, output: 53.13 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:07<00:02, 45.50it/s, est. speed input: 54214.04 toks/s, output: 52.94 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:07<00:02, 45.46it/s, est. speed input: 54028.30 toks/s, output: 52.76 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:07<00:02, 45.39it/s, est. speed input: 53847.74 toks/s, output: 52.59 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:07<00:02, 45.34it/s, est. speed input: 53676.19 toks/s, output: 52.42 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:07<00:02, 45.31it/s, est. speed input: 53512.00 toks/s, output: 52.26 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:08<00:01, 45.29it/s, est. speed input: 53355.39 toks/s, output: 52.10 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:08<00:01, 45.30it/s, est. speed input: 53206.97 toks/s, output: 51.96 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:08<00:01, 45.33it/s, est. speed input: 53066.91 toks/s, output: 51.82 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:08<00:01, 45.33it/s, est. speed input: 52930.74 toks/s, output: 51.69 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:08<00:01, 45.32it/s, est. speed input: 52799.23 toks/s, output: 51.56 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:08<00:01, 45.29it/s, est. speed input: 52671.49 toks/s, output: 51.44 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:09<00:00, 45.29it/s, est. speed input: 52549.93 toks/s, output: 51.32 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:09<00:00, 45.27it/s, est. speed input: 52431.45 toks/s, output: 51.20 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:09<00:00, 45.30it/s, est. speed input: 52320.70 toks/s, output: 51.09 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:09<00:00, 45.30it/s, est. speed input: 52212.57 toks/s, output: 50.99 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:09<00:00, 45.29it/s, est. speed input: 52107.61 toks/s, output: 50.89 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:10<00:00, 46.97it/s, est. speed input: 52116.26 toks/s, output: 50.89 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:10<00:00, 46.97it/s, est. speed input: 52319.55 toks/s, output: 51.09 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:10<00:00, 51.09it/s, est. speed input: 52319.55 toks/s, output: 51.09 toks/s]
[rank0]:[W128 11:46:14.781854188 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 53.5s

测试结果:
  Requests/s:   45.01
  Tokens/s:     46134.76
  Total Reqs:   512
  Elapsed:      11.38s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     46089.75

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:46:30 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:46:31 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=30628) WARNING 01-28 11:46:38 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=30628) WARNING 01-28 11:46:47 [backends.py:609] Failed to read file <frozen os>
Throughput: 47.10 requests/s, 48279.42 total tokens/s, 47.10 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:46:30] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:46:30] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:46:30] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:46:30] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:30] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:30] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:30] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:30] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:30] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:46:30] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:46:30] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:46:30] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:46:30] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:46:30] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:46:37] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:46:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:46:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:46:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:46:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:46:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:46:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:46:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:46:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:46:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=30628) [2026-01-28 11:46:38] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=30628) [2026-01-28 11:46:38] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=30628) [2026-01-28 11:46:38] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=30628) [2026-01-28 11:46:38] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=30628) [2026-01-28 11:46:38] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=30628) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=30628) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.00it/s]
(EngineCore_DP0 pid=30628) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.00it/s]
(EngineCore_DP0 pid=30628) 
(EngineCore_DP0 pid=30628) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  7.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  7.20it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  7.46it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  7.59it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.10it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.23it/s]
(EngineCore_DP0 pid=30628) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  6.65it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  7.42it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  7.60it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  7.80it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  7.61it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 38/1024 [00:00<00:02, 372.55it/s]
Adding requests:   8%|▊         | 78/1024 [00:00<00:02, 386.79it/s]
Adding requests:  12%|█▏        | 118/1024 [00:00<00:02, 388.38it/s]
Adding requests:  15%|█▌        | 157/1024 [00:00<00:02, 385.14it/s]
Adding requests:  19%|█▉        | 197/1024 [00:00<00:02, 387.28it/s]
Adding requests:  23%|██▎       | 238/1024 [00:00<00:02, 392.72it/s]
Adding requests:  27%|██▋       | 278/1024 [00:00<00:01, 392.86it/s]
Adding requests:  31%|███       | 318/1024 [00:00<00:01, 391.68it/s]
Adding requests:  35%|███▍      | 358/1024 [00:00<00:01, 393.79it/s]
Adding requests:  39%|███▉      | 399/1024 [00:01<00:01, 397.24it/s]
Adding requests:  43%|████▎     | 439/1024 [00:01<00:01, 392.46it/s]
Adding requests:  47%|████▋     | 480/1024 [00:01<00:01, 396.64it/s]
Adding requests:  51%|█████     | 520/1024 [00:01<00:01, 384.32it/s]
Adding requests:  55%|█████▍    | 561/1024 [00:01<00:01, 389.28it/s]
Adding requests:  59%|█████▉    | 602/1024 [00:01<00:01, 394.80it/s]
Adding requests:  63%|██████▎   | 642/1024 [00:01<00:00, 394.75it/s]
Adding requests:  67%|██████▋   | 685/1024 [00:01<00:00, 403.68it/s]
Adding requests:  71%|███████   | 727/1024 [00:01<00:00, 406.28it/s]
Adding requests:  75%|███████▌  | 768/1024 [00:01<00:00, 406.16it/s]
Adding requests:  79%|███████▉  | 809/1024 [00:02<00:00, 402.08it/s]
Adding requests:  83%|████████▎ | 850/1024 [00:02<00:00, 394.54it/s]
Adding requests:  87%|████████▋ | 893/1024 [00:02<00:00, 401.84it/s]
Adding requests:  91%|█████████ | 934/1024 [00:02<00:00, 398.40it/s]
Adding requests:  95%|█████████▌| 974/1024 [00:02<00:00, 396.70it/s]
Adding requests:  99%|█████████▉| 1014/1024 [00:02<00:00, 397.39it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 395.31it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  11%|█         | 114/1024 [00:00<00:01, 815.28it/s, est. speed input: 835083.69 toks/s, output: 815.33 toks/s]
Processed prompts:  19%|█▉        | 196/1024 [00:01<00:09, 90.78it/s, est. speed input: 110021.16 toks/s, output: 107.44 toks/s] 
Processed prompts:  23%|██▎       | 233/1024 [00:02<00:10, 78.18it/s, est. speed input: 95486.93 toks/s, output: 93.25 toks/s]  
Processed prompts:  25%|██▌       | 256/1024 [00:03<00:11, 69.19it/s, est. speed input: 87212.66 toks/s, output: 85.17 toks/s]
Processed prompts:  27%|██▋       | 272/1024 [00:03<00:11, 64.69it/s, est. speed input: 83306.17 toks/s, output: 81.35 toks/s]
Processed prompts:  28%|██▊       | 284/1024 [00:03<00:12, 58.04it/s, est. speed input: 78997.34 toks/s, output: 77.15 toks/s]
Processed prompts:  29%|██▊       | 293/1024 [00:03<00:12, 57.36it/s, est. speed input: 77922.79 toks/s, output: 76.10 toks/s]
Processed prompts:  29%|██▉       | 301/1024 [00:04<00:12, 55.68it/s, est. speed input: 76681.59 toks/s, output: 74.88 toks/s]
Processed prompts:  30%|███       | 308/1024 [00:04<00:13, 52.95it/s, est. speed input: 75302.79 toks/s, output: 73.54 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:04<00:14, 49.18it/s, est. speed input: 73789.72 toks/s, output: 72.06 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:04<00:14, 48.74it/s, est. speed input: 72842.31 toks/s, output: 71.13 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:04<00:14, 48.35it/s, est. speed input: 71958.78 toks/s, output: 70.27 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:04<00:14, 48.07it/s, est. speed input: 71139.15 toks/s, output: 69.47 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:05<00:14, 47.86it/s, est. speed input: 70376.65 toks/s, output: 68.73 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:05<00:14, 47.73it/s, est. speed input: 69668.62 toks/s, output: 68.04 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:05<00:13, 47.61it/s, est. speed input: 69001.24 toks/s, output: 67.38 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:05<00:13, 47.52it/s, est. speed input: 68373.17 toks/s, output: 66.77 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:05<00:13, 47.46it/s, est. speed input: 67782.66 toks/s, output: 66.19 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:05<00:13, 47.38it/s, est. speed input: 67221.38 toks/s, output: 65.65 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:06<00:13, 47.35it/s, est. speed input: 66695.11 toks/s, output: 65.13 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:06<00:13, 47.33it/s, est. speed input: 66198.48 toks/s, output: 64.65 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:06<00:12, 47.32it/s, est. speed input: 65727.68 toks/s, output: 64.19 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:06<00:12, 47.33it/s, est. speed input: 65283.12 toks/s, output: 63.75 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:06<00:12, 47.31it/s, est. speed input: 64859.08 toks/s, output: 63.34 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:06<00:12, 47.32it/s, est. speed input: 64456.76 toks/s, output: 62.95 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:07<00:12, 47.27it/s, est. speed input: 64069.17 toks/s, output: 62.57 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:07<00:12, 47.26it/s, est. speed input: 63701.04 toks/s, output: 62.21 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:07<00:11, 47.29it/s, est. speed input: 63354.69 toks/s, output: 61.87 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:07<00:11, 47.30it/s, est. speed input: 63021.74 toks/s, output: 61.54 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:07<00:11, 47.28it/s, est. speed input: 62701.57 toks/s, output: 61.23 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:07<00:11, 47.28it/s, est. speed input: 62395.48 toks/s, output: 60.93 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:08<00:11, 47.26it/s, est. speed input: 62100.92 toks/s, output: 60.65 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:08<00:11, 47.24it/s, est. speed input: 61818.31 toks/s, output: 60.37 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:08<00:10, 47.22it/s, est. speed input: 61545.86 toks/s, output: 60.10 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:08<00:10, 47.22it/s, est. speed input: 61285.49 toks/s, output: 59.85 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:08<00:10, 47.23it/s, est. speed input: 61036.58 toks/s, output: 59.61 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:08<00:10, 47.22it/s, est. speed input: 60794.64 toks/s, output: 59.37 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:09<00:10, 47.20it/s, est. speed input: 60561.34 toks/s, output: 59.14 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:09<00:10, 47.18it/s, est. speed input: 60335.97 toks/s, output: 58.92 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:09<00:09, 47.17it/s, est. speed input: 60119.67 toks/s, output: 58.71 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:09<00:09, 47.19it/s, est. speed input: 59911.95 toks/s, output: 58.51 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:09<00:09, 47.17it/s, est. speed input: 59709.88 toks/s, output: 58.31 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:09<00:09, 47.16it/s, est. speed input: 59514.79 toks/s, output: 58.12 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:10<00:09, 47.16it/s, est. speed input: 59326.48 toks/s, output: 57.94 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:10<00:09, 47.15it/s, est. speed input: 59143.54 toks/s, output: 57.76 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:10<00:08, 47.14it/s, est. speed input: 58966.74 toks/s, output: 57.58 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:10<00:08, 47.17it/s, est. speed input: 58797.51 toks/s, output: 57.42 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:10<00:08, 47.17it/s, est. speed input: 58632.51 toks/s, output: 57.26 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:10<00:08, 47.14it/s, est. speed input: 58471.04 toks/s, output: 57.10 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:11<00:08, 47.09it/s, est. speed input: 58312.60 toks/s, output: 56.95 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:11<00:08, 47.07it/s, est. speed input: 58159.39 toks/s, output: 56.80 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:11<00:07, 47.07it/s, est. speed input: 58011.73 toks/s, output: 56.65 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:11<00:07, 47.09it/s, est. speed input: 57869.72 toks/s, output: 56.51 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:11<00:07, 47.10it/s, est. speed input: 57731.52 toks/s, output: 56.38 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:11<00:07, 47.10it/s, est. speed input: 57596.78 toks/s, output: 56.25 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:12<00:07, 47.11it/s, est. speed input: 57466.28 toks/s, output: 56.12 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:12<00:07, 47.07it/s, est. speed input: 57337.31 toks/s, output: 55.99 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:12<00:06, 47.08it/s, est. speed input: 57213.21 toks/s, output: 55.87 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:12<00:06, 47.08it/s, est. speed input: 57092.54 toks/s, output: 55.75 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:12<00:06, 46.59it/s, est. speed input: 56948.38 toks/s, output: 55.61 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:13<00:06, 46.97it/s, est. speed input: 56846.92 toks/s, output: 55.51 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:13<00:06, 47.25it/s, est. speed input: 56747.92 toks/s, output: 55.42 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:13<00:06, 47.42it/s, est. speed input: 56650.50 toks/s, output: 55.32 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:13<00:05, 47.54it/s, est. speed input: 56555.59 toks/s, output: 55.23 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:13<00:05, 47.63it/s, est. speed input: 56462.76 toks/s, output: 55.14 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:13<00:05, 47.67it/s, est. speed input: 56371.66 toks/s, output: 55.05 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:14<00:05, 47.73it/s, est. speed input: 56283.84 toks/s, output: 54.96 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:14<00:05, 47.76it/s, est. speed input: 56197.77 toks/s, output: 54.88 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:14<00:04, 47.79it/s, est. speed input: 56114.00 toks/s, output: 54.80 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:14<00:04, 47.79it/s, est. speed input: 56031.30 toks/s, output: 54.72 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:14<00:04, 47.85it/s, est. speed input: 55952.77 toks/s, output: 54.64 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:14<00:04, 47.87it/s, est. speed input: 55875.27 toks/s, output: 54.57 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:15<00:04, 47.88it/s, est. speed input: 55799.47 toks/s, output: 54.49 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:15<00:04, 47.88it/s, est. speed input: 55725.08 toks/s, output: 54.42 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:15<00:03, 47.87it/s, est. speed input: 55651.54 toks/s, output: 54.35 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:15<00:03, 47.87it/s, est. speed input: 55580.14 toks/s, output: 54.28 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:15<00:03, 47.88it/s, est. speed input: 55510.77 toks/s, output: 54.21 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:15<00:03, 47.88it/s, est. speed input: 55442.29 toks/s, output: 54.14 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:16<00:03, 47.89it/s, est. speed input: 55375.94 toks/s, output: 54.08 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:16<00:03, 47.91it/s, est. speed input: 55311.24 toks/s, output: 54.01 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:16<00:02, 47.88it/s, est. speed input: 55246.06 toks/s, output: 53.95 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:16<00:02, 47.85it/s, est. speed input: 55182.02 toks/s, output: 53.89 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:16<00:02, 47.85it/s, est. speed input: 55120.28 toks/s, output: 53.83 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:16<00:02, 47.85it/s, est. speed input: 55059.23 toks/s, output: 53.77 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:17<00:02, 47.86it/s, est. speed input: 55000.09 toks/s, output: 53.71 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:17<00:02, 47.85it/s, est. speed input: 54941.52 toks/s, output: 53.65 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:17<00:01, 47.85it/s, est. speed input: 54884.27 toks/s, output: 53.60 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:17<00:01, 47.86it/s, est. speed input: 54828.57 toks/s, output: 53.54 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:17<00:01, 47.89it/s, est. speed input: 54774.40 toks/s, output: 53.49 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:17<00:01, 47.88it/s, est. speed input: 54720.58 toks/s, output: 53.44 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:18<00:01, 47.88it/s, est. speed input: 54667.64 toks/s, output: 53.39 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:18<00:01, 47.88it/s, est. speed input: 54615.73 toks/s, output: 53.34 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:18<00:00, 47.86it/s, est. speed input: 54564.26 toks/s, output: 53.29 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:18<00:00, 49.65it/s, est. speed input: 54573.33 toks/s, output: 53.29 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:18<00:00, 49.11it/s, est. speed input: 54523.86 toks/s, output: 53.25 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:18<00:00, 48.72it/s, est. speed input: 54474.58 toks/s, output: 53.20 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:19<00:00, 48.46it/s, est. speed input: 54426.46 toks/s, output: 53.15 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:19<00:00, 50.26it/s, est. speed input: 54441.02 toks/s, output: 53.17 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:19<00:00, 50.26it/s, est. speed input: 54761.26 toks/s, output: 53.48 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:19<00:00, 53.48it/s, est. speed input: 54761.26 toks/s, output: 53.48 toks/s]
[rank0]:[W128 11:47:23.681693195 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 69.1s

测试结果:
  Requests/s:   47.10
  Tokens/s:     48279.42
  Total Reqs:   1024
  Elapsed:      21.74s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     48232.31

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:47:45 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:47:46 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=31369) WARNING 01-28 11:47:52 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=31369) WARNING 01-28 11:48:04 [backends.py:609] Failed to read file <frozen os>
Throughput: 45.32 requests/s, 46451.95 total tokens/s, 45.32 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:47:45] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:47:45] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:47:45] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:47:45] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:45] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:45] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:45] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:45] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:45] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:47:45] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:47:45] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:47:45] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:47:45] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:47:45] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:47:52] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:47:52] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:47:52] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:47:52] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:52] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:52] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:52] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:52] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:47:52] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:47:52] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:47:52] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:47:52] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:47:52] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:47:52] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=31369) [2026-01-28 11:47:53] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=31369) [2026-01-28 11:47:53] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=31369) [2026-01-28 11:47:53] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=31369) [2026-01-28 11:47:53] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=31369) [2026-01-28 11:47:53] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=31369) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=31369) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.95it/s]
(EngineCore_DP0 pid=31369) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.95it/s]
(EngineCore_DP0 pid=31369) 
(EngineCore_DP0 pid=31369) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.63it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  7.86it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.06it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.09it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  7.57it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  7.76it/s]
(EngineCore_DP0 pid=31369) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  6.56it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  7.44it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  7.84it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  7.97it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.16it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  7.89it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 37/2048 [00:00<00:05, 367.21it/s]
Adding requests:   4%|▎         | 75/2048 [00:00<00:05, 374.69it/s]
Adding requests:   6%|▌         | 114/2048 [00:00<00:05, 379.71it/s]
Adding requests:   7%|▋         | 152/2048 [00:00<00:05, 377.95it/s]
Adding requests:   9%|▉         | 190/2048 [00:00<00:04, 377.39it/s]
Adding requests:  11%|█         | 229/2048 [00:00<00:04, 379.99it/s]
Adding requests:  13%|█▎        | 268/2048 [00:00<00:04, 380.29it/s]
Adding requests:  15%|█▍        | 307/2048 [00:00<00:04, 379.64it/s]
Adding requests:  17%|█▋        | 345/2048 [00:00<00:04, 377.97it/s]
Adding requests:  19%|█▊        | 383/2048 [00:01<00:04, 378.32it/s]
Adding requests:  21%|██        | 423/2048 [00:01<00:04, 384.26it/s]
Adding requests:  23%|██▎       | 462/2048 [00:01<00:04, 383.87it/s]
Adding requests:  24%|██▍       | 501/2048 [00:01<00:04, 381.62it/s]
Adding requests:  26%|██▋       | 540/2048 [00:01<00:04, 376.47it/s]
Adding requests:  28%|██▊       | 580/2048 [00:01<00:03, 381.82it/s]
Adding requests:  30%|███       | 619/2048 [00:01<00:03, 382.97it/s]
Adding requests:  32%|███▏      | 658/2048 [00:01<00:03, 382.67it/s]
Adding requests:  34%|███▍      | 697/2048 [00:01<00:03, 380.72it/s]
Adding requests:  36%|███▌      | 738/2048 [00:01<00:03, 386.88it/s]
Adding requests:  38%|███▊      | 777/2048 [00:02<00:03, 376.49it/s]
Adding requests:  40%|███▉      | 815/2048 [00:02<00:03, 376.92it/s]
Adding requests:  42%|████▏     | 853/2048 [00:02<00:03, 377.54it/s]
Adding requests:  44%|████▎     | 894/2048 [00:02<00:02, 386.90it/s]
Adding requests:  46%|████▌     | 934/2048 [00:02<00:02, 390.68it/s]
Adding requests:  48%|████▊     | 974/2048 [00:02<00:02, 392.14it/s]
Adding requests:  50%|████▉     | 1016/2048 [00:02<00:02, 397.91it/s]
Adding requests:  52%|█████▏    | 1056/2048 [00:02<00:02, 396.49it/s]
Adding requests:  54%|█████▎    | 1096/2048 [00:02<00:02, 395.69it/s]
Adding requests:  55%|█████▌    | 1136/2048 [00:02<00:02, 389.52it/s]
Adding requests:  58%|█████▊    | 1178/2048 [00:03<00:02, 396.65it/s]
Adding requests:  60%|█████▉    | 1220/2048 [00:03<00:02, 402.46it/s]
Adding requests:  62%|██████▏   | 1261/2048 [00:03<00:01, 397.05it/s]
Adding requests:  64%|██████▎   | 1302/2048 [00:03<00:01, 400.81it/s]
Adding requests:  66%|██████▌   | 1343/2048 [00:03<00:01, 402.44it/s]
Adding requests:  68%|██████▊   | 1384/2048 [00:03<00:01, 402.22it/s]
Adding requests:  70%|██████▉   | 1425/2048 [00:03<00:01, 404.36it/s]
Adding requests:  72%|███████▏  | 1467/2048 [00:03<00:01, 407.54it/s]
Adding requests:  74%|███████▎  | 1508/2048 [00:03<00:01, 405.10it/s]
Adding requests:  76%|███████▌  | 1549/2048 [00:03<00:01, 401.95it/s]
Adding requests:  78%|███████▊  | 1592/2048 [00:04<00:01, 408.26it/s]
Adding requests:  80%|███████▉  | 1633/2048 [00:04<00:01, 407.47it/s]
Adding requests:  82%|████████▏ | 1674/2048 [00:04<00:00, 404.37it/s]
Adding requests:  84%|████████▎ | 1715/2048 [00:04<00:00, 402.24it/s]
Adding requests:  86%|████████▌ | 1756/2048 [00:04<00:00, 399.61it/s]
Adding requests:  88%|████████▊ | 1796/2048 [00:04<00:00, 397.53it/s]
Adding requests:  90%|████████▉ | 1836/2048 [00:04<00:00, 394.66it/s]
Adding requests:  92%|█████████▏| 1877/2048 [00:04<00:00, 399.16it/s]
Adding requests:  94%|█████████▎| 1917/2048 [00:04<00:00, 385.36it/s]
Adding requests:  96%|█████████▌| 1957/2048 [00:05<00:00, 387.71it/s]
Adding requests:  98%|█████████▊| 1998/2048 [00:05<00:00, 393.04it/s]
Adding requests: 100%|█████████▉| 2038/2048 [00:05<00:00, 394.80it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 390.96it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  11%|█         | 226/2048 [00:00<00:02, 818.37it/s, est. speed input: 838096.67 toks/s, output: 818.40 toks/s]
Processed prompts:  15%|█▌        | 308/2048 [00:02<00:14, 123.64it/s, est. speed input: 155707.35 toks/s, output: 152.06 toks/s]
Processed prompts:  17%|█▋        | 345/2048 [00:02<00:17, 99.55it/s, est. speed input: 129581.84 toks/s, output: 126.54 toks/s] 
Processed prompts:  18%|█▊        | 368/2048 [00:03<00:18, 92.92it/s, est. speed input: 122474.10 toks/s, output: 119.60 toks/s]
Processed prompts:  19%|█▉        | 385/2048 [00:03<00:19, 83.25it/s, est. speed input: 115047.35 toks/s, output: 112.35 toks/s]
Processed prompts:  19%|█▉        | 398/2048 [00:03<00:22, 72.36it/s, est. speed input: 107942.10 toks/s, output: 105.41 toks/s]
Processed prompts:  20%|█▉        | 408/2048 [00:04<00:26, 61.33it/s, est. speed input: 101308.42 toks/s, output: 98.93 toks/s] 
Processed prompts:  20%|██        | 418/2048 [00:04<00:30, 52.68it/s, est. speed input: 95707.29 toks/s, output: 93.46 toks/s] 
Processed prompts:  21%|██        | 434/2048 [00:04<00:31, 50.82it/s, est. speed input: 92185.97 toks/s, output: 90.03 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:05<00:32, 49.43it/s, est. speed input: 89140.84 toks/s, output: 87.05 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:05<00:32, 48.41it/s, est. speed input: 86474.98 toks/s, output: 84.45 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:05<00:32, 47.67it/s, est. speed input: 84127.05 toks/s, output: 82.16 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:06<00:32, 47.13it/s, est. speed input: 82038.50 toks/s, output: 80.12 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:06<00:32, 46.79it/s, est. speed input: 80183.23 toks/s, output: 78.30 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:06<00:32, 46.47it/s, est. speed input: 78494.34 toks/s, output: 76.65 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:07<00:32, 46.27it/s, est. speed input: 76975.71 toks/s, output: 75.17 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:07<00:32, 46.13it/s, est. speed input: 75594.88 toks/s, output: 73.82 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:07<00:31, 46.02it/s, est. speed input: 74333.45 toks/s, output: 72.59 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:08<00:31, 45.93it/s, est. speed input: 73175.97 toks/s, output: 71.46 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:08<00:31, 45.87it/s, est. speed input: 72111.75 toks/s, output: 70.42 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:09<00:31, 45.84it/s, est. speed input: 71132.51 toks/s, output: 69.47 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:09<00:30, 45.80it/s, est. speed input: 70222.11 toks/s, output: 68.58 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:09<00:30, 45.78it/s, est. speed input: 69378.83 toks/s, output: 67.75 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:10<00:30, 45.77it/s, est. speed input: 68595.52 toks/s, output: 66.99 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:10<00:29, 45.75it/s, est. speed input: 67863.79 toks/s, output: 66.27 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:10<00:29, 45.74it/s, est. speed input: 67178.51 toks/s, output: 65.60 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:11<00:28, 45.73it/s, est. speed input: 66536.97 toks/s, output: 64.98 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:11<00:28, 45.73it/s, est. speed input: 65934.75 toks/s, output: 64.39 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:11<00:28, 45.65it/s, est. speed input: 65358.38 toks/s, output: 63.83 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:12<00:28, 45.60it/s, est. speed input: 64815.30 toks/s, output: 63.30 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:12<00:27, 45.55it/s, est. speed input: 64300.28 toks/s, output: 62.79 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:12<00:27, 45.53it/s, est. speed input: 63815.20 toks/s, output: 62.32 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:13<00:27, 45.50it/s, est. speed input: 63354.60 toks/s, output: 61.87 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:13<00:26, 45.49it/s, est. speed input: 62919.38 toks/s, output: 61.44 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:13<00:26, 45.49it/s, est. speed input: 62506.11 toks/s, output: 61.04 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:16<01:10, 16.76it/s, est. speed input: 54452.31 toks/s, output: 53.18 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:16<00:56, 20.68it/s, est. speed input: 54284.58 toks/s, output: 53.01 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:16<00:46, 24.72it/s, est. speed input: 54123.31 toks/s, output: 52.85 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:17<00:39, 28.64it/s, est. speed input: 53968.95 toks/s, output: 52.70 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:17<00:34, 32.21it/s, est. speed input: 53820.88 toks/s, output: 52.56 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:18<00:31, 35.29it/s, est. speed input: 53677.84 toks/s, output: 52.42 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:18<00:28, 37.82it/s, est. speed input: 53541.23 toks/s, output: 52.29 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:18<00:26, 40.44it/s, est. speed input: 53467.53 toks/s, output: 52.21 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:19<00:25, 41.82it/s, est. speed input: 53339.43 toks/s, output: 52.09 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:19<00:24, 42.84it/s, est. speed input: 53215.86 toks/s, output: 51.97 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:19<00:23, 43.58it/s, est. speed input: 53096.14 toks/s, output: 51.85 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:20<00:22, 44.12it/s, est. speed input: 52981.10 toks/s, output: 51.74 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:20<00:22, 44.50it/s, est. speed input: 52869.94 toks/s, output: 51.63 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:20<00:21, 44.76it/s, est. speed input: 52761.84 toks/s, output: 51.53 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:21<00:21, 44.96it/s, est. speed input: 52657.96 toks/s, output: 51.42 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:21<00:20, 45.09it/s, est. speed input: 52556.84 toks/s, output: 51.32 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:21<00:20, 45.16it/s, est. speed input: 52457.89 toks/s, output: 51.23 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:22<00:20, 45.21it/s, est. speed input: 52362.15 toks/s, output: 51.13 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:22<00:19, 46.04it/s, est. speed input: 52316.19 toks/s, output: 51.09 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:22<00:19, 45.83it/s, est. speed input: 52225.64 toks/s, output: 51.00 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:23<00:18, 45.67it/s, est. speed input: 52137.20 toks/s, output: 50.92 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:23<00:18, 45.56it/s, est. speed input: 52051.69 toks/s, output: 50.83 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:24<00:18, 45.48it/s, est. speed input: 51968.06 toks/s, output: 50.75 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:24<00:17, 45.42it/s, est. speed input: 51886.83 toks/s, output: 50.67 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:24<00:17, 45.39it/s, est. speed input: 51808.28 toks/s, output: 50.59 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:25<00:17, 45.36it/s, est. speed input: 51731.98 toks/s, output: 50.52 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:25<00:16, 45.34it/s, est. speed input: 51657.77 toks/s, output: 50.45 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:25<00:16, 45.33it/s, est. speed input: 51585.69 toks/s, output: 50.38 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:26<00:16, 45.34it/s, est. speed input: 51516.10 toks/s, output: 50.31 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:26<00:15, 45.33it/s, est. speed input: 51447.60 toks/s, output: 50.24 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:26<00:15, 45.32it/s, est. speed input: 51381.32 toks/s, output: 50.18 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:27<00:15, 45.32it/s, est. speed input: 51316.56 toks/s, output: 50.11 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:27<00:14, 45.32it/s, est. speed input: 51253.46 toks/s, output: 50.05 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:27<00:14, 45.30it/s, est. speed input: 51191.11 toks/s, output: 49.99 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:28<00:14, 45.29it/s, est. speed input: 51130.75 toks/s, output: 49.93 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:28<00:13, 45.28it/s, est. speed input: 51071.49 toks/s, output: 49.87 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:28<00:13, 45.31it/s, est. speed input: 51015.41 toks/s, output: 49.82 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:29<00:13, 45.28it/s, est. speed input: 50958.18 toks/s, output: 49.76 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:29<00:12, 45.28it/s, est. speed input: 50903.77 toks/s, output: 49.71 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:30<00:12, 45.29it/s, est. speed input: 50850.49 toks/s, output: 49.66 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:30<00:11, 45.30it/s, est. speed input: 50798.85 toks/s, output: 49.61 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:30<00:11, 45.30it/s, est. speed input: 50748.39 toks/s, output: 49.56 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:31<00:11, 45.31it/s, est. speed input: 50698.97 toks/s, output: 49.51 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:31<00:10, 45.32it/s, est. speed input: 50651.08 toks/s, output: 49.46 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:31<00:10, 45.34it/s, est. speed input: 50604.90 toks/s, output: 49.42 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:32<00:10, 45.33it/s, est. speed input: 50558.62 toks/s, output: 49.37 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:32<00:09, 45.31it/s, est. speed input: 50512.86 toks/s, output: 49.33 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:32<00:09, 45.32it/s, est. speed input: 50468.78 toks/s, output: 49.29 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:33<00:09, 45.32it/s, est. speed input: 50425.74 toks/s, output: 49.24 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:33<00:08, 45.32it/s, est. speed input: 50383.55 toks/s, output: 49.20 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:33<00:08, 45.32it/s, est. speed input: 50342.19 toks/s, output: 49.16 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:34<00:08, 45.32it/s, est. speed input: 50301.55 toks/s, output: 49.12 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:34<00:07, 45.32it/s, est. speed input: 50261.77 toks/s, output: 49.08 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:34<00:07, 45.32it/s, est. speed input: 50222.81 toks/s, output: 49.05 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:35<00:07, 45.31it/s, est. speed input: 50184.14 toks/s, output: 49.01 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:35<00:06, 45.32it/s, est. speed input: 50146.93 toks/s, output: 48.97 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:36<00:06, 45.32it/s, est. speed input: 50110.26 toks/s, output: 48.94 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:36<00:05, 45.32it/s, est. speed input: 50074.40 toks/s, output: 48.90 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:36<00:05, 45.32it/s, est. speed input: 50039.21 toks/s, output: 48.87 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:37<00:05, 45.33it/s, est. speed input: 50004.97 toks/s, output: 48.83 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:37<00:04, 45.34it/s, est. speed input: 49971.52 toks/s, output: 48.80 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:37<00:04, 45.34it/s, est. speed input: 49938.34 toks/s, output: 48.77 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:38<00:04, 45.34it/s, est. speed input: 49906.03 toks/s, output: 48.74 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:38<00:03, 46.14it/s, est. speed input: 49900.50 toks/s, output: 48.73 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:38<00:03, 45.91it/s, est. speed input: 49869.28 toks/s, output: 48.70 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:39<00:03, 45.74it/s, est. speed input: 49838.38 toks/s, output: 48.67 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:39<00:02, 45.63it/s, est. speed input: 49808.27 toks/s, output: 48.64 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:39<00:02, 45.55it/s, est. speed input: 49778.61 toks/s, output: 48.61 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:40<00:02, 45.50it/s, est. speed input: 49749.51 toks/s, output: 48.58 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:40<00:01, 45.46it/s, est. speed input: 49720.97 toks/s, output: 48.56 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:40<00:01, 45.43it/s, est. speed input: 49692.88 toks/s, output: 48.53 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:41<00:01, 45.42it/s, est. speed input: 49665.47 toks/s, output: 48.50 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:41<00:00, 45.43it/s, est. speed input: 49639.04 toks/s, output: 48.48 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:41<00:00, 46.35it/s, est. speed input: 49640.32 toks/s, output: 48.48 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:41<00:00, 46.35it/s, est. speed input: 49981.56 toks/s, output: 48.81 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:41<00:00, 48.81it/s, est. speed input: 49981.56 toks/s, output: 48.81 toks/s]
[rank0]:[W128 11:49:04.875174827 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 101.1s

测试结果:
  Requests/s:   45.32
  Tokens/s:     46451.95
  Total Reqs:   2048
  Elapsed:      45.19s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     46406.63

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:49:36 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:49:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=32301) WARNING 01-28 11:49:54 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=32301) WARNING 01-28 11:50:04 [backends.py:609] Failed to read file <frozen os>
Throughput: 45.07 requests/s, 46199.36 total tokens/s, 45.07 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:49:36] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:49:36] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:49:36] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:49:36] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:36] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:36] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:36] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:36] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:36] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:49:36] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:49:36] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:49:36] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:49:36] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:49:36] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:49:43] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:49:43] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:49:43] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:49:43] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:43] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:43] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:43] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:43] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:49:43] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:49:43] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:49:43] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:49:43] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:49:43] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:49:43] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 11:49:54.617076893 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=32301) [2026-01-28 11:49:55] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=32301) [2026-01-28 11:49:55] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=32301) [2026-01-28 11:49:55] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=32301) [2026-01-28 11:49:55] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=32301) [2026-01-28 11:49:55] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=32301) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=32301) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=32301) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=32301) 
(EngineCore_DP0 pid=32301) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.40it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  7.39it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:01,  7.70it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  7.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  7.88it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  7.90it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.04it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:01<00:00,  8.05it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  7.98it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.02it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  7.55it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  7.77it/s]
(EngineCore_DP0 pid=32301) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  6.88it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  7.51it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  7.86it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  7.94it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.13it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  8.23it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.27it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.04it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 35/4096 [00:00<00:11, 346.28it/s]
Adding requests:   2%|▏         | 72/4096 [00:00<00:11, 358.00it/s]
Adding requests:   3%|▎         | 109/4096 [00:00<00:11, 362.40it/s]
Adding requests:   4%|▎         | 147/4096 [00:00<00:10, 366.55it/s]
Adding requests:   4%|▍         | 184/4096 [00:00<00:10, 364.98it/s]
Adding requests:   5%|▌         | 223/4096 [00:00<00:10, 372.16it/s]
Adding requests:   6%|▋         | 263/4096 [00:00<00:10, 380.59it/s]
Adding requests:   7%|▋         | 302/4096 [00:00<00:10, 377.12it/s]
Adding requests:   8%|▊         | 341/4096 [00:00<00:09, 379.74it/s]
Adding requests:   9%|▉         | 381/4096 [00:01<00:09, 383.01it/s]
Adding requests:  10%|█         | 420/4096 [00:01<00:09, 385.00it/s]
Adding requests:  11%|█         | 459/4096 [00:01<00:09, 384.70it/s]
Adding requests:  12%|█▏        | 498/4096 [00:01<00:09, 385.50it/s]
Adding requests:  13%|█▎        | 537/4096 [00:01<00:09, 376.39it/s]
Adding requests:  14%|█▍        | 579/4096 [00:01<00:09, 386.75it/s]
Adding requests:  15%|█▌        | 620/4096 [00:01<00:08, 390.76it/s]
Adding requests:  16%|█▌        | 660/4096 [00:01<00:08, 391.63it/s]
Adding requests:  17%|█▋        | 702/4096 [00:01<00:08, 397.79it/s]
Adding requests:  18%|█▊        | 742/4096 [00:01<00:08, 397.13it/s]
Adding requests:  19%|█▉        | 782/4096 [00:02<00:08, 397.26it/s]
Adding requests:  20%|██        | 822/4096 [00:02<00:08, 384.08it/s]
Adding requests:  21%|██        | 862/4096 [00:02<00:08, 387.64it/s]
Adding requests:  22%|██▏       | 901/4096 [00:02<00:08, 388.28it/s]
Adding requests:  23%|██▎       | 940/4096 [00:02<00:08, 388.51it/s]
Adding requests:  24%|██▍       | 980/4096 [00:02<00:07, 391.69it/s]
Adding requests:  25%|██▍       | 1020/4096 [00:02<00:07, 386.38it/s]
Adding requests:  26%|██▌       | 1061/4096 [00:02<00:07, 393.10it/s]
Adding requests:  27%|██▋       | 1101/4096 [00:04<00:53, 55.74it/s] 
Adding requests:  28%|██▊       | 1141/4096 [00:05<00:39, 75.01it/s]
Adding requests:  29%|██▉       | 1182/4096 [00:05<00:29, 99.77it/s]
Adding requests:  30%|██▉       | 1223/4096 [00:05<00:22, 129.32it/s]
Adding requests:  31%|███       | 1261/4096 [00:05<00:17, 158.98it/s]
Adding requests:  32%|███▏      | 1301/4096 [00:05<00:14, 193.61it/s]
Adding requests:  33%|███▎      | 1343/4096 [00:05<00:11, 232.47it/s]
Adding requests:  34%|███▍      | 1384/4096 [00:05<00:10, 266.82it/s]
Adding requests:  35%|███▍      | 1426/4096 [00:05<00:08, 299.00it/s]
Adding requests:  36%|███▌      | 1468/4096 [00:05<00:08, 326.80it/s]
Adding requests:  37%|███▋      | 1509/4096 [00:05<00:07, 346.95it/s]
Adding requests:  38%|███▊      | 1550/4096 [00:06<00:07, 363.19it/s]
Adding requests:  39%|███▉      | 1592/4096 [00:06<00:06, 377.90it/s]
Adding requests:  40%|███▉      | 1633/4096 [00:06<00:06, 385.79it/s]
Adding requests:  41%|████      | 1674/4096 [00:06<00:06, 387.09it/s]
Adding requests:  42%|████▏     | 1715/4096 [00:06<00:06, 392.49it/s]
Adding requests:  43%|████▎     | 1756/4096 [00:06<00:05, 394.59it/s]
Adding requests:  44%|████▍     | 1797/4096 [00:06<00:05, 396.32it/s]
Adding requests:  45%|████▍     | 1838/4096 [00:06<00:05, 399.97it/s]
Adding requests:  46%|████▌     | 1879/4096 [00:06<00:05, 401.90it/s]
Adding requests:  47%|████▋     | 1920/4096 [00:06<00:05, 399.96it/s]
Adding requests:  48%|████▊     | 1961/4096 [00:07<00:05, 400.57it/s]
Adding requests:  49%|████▉     | 2003/4096 [00:07<00:05, 404.58it/s]
Adding requests:  50%|████▉     | 2044/4096 [00:07<00:05, 403.31it/s]
Adding requests:  51%|█████     | 2085/4096 [00:07<00:04, 402.61it/s]
Adding requests:  52%|█████▏    | 2126/4096 [00:07<00:04, 402.21it/s]
Adding requests:  53%|█████▎    | 2167/4096 [00:07<00:04, 400.67it/s]
Adding requests:  54%|█████▍    | 2208/4096 [00:07<00:04, 384.35it/s]
Adding requests:  55%|█████▍    | 2251/4096 [00:07<00:04, 395.86it/s]
Adding requests:  56%|█████▌    | 2291/4096 [00:07<00:04, 395.09it/s]
Adding requests:  57%|█████▋    | 2331/4096 [00:07<00:04, 390.58it/s]
Adding requests:  58%|█████▊    | 2371/4096 [00:08<00:04, 390.54it/s]
Adding requests:  59%|█████▉    | 2411/4096 [00:08<00:04, 385.37it/s]
Adding requests:  60%|█████▉    | 2451/4096 [00:08<00:04, 388.71it/s]
Adding requests:  61%|██████    | 2493/4096 [00:08<00:04, 394.45it/s]
Adding requests:  62%|██████▏   | 2534/4096 [00:08<00:03, 398.17it/s]
Adding requests:  63%|██████▎   | 2575/4096 [00:08<00:03, 400.41it/s]
Adding requests:  64%|██████▍   | 2616/4096 [00:08<00:03, 399.03it/s]
Adding requests:  65%|██████▍   | 2657/4096 [00:08<00:03, 401.95it/s]
Adding requests:  66%|██████▌   | 2698/4096 [00:08<00:03, 397.98it/s]
Adding requests:  67%|██████▋   | 2738/4096 [00:09<00:03, 395.34it/s]
Adding requests:  68%|██████▊   | 2778/4096 [00:09<00:03, 396.18it/s]
Adding requests:  69%|██████▉   | 2818/4096 [00:09<00:03, 395.95it/s]
Adding requests:  70%|██████▉   | 2858/4096 [00:09<00:03, 396.24it/s]
Adding requests:  71%|███████   | 2898/4096 [00:09<00:03, 396.85it/s]
Adding requests:  72%|███████▏  | 2938/4096 [00:09<00:02, 390.34it/s]
Adding requests:  73%|███████▎  | 2979/4096 [00:09<00:02, 395.34it/s]
Adding requests:  74%|███████▎  | 3019/4096 [00:09<00:02, 396.42it/s]
Adding requests:  75%|███████▍  | 3059/4096 [00:09<00:02, 397.33it/s]
Adding requests:  76%|███████▌  | 3099/4096 [00:09<00:02, 392.00it/s]
Adding requests:  77%|███████▋  | 3139/4096 [00:10<00:02, 393.54it/s]
Adding requests:  78%|███████▊  | 3179/4096 [00:10<00:02, 394.91it/s]
Adding requests:  79%|███████▊  | 3219/4096 [00:10<00:02, 393.63it/s]
Adding requests:  80%|███████▉  | 3259/4096 [00:10<00:02, 395.24it/s]
Adding requests:  81%|████████  | 3299/4096 [00:10<00:02, 393.64it/s]
Adding requests:  82%|████████▏ | 3339/4096 [00:10<00:01, 393.70it/s]
Adding requests:  83%|████████▎ | 3380/4096 [00:10<00:01, 397.90it/s]
Adding requests:  83%|████████▎ | 3420/4096 [00:10<00:01, 397.22it/s]
Adding requests:  84%|████████▍ | 3460/4096 [00:10<00:01, 387.23it/s]
Adding requests:  85%|████████▌ | 3499/4096 [00:10<00:01, 385.98it/s]
Adding requests:  86%|████████▋ | 3538/4096 [00:11<00:01, 370.96it/s]
Adding requests:  87%|████████▋ | 3579/4096 [00:11<00:01, 380.06it/s]
Adding requests:  88%|████████▊ | 3619/4096 [00:11<00:01, 382.26it/s]
Adding requests:  89%|████████▉ | 3658/4096 [00:11<00:01, 382.51it/s]
Adding requests:  90%|█████████ | 3699/4096 [00:11<00:01, 389.45it/s]
Adding requests:  91%|█████████▏| 3739/4096 [00:11<00:00, 389.12it/s]
Adding requests:  92%|█████████▏| 3781/4096 [00:11<00:00, 397.06it/s]
Adding requests:  93%|█████████▎| 3821/4096 [00:11<00:00, 397.29it/s]
Adding requests:  94%|█████████▍| 3863/4096 [00:11<00:00, 403.51it/s]
Adding requests:  95%|█████████▌| 3904/4096 [00:11<00:00, 399.78it/s]
Adding requests:  96%|█████████▋| 3945/4096 [00:12<00:00, 401.34it/s]
Adding requests:  97%|█████████▋| 3986/4096 [00:12<00:00, 397.97it/s]
Adding requests:  98%|█████████▊| 4026/4096 [00:12<00:00, 396.89it/s]
Adding requests:  99%|█████████▉| 4066/4096 [00:12<00:00, 389.22it/s]
Adding requests: 100%|██████████| 4096/4096 [00:12<00:00, 328.22it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  11%|█         | 450/4096 [00:00<00:03, 1160.64it/s, est. speed input: 1188572.45 toks/s, output: 1160.66 toks/s]
Processed prompts:  14%|█▍        | 567/4096 [00:02<00:19, 180.79it/s, est. speed input: 231704.98 toks/s, output: 226.27 toks/s]   
Processed prompts:  15%|█▌        | 619/4096 [00:03<00:30, 114.81it/s, est. speed input: 161701.96 toks/s, output: 157.91 toks/s]
Processed prompts:  16%|█▌        | 649/4096 [00:04<00:35, 96.95it/s, est. speed input: 143611.62 toks/s, output: 140.25 toks/s] 
Processed prompts:  16%|█▋        | 674/4096 [00:05<00:42, 80.90it/s, est. speed input: 129367.87 toks/s, output: 126.34 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:06<00:47, 71.20it/s, est. speed input: 119631.31 toks/s, output: 116.83 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:06<00:52, 63.93it/s, est. speed input: 111935.96 toks/s, output: 109.31 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:07<00:56, 58.57it/s, est. speed input: 105692.15 toks/s, output: 103.21 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:08<01:00, 54.68it/s, est. speed input: 100532.60 toks/s, output: 98.18 toks/s] 
Processed prompts:  20%|██        | 834/4096 [00:08<01:02, 51.88it/s, est. speed input: 96191.98 toks/s, output: 93.94 toks/s] 
Processed prompts:  21%|██        | 866/4096 [00:09<01:04, 49.92it/s, est. speed input: 92511.51 toks/s, output: 90.34 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:10<01:06, 48.44it/s, est. speed input: 89295.63 toks/s, output: 87.20 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:11<01:06, 47.42it/s, est. speed input: 86507.36 toks/s, output: 84.48 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:11<01:06, 47.09it/s, est. speed input: 84197.42 toks/s, output: 82.22 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:12<01:06, 46.48it/s, est. speed input: 82017.88 toks/s, output: 80.10 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:13<01:06, 46.04it/s, est. speed input: 80072.32 toks/s, output: 78.20 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:13<01:06, 45.73it/s, est. speed input: 78325.21 toks/s, output: 76.49 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:14<01:06, 45.51it/s, est. speed input: 76748.39 toks/s, output: 74.95 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:15<01:05, 45.36it/s, est. speed input: 75319.28 toks/s, output: 73.55 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:15<01:04, 45.62it/s, est. speed input: 74106.32 toks/s, output: 72.37 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:16<01:04, 45.43it/s, est. speed input: 72909.87 toks/s, output: 71.20 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:17<01:03, 45.30it/s, est. speed input: 71809.83 toks/s, output: 70.13 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:18<01:02, 45.21it/s, est. speed input: 70797.96 toks/s, output: 69.14 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:18<01:02, 45.14it/s, est. speed input: 69860.68 toks/s, output: 68.22 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:19<01:01, 45.09it/s, est. speed input: 68993.15 toks/s, output: 67.38 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:20<01:01, 45.06it/s, est. speed input: 68186.71 toks/s, output: 66.59 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:20<01:00, 45.04it/s, est. speed input: 67434.37 toks/s, output: 65.85 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:21<00:59, 45.03it/s, est. speed input: 66732.63 toks/s, output: 65.17 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:22<00:58, 45.02it/s, est. speed input: 66075.13 toks/s, output: 64.53 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:23<00:58, 45.01it/s, est. speed input: 65458.19 toks/s, output: 63.92 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:23<00:57, 45.01it/s, est. speed input: 64878.28 toks/s, output: 63.36 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:24<00:56, 45.00it/s, est. speed input: 64331.66 toks/s, output: 62.82 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:27<01:44, 24.08it/s, est. speed input: 58995.73 toks/s, output: 57.61 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:27<01:29, 27.99it/s, est. speed input: 58668.36 toks/s, output: 57.29 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:28<01:17, 31.58it/s, est. speed input: 58357.51 toks/s, output: 56.99 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:29<01:10, 34.69it/s, est. speed input: 58062.32 toks/s, output: 56.70 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:30<01:04, 37.27it/s, est. speed input: 57781.61 toks/s, output: 56.43 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:30<01:00, 39.30it/s, est. speed input: 57512.86 toks/s, output: 56.16 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:31<00:57, 40.86it/s, est. speed input: 57255.59 toks/s, output: 55.91 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:32<00:54, 42.04it/s, est. speed input: 57010.98 toks/s, output: 55.67 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:32<00:52, 42.91it/s, est. speed input: 56777.31 toks/s, output: 55.45 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:33<00:50, 43.88it/s, est. speed input: 56585.64 toks/s, output: 55.26 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:34<00:49, 44.25it/s, est. speed input: 56371.06 toks/s, output: 55.05 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:35<00:48, 44.50it/s, est. speed input: 56164.94 toks/s, output: 54.85 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:35<00:47, 44.68it/s, est. speed input: 55966.56 toks/s, output: 54.65 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:36<00:47, 44.80it/s, est. speed input: 55775.83 toks/s, output: 54.47 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:37<00:46, 44.89it/s, est. speed input: 55592.47 toks/s, output: 54.29 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:37<00:45, 44.95it/s, est. speed input: 55416.10 toks/s, output: 54.12 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:38<00:44, 44.99it/s, est. speed input: 55246.26 toks/s, output: 53.95 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:39<00:44, 45.02it/s, est. speed input: 55082.60 toks/s, output: 53.79 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:40<00:43, 45.05it/s, est. speed input: 54924.66 toks/s, output: 53.64 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:40<00:42, 45.06it/s, est. speed input: 54772.08 toks/s, output: 53.49 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:41<00:41, 45.07it/s, est. speed input: 54624.78 toks/s, output: 53.34 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:42<00:41, 45.07it/s, est. speed input: 54482.17 toks/s, output: 53.21 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:42<00:40, 45.45it/s, est. speed input: 54368.97 toks/s, output: 53.09 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:43<00:39, 45.34it/s, est. speed input: 54235.42 toks/s, output: 52.96 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:44<00:38, 45.27it/s, est. speed input: 54106.32 toks/s, output: 52.84 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:44<00:38, 45.21it/s, est. speed input: 53980.90 toks/s, output: 52.72 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:45<00:37, 45.17it/s, est. speed input: 53859.26 toks/s, output: 52.60 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:46<00:36, 45.14it/s, est. speed input: 53741.44 toks/s, output: 52.48 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:47<00:36, 45.13it/s, est. speed input: 53627.39 toks/s, output: 52.37 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:47<00:35, 45.48it/s, est. speed input: 53538.04 toks/s, output: 52.28 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:48<00:34, 45.35it/s, est. speed input: 53429.63 toks/s, output: 52.18 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:49<00:33, 45.27it/s, est. speed input: 53324.43 toks/s, output: 52.07 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:49<00:33, 45.21it/s, est. speed input: 53222.65 toks/s, output: 51.98 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:50<00:32, 45.21it/s, est. speed input: 53125.48 toks/s, output: 51.88 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:51<00:31, 45.13it/s, est. speed input: 53027.17 toks/s, output: 51.78 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:52<00:31, 45.11it/s, est. speed input: 52933.15 toks/s, output: 51.69 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:52<00:30, 45.10it/s, est. speed input: 52842.18 toks/s, output: 51.60 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:53<00:29, 45.10it/s, est. speed input: 52753.79 toks/s, output: 51.52 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:54<00:29, 45.09it/s, est. speed input: 52667.36 toks/s, output: 51.43 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:54<00:28, 45.09it/s, est. speed input: 52583.18 toks/s, output: 51.35 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:55<00:27, 45.08it/s, est. speed input: 52500.85 toks/s, output: 51.27 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:56<00:26, 45.08it/s, est. speed input: 52420.74 toks/s, output: 51.19 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:57<00:26, 45.07it/s, est. speed input: 52342.52 toks/s, output: 51.12 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:57<00:25, 45.07it/s, est. speed input: 52266.31 toks/s, output: 51.04 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:58<00:24, 45.07it/s, est. speed input: 52192.02 toks/s, output: 50.97 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:59<00:24, 45.07it/s, est. speed input: 52119.53 toks/s, output: 50.90 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [01:01<00:43, 24.10it/s, est. speed input: 50316.94 toks/s, output: 49.14 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [01:02<00:36, 28.01it/s, est. speed input: 50269.92 toks/s, output: 49.09 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [01:03<00:31, 31.60it/s, est. speed input: 50223.96 toks/s, output: 49.05 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [01:04<00:27, 34.71it/s, est. speed input: 50178.97 toks/s, output: 49.00 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [01:04<00:24, 37.28it/s, est. speed input: 50134.60 toks/s, output: 48.96 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [01:05<00:22, 39.31it/s, est. speed input: 50091.02 toks/s, output: 48.92 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [01:06<00:21, 40.88it/s, est. speed input: 50048.58 toks/s, output: 48.88 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [01:06<00:19, 42.04it/s, est. speed input: 50006.81 toks/s, output: 48.83 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [01:07<00:18, 42.90it/s, est. speed input: 49966.00 toks/s, output: 48.79 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [01:08<00:17, 43.52it/s, est. speed input: 49926.10 toks/s, output: 48.76 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [01:09<00:16, 43.97it/s, est. speed input: 49887.18 toks/s, output: 48.72 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [01:09<00:15, 44.29it/s, est. speed input: 49849.03 toks/s, output: 48.68 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [01:10<00:15, 44.51it/s, est. speed input: 49811.27 toks/s, output: 48.64 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:11<00:14, 44.67it/s, est. speed input: 49774.29 toks/s, output: 48.61 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:11<00:13, 44.78it/s, est. speed input: 49738.19 toks/s, output: 48.57 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:12<00:12, 44.85it/s, est. speed input: 49702.65 toks/s, output: 48.54 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:13<00:12, 44.93it/s, est. speed input: 49668.57 toks/s, output: 48.50 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:13<00:11, 44.98it/s, est. speed input: 49635.02 toks/s, output: 48.47 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:14<00:10, 45.01it/s, est. speed input: 49602.27 toks/s, output: 48.44 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:15<00:09, 45.04it/s, est. speed input: 49570.05 toks/s, output: 48.41 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:16<00:09, 45.05it/s, est. speed input: 49538.21 toks/s, output: 48.38 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:16<00:08, 45.42it/s, est. speed input: 49519.29 toks/s, output: 48.36 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:17<00:07, 45.33it/s, est. speed input: 49488.72 toks/s, output: 48.33 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:18<00:07, 45.26it/s, est. speed input: 49458.69 toks/s, output: 48.30 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:18<00:06, 45.21it/s, est. speed input: 49429.21 toks/s, output: 48.27 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:19<00:05, 45.17it/s, est. speed input: 49400.00 toks/s, output: 48.24 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:20<00:04, 45.14it/s, est. speed input: 49371.25 toks/s, output: 48.21 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:21<00:04, 45.11it/s, est. speed input: 49342.70 toks/s, output: 48.19 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:21<00:03, 45.10it/s, est. speed input: 49315.07 toks/s, output: 48.16 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:22<00:02, 45.08it/s, est. speed input: 49287.41 toks/s, output: 48.13 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:23<00:02, 45.06it/s, est. speed input: 49260.16 toks/s, output: 48.11 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:23<00:01, 45.42it/s, est. speed input: 49244.78 toks/s, output: 48.09 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:24<00:00, 45.82it/s, est. speed input: 49233.92 toks/s, output: 48.08 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:24<00:00, 45.82it/s, est. speed input: 49596.89 toks/s, output: 48.43 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:24<00:00, 48.43it/s, est. speed input: 49596.89 toks/s, output: 48.43 toks/s]
[rank0]:[W128 11:51:54.789861051 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 170.3s

测试结果:
  Requests/s:   45.07
  Tokens/s:     46199.36
  Total Reqs:   4096
  Elapsed:      90.88s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     46154.29


------------------------------------------------------------
  生成 CSV: BitNet-2B-FP8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cublaslt/BitNet-2B-FP8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,15.7209,8064.8010,8.1420
1024,1024,1,128,128,15.6381,16029.0405,8.1851
2048,1024,2,256,128,30.4181,31178.5197,8.4161
4096,1024,4,512,128,45.0095,46134.7605,11.3754
8192,1024,8,1024,128,47.1019,48279.4158,21.7401
16384,1024,16,2048,128,45.3190,46451.9465,45.1908
32768,1024,32,4096,128,45.0725,46199.3590,90.8757

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-FP8 | cuSPARSELt (2_4) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-FP8-SlideSparse-2_4
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_4

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:52:06 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:52:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=33488) WARNING 01-28 11:52:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=33488) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=33488) WARNING 01-28 11:52:25 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.43 requests/s, 8429.96 total tokens/s, 16.43 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:52:06] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:52:06] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:52:06] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:52:06] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:06] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:06] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:06] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:06] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:06] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:52:06] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:52:06] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:52:06] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:52:06] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:52:06] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:52:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:52:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:52:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:52:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:52:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:52:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:52:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:52:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:52:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:14] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:14] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:14] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:14] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:14] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:14] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=33488) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=33488) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.15s/it]
(EngineCore_DP0 pid=33488) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.15s/it]
(EngineCore_DP0 pid=33488) 
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=33488) [2026-01-28 11:52:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=33488) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  6.23it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.14it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  6.98it/s]
(EngineCore_DP0 pid=33488) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.43it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.42it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  51%|█████     | 65/128 [00:00<00:00, 648.04it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 673.31it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 36.32it/s, est. speed input: 18597.80 toks/s, output: 36.32 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:05, 21.55it/s, est. speed input: 11751.44 toks/s, output: 22.95 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:06, 19.44it/s, est. speed input: 10691.45 toks/s, output: 20.88 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:06, 18.34it/s, est. speed input: 10134.72 toks/s, output: 19.79 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 17.87it/s, est. speed input: 9897.28 toks/s, output: 19.33 toks/s] 
Processed prompts:  14%|█▍        | 18/128 [00:00<00:06, 17.55it/s, est. speed input: 9729.68 toks/s, output: 19.00 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 17.31it/s, est. speed input: 9598.61 toks/s, output: 18.75 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.07it/s, est. speed input: 9479.36 toks/s, output: 18.51 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.89it/s, est. speed input: 9382.64 toks/s, output: 18.33 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.80it/s, est. speed input: 9307.65 toks/s, output: 18.18 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:05, 16.76it/s, est. speed input: 9246.98 toks/s, output: 18.06 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.72it/s, est. speed input: 9194.85 toks/s, output: 17.96 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:03<00:35,  2.73it/s, est. speed input: 4252.63 toks/s, output: 8.31 toks/s] 
Processed prompts:  27%|██▋       | 34/128 [00:03<00:25,  3.64it/s, est. speed input: 4381.02 toks/s, output: 8.56 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:04<00:19,  4.74it/s, est. speed input: 4502.71 toks/s, output: 8.79 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:04<00:14,  6.04it/s, est. speed input: 4618.21 toks/s, output: 9.02 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:04<00:11,  7.47it/s, est. speed input: 4727.42 toks/s, output: 9.23 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:04<00:09,  8.96it/s, est. speed input: 4831.07 toks/s, output: 9.44 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:04<00:08, 10.41it/s, est. speed input: 4929.22 toks/s, output: 9.63 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:04<00:06, 11.75it/s, est. speed input: 5022.27 toks/s, output: 9.81 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:04<00:06, 12.90it/s, est. speed input: 5110.47 toks/s, output: 9.98 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:04<00:05, 13.82it/s, est. speed input: 5193.07 toks/s, output: 10.14 toks/s]
Processed prompts:  41%|████      | 52/128 [00:05<00:05, 14.52it/s, est. speed input: 5270.91 toks/s, output: 10.29 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:05<00:04, 15.14it/s, est. speed input: 5347.75 toks/s, output: 10.44 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:05<00:04, 15.61it/s, est. speed input: 5421.21 toks/s, output: 10.59 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:05<00:04, 15.98it/s, est. speed input: 5491.93 toks/s, output: 10.73 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:05<00:04, 16.17it/s, est. speed input: 5557.68 toks/s, output: 10.85 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:05<00:04, 16.34it/s, est. speed input: 5621.54 toks/s, output: 10.98 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:05<00:03, 16.47it/s, est. speed input: 5682.95 toks/s, output: 11.10 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:05<00:03, 16.60it/s, est. speed input: 5742.79 toks/s, output: 11.22 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:06<00:03, 16.67it/s, est. speed input: 5799.69 toks/s, output: 11.33 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:06<00:03, 16.49it/s, est. speed input: 5849.22 toks/s, output: 11.42 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:06<00:03, 16.54it/s, est. speed input: 5900.65 toks/s, output: 11.52 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:06<00:03, 16.61it/s, est. speed input: 5950.94 toks/s, output: 11.62 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:06<00:03, 16.63it/s, est. speed input: 5998.78 toks/s, output: 11.72 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:06<00:03, 16.56it/s, est. speed input: 6043.14 toks/s, output: 11.80 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:06<00:02, 16.57it/s, est. speed input: 6087.07 toks/s, output: 11.89 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:06<00:02, 16.57it/s, est. speed input: 6129.37 toks/s, output: 11.97 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:06<00:02, 16.50it/s, est. speed input: 6168.47 toks/s, output: 12.05 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:07<00:02, 16.51it/s, est. speed input: 6207.70 toks/s, output: 12.12 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:07<00:02, 16.52it/s, est. speed input: 6245.71 toks/s, output: 12.20 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:07<00:02, 16.54it/s, est. speed input: 6282.56 toks/s, output: 12.27 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:07<00:02, 16.56it/s, est. speed input: 6318.35 toks/s, output: 12.34 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:07<00:02, 16.55it/s, est. speed input: 6352.62 toks/s, output: 12.41 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:07<00:01, 16.57it/s, est. speed input: 6386.43 toks/s, output: 12.47 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:07<00:01, 16.65it/s, est. speed input: 6420.27 toks/s, output: 12.54 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:07<00:01, 16.68it/s, est. speed input: 6452.81 toks/s, output: 12.60 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:08<00:01, 16.72it/s, est. speed input: 6484.66 toks/s, output: 12.67 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:08<00:01, 16.77it/s, est. speed input: 6515.99 toks/s, output: 12.73 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:08<00:01, 16.70it/s, est. speed input: 6544.51 toks/s, output: 12.78 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:08<00:01, 16.58it/s, est. speed input: 6570.69 toks/s, output: 12.83 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:08<00:01, 16.52it/s, est. speed input: 6596.80 toks/s, output: 12.88 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:08<00:00, 16.39it/s, est. speed input: 6620.25 toks/s, output: 12.93 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:08<00:00, 16.33it/s, est. speed input: 6643.86 toks/s, output: 12.98 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:08<00:00, 16.28it/s, est. speed input: 6666.53 toks/s, output: 13.02 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:09<00:00, 16.24it/s, est. speed input: 6688.53 toks/s, output: 13.06 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:09<00:00, 16.21it/s, est. speed input: 6709.80 toks/s, output: 13.11 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:09<00:00, 16.16it/s, est. speed input: 6729.95 toks/s, output: 13.14 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:09<00:00, 16.07it/s, est. speed input: 6748.71 toks/s, output: 13.18 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:09<00:00, 16.00it/s, est. speed input: 6766.66 toks/s, output: 13.22 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 15.95it/s, est. speed input: 6784.19 toks/s, output: 13.25 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 15.95it/s, est. speed input: 6784.19 toks/s, output: 13.25 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 13.25it/s, est. speed input: 6784.19 toks/s, output: 13.25 toks/s]
[rank0]:[W128 11:52:46.511390359 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.8s

测试结果:
  Requests/s:   16.43
  Tokens/s:     8429.96
  Total Reqs:   128
  Elapsed:      7.79s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8413.53

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:52:56 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:52:57 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=34107) WARNING 01-28 11:53:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=34107) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=34107) WARNING 01-28 11:53:15 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.08 requests/s, 16479.99 total tokens/s, 16.08 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 11:52:56] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:52:56] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:52:56] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:52:56] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:56] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:56] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:56] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:56] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:52:56] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:52:56] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:52:56] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:52:56] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:52:56] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:52:56] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:53:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:53:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:53:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:53:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:53:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:53:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:53:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:53:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:53:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:04] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:04] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:04] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:04] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:04] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:04] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=34107) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=34107) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.00it/s]
(EngineCore_DP0 pid=34107) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.00it/s]
(EngineCore_DP0 pid=34107) 
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=34107) [2026-01-28 11:53:05] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=34107) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.91it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  7.95it/s]
(EngineCore_DP0 pid=34107) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.23it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.22it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  28%|██▊       | 36/128 [00:00<00:00, 351.99it/s]
Adding requests:  59%|█████▊    | 75/128 [00:00<00:00, 372.37it/s]
Adding requests:  89%|████████▉ | 114/128 [00:00<00:00, 376.60it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 375.43it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:03, 38.74it/s, est. speed input: 39677.59 toks/s, output: 38.74 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:05, 23.27it/s, est. speed input: 25678.47 toks/s, output: 25.08 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:05, 20.42it/s, est. speed input: 22947.98 toks/s, output: 22.41 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:05, 18.86it/s, est. speed input: 21447.73 toks/s, output: 20.94 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:00<00:06, 18.05it/s, est. speed input: 20713.67 toks/s, output: 20.23 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 17.46it/s, est. speed input: 20169.21 toks/s, output: 19.70 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 17.11it/s, est. speed input: 19780.65 toks/s, output: 19.32 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.85it/s, est. speed input: 19471.28 toks/s, output: 19.01 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.70it/s, est. speed input: 19227.98 toks/s, output: 18.78 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:06, 16.60it/s, est. speed input: 19026.81 toks/s, output: 18.58 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.45it/s, est. speed input: 18833.25 toks/s, output: 18.39 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.39it/s, est. speed input: 18678.98 toks/s, output: 18.24 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:01<00:05, 16.32it/s, est. speed input: 18538.55 toks/s, output: 18.10 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 16.30it/s, est. speed input: 18422.68 toks/s, output: 17.99 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.25it/s, est. speed input: 18310.92 toks/s, output: 17.88 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.22it/s, est. speed input: 18213.36 toks/s, output: 17.79 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 16.28it/s, est. speed input: 18140.92 toks/s, output: 17.72 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 16.41it/s, est. speed input: 18091.68 toks/s, output: 17.67 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:04, 16.44it/s, est. speed input: 18036.66 toks/s, output: 17.61 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:04, 16.45it/s, est. speed input: 17985.77 toks/s, output: 17.56 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:02<00:04, 16.37it/s, est. speed input: 17924.28 toks/s, output: 17.50 toks/s]
Processed prompts:  41%|████      | 52/128 [00:02<00:04, 16.47it/s, est. speed input: 17890.81 toks/s, output: 17.47 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 16.53it/s, est. speed input: 17860.14 toks/s, output: 17.44 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.60it/s, est. speed input: 17834.33 toks/s, output: 17.42 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 16.56it/s, est. speed input: 17799.04 toks/s, output: 17.38 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 16.53it/s, est. speed input: 17765.35 toks/s, output: 17.35 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:03, 16.50it/s, est. speed input: 17733.86 toks/s, output: 17.32 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:03, 16.48it/s, est. speed input: 17704.26 toks/s, output: 17.29 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 16.50it/s, est. speed input: 17680.08 toks/s, output: 17.27 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:03<00:03, 16.56it/s, est. speed input: 17662.04 toks/s, output: 17.25 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 16.58it/s, est. speed input: 17643.78 toks/s, output: 17.23 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 16.61it/s, est. speed input: 17627.62 toks/s, output: 17.21 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 16.58it/s, est. speed input: 17607.06 toks/s, output: 17.19 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 16.51it/s, est. speed input: 17583.68 toks/s, output: 17.17 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 16.42it/s, est. speed input: 17556.54 toks/s, output: 17.14 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:02, 16.48it/s, est. speed input: 17542.43 toks/s, output: 17.13 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 16.44it/s, est. speed input: 17522.66 toks/s, output: 17.11 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:04<00:02, 16.42it/s, est. speed input: 17503.87 toks/s, output: 17.09 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 16.47it/s, est. speed input: 17491.52 toks/s, output: 17.08 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 16.50it/s, est. speed input: 17479.20 toks/s, output: 17.07 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 16.55it/s, est. speed input: 17469.98 toks/s, output: 17.06 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 16.61it/s, est. speed input: 17462.72 toks/s, output: 17.05 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 16.50it/s, est. speed input: 17444.14 toks/s, output: 17.04 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 16.40it/s, est. speed input: 17425.16 toks/s, output: 17.02 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 16.30it/s, est. speed input: 17404.42 toks/s, output: 17.00 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:05<00:01, 16.29it/s, est. speed input: 17388.36 toks/s, output: 16.98 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 16.26it/s, est. speed input: 17371.95 toks/s, output: 16.96 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 16.26it/s, est. speed input: 17357.74 toks/s, output: 16.95 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 16.19it/s, est. speed input: 17338.86 toks/s, output: 16.93 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 16.16it/s, est. speed input: 17322.27 toks/s, output: 16.92 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 16.10it/s, est. speed input: 17303.40 toks/s, output: 16.90 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:00, 16.15it/s, est. speed input: 17291.58 toks/s, output: 16.89 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 16.17it/s, est. speed input: 17279.08 toks/s, output: 16.87 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:06<00:00, 16.17it/s, est. speed input: 17266.11 toks/s, output: 16.86 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 16.09it/s, est. speed input: 17248.65 toks/s, output: 16.84 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 16.14it/s, est. speed input: 17238.30 toks/s, output: 16.83 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 16.19it/s, est. speed input: 17229.12 toks/s, output: 16.83 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 16.24it/s, est. speed input: 17221.19 toks/s, output: 16.82 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 16.26it/s, est. speed input: 17212.72 toks/s, output: 16.81 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.27it/s, est. speed input: 17204.07 toks/s, output: 16.80 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.27it/s, est. speed input: 17204.07 toks/s, output: 16.80 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.80it/s, est. speed input: 17204.07 toks/s, output: 16.80 toks/s]
[rank0]:[W128 11:53:34.769841286 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 48.3s

测试结果:
  Requests/s:   16.08
  Tokens/s:     16479.99
  Total Reqs:   128
  Elapsed:      7.96s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16463.91

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:53:45 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:53:46 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=34627) WARNING 01-28 11:53:54 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=34627) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=34627) WARNING 01-28 11:54:04 [backends.py:609] Failed to read file <frozen os>
Throughput: 32.63 requests/s, 33441.90 total tokens/s, 32.63 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 11:53:45] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:53:45] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:53:45] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:53:45] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:45] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:45] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:45] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:45] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:45] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:53:45] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:53:45] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:53:45] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:53:45] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:53:45] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:53:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:53:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:53:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:53:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:53:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:53:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:53:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:53:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:53:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:53:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:55] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:55] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:55] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:55] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:55] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:55] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=34627) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=34627) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.01it/s]
(EngineCore_DP0 pid=34627) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.01it/s]
(EngineCore_DP0 pid=34627) 
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=34627) [2026-01-28 11:53:56] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=34627) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.91it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.22it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.66it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.77it/s]
(EngineCore_DP0 pid=34627) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.26it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.25it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.08it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 37/256 [00:00<00:00, 366.67it/s]
Adding requests:  30%|███       | 77/256 [00:00<00:00, 386.01it/s]
Adding requests:  45%|████▌     | 116/256 [00:00<00:00, 379.99it/s]
Adding requests:  61%|██████    | 155/256 [00:00<00:00, 379.85it/s]
Adding requests:  76%|███████▌  | 194/256 [00:00<00:00, 379.37it/s]
Adding requests:  91%|█████████▏| 234/256 [00:00<00:00, 385.52it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 383.49it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   8%|▊         | 20/256 [00:00<00:01, 129.40it/s, est. speed input: 132523.50 toks/s, output: 129.40 toks/s]
Processed prompts:  13%|█▎        | 33/256 [00:00<00:03, 58.65it/s, est. speed input: 66689.34 toks/s, output: 65.13 toks/s]   
Processed prompts:  16%|█▌        | 41/256 [00:00<00:04, 48.25it/s, est. speed input: 56579.69 toks/s, output: 55.25 toks/s]
Processed prompts:  18%|█▊        | 47/256 [00:00<00:04, 43.67it/s, est. speed input: 52292.39 toks/s, output: 51.07 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:05, 38.56it/s, est. speed input: 48290.60 toks/s, output: 47.16 toks/s]
Processed prompts:  22%|██▏       | 57/256 [00:01<00:05, 39.16it/s, est. speed input: 47681.10 toks/s, output: 46.56 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 35.14it/s, est. speed input: 45068.10 toks/s, output: 44.01 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 34.59it/s, est. speed input: 44156.17 toks/s, output: 43.12 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 34.30it/s, est. speed input: 43439.68 toks/s, output: 42.42 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:01<00:05, 34.03it/s, est. speed input: 42802.93 toks/s, output: 41.80 toks/s]
Processed prompts:  30%|███       | 78/256 [00:01<00:05, 33.86it/s, est. speed input: 42259.66 toks/s, output: 41.27 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:02<00:05, 33.72it/s, est. speed input: 41775.00 toks/s, output: 40.80 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:05, 33.87it/s, est. speed input: 41408.50 toks/s, output: 40.44 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:04, 33.98it/s, est. speed input: 41078.74 toks/s, output: 40.12 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:04, 34.05it/s, est. speed input: 40779.90 toks/s, output: 39.82 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 34.02it/s, est. speed input: 40492.88 toks/s, output: 39.54 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 34.08it/s, est. speed input: 40247.12 toks/s, output: 39.30 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:02<00:04, 34.03it/s, est. speed input: 40008.23 toks/s, output: 39.07 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:02<00:04, 34.12it/s, est. speed input: 39807.39 toks/s, output: 38.87 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:02<00:04, 34.19it/s, est. speed input: 39625.25 toks/s, output: 38.70 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:03<00:04, 34.20it/s, est. speed input: 39450.74 toks/s, output: 38.53 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:03<00:03, 34.03it/s, est. speed input: 39263.71 toks/s, output: 38.34 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:03<00:03, 34.08it/s, est. speed input: 39112.44 toks/s, output: 38.20 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:03<00:03, 33.82it/s, est. speed input: 38934.46 toks/s, output: 38.02 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:03<00:03, 33.68it/s, est. speed input: 38772.20 toks/s, output: 37.86 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:03<00:03, 33.53it/s, est. speed input: 38613.69 toks/s, output: 37.71 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:03<00:03, 33.47it/s, est. speed input: 38472.12 toks/s, output: 37.57 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:03<00:03, 33.43it/s, est. speed input: 38338.87 toks/s, output: 37.44 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:04<00:03, 33.24it/s, est. speed input: 38194.26 toks/s, output: 37.30 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:04<00:03, 33.18it/s, est. speed input: 38066.62 toks/s, output: 37.17 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:04<00:02, 33.16it/s, est. speed input: 37949.65 toks/s, output: 37.06 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:04<00:02, 33.21it/s, est. speed input: 37844.86 toks/s, output: 36.96 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:04<00:02, 33.16it/s, est. speed input: 37736.96 toks/s, output: 36.85 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:04<00:02, 33.09it/s, est. speed input: 37631.48 toks/s, output: 36.75 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:04<00:02, 33.00it/s, est. speed input: 37527.37 toks/s, output: 36.65 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:04<00:02, 33.11it/s, est. speed input: 37444.88 toks/s, output: 36.57 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:04<00:02, 33.21it/s, est. speed input: 37367.68 toks/s, output: 36.49 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:05<00:02, 33.22it/s, est. speed input: 37289.69 toks/s, output: 36.42 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:05<00:01, 33.16it/s, est. speed input: 37209.25 toks/s, output: 36.34 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:05<00:01, 33.26it/s, est. speed input: 37143.92 toks/s, output: 36.27 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:05<00:01, 33.15it/s, est. speed input: 37067.59 toks/s, output: 36.20 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:05<00:01, 33.20it/s, est. speed input: 37004.12 toks/s, output: 36.14 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:07<00:09,  5.37it/s, est. speed input: 27066.48 toks/s, output: 26.43 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:07<00:06,  7.18it/s, est. speed input: 27182.16 toks/s, output: 26.54 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:08<00:04,  9.41it/s, est. speed input: 27297.06 toks/s, output: 26.66 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:08<00:03, 12.03it/s, est. speed input: 27408.44 toks/s, output: 26.77 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:08<00:02, 14.94it/s, est. speed input: 27516.87 toks/s, output: 26.87 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:08<00:01, 17.96it/s, est. speed input: 27620.21 toks/s, output: 26.97 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:08<00:01, 20.95it/s, est. speed input: 27722.04 toks/s, output: 27.07 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:08<00:00, 23.69it/s, est. speed input: 27820.54 toks/s, output: 27.17 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:08<00:00, 26.07it/s, est. speed input: 27915.46 toks/s, output: 27.26 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:08<00:00, 27.82it/s, est. speed input: 27995.71 toks/s, output: 27.34 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:08<00:00, 29.39it/s, est. speed input: 28083.30 toks/s, output: 27.42 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:09<00:00, 30.64it/s, est. speed input: 28170.63 toks/s, output: 27.51 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:09<00:00, 31.56it/s, est. speed input: 28255.03 toks/s, output: 27.59 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 31.56it/s, est. speed input: 28296.71 toks/s, output: 27.63 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 27.63it/s, est. speed input: 28296.71 toks/s, output: 27.63 toks/s]
[rank0]:[W128 11:54:26.684490937 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.1s

测试结果:
  Requests/s:   32.63
  Tokens/s:     33441.90
  Total Reqs:   256
  Elapsed:      7.85s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     33409.27

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:54:37 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:54:38 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=35164) WARNING 01-28 11:54:45 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=35164) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=35164) WARNING 01-28 11:54:54 [backends.py:609] Failed to read file <frozen os>
Throughput: 59.78 requests/s, 61270.31 total tokens/s, 59.78 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 11:54:37] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:54:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:54:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:54:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:54:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:54:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:54:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:54:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:54:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:54:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:54:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:54:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:54:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:54:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:54:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:54:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:54:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:54:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:54:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:45] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:45] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:45] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:45] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:45] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:45] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=35164) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=35164) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.93it/s]
(EngineCore_DP0 pid=35164) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.93it/s]
(EngineCore_DP0 pid=35164) 
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=35164) [2026-01-28 11:54:46] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=35164) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  8.20it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.61it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.67it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.03it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.21it/s]
(EngineCore_DP0 pid=35164) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.39it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.44it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.86it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.61it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 37/512 [00:00<00:01, 363.12it/s]
Adding requests:  15%|█▌        | 77/512 [00:00<00:01, 381.08it/s]
Adding requests:  23%|██▎       | 116/512 [00:00<00:01, 384.45it/s]
Adding requests:  30%|███       | 155/512 [00:00<00:00, 381.64it/s]
Adding requests:  38%|███▊      | 194/512 [00:00<00:00, 380.23it/s]
Adding requests:  46%|████▌     | 234/512 [00:00<00:00, 385.84it/s]
Adding requests:  53%|█████▎    | 273/512 [00:00<00:00, 383.40it/s]
Adding requests:  61%|██████    | 312/512 [00:00<00:00, 381.40it/s]
Adding requests:  69%|██████▊   | 351/512 [00:00<00:00, 382.38it/s]
Adding requests:  76%|███████▌  | 390/512 [00:01<00:00, 384.00it/s]
Adding requests:  84%|████████▍ | 429/512 [00:01<00:00, 385.30it/s]
Adding requests:  91%|█████████▏| 468/512 [00:01<00:00, 383.31it/s]
Adding requests:  99%|█████████▉| 507/512 [00:01<00:00, 382.81it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 382.50it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 62/512 [00:00<00:01, 387.62it/s, est. speed input: 396985.54 toks/s, output: 387.64 toks/s]
Processed prompts:  20%|█▉        | 101/512 [00:00<00:03, 121.45it/s, est. speed input: 142370.09 toks/s, output: 139.03 toks/s]
Processed prompts:  24%|██▍       | 122/512 [00:01<00:04, 92.33it/s, est. speed input: 113190.26 toks/s, output: 110.54 toks/s] 
Processed prompts:  27%|██▋       | 136/512 [00:01<00:04, 87.97it/s, est. speed input: 107753.34 toks/s, output: 105.23 toks/s]
Processed prompts:  29%|██▉       | 148/512 [00:01<00:04, 81.71it/s, est. speed input: 102305.47 toks/s, output: 99.91 toks/s] 
Processed prompts:  31%|███       | 158/512 [00:01<00:04, 74.04it/s, est. speed input: 96880.12 toks/s, output: 94.61 toks/s] 
Processed prompts:  32%|███▏      | 166/512 [00:01<00:04, 71.93it/s, est. speed input: 94659.74 toks/s, output: 92.44 toks/s]
Processed prompts:  34%|███▍      | 174/512 [00:01<00:04, 69.99it/s, est. speed input: 92702.11 toks/s, output: 90.53 toks/s]
Processed prompts:  36%|███▌      | 182/512 [00:02<00:04, 68.44it/s, est. speed input: 91008.47 toks/s, output: 88.87 toks/s]
Processed prompts:  37%|███▋      | 190/512 [00:02<00:04, 67.19it/s, est. speed input: 89510.60 toks/s, output: 87.41 toks/s]
Processed prompts:  39%|███▊      | 198/512 [00:02<00:04, 66.27it/s, est. speed input: 88187.68 toks/s, output: 86.12 toks/s]
Processed prompts:  40%|████      | 206/512 [00:02<00:04, 65.57it/s, est. speed input: 87001.84 toks/s, output: 84.96 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:02<00:04, 65.05it/s, est. speed input: 85932.31 toks/s, output: 83.92 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:02<00:04, 64.65it/s, est. speed input: 84958.05 toks/s, output: 82.97 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:02<00:04, 64.30it/s, est. speed input: 84059.46 toks/s, output: 82.09 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:02<00:04, 64.00it/s, est. speed input: 83228.85 toks/s, output: 81.28 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:03<00:04, 63.80it/s, est. speed input: 82468.52 toks/s, output: 80.54 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:03<00:04, 63.67it/s, est. speed input: 81769.55 toks/s, output: 79.85 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:03<00:03, 63.63it/s, est. speed input: 81133.46 toks/s, output: 79.23 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:03<00:03, 63.64it/s, est. speed input: 80549.34 toks/s, output: 78.66 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:03<00:03, 63.56it/s, est. speed input: 79994.81 toks/s, output: 78.12 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:03<00:03, 63.56it/s, est. speed input: 79485.68 toks/s, output: 77.62 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:03<00:03, 63.56it/s, est. speed input: 79009.96 toks/s, output: 77.16 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:03<00:03, 63.51it/s, est. speed input: 78557.93 toks/s, output: 76.72 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:04<00:03, 63.51it/s, est. speed input: 78138.67 toks/s, output: 76.31 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:04<00:03, 63.57it/s, est. speed input: 77752.04 toks/s, output: 75.93 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:04<00:02, 63.55it/s, est. speed input: 77380.08 toks/s, output: 75.57 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:04<00:02, 63.58it/s, est. speed input: 77035.15 toks/s, output: 75.23 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:04<00:02, 63.52it/s, est. speed input: 76699.67 toks/s, output: 74.90 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:04<00:02, 63.53it/s, est. speed input: 76387.99 toks/s, output: 74.60 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:04<00:02, 63.50it/s, est. speed input: 76088.10 toks/s, output: 74.30 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:04<00:02, 63.50it/s, est. speed input: 75806.80 toks/s, output: 74.03 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:05<00:02, 63.57it/s, est. speed input: 75545.40 toks/s, output: 73.77 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:05<00:02, 63.56it/s, est. speed input: 75290.92 toks/s, output: 73.53 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:05<00:01, 63.53it/s, est. speed input: 75047.46 toks/s, output: 73.29 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:05<00:01, 63.41it/s, est. speed input: 74804.89 toks/s, output: 73.05 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:05<00:01, 63.28it/s, est. speed input: 74569.72 toks/s, output: 72.82 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:05<00:01, 63.13it/s, est. speed input: 74339.98 toks/s, output: 72.60 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:05<00:01, 62.97it/s, est. speed input: 74115.63 toks/s, output: 72.38 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:05<00:01, 62.89it/s, est. speed input: 73903.69 toks/s, output: 72.17 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:06<00:01, 62.89it/s, est. speed input: 73704.82 toks/s, output: 71.98 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:06<00:01, 62.92it/s, est. speed input: 73516.42 toks/s, output: 71.79 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:06<00:00, 62.89it/s, est. speed input: 73332.10 toks/s, output: 71.61 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:06<00:00, 62.89it/s, est. speed input: 73156.64 toks/s, output: 71.44 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:06<00:00, 62.96it/s, est. speed input: 72992.70 toks/s, output: 71.28 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:06<00:00, 62.90it/s, est. speed input: 72827.14 toks/s, output: 71.12 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:06<00:00, 62.94it/s, est. speed input: 72673.95 toks/s, output: 70.97 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:06<00:00, 62.99it/s, est. speed input: 72527.47 toks/s, output: 70.83 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:07<00:00, 63.04it/s, est. speed input: 72387.66 toks/s, output: 70.69 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:07<00:00, 63.53it/s, est. speed input: 72282.31 toks/s, output: 70.59 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 63.53it/s, est. speed input: 72563.87 toks/s, output: 70.86 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 70.86it/s, est. speed input: 72563.87 toks/s, output: 70.86 toks/s]
[rank0]:[W128 11:55:17.620099655 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 51.1s

测试结果:
  Requests/s:   59.78
  Tokens/s:     61270.31
  Total Reqs:   512
  Elapsed:      8.57s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     61210.53

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:55:31 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:55:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=35716) WARNING 01-28 11:55:41 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=35716) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=35716) WARNING 01-28 11:55:50 [backends.py:609] Failed to read file <frozen os>
Throughput: 61.75 requests/s, 63289.73 total tokens/s, 61.75 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 11:55:31] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:55:31] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:55:31] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:55:31] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:31] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:31] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:31] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:31] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:31] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:55:31] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:55:31] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:55:31] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:55:31] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:55:31] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:55:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:55:40] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:55:40] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:55:40] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:40] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:40] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:40] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:40] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:55:40] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:55:40] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:55:40] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:55:40] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:55:40] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:55:40] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:41] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:41] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:41] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:41] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:41] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:41] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=35716) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=35716) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.05it/s]
(EngineCore_DP0 pid=35716) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.05it/s]
(EngineCore_DP0 pid=35716) 
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=35716) [2026-01-28 11:55:42] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=35716) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  7.95it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  8.07it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  8.43it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  8.61it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.99it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  8.14it/s]
(EngineCore_DP0 pid=35716) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.24it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.14it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  8.38it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.67it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.42it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 36/1024 [00:00<00:02, 352.39it/s]
Adding requests:   7%|▋         | 75/1024 [00:00<00:02, 372.58it/s]
Adding requests:  11%|█         | 115/1024 [00:00<00:02, 381.11it/s]
Adding requests:  15%|█▌        | 154/1024 [00:00<00:02, 381.13it/s]
Adding requests:  19%|█▉        | 193/1024 [00:00<00:02, 377.91it/s]
Adding requests:  23%|██▎       | 232/1024 [00:00<00:02, 379.38it/s]
Adding requests:  26%|██▋       | 271/1024 [00:00<00:01, 382.18it/s]
Adding requests:  30%|███       | 310/1024 [00:00<00:01, 381.92it/s]
Adding requests:  34%|███▍      | 349/1024 [00:00<00:01, 382.74it/s]
Adding requests:  38%|███▊      | 388/1024 [00:01<00:01, 381.65it/s]
Adding requests:  42%|████▏     | 428/1024 [00:01<00:01, 383.74it/s]
Adding requests:  46%|████▌     | 468/1024 [00:01<00:01, 385.77it/s]
Adding requests:  50%|████▉     | 507/1024 [00:01<00:01, 382.77it/s]
Adding requests:  53%|█████▎    | 546/1024 [00:01<00:01, 367.72it/s]
Adding requests:  57%|█████▋    | 586/1024 [00:01<00:01, 376.61it/s]
Adding requests:  61%|██████    | 625/1024 [00:01<00:01, 380.46it/s]
Adding requests:  65%|██████▍   | 664/1024 [00:01<00:00, 383.03it/s]
Adding requests:  69%|██████▉   | 705/1024 [00:01<00:00, 390.33it/s]
Adding requests:  73%|███████▎  | 745/1024 [00:01<00:00, 388.16it/s]
Adding requests:  77%|███████▋  | 785/1024 [00:02<00:00, 389.82it/s]
Adding requests:  81%|████████  | 825/1024 [00:02<00:00, 380.92it/s]
Adding requests:  84%|████████▍ | 865/1024 [00:02<00:00, 384.63it/s]
Adding requests:  88%|████████▊ | 906/1024 [00:02<00:00, 389.55it/s]
Adding requests:  92%|█████████▏| 946/1024 [00:02<00:00, 388.52it/s]
Adding requests:  96%|█████████▋| 986/1024 [00:02<00:00, 390.35it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 382.89it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  15%|█▌        | 154/1024 [00:00<00:01, 756.14it/s, est. speed input: 774396.21 toks/s, output: 756.18 toks/s]
Processed prompts:  22%|██▏       | 230/1024 [00:03<00:16, 49.34it/s, est. speed input: 62197.88 toks/s, output: 60.74 toks/s]   
Processed prompts:  26%|██▌       | 263/1024 [00:04<00:14, 51.72it/s, est. speed input: 62565.18 toks/s, output: 61.10 toks/s]
Processed prompts:  28%|██▊       | 284/1024 [00:04<00:14, 52.07it/s, est. speed input: 61965.43 toks/s, output: 60.51 toks/s]
Processed prompts:  29%|██▉       | 299/1024 [00:04<00:13, 52.79it/s, est. speed input: 61821.64 toks/s, output: 60.37 toks/s]
Processed prompts:  30%|███       | 311/1024 [00:05<00:12, 56.07it/s, est. speed input: 62664.64 toks/s, output: 61.20 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:05<00:13, 53.47it/s, est. speed input: 61731.37 toks/s, output: 60.28 toks/s]
Processed prompts:  32%|███▏      | 331/1024 [00:05<00:12, 55.34it/s, est. speed input: 61943.15 toks/s, output: 60.49 toks/s]
Processed prompts:  33%|███▎      | 340/1024 [00:05<00:11, 58.07it/s, est. speed input: 62269.16 toks/s, output: 60.81 toks/s]
Processed prompts:  34%|███▍      | 348/1024 [00:05<00:11, 58.71it/s, est. speed input: 62291.60 toks/s, output: 60.83 toks/s]
Processed prompts:  35%|███▍      | 356/1024 [00:05<00:11, 59.32it/s, est. speed input: 62312.78 toks/s, output: 60.85 toks/s]
Processed prompts:  35%|███▌      | 363/1024 [00:05<00:11, 58.14it/s, est. speed input: 62160.09 toks/s, output: 60.70 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:06<00:11, 57.17it/s, est. speed input: 62017.70 toks/s, output: 60.56 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:06<00:11, 58.31it/s, est. speed input: 62039.69 toks/s, output: 60.59 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:06<00:10, 59.22it/s, est. speed input: 62063.41 toks/s, output: 60.61 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:06<00:10, 59.90it/s, est. speed input: 62085.25 toks/s, output: 60.63 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:06<00:10, 60.37it/s, est. speed input: 62103.53 toks/s, output: 60.65 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:06<00:10, 60.77it/s, est. speed input: 62125.38 toks/s, output: 60.67 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:06<00:09, 61.01it/s, est. speed input: 62143.49 toks/s, output: 60.69 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:07<00:09, 61.20it/s, est. speed input: 62161.38 toks/s, output: 60.70 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:07<00:09, 61.35it/s, est. speed input: 62180.16 toks/s, output: 60.72 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:07<00:09, 61.48it/s, est. speed input: 62199.52 toks/s, output: 60.74 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:07<00:09, 61.57it/s, est. speed input: 62218.06 toks/s, output: 60.76 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:07<00:09, 61.63it/s, est. speed input: 62236.29 toks/s, output: 60.78 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:07<00:09, 61.66it/s, est. speed input: 62252.60 toks/s, output: 60.79 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:07<00:08, 61.68it/s, est. speed input: 62268.28 toks/s, output: 60.81 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:07<00:08, 61.71it/s, est. speed input: 62284.86 toks/s, output: 60.82 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:08<00:08, 61.67it/s, est. speed input: 62297.02 toks/s, output: 60.84 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:08<00:08, 61.61it/s, est. speed input: 62307.38 toks/s, output: 60.85 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:08<00:08, 61.54it/s, est. speed input: 62316.06 toks/s, output: 60.86 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:08<00:08, 61.56it/s, est. speed input: 62327.56 toks/s, output: 60.87 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:08<00:08, 61.57it/s, est. speed input: 62338.87 toks/s, output: 60.88 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:08<00:08, 61.57it/s, est. speed input: 62349.27 toks/s, output: 60.89 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:08<00:07, 61.62it/s, est. speed input: 62362.21 toks/s, output: 60.90 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:08<00:07, 61.62it/s, est. speed input: 62372.91 toks/s, output: 60.91 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:09<00:07, 61.59it/s, est. speed input: 62381.65 toks/s, output: 60.92 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:09<00:07, 61.58it/s, est. speed input: 62390.84 toks/s, output: 60.93 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:09<00:07, 61.55it/s, est. speed input: 62398.77 toks/s, output: 60.94 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:09<00:07, 61.59it/s, est. speed input: 62409.22 toks/s, output: 60.95 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:09<00:07, 61.66it/s, est. speed input: 62421.36 toks/s, output: 60.96 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:09<00:06, 61.67it/s, est. speed input: 62431.36 toks/s, output: 60.97 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:09<00:06, 61.68it/s, est. speed input: 62441.04 toks/s, output: 60.98 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:10<00:06, 61.68it/s, est. speed input: 62450.47 toks/s, output: 60.99 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:10<00:06, 61.69it/s, est. speed input: 62459.93 toks/s, output: 61.00 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:10<00:06, 61.64it/s, est. speed input: 62466.89 toks/s, output: 61.00 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:10<00:06, 61.61it/s, est. speed input: 62473.70 toks/s, output: 61.01 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:10<00:06, 61.65it/s, est. speed input: 62482.95 toks/s, output: 61.02 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:10<00:05, 62.44it/s, est. speed input: 62522.84 toks/s, output: 61.06 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:10<00:05, 63.08it/s, est. speed input: 62564.75 toks/s, output: 61.10 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:10<00:05, 63.49it/s, est. speed input: 62604.14 toks/s, output: 61.14 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:11<00:05, 63.78it/s, est. speed input: 62642.61 toks/s, output: 61.17 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:11<00:05, 63.93it/s, est. speed input: 62678.06 toks/s, output: 61.21 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:11<00:05, 64.07it/s, est. speed input: 62714.02 toks/s, output: 61.24 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:11<00:05, 64.21it/s, est. speed input: 62750.78 toks/s, output: 61.28 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:11<00:04, 64.27it/s, est. speed input: 62785.44 toks/s, output: 61.31 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:11<00:04, 64.34it/s, est. speed input: 62820.14 toks/s, output: 61.35 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:11<00:04, 64.42it/s, est. speed input: 62855.39 toks/s, output: 61.38 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:11<00:04, 64.45it/s, est. speed input: 62888.95 toks/s, output: 61.41 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:12<00:04, 64.49it/s, est. speed input: 62922.27 toks/s, output: 61.45 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:12<00:04, 64.54it/s, est. speed input: 62955.68 toks/s, output: 61.48 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:12<00:04, 64.56it/s, est. speed input: 62988.02 toks/s, output: 61.51 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:12<00:04, 64.56it/s, est. speed input: 63019.35 toks/s, output: 61.54 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:12<00:03, 64.58it/s, est. speed input: 63050.52 toks/s, output: 61.57 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:12<00:03, 64.57it/s, est. speed input: 63080.32 toks/s, output: 61.60 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:12<00:03, 64.49it/s, est. speed input: 63107.27 toks/s, output: 61.63 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:12<00:03, 64.49it/s, est. speed input: 63135.71 toks/s, output: 61.66 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:13<00:03, 64.49it/s, est. speed input: 63163.24 toks/s, output: 61.68 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:03, 64.44it/s, est. speed input: 63189.02 toks/s, output: 61.71 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:03, 64.48it/s, est. speed input: 63216.51 toks/s, output: 61.73 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:13<00:03, 64.51it/s, est. speed input: 63243.33 toks/s, output: 61.76 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:13<00:02, 64.51it/s, est. speed input: 63269.19 toks/s, output: 61.79 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:13<00:02, 64.48it/s, est. speed input: 63293.81 toks/s, output: 61.81 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:13<00:02, 64.44it/s, est. speed input: 63317.34 toks/s, output: 61.83 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:13<00:02, 64.44it/s, est. speed input: 63341.07 toks/s, output: 61.86 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:13<00:02, 64.41it/s, est. speed input: 63363.81 toks/s, output: 61.88 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 64.45it/s, est. speed input: 63387.81 toks/s, output: 61.90 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:14<00:02, 64.48it/s, est. speed input: 63411.27 toks/s, output: 61.92 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:14<00:02, 64.48it/s, est. speed input: 63433.91 toks/s, output: 61.95 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:14<00:01, 64.47it/s, est. speed input: 63455.83 toks/s, output: 61.97 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:14<00:01, 64.47it/s, est. speed input: 63477.50 toks/s, output: 61.99 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:14<00:01, 64.45it/s, est. speed input: 63498.47 toks/s, output: 62.01 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:14<00:01, 64.43it/s, est. speed input: 63518.71 toks/s, output: 62.03 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:14<00:01, 64.43it/s, est. speed input: 63539.04 toks/s, output: 62.05 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 64.43it/s, est. speed input: 63559.21 toks/s, output: 62.07 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:15<00:01, 64.43it/s, est. speed input: 63578.73 toks/s, output: 62.09 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:15<00:01, 64.44it/s, est. speed input: 63598.33 toks/s, output: 62.11 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:15<00:00, 64.45it/s, est. speed input: 63617.87 toks/s, output: 62.13 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:15<00:00, 64.50it/s, est. speed input: 63638.09 toks/s, output: 62.15 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:15<00:00, 64.52it/s, est. speed input: 63657.44 toks/s, output: 62.17 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:15<00:00, 66.54it/s, est. speed input: 63726.82 toks/s, output: 62.23 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:15<00:00, 65.94it/s, est. speed input: 63745.59 toks/s, output: 62.25 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:16<00:00, 65.54it/s, est. speed input: 63764.29 toks/s, output: 62.27 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:16<00:00, 65.16it/s, est. speed input: 63780.08 toks/s, output: 62.29 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:16<00:00, 67.27it/s, est. speed input: 63852.34 toks/s, output: 62.36 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:16<00:00, 67.27it/s, est. speed input: 64227.81 toks/s, output: 62.72 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:16<00:00, 62.72it/s, est. speed input: 64227.81 toks/s, output: 62.72 toks/s]
[rank0]:[W128 11:56:21.523070175 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 64.6s

测试结果:
  Requests/s:   61.75
  Tokens/s:     63289.73
  Total Reqs:   1024
  Elapsed:      16.58s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     63227.98

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:56:40 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:56:44 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=36384) WARNING 01-28 11:56:51 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=36384) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=36384) WARNING 01-28 11:57:00 [backends.py:609] Failed to read file <frozen os>
Throughput: 62.32 requests/s, 63874.43 total tokens/s, 62.32 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 11:56:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:56:40] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:56:40] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:56:40] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:40] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:40] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:40] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:40] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:40] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:56:40] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:56:40] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:56:40] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:56:40] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:56:40] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:56:50] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:56:50] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:56:50] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:56:50] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:50] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:50] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:50] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:50] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:56:50] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:56:50] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:56:50] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:56:50] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:56:50] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:56:50] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:51] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:51] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:51] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:51] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:51] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:51] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=36384) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=36384) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.99it/s]
(EngineCore_DP0 pid=36384) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.99it/s]
(EngineCore_DP0 pid=36384) 
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=36384) [2026-01-28 11:56:52] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=36384) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.70it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.93it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.22it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.36it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.49it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.50it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  7.94it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.13it/s]
(EngineCore_DP0 pid=36384) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  6.98it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  7.94it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.37it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  8.61it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.77it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.47it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 37/2048 [00:00<00:05, 364.33it/s]
Adding requests:   4%|▎         | 76/2048 [00:00<00:05, 374.38it/s]
Adding requests:   6%|▌         | 116/2048 [00:00<00:05, 382.92it/s]
Adding requests:   8%|▊         | 155/2048 [00:00<00:04, 383.11it/s]
Adding requests:   9%|▉         | 194/2048 [00:00<00:04, 384.60it/s]
Adding requests:  11%|█▏        | 233/2048 [00:00<00:04, 383.01it/s]
Adding requests:  13%|█▎        | 272/2048 [00:00<00:04, 384.33it/s]
Adding requests:  15%|█▌        | 311/2048 [00:00<00:04, 381.94it/s]
Adding requests:  17%|█▋        | 350/2048 [00:00<00:04, 381.43it/s]
Adding requests:  19%|█▉        | 390/2048 [00:01<00:04, 384.14it/s]
Adding requests:  21%|██        | 429/2048 [00:01<00:04, 385.18it/s]
Adding requests:  23%|██▎       | 468/2048 [00:01<00:04, 385.87it/s]
Adding requests:  25%|██▍       | 507/2048 [00:01<00:04, 384.98it/s]
Adding requests:  27%|██▋       | 546/2048 [00:01<00:04, 374.17it/s]
Adding requests:  29%|██▊       | 586/2048 [00:01<00:03, 380.74it/s]
Adding requests:  31%|███       | 625/2048 [00:01<00:03, 376.05it/s]
Adding requests:  32%|███▏      | 665/2048 [00:01<00:03, 381.95it/s]
Adding requests:  34%|███▍      | 706/2048 [00:01<00:03, 389.49it/s]
Adding requests:  36%|███▋      | 745/2048 [00:01<00:03, 381.60it/s]
Adding requests:  38%|███▊      | 784/2048 [00:02<00:03, 382.68it/s]
Adding requests:  40%|████      | 823/2048 [00:02<00:03, 374.14it/s]
Adding requests:  42%|████▏     | 861/2048 [00:02<00:03, 369.61it/s]
Adding requests:  44%|████▍     | 901/2048 [00:02<00:03, 376.95it/s]
Adding requests:  46%|████▌     | 939/2048 [00:02<00:02, 377.75it/s]
Adding requests:  48%|████▊     | 979/2048 [00:02<00:02, 381.96it/s]
Adding requests:  50%|████▉     | 1020/2048 [00:02<00:02, 387.57it/s]
Adding requests:  52%|█████▏    | 1059/2048 [00:02<00:02, 387.42it/s]
Adding requests:  54%|█████▎    | 1099/2048 [00:02<00:02, 390.34it/s]
Adding requests:  56%|█████▌    | 1139/2048 [00:02<00:02, 382.42it/s]
Adding requests:  58%|█████▊    | 1180/2048 [00:03<00:02, 389.85it/s]
Adding requests:  60%|█████▉    | 1222/2048 [00:03<00:02, 395.37it/s]
Adding requests:  62%|██████▏   | 1262/2048 [00:03<00:02, 389.53it/s]
Adding requests:  64%|██████▎   | 1302/2048 [00:03<00:01, 391.71it/s]
Adding requests:  66%|██████▌   | 1342/2048 [00:03<00:01, 394.00it/s]
Adding requests:  67%|██████▋   | 1382/2048 [00:06<00:15, 44.15it/s] 
Adding requests:  69%|██████▉   | 1421/2048 [00:06<00:10, 59.71it/s]
Adding requests:  71%|███████▏  | 1461/2048 [00:06<00:07, 80.23it/s]
Adding requests:  73%|███████▎  | 1502/2048 [00:06<00:05, 106.35it/s]
Adding requests:  75%|███████▌  | 1540/2048 [00:06<00:03, 134.11it/s]
Adding requests:  77%|███████▋  | 1578/2048 [00:06<00:02, 165.25it/s]
Adding requests:  79%|███████▉  | 1618/2048 [00:06<00:02, 201.03it/s]
Adding requests:  81%|████████  | 1657/2048 [00:06<00:01, 234.06it/s]
Adding requests:  83%|████████▎ | 1695/2048 [00:07<00:01, 263.45it/s]
Adding requests:  85%|████████▍ | 1735/2048 [00:07<00:01, 294.10it/s]
Adding requests:  87%|████████▋ | 1774/2048 [00:07<00:00, 311.11it/s]
Adding requests:  89%|████████▊ | 1814/2048 [00:07<00:00, 333.64it/s]
Adding requests:  91%|█████████ | 1854/2048 [00:07<00:00, 350.15it/s]
Adding requests:  92%|█████████▏| 1894/2048 [00:07<00:00, 362.37it/s]
Adding requests:  94%|█████████▍| 1934/2048 [00:07<00:00, 371.45it/s]
Adding requests:  96%|█████████▋| 1974/2048 [00:07<00:00, 376.01it/s]
Adding requests:  98%|█████████▊| 2013/2048 [00:07<00:00, 371.80it/s]
Adding requests: 100%|██████████| 2048/2048 [00:08<00:00, 255.80it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:00<00:01, 1138.84it/s, est. speed input: 1166291.43 toks/s, output: 1138.87 toks/s]
Processed prompts:  21%|██        | 420/2048 [00:02<00:10, 159.59it/s, est. speed input: 201246.97 toks/s, output: 196.53 toks/s]   
Processed prompts:  23%|██▎       | 471/2048 [00:02<00:12, 125.27it/s, est. speed input: 164125.16 toks/s, output: 160.28 toks/s]
Processed prompts:  25%|██▍       | 502/2048 [00:03<00:14, 107.94it/s, est. speed input: 147810.39 toks/s, output: 144.35 toks/s]
Processed prompts:  26%|██▌       | 523/2048 [00:03<00:14, 104.02it/s, est. speed input: 143380.95 toks/s, output: 140.02 toks/s]
Processed prompts:  26%|██▋       | 540/2048 [00:03<00:15, 97.35it/s, est. speed input: 138484.38 toks/s, output: 135.24 toks/s] 
Processed prompts:  27%|██▋       | 553/2048 [00:04<00:16, 87.97it/s, est. speed input: 133226.85 toks/s, output: 130.10 toks/s]
Processed prompts:  28%|██▊       | 564/2048 [00:04<00:19, 77.92it/s, est. speed input: 128115.94 toks/s, output: 125.11 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:04<00:20, 72.21it/s, est. speed input: 124191.35 toks/s, output: 121.28 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:05<00:20, 69.59it/s, est. speed input: 121071.92 toks/s, output: 118.23 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:05<00:21, 67.56it/s, est. speed input: 118260.05 toks/s, output: 115.49 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:05<00:21, 66.05it/s, est. speed input: 115718.25 toks/s, output: 113.01 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:05<00:21, 64.94it/s, est. speed input: 113403.01 toks/s, output: 110.74 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:06<00:21, 64.11it/s, est. speed input: 111280.21 toks/s, output: 108.67 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:06<00:21, 63.52it/s, est. speed input: 109333.02 toks/s, output: 106.77 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:06<00:21, 63.10it/s, est. speed input: 107539.61 toks/s, output: 105.02 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:06<00:21, 62.80it/s, est. speed input: 105878.73 toks/s, output: 103.40 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:07<00:21, 62.56it/s, est. speed input: 104335.78 toks/s, output: 101.89 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:07<00:20, 62.42it/s, est. speed input: 102906.04 toks/s, output: 100.49 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:07<00:20, 62.31it/s, est. speed input: 101569.42 toks/s, output: 99.19 toks/s] 
Processed prompts:  38%|███▊      | 770/2048 [00:07<00:20, 62.22it/s, est. speed input: 100320.17 toks/s, output: 97.97 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:08<00:20, 62.15it/s, est. speed input: 99147.65 toks/s, output: 96.82 toks/s] 
Processed prompts:  39%|███▉      | 802/2048 [00:08<00:20, 62.11it/s, est. speed input: 98049.65 toks/s, output: 95.75 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:08<00:19, 62.09it/s, est. speed input: 97018.71 toks/s, output: 94.74 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:08<00:19, 62.08it/s, est. speed input: 96048.13 toks/s, output: 93.80 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:09<00:19, 62.05it/s, est. speed input: 95129.46 toks/s, output: 92.90 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:09<00:19, 62.07it/s, est. speed input: 94266.32 toks/s, output: 92.06 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:09<00:18, 62.07it/s, est. speed input: 93446.80 toks/s, output: 91.26 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:09<00:18, 62.05it/s, est. speed input: 92668.45 toks/s, output: 90.50 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:10<00:18, 62.06it/s, est. speed input: 91931.64 toks/s, output: 89.78 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:10<00:18, 62.08it/s, est. speed input: 91233.59 toks/s, output: 89.10 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:10<00:17, 62.01it/s, est. speed input: 90557.94 toks/s, output: 88.44 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:10<00:17, 62.02it/s, est. speed input: 89922.25 toks/s, output: 87.81 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:11<00:16, 63.06it/s, est. speed input: 89427.69 toks/s, output: 87.33 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:11<00:16, 62.69it/s, est. speed input: 88838.60 toks/s, output: 86.76 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:11<00:16, 62.47it/s, est. speed input: 88279.04 toks/s, output: 86.21 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:11<00:16, 62.36it/s, est. speed input: 87747.35 toks/s, output: 85.69 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:12<00:16, 62.23it/s, est. speed input: 87233.85 toks/s, output: 85.19 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:12<00:15, 62.43it/s, est. speed input: 86768.49 toks/s, output: 84.73 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:12<00:15, 63.19it/s, est. speed input: 86378.57 toks/s, output: 84.35 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:12<00:15, 63.71it/s, est. speed input: 86001.89 toks/s, output: 83.99 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:13<00:14, 64.09it/s, est. speed input: 85639.80 toks/s, output: 83.63 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:13<00:14, 64.33it/s, est. speed input: 85288.73 toks/s, output: 83.29 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:13<00:14, 64.53it/s, est. speed input: 84952.48 toks/s, output: 82.96 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:13<00:13, 65.74it/s, est. speed input: 84709.80 toks/s, output: 82.72 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:14<00:13, 65.52it/s, est. speed input: 84395.54 toks/s, output: 82.42 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:14<00:13, 65.37it/s, est. speed input: 84091.84 toks/s, output: 82.12 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:14<00:12, 65.26it/s, est. speed input: 83797.92 toks/s, output: 81.83 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:14<00:12, 65.17it/s, est. speed input: 83513.02 toks/s, output: 81.56 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:15<00:12, 65.11it/s, est. speed input: 83237.59 toks/s, output: 81.29 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:15<00:12, 65.03it/s, est. speed input: 82968.57 toks/s, output: 81.02 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:15<00:12, 65.02it/s, est. speed input: 82710.79 toks/s, output: 80.77 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:15<00:11, 65.00it/s, est. speed input: 82460.10 toks/s, output: 80.53 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:16<00:11, 64.98it/s, est. speed input: 82216.35 toks/s, output: 80.29 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:16<00:11, 64.97it/s, est. speed input: 81980.59 toks/s, output: 80.06 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:16<00:11, 64.95it/s, est. speed input: 81751.30 toks/s, output: 79.84 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:16<00:10, 64.95it/s, est. speed input: 81529.06 toks/s, output: 79.62 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:17<00:10, 64.94it/s, est. speed input: 81312.80 toks/s, output: 79.41 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:17<00:10, 64.95it/s, est. speed input: 81103.69 toks/s, output: 79.20 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:17<00:10, 64.95it/s, est. speed input: 80899.77 toks/s, output: 79.00 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:17<00:09, 64.95it/s, est. speed input: 80701.43 toks/s, output: 78.81 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:18<00:09, 64.96it/s, est. speed input: 80509.10 toks/s, output: 78.62 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:18<00:09, 64.94it/s, est. speed input: 80320.53 toks/s, output: 78.44 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:18<00:09, 64.94it/s, est. speed input: 80137.68 toks/s, output: 78.26 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:18<00:08, 64.89it/s, est. speed input: 79957.19 toks/s, output: 78.08 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:19<00:08, 64.87it/s, est. speed input: 79781.89 toks/s, output: 77.91 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:19<00:08, 64.86it/s, est. speed input: 79611.14 toks/s, output: 77.75 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:19<00:08, 64.86it/s, est. speed input: 79445.17 toks/s, output: 77.58 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:19<00:07, 64.87it/s, est. speed input: 79284.00 toks/s, output: 77.43 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:20<00:07, 64.90it/s, est. speed input: 79127.59 toks/s, output: 77.27 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:20<00:07, 64.89it/s, est. speed input: 78973.87 toks/s, output: 77.12 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:20<00:07, 64.75it/s, est. speed input: 78817.29 toks/s, output: 76.97 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:20<00:06, 64.62it/s, est. speed input: 78662.46 toks/s, output: 76.82 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:21<00:06, 64.51it/s, est. speed input: 78510.89 toks/s, output: 76.67 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:21<00:06, 64.43it/s, est. speed input: 78362.44 toks/s, output: 76.53 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:21<00:06, 64.36it/s, est. speed input: 78216.93 toks/s, output: 76.38 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:21<00:05, 64.32it/s, est. speed input: 78074.95 toks/s, output: 76.24 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:22<00:05, 64.31it/s, est. speed input: 77936.96 toks/s, output: 76.11 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:22<00:05, 64.29it/s, est. speed input: 77801.70 toks/s, output: 75.98 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:22<00:05, 64.26it/s, est. speed input: 77668.55 toks/s, output: 75.85 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:22<00:04, 64.29it/s, est. speed input: 77540.62 toks/s, output: 75.72 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:23<00:04, 64.29it/s, est. speed input: 77414.30 toks/s, output: 75.60 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:23<00:04, 64.27it/s, est. speed input: 77290.12 toks/s, output: 75.48 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:23<00:04, 64.28it/s, est. speed input: 77169.22 toks/s, output: 75.36 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:23<00:03, 64.29it/s, est. speed input: 77051.37 toks/s, output: 75.25 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:24<00:03, 64.29it/s, est. speed input: 76935.32 toks/s, output: 75.13 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:24<00:03, 64.27it/s, est. speed input: 76820.84 toks/s, output: 75.02 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:24<00:03, 64.26it/s, est. speed input: 76709.05 toks/s, output: 74.91 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:24<00:02, 64.27it/s, est. speed input: 76600.34 toks/s, output: 74.80 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:25<00:02, 65.33it/s, est. speed input: 76534.28 toks/s, output: 74.74 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:25<00:02, 65.02it/s, est. speed input: 76429.30 toks/s, output: 74.64 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:25<00:02, 64.78it/s, est. speed input: 76325.58 toks/s, output: 74.54 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:25<00:01, 64.64it/s, est. speed input: 76224.57 toks/s, output: 74.44 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:26<00:01, 64.52it/s, est. speed input: 76124.97 toks/s, output: 74.34 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:26<00:01, 64.45it/s, est. speed input: 76027.51 toks/s, output: 74.25 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:26<00:01, 64.39it/s, est. speed input: 75931.44 toks/s, output: 74.15 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:26<00:00, 64.34it/s, est. speed input: 75837.10 toks/s, output: 74.06 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:27<00:00, 64.31it/s, est. speed input: 75744.57 toks/s, output: 73.97 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:27<00:00, 64.30it/s, est. speed input: 75654.00 toks/s, output: 73.88 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:27<00:00, 65.53it/s, est. speed input: 75608.30 toks/s, output: 73.84 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:27<00:00, 65.53it/s, est. speed input: 76127.68 toks/s, output: 74.34 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:27<00:00, 74.34it/s, est. speed input: 76127.68 toks/s, output: 74.34 toks/s]
[rank0]:[W128 11:57:48.965258290 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 86.7s

测试结果:
  Requests/s:   62.32
  Tokens/s:     63874.43
  Total Reqs:   2048
  Elapsed:      32.86s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     63812.11

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 11:58:20 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 11:58:21 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=37227) WARNING 01-28 11:58:30 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=37227) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=37227) WARNING 01-28 11:58:40 [backends.py:609] Failed to read file <frozen os>
Throughput: 62.42 requests/s, 63978.71 total tokens/s, 62.42 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 11:58:20] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:58:20] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:58:20] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:58:20] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:20] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:20] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:20] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:20] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:20] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:58:20] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:58:20] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:58:20] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:58:20] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:58:20] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 11:58:29] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 11:58:29] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 11:58:29] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 11:58:29] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:29] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:29] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:29] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:29] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 11:58:29] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 11:58:29] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 11:58:29] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 11:58:29] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 11:58:29] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 11:58:29] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:30] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:30] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:30] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:30] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:30] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:30] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=37227) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=37227) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.00it/s]
(EngineCore_DP0 pid=37227) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  2.00it/s]
(EngineCore_DP0 pid=37227) 
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=37227) [2026-01-28 11:58:31] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=37227) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.65it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  7.77it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.11it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.34it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.47it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  8.55it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.61it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  8.64it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  8.73it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.82it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.26it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.40it/s]
(EngineCore_DP0 pid=37227) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.31it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.25it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.62it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  8.66it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.74it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  8.73it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.79it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.63it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 37/4096 [00:00<00:11, 363.74it/s]
Adding requests:   2%|▏         | 76/4096 [00:00<00:10, 373.59it/s]
Adding requests:   3%|▎         | 116/4096 [00:00<00:10, 384.15it/s]
Adding requests:   4%|▍         | 155/4096 [00:00<00:10, 384.45it/s]
Adding requests:   5%|▍         | 195/4096 [00:00<00:10, 387.08it/s]
Adding requests:   6%|▌         | 236/4096 [00:00<00:09, 392.87it/s]
Adding requests:   7%|▋         | 277/4096 [00:00<00:09, 394.39it/s]
Adding requests:   8%|▊         | 317/4096 [00:00<00:09, 387.60it/s]
Adding requests:   9%|▊         | 356/4096 [00:00<00:09, 384.41it/s]
Adding requests:  10%|▉         | 396/4096 [00:01<00:09, 387.35it/s]
Adding requests:  11%|█         | 435/4096 [00:01<00:09, 380.70it/s]
Adding requests:  12%|█▏        | 475/4096 [00:01<00:09, 385.70it/s]
Adding requests:  13%|█▎        | 514/4096 [00:01<00:09, 383.64it/s]
Adding requests:  14%|█▎        | 553/4096 [00:01<00:09, 380.77it/s]
Adding requests:  15%|█▍        | 595/4096 [00:01<00:08, 391.67it/s]
Adding requests:  16%|█▌        | 636/4096 [00:01<00:08, 396.51it/s]
Adding requests:  17%|█▋        | 678/4096 [00:01<00:08, 402.93it/s]
Adding requests:  18%|█▊        | 719/4096 [00:01<00:08, 404.02it/s]
Adding requests:  19%|█▊        | 760/4096 [00:01<00:08, 401.32it/s]
Adding requests:  20%|█▉        | 801/4096 [00:02<00:08, 398.70it/s]
Adding requests:  21%|██        | 841/4096 [00:02<00:08, 395.00it/s]
Adding requests:  22%|██▏       | 883/4096 [00:02<00:08, 401.28it/s]
Adding requests:  23%|██▎       | 924/4096 [00:02<00:07, 401.78it/s]
Adding requests:  24%|██▎       | 965/4096 [00:02<00:07, 398.34it/s]
Adding requests:  25%|██▍       | 1005/4096 [00:02<00:07, 396.17it/s]
Adding requests:  26%|██▌       | 1046/4096 [00:02<00:07, 399.59it/s]
Adding requests:  27%|██▋       | 1087/4096 [00:02<00:07, 400.39it/s]
Adding requests:  28%|██▊       | 1128/4096 [00:02<00:07, 397.16it/s]
Adding requests:  29%|██▊       | 1170/4096 [00:02<00:07, 403.69it/s]
Adding requests:  30%|██▉       | 1211/4096 [00:03<00:07, 399.19it/s]
Adding requests:  31%|███       | 1251/4096 [00:03<00:07, 397.84it/s]
Adding requests:  32%|███▏      | 1292/4096 [00:03<00:07, 399.69it/s]
Adding requests:  33%|███▎      | 1333/4096 [00:03<00:06, 402.73it/s]
Adding requests:  34%|███▎      | 1374/4096 [00:03<00:06, 402.35it/s]
Adding requests:  35%|███▍      | 1416/4096 [00:03<00:06, 405.64it/s]
Adding requests:  36%|███▌      | 1457/4096 [00:03<00:06, 405.65it/s]
Adding requests:  37%|███▋      | 1498/4096 [00:03<00:06, 403.66it/s]
Adding requests:  38%|███▊      | 1539/4096 [00:03<00:06, 401.99it/s]
Adding requests:  39%|███▊      | 1580/4096 [00:03<00:06, 396.00it/s]
Adding requests:  40%|███▉      | 1623/4096 [00:04<00:06, 403.94it/s]
Adding requests:  41%|████      | 1665/4096 [00:04<00:06, 404.93it/s]
Adding requests:  42%|████▏     | 1707/4096 [00:04<00:05, 408.12it/s]
Adding requests:  43%|████▎     | 1749/4096 [00:04<00:05, 409.75it/s]
Adding requests:  44%|████▎     | 1790/4096 [00:04<00:05, 408.69it/s]
Adding requests:  45%|████▍     | 1832/4096 [00:04<00:05, 410.62it/s]
Adding requests:  46%|████▌     | 1874/4096 [00:04<00:05, 410.98it/s]
Adding requests:  47%|████▋     | 1916/4096 [00:04<00:05, 409.43it/s]
Adding requests:  48%|████▊     | 1957/4096 [00:04<00:05, 407.70it/s]
Adding requests:  49%|████▉     | 1998/4096 [00:05<00:05, 407.79it/s]
Adding requests:  50%|████▉     | 2041/4096 [00:05<00:04, 411.11it/s]
Adding requests:  51%|█████     | 2084/4096 [00:05<00:04, 414.62it/s]
Adding requests:  52%|█████▏    | 2126/4096 [00:05<00:04, 409.34it/s]
Adding requests:  53%|█████▎    | 2167/4096 [00:05<00:04, 404.27it/s]
Adding requests:  54%|█████▍    | 2208/4096 [00:05<00:04, 398.62it/s]
Adding requests:  55%|█████▍    | 2251/4096 [00:05<00:04, 405.39it/s]
Adding requests:  56%|█████▌    | 2292/4096 [00:05<00:04, 405.18it/s]
Adding requests:  57%|█████▋    | 2333/4096 [00:05<00:04, 405.74it/s]
Adding requests:  58%|█████▊    | 2375/4096 [00:05<00:04, 407.60it/s]
Adding requests:  59%|█████▉    | 2416/4096 [00:06<00:04, 394.30it/s]
Adding requests:  60%|██████    | 2458/4096 [00:06<00:04, 399.92it/s]
Adding requests:  61%|██████    | 2500/4096 [00:06<00:03, 404.06it/s]
Adding requests:  62%|██████▏   | 2541/4096 [00:06<00:03, 403.80it/s]
Adding requests:  63%|██████▎   | 2582/4096 [00:06<00:03, 398.94it/s]
Adding requests:  64%|██████▍   | 2622/4096 [00:06<00:03, 394.35it/s]
Adding requests:  65%|██████▌   | 2664/4096 [00:06<00:03, 398.94it/s]
Adding requests:  66%|██████▌   | 2704/4096 [00:06<00:03, 392.23it/s]
Adding requests:  67%|██████▋   | 2745/4096 [00:06<00:03, 395.14it/s]
Adding requests:  68%|██████▊   | 2786/4096 [00:06<00:03, 396.49it/s]
Adding requests:  69%|██████▉   | 2826/4096 [00:07<00:03, 395.46it/s]
Adding requests:  70%|██████▉   | 2867/4096 [00:07<00:03, 398.08it/s]
Adding requests:  71%|███████   | 2909/4096 [00:07<00:02, 403.11it/s]
Adding requests:  72%|███████▏  | 2950/4096 [00:07<00:02, 394.20it/s]
Adding requests:  73%|███████▎  | 2990/4096 [00:07<00:02, 395.19it/s]
Adding requests:  74%|███████▍  | 3030/4096 [00:07<00:02, 392.19it/s]
Adding requests:  75%|███████▍  | 3070/4096 [00:07<00:02, 393.76it/s]
Adding requests:  76%|███████▌  | 3111/4096 [00:07<00:02, 395.55it/s]
Adding requests:  77%|███████▋  | 3151/4096 [00:10<00:18, 52.34it/s] 
Adding requests:  78%|███████▊  | 3191/4096 [00:10<00:12, 70.62it/s]
Adding requests:  79%|███████▉  | 3231/4096 [00:10<00:09, 93.64it/s]
Adding requests:  80%|███████▉  | 3271/4096 [00:10<00:06, 121.40it/s]
Adding requests:  81%|████████  | 3312/4096 [00:10<00:05, 154.15it/s]
Adding requests:  82%|████████▏ | 3354/4096 [00:10<00:03, 191.00it/s]
Adding requests:  83%|████████▎ | 3394/4096 [00:10<00:03, 225.35it/s]
Adding requests:  84%|████████▍ | 3435/4096 [00:10<00:02, 260.82it/s]
Adding requests:  85%|████████▍ | 3475/4096 [00:10<00:02, 287.68it/s]
Adding requests:  86%|████████▌ | 3516/4096 [00:11<00:01, 315.55it/s]
Adding requests:  87%|████████▋ | 3557/4096 [00:11<00:01, 337.85it/s]
Adding requests:  88%|████████▊ | 3597/4096 [00:11<00:01, 353.41it/s]
Adding requests:  89%|████████▉ | 3637/4096 [00:11<00:01, 361.57it/s]
Adding requests:  90%|████████▉ | 3677/4096 [00:11<00:01, 370.25it/s]
Adding requests:  91%|█████████ | 3717/4096 [00:11<00:01, 375.71it/s]
Adding requests:  92%|█████████▏| 3757/4096 [00:11<00:00, 365.98it/s]
Adding requests:  93%|█████████▎| 3797/4096 [00:11<00:00, 373.69it/s]
Adding requests:  94%|█████████▎| 3836/4096 [00:11<00:00, 378.22it/s]
Adding requests:  95%|█████████▍| 3878/4096 [00:11<00:00, 387.94it/s]
Adding requests:  96%|█████████▌| 3918/4096 [00:12<00:00, 389.15it/s]
Adding requests:  97%|█████████▋| 3959/4096 [00:12<00:00, 394.17it/s]
Adding requests:  98%|█████████▊| 3999/4096 [00:12<00:00, 391.05it/s]
Adding requests:  99%|█████████▊| 4039/4096 [00:12<00:00, 391.66it/s]
Adding requests: 100%|█████████▉| 4079/4096 [00:12<00:00, 391.98it/s]
Adding requests: 100%|██████████| 4096/4096 [00:12<00:00, 326.88it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:00<00:01, 2813.29it/s, est. speed input: 2881136.79 toks/s, output: 2813.39 toks/s]
Processed prompts:  22%|██▏       | 892/4096 [00:04<00:19, 167.37it/s, est. speed input: 212360.28 toks/s, output: 207.38 toks/s]   
Processed prompts:  25%|██▍       | 1012/4096 [00:06<00:25, 123.33it/s, est. speed input: 163627.08 toks/s, output: 159.79 toks/s]
Processed prompts:  26%|██▋       | 1080/4096 [00:07<00:27, 110.46it/s, est. speed input: 150336.71 toks/s, output: 146.81 toks/s]
Processed prompts:  27%|██▋       | 1124/4096 [00:08<00:31, 93.99it/s, est. speed input: 137362.39 toks/s, output: 134.14 toks/s] 
Processed prompts:  28%|██▊       | 1154/4096 [00:08<00:33, 89.09it/s, est. speed input: 133116.88 toks/s, output: 130.00 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:09<00:34, 84.42it/s, est. speed input: 129352.10 toks/s, output: 126.32 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:09<00:35, 80.03it/s, est. speed input: 125977.84 toks/s, output: 123.02 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:10<00:37, 76.15it/s, est. speed input: 122938.67 toks/s, output: 120.06 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:10<00:38, 72.94it/s, est. speed input: 120203.08 toks/s, output: 117.39 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:11<00:39, 70.32it/s, est. speed input: 117704.49 toks/s, output: 114.95 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:11<00:40, 68.27it/s, est. speed input: 115416.19 toks/s, output: 112.71 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:12<00:40, 66.74it/s, est. speed input: 113320.49 toks/s, output: 110.66 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:12<00:40, 65.60it/s, est. speed input: 111386.86 toks/s, output: 108.78 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:13<00:40, 64.76it/s, est. speed input: 109598.78 toks/s, output: 107.03 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:13<00:40, 64.15it/s, est. speed input: 107940.00 toks/s, output: 105.41 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:14<00:40, 63.72it/s, est. speed input: 106399.39 toks/s, output: 103.91 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:15<00:40, 63.40it/s, est. speed input: 104960.75 toks/s, output: 102.50 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:15<00:39, 63.18it/s, est. speed input: 103618.18 toks/s, output: 101.19 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:16<00:39, 63.02it/s, est. speed input: 102359.68 toks/s, output: 99.96 toks/s] 
Processed prompts:  40%|███▉      | 1634/4096 [00:16<00:39, 62.92it/s, est. speed input: 101180.91 toks/s, output: 98.81 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:17<00:38, 62.84it/s, est. speed input: 100072.73 toks/s, output: 97.73 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:17<00:38, 62.79it/s, est. speed input: 99028.13 toks/s, output: 96.71 toks/s] 
Processed prompts:  42%|████▏     | 1730/4096 [00:18<00:37, 62.74it/s, est. speed input: 98040.85 toks/s, output: 95.74 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:18<00:37, 62.70it/s, est. speed input: 97108.36 toks/s, output: 94.83 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:19<00:36, 62.67it/s, est. speed input: 96223.69 toks/s, output: 93.97 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:19<00:36, 62.64it/s, est. speed input: 95385.54 toks/s, output: 93.15 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:20<00:35, 63.13it/s, est. speed input: 94654.06 toks/s, output: 92.44 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:20<00:35, 62.98it/s, est. speed input: 93897.21 toks/s, output: 91.70 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:21<00:34, 62.87it/s, est. speed input: 93176.63 toks/s, output: 90.99 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:21<00:34, 62.78it/s, est. speed input: 92488.60 toks/s, output: 90.32 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:22<00:33, 62.71it/s, est. speed input: 91831.62 toks/s, output: 89.68 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:22<00:33, 62.68it/s, est. speed input: 91205.87 toks/s, output: 89.07 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:23<00:32, 62.64it/s, est. speed input: 90607.11 toks/s, output: 88.48 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:23<00:32, 62.63it/s, est. speed input: 90034.49 toks/s, output: 87.92 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:24<00:31, 62.60it/s, est. speed input: 89484.75 toks/s, output: 87.39 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:24<00:31, 62.59it/s, est. speed input: 88958.27 toks/s, output: 86.87 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:25<00:30, 62.58it/s, est. speed input: 88453.42 toks/s, output: 86.38 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:25<00:30, 62.57it/s, est. speed input: 87967.86 toks/s, output: 85.91 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:26<00:29, 62.57it/s, est. speed input: 87502.37 toks/s, output: 85.45 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:26<00:28, 63.06it/s, est. speed input: 87097.64 toks/s, output: 85.06 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:27<00:28, 62.91it/s, est. speed input: 86664.65 toks/s, output: 84.63 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:27<00:27, 62.81it/s, est. speed input: 86248.72 toks/s, output: 84.23 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:28<00:27, 62.74it/s, est. speed input: 85848.01 toks/s, output: 83.84 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:28<00:27, 62.69it/s, est. speed input: 85461.36 toks/s, output: 83.46 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:29<00:26, 62.65it/s, est. speed input: 85087.10 toks/s, output: 83.09 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:29<00:26, 62.61it/s, est. speed input: 84725.37 toks/s, output: 82.74 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:32<00:58, 27.12it/s, est. speed input: 78597.62 toks/s, output: 76.76 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:33<00:47, 32.67it/s, est. speed input: 78372.27 toks/s, output: 76.54 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:33<00:40, 38.14it/s, est. speed input: 78154.87 toks/s, output: 76.32 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:34<00:34, 43.20it/s, est. speed input: 77943.48 toks/s, output: 76.12 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:34<00:30, 47.63it/s, est. speed input: 77739.10 toks/s, output: 75.92 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:35<00:28, 51.31it/s, est. speed input: 77540.24 toks/s, output: 75.72 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:35<00:25, 54.23it/s, est. speed input: 77346.18 toks/s, output: 75.53 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:36<00:24, 56.49it/s, est. speed input: 77158.62 toks/s, output: 75.35 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:36<00:23, 58.17it/s, est. speed input: 76975.02 toks/s, output: 75.17 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:37<00:22, 59.41it/s, est. speed input: 76796.00 toks/s, output: 75.00 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:37<00:21, 60.29it/s, est. speed input: 76621.32 toks/s, output: 74.83 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:38<00:20, 60.92it/s, est. speed input: 76451.35 toks/s, output: 74.66 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:38<00:19, 61.38it/s, est. speed input: 76285.98 toks/s, output: 74.50 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:39<00:19, 61.70it/s, est. speed input: 76124.82 toks/s, output: 74.34 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:39<00:18, 61.93it/s, est. speed input: 75968.27 toks/s, output: 74.19 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:40<00:18, 62.09it/s, est. speed input: 75815.40 toks/s, output: 74.04 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:40<00:17, 62.20it/s, est. speed input: 75666.36 toks/s, output: 73.89 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:41<00:16, 62.28it/s, est. speed input: 75520.76 toks/s, output: 73.75 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:41<00:16, 62.34it/s, est. speed input: 75379.16 toks/s, output: 73.61 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:42<00:15, 62.37it/s, est. speed input: 75240.63 toks/s, output: 73.48 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:42<00:15, 62.39it/s, est. speed input: 75105.25 toks/s, output: 73.34 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:43<00:14, 62.40it/s, est. speed input: 74972.61 toks/s, output: 73.22 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:43<00:14, 62.41it/s, est. speed input: 74843.46 toks/s, output: 73.09 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:44<00:13, 62.42it/s, est. speed input: 74717.57 toks/s, output: 72.97 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:44<00:13, 62.47it/s, est. speed input: 74596.11 toks/s, output: 72.85 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:45<00:12, 62.53it/s, est. speed input: 74478.88 toks/s, output: 72.73 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:45<00:12, 62.57it/s, est. speed input: 74364.16 toks/s, output: 72.62 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:46<00:11, 62.59it/s, est. speed input: 74251.26 toks/s, output: 72.51 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:46<00:11, 62.61it/s, est. speed input: 74141.34 toks/s, output: 72.40 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:47<00:10, 62.62it/s, est. speed input: 74033.83 toks/s, output: 72.30 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:47<00:10, 62.63it/s, est. speed input: 73928.39 toks/s, output: 72.20 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:48<00:09, 62.64it/s, est. speed input: 73825.31 toks/s, output: 72.09 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [00:48<00:09, 62.63it/s, est. speed input: 73723.96 toks/s, output: 72.00 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [00:49<00:08, 62.63it/s, est. speed input: 73624.95 toks/s, output: 71.90 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [00:49<00:08, 62.63it/s, est. speed input: 73527.66 toks/s, output: 71.80 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [00:50<00:07, 62.63it/s, est. speed input: 73432.77 toks/s, output: 71.71 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [00:50<00:07, 62.63it/s, est. speed input: 73339.37 toks/s, output: 71.62 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [00:51<00:06, 62.63it/s, est. speed input: 73248.10 toks/s, output: 71.53 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [00:51<00:06, 63.12it/s, est. speed input: 73176.94 toks/s, output: 71.46 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [00:52<00:05, 62.97it/s, est. speed input: 73088.84 toks/s, output: 71.38 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [00:52<00:05, 62.86it/s, est. speed input: 73002.06 toks/s, output: 71.29 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [00:53<00:04, 62.77it/s, est. speed input: 72916.63 toks/s, output: 71.21 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [00:54<00:04, 62.71it/s, est. speed input: 72833.00 toks/s, output: 71.13 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [00:54<00:03, 62.67it/s, est. speed input: 72750.90 toks/s, output: 71.05 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [00:55<00:03, 62.64it/s, est. speed input: 72670.20 toks/s, output: 70.97 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [00:55<00:02, 62.62it/s, est. speed input: 72591.27 toks/s, output: 70.89 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [00:56<00:02, 62.63it/s, est. speed input: 72514.16 toks/s, output: 70.81 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [00:56<00:01, 62.62it/s, est. speed input: 72438.27 toks/s, output: 70.74 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [00:57<00:00, 63.12it/s, est. speed input: 72380.77 toks/s, output: 70.68 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [00:57<00:00, 63.65it/s, est. speed input: 72330.46 toks/s, output: 70.64 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [00:57<00:00, 63.65it/s, est. speed input: 72863.45 toks/s, output: 71.16 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [00:57<00:00, 71.16it/s, est. speed input: 72863.45 toks/s, output: 71.16 toks/s]
[rank0]:[W128 12:00:03.031794635 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 135.0s

测试结果:
  Requests/s:   62.42
  Tokens/s:     63978.71
  Total Reqs:   4096
  Elapsed:      65.62s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     63916.29


------------------------------------------------------------
  生成 CSV: BitNet-2B-FP8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_4/BitNet-2B-FP8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.4327,8429.9638,7.7894
1024,1024,1,128,128,16.0780,16479.9890,7.9612
2048,1024,2,256,128,32.6262,33441.9008,7.8464
4096,1024,4,512,128,59.7759,61270.3077,8.5653
8192,1024,8,1024,128,61.7461,63289.7273,16.5840
16384,1024,16,2048,128,62.3165,63874.4284,32.8645
32768,1024,32,4096,128,62.4183,63978.7118,65.6218

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-FP8 | cuSPARSELt (2_6) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-FP8-SlideSparse-2_6
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_6

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:00:14 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:00:15 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=38256) WARNING 01-28 12:00:22 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=38256) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=38256) WARNING 01-28 12:00:34 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.13 requests/s, 8273.80 total tokens/s, 16.13 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 12:00:14] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:00:14] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:00:14] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:00:14] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:14] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:14] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:14] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:14] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:14] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:00:14] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:00:14] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:00:14] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:00:14] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:00:14] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:00:21] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:00:21] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:00:21] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:00:21] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:21] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:21] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:21] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:21] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:00:21] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:00:21] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:00:21] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:00:21] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:00:21] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:00:21] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:22] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:22] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:22] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:22] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:22] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:22] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=38256) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=38256) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.69s/it]
(EngineCore_DP0 pid=38256) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.69s/it]
(EngineCore_DP0 pid=38256) 
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=38256) [2026-01-28 12:00:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=38256) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  2.73it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.76it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.76it/s]
(EngineCore_DP0 pid=38256) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.37it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.36it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  51%|█████     | 65/128 [00:00<00:00, 641.80it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 658.87it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:19,  6.55it/s, est. speed input: 3354.71 toks/s, output: 6.55 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:10, 11.89it/s, est. speed input: 5630.56 toks/s, output: 11.00 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:08, 13.97it/s, est. speed input: 6524.40 toks/s, output: 12.74 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:08, 15.12it/s, est. speed input: 7029.46 toks/s, output: 13.73 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:07, 15.71it/s, est. speed input: 7326.40 toks/s, output: 14.31 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:07, 16.06it/s, est. speed input: 7525.35 toks/s, output: 14.70 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:07, 16.36it/s, est. speed input: 7686.55 toks/s, output: 15.01 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:06, 16.49it/s, est. speed input: 7794.27 toks/s, output: 15.22 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:06, 16.58it/s, est. speed input: 7879.96 toks/s, output: 15.39 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.69it/s, est. speed input: 7956.24 toks/s, output: 15.54 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.49it/s, est. speed input: 7981.38 toks/s, output: 15.59 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.59it/s, est. speed input: 8032.24 toks/s, output: 15.69 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.66it/s, est. speed input: 8075.49 toks/s, output: 15.77 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.77it/s, est. speed input: 8120.51 toks/s, output: 15.86 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 16.84it/s, est. speed input: 8158.19 toks/s, output: 15.93 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 16.85it/s, est. speed input: 8187.99 toks/s, output: 15.99 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:02<00:05, 16.90it/s, est. speed input: 8217.63 toks/s, output: 16.05 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.88it/s, est. speed input: 8239.48 toks/s, output: 16.09 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.84it/s, est. speed input: 8257.14 toks/s, output: 16.13 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.80it/s, est. speed input: 8271.99 toks/s, output: 16.16 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.83it/s, est. speed input: 8289.69 toks/s, output: 16.19 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.78it/s, est. speed input: 8300.79 toks/s, output: 16.21 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 16.78it/s, est. speed input: 8313.41 toks/s, output: 16.24 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 16.75it/s, est. speed input: 8322.62 toks/s, output: 16.26 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:03<00:04, 16.70it/s, est. speed input: 8329.28 toks/s, output: 16.27 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 16.72it/s, est. speed input: 8338.87 toks/s, output: 16.29 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 16.77it/s, est. speed input: 8350.36 toks/s, output: 16.31 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.79it/s, est. speed input: 8359.57 toks/s, output: 16.33 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.72it/s, est. speed input: 8363.74 toks/s, output: 16.34 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.68it/s, est. speed input: 8367.85 toks/s, output: 16.34 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:04, 16.65it/s, est. speed input: 8371.71 toks/s, output: 16.35 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 16.68it/s, est. speed input: 8377.95 toks/s, output: 16.36 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 16.68it/s, est. speed input: 8383.16 toks/s, output: 16.37 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 16.69it/s, est. speed input: 8388.07 toks/s, output: 16.38 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.67it/s, est. speed input: 8391.43 toks/s, output: 16.39 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.66it/s, est. speed input: 8394.98 toks/s, output: 16.40 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.57it/s, est. speed input: 8394.53 toks/s, output: 16.40 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.59it/s, est. speed input: 8397.91 toks/s, output: 16.40 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.59it/s, est. speed input: 8400.40 toks/s, output: 16.41 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 16.55it/s, est. speed input: 8400.83 toks/s, output: 16.41 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 16.59it/s, est. speed input: 8404.26 toks/s, output: 16.41 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:05<00:02, 16.62it/s, est. speed input: 8407.55 toks/s, output: 16.42 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 16.67it/s, est. speed input: 8411.99 toks/s, output: 16.43 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.74it/s, est. speed input: 8417.37 toks/s, output: 16.44 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.75it/s, est. speed input: 8421.29 toks/s, output: 16.45 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.76it/s, est. speed input: 8424.86 toks/s, output: 16.45 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.80it/s, est. speed input: 8429.64 toks/s, output: 16.46 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 16.66it/s, est. speed input: 8428.16 toks/s, output: 16.46 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 16.73it/s, est. speed input: 8432.84 toks/s, output: 16.47 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:06<00:01, 16.80it/s, est. speed input: 8437.87 toks/s, output: 16.48 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 16.84it/s, est. speed input: 8442.34 toks/s, output: 16.49 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 16.81it/s, est. speed input: 8444.69 toks/s, output: 16.49 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.75it/s, est. speed input: 8445.79 toks/s, output: 16.50 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.72it/s, est. speed input: 8447.29 toks/s, output: 16.50 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.76it/s, est. speed input: 8450.50 toks/s, output: 16.50 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.77it/s, est. speed input: 8453.29 toks/s, output: 16.51 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 16.77it/s, est. speed input: 8455.61 toks/s, output: 16.51 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 16.71it/s, est. speed input: 8456.13 toks/s, output: 16.52 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 16.70it/s, est. speed input: 8457.48 toks/s, output: 16.52 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 16.64it/s, est. speed input: 8457.27 toks/s, output: 16.52 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 16.64it/s, est. speed input: 8458.33 toks/s, output: 16.52 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.65it/s, est. speed input: 8459.70 toks/s, output: 16.52 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.69it/s, est. speed input: 8461.65 toks/s, output: 16.53 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.75it/s, est. speed input: 8464.70 toks/s, output: 16.53 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.75it/s, est. speed input: 8466.49 toks/s, output: 16.54 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.54it/s, est. speed input: 8466.49 toks/s, output: 16.54 toks/s]
[rank0]:[W128 12:01:01.830449085 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 58.2s

测试结果:
  Requests/s:   16.13
  Tokens/s:     8273.80
  Total Reqs:   128
  Elapsed:      7.94s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8257.67

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:01:11 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:01:12 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=38902) WARNING 01-28 12:01:18 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=38902) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=38902) WARNING 01-28 12:01:31 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.91 requests/s, 16304.71 total tokens/s, 15.91 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 12:01:11] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:01:11] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:01:11] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:01:11] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:11] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:11] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:11] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:11] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:11] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:01:11] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:01:11] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:01:11] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:01:11] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:01:11] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:01:18] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:01:18] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:01:18] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:01:18] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:18] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:18] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:18] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:18] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:01:18] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:01:18] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:01:18] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:01:18] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:01:18] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:01:18] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:19] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:19] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:19] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:19] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:19] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:19] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=38902) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=38902) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.86s/it]
(EngineCore_DP0 pid=38902) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.86s/it]
(EngineCore_DP0 pid=38902) 
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=38902) [2026-01-28 12:01:22] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=38902) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.85it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.04it/s]
(EngineCore_DP0 pid=38902) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.43it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.42it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  29%|██▉       | 37/128 [00:00<00:00, 365.29it/s]
Adding requests:  59%|█████▉    | 76/128 [00:00<00:00, 375.62it/s]
Adding requests:  89%|████████▉ | 114/128 [00:00<00:00, 372.67it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 373.95it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:06, 19.02it/s, est. speed input: 19482.87 toks/s, output: 19.02 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:07, 17.57it/s, est. speed input: 18243.06 toks/s, output: 17.81 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:07, 16.87it/s, est. speed input: 17657.85 toks/s, output: 17.24 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:07, 16.70it/s, est. speed input: 17460.12 toks/s, output: 17.05 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:07, 16.53it/s, est. speed input: 17299.12 toks/s, output: 16.89 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:06, 16.46it/s, est. speed input: 17208.19 toks/s, output: 16.80 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:06, 16.45it/s, est. speed input: 17155.91 toks/s, output: 16.75 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:06, 16.40it/s, est. speed input: 17098.16 toks/s, output: 16.70 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.38it/s, est. speed input: 17058.76 toks/s, output: 16.66 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.36it/s, est. speed input: 17025.03 toks/s, output: 16.63 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.39it/s, est. speed input: 17010.81 toks/s, output: 16.61 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.41it/s, est. speed input: 16997.71 toks/s, output: 16.60 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.40it/s, est. speed input: 16980.83 toks/s, output: 16.58 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:06, 16.43it/s, est. speed input: 16974.92 toks/s, output: 16.58 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 16.44it/s, est. speed input: 16966.59 toks/s, output: 16.57 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 16.46it/s, est. speed input: 16962.20 toks/s, output: 16.56 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.49it/s, est. speed input: 16963.16 toks/s, output: 16.57 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.48it/s, est. speed input: 16956.44 toks/s, output: 16.56 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.24it/s, est. speed input: 16909.63 toks/s, output: 16.51 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.17it/s, est. speed input: 16882.85 toks/s, output: 16.49 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.13it/s, est. speed input: 16861.24 toks/s, output: 16.47 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:05, 16.09it/s, est. speed input: 16840.22 toks/s, output: 16.45 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 16.29it/s, est. speed input: 16853.70 toks/s, output: 16.46 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 16.40it/s, est. speed input: 16862.84 toks/s, output: 16.47 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 16.49it/s, est. speed input: 16871.17 toks/s, output: 16.48 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 16.56it/s, est. speed input: 16880.57 toks/s, output: 16.48 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.69it/s, est. speed input: 16899.11 toks/s, output: 16.50 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.78it/s, est. speed input: 16916.03 toks/s, output: 16.52 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.84it/s, est. speed input: 16932.22 toks/s, output: 16.54 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 16.82it/s, est. speed input: 16940.23 toks/s, output: 16.54 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 16.87it/s, est. speed input: 16953.80 toks/s, output: 16.56 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 16.89it/s, est. speed input: 16965.82 toks/s, output: 16.57 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 16.92it/s, est. speed input: 16978.55 toks/s, output: 16.58 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.94it/s, est. speed input: 16990.03 toks/s, output: 16.59 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.98it/s, est. speed input: 17003.91 toks/s, output: 16.61 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 17.01it/s, est. speed input: 17016.90 toks/s, output: 16.62 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 17.03it/s, est. speed input: 17029.35 toks/s, output: 16.63 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:02, 17.02it/s, est. speed input: 17038.86 toks/s, output: 16.64 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 16.82it/s, est. speed input: 17031.38 toks/s, output: 16.63 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 16.54it/s, est. speed input: 17013.18 toks/s, output: 16.61 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 16.45it/s, est. speed input: 17003.92 toks/s, output: 16.61 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 16.51it/s, est. speed input: 17005.11 toks/s, output: 16.61 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.58it/s, est. speed input: 17008.18 toks/s, output: 16.61 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.70it/s, est. speed input: 17016.52 toks/s, output: 16.62 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.74it/s, est. speed input: 17021.75 toks/s, output: 16.62 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.73it/s, est. speed input: 17023.22 toks/s, output: 16.62 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 16.53it/s, est. speed input: 17011.16 toks/s, output: 16.61 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 16.46it/s, est. speed input: 17004.65 toks/s, output: 16.61 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 16.46it/s, est. speed input: 17001.43 toks/s, output: 16.60 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 16.54it/s, est. speed input: 17003.88 toks/s, output: 16.61 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 16.49it/s, est. speed input: 16999.32 toks/s, output: 16.60 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.48it/s, est. speed input: 16996.15 toks/s, output: 16.60 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.46it/s, est. speed input: 16992.62 toks/s, output: 16.59 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.46it/s, est. speed input: 16990.23 toks/s, output: 16.59 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.57it/s, est. speed input: 16994.39 toks/s, output: 16.60 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 16.62it/s, est. speed input: 16997.00 toks/s, output: 16.60 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:09<00:05,  2.51it/s, est. speed input: 12818.49 toks/s, output: 12.52 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:09<00:03,  3.36it/s, est. speed input: 12873.15 toks/s, output: 12.57 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:09<00:02,  4.43it/s, est. speed input: 12927.81 toks/s, output: 12.62 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:09<00:01,  5.68it/s, est. speed input: 12979.95 toks/s, output: 12.68 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:09<00:00,  7.09it/s, est. speed input: 13033.57 toks/s, output: 12.73 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:09<00:00,  8.60it/s, est. speed input: 13087.19 toks/s, output: 12.78 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:09<00:00, 10.08it/s, est. speed input: 13137.08 toks/s, output: 12.83 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 10.08it/s, est. speed input: 13162.54 toks/s, output: 12.85 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 12.85it/s, est. speed input: 13162.54 toks/s, output: 12.85 toks/s]
[rank0]:[W128 12:01:57.465118610 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 56.2s

测试结果:
  Requests/s:   15.91
  Tokens/s:     16304.71
  Total Reqs:   128
  Elapsed:      8.05s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16288.80

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:02:08 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:02:08 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=39504) WARNING 01-28 12:02:15 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=39504) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=39504) WARNING 01-28 12:02:25 [backends.py:609] Failed to read file <frozen os>
Throughput: 32.56 requests/s, 33372.25 total tokens/s, 32.56 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 12:02:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:02:08] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:02:08] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:02:08] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:08] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:08] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:08] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:08] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:08] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:02:08] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:02:08] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:02:08] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:02:08] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:02:08] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:02:15] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:02:15] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:02:15] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:02:15] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:15] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:15] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:15] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:15] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:02:15] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:02:15] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:02:15] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:02:15] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:02:15] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:02:15] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:16] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:16] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:16] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:16] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:16] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:16] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=39504) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=39504) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.65it/s]
(EngineCore_DP0 pid=39504) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.65it/s]
(EngineCore_DP0 pid=39504) 
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=39504) [2026-01-28 12:02:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=39504) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.71it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.21it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.69it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.77it/s]
(EngineCore_DP0 pid=39504) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.08it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.17it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.98it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 36/256 [00:00<00:00, 355.54it/s]
Adding requests:  30%|██▉       | 76/256 [00:00<00:00, 379.17it/s]
Adding requests:  45%|████▍     | 114/256 [00:00<00:00, 374.87it/s]
Adding requests:  59%|█████▉    | 152/256 [00:00<00:00, 376.15it/s]
Adding requests:  74%|███████▍  | 190/256 [00:00<00:00, 375.06it/s]
Adding requests:  89%|████████▉ | 228/256 [00:00<00:00, 375.88it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 375.32it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:00<00:01, 165.77it/s, est. speed input: 169782.06 toks/s, output: 165.78 toks/s]
Processed prompts:  14%|█▎        | 35/256 [00:00<00:04, 52.91it/s, est. speed input: 60542.54 toks/s, output: 59.12 toks/s]   
Processed prompts:  17%|█▋        | 44/256 [00:00<00:04, 43.07it/s, est. speed input: 50599.70 toks/s, output: 49.41 toks/s]
Processed prompts:  20%|█▉        | 51/256 [00:01<00:04, 42.14it/s, est. speed input: 48935.04 toks/s, output: 47.79 toks/s]
Processed prompts:  22%|██▏       | 57/256 [00:01<00:04, 39.97it/s, est. speed input: 46982.39 toks/s, output: 45.88 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 36.73it/s, est. speed input: 44779.39 toks/s, output: 43.73 toks/s]
Processed prompts:  26%|██▌       | 67/256 [00:01<00:04, 37.98it/s, est. speed input: 44692.83 toks/s, output: 43.65 toks/s]
Processed prompts:  28%|██▊       | 72/256 [00:01<00:05, 34.80it/s, est. speed input: 43013.12 toks/s, output: 42.00 toks/s]
Processed prompts:  30%|██▉       | 76/256 [00:01<00:05, 34.62it/s, est. speed input: 42486.37 toks/s, output: 41.49 toks/s]
Processed prompts:  31%|███▏      | 80/256 [00:01<00:05, 34.45it/s, est. speed input: 42018.13 toks/s, output: 41.03 toks/s]
Processed prompts:  33%|███▎      | 84/256 [00:02<00:05, 34.21it/s, est. speed input: 41575.85 toks/s, output: 40.60 toks/s]
Processed prompts:  34%|███▍      | 88/256 [00:02<00:04, 34.02it/s, est. speed input: 41178.96 toks/s, output: 40.21 toks/s]
Processed prompts:  36%|███▌      | 92/256 [00:02<00:04, 34.01it/s, est. speed input: 40855.05 toks/s, output: 39.90 toks/s]
Processed prompts:  38%|███▊      | 96/256 [00:02<00:04, 33.97it/s, est. speed input: 40553.48 toks/s, output: 39.60 toks/s]
Processed prompts:  39%|███▉      | 100/256 [00:02<00:04, 33.79it/s, est. speed input: 40252.17 toks/s, output: 39.31 toks/s]
Processed prompts:  41%|████      | 104/256 [00:02<00:04, 33.87it/s, est. speed input: 40014.47 toks/s, output: 39.08 toks/s]
Processed prompts:  42%|████▏     | 108/256 [00:02<00:04, 33.91it/s, est. speed input: 39795.18 toks/s, output: 38.86 toks/s]
Processed prompts:  44%|████▍     | 112/256 [00:02<00:04, 33.92it/s, est. speed input: 39590.86 toks/s, output: 38.66 toks/s]
Processed prompts:  45%|████▌     | 116/256 [00:03<00:04, 33.93it/s, est. speed input: 39401.28 toks/s, output: 38.48 toks/s]
Processed prompts:  47%|████▋     | 120/256 [00:03<00:04, 33.89it/s, est. speed input: 39219.97 toks/s, output: 38.30 toks/s]
Processed prompts:  48%|████▊     | 124/256 [00:03<00:03, 33.92it/s, est. speed input: 39060.13 toks/s, output: 38.14 toks/s]
Processed prompts:  50%|█████     | 128/256 [00:03<00:03, 33.92it/s, est. speed input: 38909.28 toks/s, output: 38.00 toks/s]
Processed prompts:  52%|█████▏    | 132/256 [00:03<00:03, 33.77it/s, est. speed input: 38749.03 toks/s, output: 37.84 toks/s]
Processed prompts:  53%|█████▎    | 136/256 [00:03<00:03, 33.79it/s, est. speed input: 38614.14 toks/s, output: 37.71 toks/s]
Processed prompts:  55%|█████▍    | 140/256 [00:03<00:03, 33.61it/s, est. speed input: 38465.31 toks/s, output: 37.56 toks/s]
Processed prompts:  56%|█████▋    | 144/256 [00:03<00:03, 33.61it/s, est. speed input: 38339.29 toks/s, output: 37.44 toks/s]
Processed prompts:  58%|█████▊    | 148/256 [00:03<00:03, 33.71it/s, est. speed input: 38232.76 toks/s, output: 37.34 toks/s]
Processed prompts:  59%|█████▉    | 152/256 [00:04<00:03, 33.80it/s, est. speed input: 38134.75 toks/s, output: 37.24 toks/s]
Processed prompts:  61%|██████    | 156/256 [00:04<00:02, 33.74it/s, est. speed input: 38028.94 toks/s, output: 37.14 toks/s]
Processed prompts:  62%|██████▎   | 160/256 [00:04<00:02, 33.77it/s, est. speed input: 37936.25 toks/s, output: 37.05 toks/s]
Processed prompts:  64%|██████▍   | 164/256 [00:04<00:02, 33.84it/s, est. speed input: 37853.77 toks/s, output: 36.97 toks/s]
Processed prompts:  66%|██████▌   | 168/256 [00:04<00:02, 33.89it/s, est. speed input: 37775.22 toks/s, output: 36.89 toks/s]
Processed prompts:  67%|██████▋   | 172/256 [00:04<00:02, 33.92it/s, est. speed input: 37700.74 toks/s, output: 36.82 toks/s]
Processed prompts:  69%|██████▉   | 176/256 [00:04<00:02, 33.75it/s, est. speed input: 37611.91 toks/s, output: 36.73 toks/s]
Processed prompts:  70%|███████   | 180/256 [00:04<00:02, 33.80it/s, est. speed input: 37543.24 toks/s, output: 36.66 toks/s]
Processed prompts:  72%|███████▏  | 184/256 [00:05<00:02, 33.87it/s, est. speed input: 37479.83 toks/s, output: 36.60 toks/s]
Processed prompts:  73%|███████▎  | 188/256 [00:05<00:02, 33.93it/s, est. speed input: 37420.78 toks/s, output: 36.54 toks/s]
Processed prompts:  75%|███████▌  | 192/256 [00:05<00:01, 33.96it/s, est. speed input: 37363.72 toks/s, output: 36.49 toks/s]
Processed prompts:  77%|███████▋  | 196/256 [00:05<00:01, 33.97it/s, est. speed input: 37307.55 toks/s, output: 36.43 toks/s]
Processed prompts:  78%|███████▊  | 200/256 [00:05<00:01, 33.98it/s, est. speed input: 37254.32 toks/s, output: 36.38 toks/s]
Processed prompts:  80%|███████▉  | 204/256 [00:05<00:01, 34.00it/s, est. speed input: 37204.32 toks/s, output: 36.33 toks/s]
Processed prompts:  81%|████████▏ | 208/256 [00:05<00:01, 33.94it/s, est. speed input: 37150.81 toks/s, output: 36.28 toks/s]
Processed prompts:  83%|████████▎ | 212/256 [00:05<00:01, 33.64it/s, est. speed input: 37080.48 toks/s, output: 36.21 toks/s]
Processed prompts:  84%|████████▍ | 216/256 [00:05<00:01, 33.72it/s, est. speed input: 37033.98 toks/s, output: 36.17 toks/s]
Processed prompts:  86%|████████▌ | 220/256 [00:06<00:01, 33.83it/s, est. speed input: 36993.01 toks/s, output: 36.13 toks/s]
Processed prompts:  88%|████████▊ | 224/256 [00:06<00:00, 33.60it/s, est. speed input: 36932.31 toks/s, output: 36.07 toks/s]
Processed prompts:  89%|████████▉ | 228/256 [00:06<00:00, 33.61it/s, est. speed input: 36885.17 toks/s, output: 36.02 toks/s]
Processed prompts:  91%|█████████ | 232/256 [00:06<00:00, 33.29it/s, est. speed input: 36818.09 toks/s, output: 35.96 toks/s]
Processed prompts:  92%|█████████▏| 236/256 [00:06<00:00, 33.12it/s, est. speed input: 36756.54 toks/s, output: 35.89 toks/s]
Processed prompts:  94%|█████████▍| 240/256 [00:06<00:00, 32.99it/s, est. speed input: 36696.56 toks/s, output: 35.84 toks/s]
Processed prompts:  95%|█████████▌| 244/256 [00:06<00:00, 33.03it/s, est. speed input: 36647.42 toks/s, output: 35.79 toks/s]
Processed prompts:  97%|█████████▋| 248/256 [00:06<00:00, 33.07it/s, est. speed input: 36600.62 toks/s, output: 35.74 toks/s]
Processed prompts:  98%|█████████▊| 252/256 [00:07<00:00, 33.10it/s, est. speed input: 36555.83 toks/s, output: 35.70 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 33.16it/s, est. speed input: 36514.78 toks/s, output: 35.66 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 33.16it/s, est. speed input: 36514.78 toks/s, output: 35.66 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 35.66it/s, est. speed input: 36514.78 toks/s, output: 35.66 toks/s]
[rank0]:[W128 12:02:52.765029948 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 54.6s

测试结果:
  Requests/s:   32.56
  Tokens/s:     33372.25
  Total Reqs:   256
  Elapsed:      7.86s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     33339.69

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:03:03 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:03:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=40131) WARNING 01-28 12:03:13 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=40131) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=40131) WARNING 01-28 12:03:23 [backends.py:609] Failed to read file <frozen os>
Throughput: 53.54 requests/s, 54880.48 total tokens/s, 53.54 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 12:03:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:03:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:03:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:03:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:03:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:03:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:03:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:03:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:03:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:03:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:03:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:03:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:03:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:03:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:03:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:03:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:03:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:03:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:03:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:14] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:14] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:14] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:14] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:14] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:14] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=40131) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=40131) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.59it/s]
(EngineCore_DP0 pid=40131) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.59it/s]
(EngineCore_DP0 pid=40131) 
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=40131) [2026-01-28 12:03:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=40131) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  7.87it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.40it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.55it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.92it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.07it/s]
(EngineCore_DP0 pid=40131) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.24it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.04it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.41it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.21it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 359.83it/s]
Adding requests:  15%|█▍        | 75/512 [00:00<00:01, 375.34it/s]
Adding requests:  22%|██▏       | 114/512 [00:00<00:01, 379.67it/s]
Adding requests:  30%|██▉       | 152/512 [00:00<00:00, 368.96it/s]
Adding requests:  37%|███▋      | 190/512 [00:00<00:00, 370.52it/s]
Adding requests:  45%|████▍     | 228/512 [00:00<00:00, 370.30it/s]
Adding requests:  52%|█████▏    | 267/512 [00:00<00:00, 375.80it/s]
Adding requests:  60%|█████▉    | 305/512 [00:00<00:00, 371.72it/s]
Adding requests:  67%|██████▋   | 343/512 [00:00<00:00, 366.71it/s]
Adding requests:  74%|███████▍  | 381/512 [00:01<00:00, 368.85it/s]
Adding requests:  82%|████████▏ | 419/512 [00:01<00:00, 369.82it/s]
Adding requests:  89%|████████▉ | 456/512 [00:01<00:00, 367.93it/s]
Adding requests:  96%|█████████▋| 494/512 [00:01<00:00, 371.29it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 370.92it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:00<00:00, 449.37it/s, est. speed input: 460227.37 toks/s, output: 449.39 toks/s]
Processed prompts:  22%|██▏       | 111/512 [00:00<00:03, 101.48it/s, est. speed input: 120561.61 toks/s, output: 117.74 toks/s]
Processed prompts:  26%|██▌       | 133/512 [00:01<00:04, 86.51it/s, est. speed input: 104289.85 toks/s, output: 101.85 toks/s] 
Processed prompts:  29%|██▉       | 148/512 [00:01<00:04, 76.28it/s, est. speed input: 94973.31 toks/s, output: 92.75 toks/s]  
Processed prompts:  31%|███       | 159/512 [00:01<00:05, 70.13it/s, est. speed input: 89801.91 toks/s, output: 87.70 toks/s]
Processed prompts:  33%|███▎      | 168/512 [00:01<00:05, 68.63it/s, est. speed input: 87859.44 toks/s, output: 85.80 toks/s]
Processed prompts:  34%|███▍      | 176/512 [00:02<00:05, 65.85it/s, est. speed input: 85716.22 toks/s, output: 83.71 toks/s]
Processed prompts:  36%|███▌      | 184/512 [00:02<00:05, 63.39it/s, est. speed input: 83834.12 toks/s, output: 81.87 toks/s]
Processed prompts:  37%|███▋      | 191/512 [00:02<00:05, 59.60it/s, est. speed input: 81735.18 toks/s, output: 79.82 toks/s]
Processed prompts:  39%|███▊      | 198/512 [00:02<00:05, 56.64it/s, est. speed input: 79890.00 toks/s, output: 78.02 toks/s]
Processed prompts:  40%|████      | 206/512 [00:02<00:05, 56.19it/s, est. speed input: 78612.91 toks/s, output: 76.77 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:02<00:05, 55.94it/s, est. speed input: 77486.18 toks/s, output: 75.67 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:02<00:05, 55.72it/s, est. speed input: 76464.84 toks/s, output: 74.67 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:03<00:05, 55.55it/s, est. speed input: 75533.07 toks/s, output: 73.76 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:03<00:04, 55.44it/s, est. speed input: 74687.00 toks/s, output: 72.94 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:03<00:04, 55.36it/s, est. speed input: 73912.55 toks/s, output: 72.18 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:03<00:04, 55.29it/s, est. speed input: 73199.21 toks/s, output: 71.48 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:03<00:04, 55.19it/s, est. speed input: 72534.28 toks/s, output: 70.83 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:03<00:04, 55.21it/s, est. speed input: 71931.67 toks/s, output: 70.25 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:03<00:04, 55.22it/s, est. speed input: 71376.85 toks/s, output: 69.70 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:04<00:04, 55.22it/s, est. speed input: 70853.78 toks/s, output: 69.19 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:04<00:03, 55.21it/s, est. speed input: 70367.91 toks/s, output: 68.72 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:04<00:03, 55.21it/s, est. speed input: 69916.77 toks/s, output: 68.28 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:04<00:03, 55.22it/s, est. speed input: 69492.36 toks/s, output: 67.86 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:04<00:03, 55.23it/s, est. speed input: 69096.53 toks/s, output: 67.48 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:04<00:03, 55.21it/s, est. speed input: 68720.23 toks/s, output: 67.11 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:05<00:03, 55.23it/s, est. speed input: 68368.21 toks/s, output: 66.77 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:05<00:03, 55.18it/s, est. speed input: 68030.20 toks/s, output: 66.44 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:05<00:02, 55.07it/s, est. speed input: 67702.27 toks/s, output: 66.12 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:05<00:02, 55.07it/s, est. speed input: 67400.95 toks/s, output: 65.82 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:05<00:02, 55.08it/s, est. speed input: 67114.77 toks/s, output: 65.54 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:05<00:02, 55.05it/s, est. speed input: 66839.89 toks/s, output: 65.27 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:05<00:02, 55.10it/s, est. speed input: 66586.10 toks/s, output: 65.03 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:06<00:02, 55.05it/s, est. speed input: 66335.91 toks/s, output: 64.78 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:06<00:02, 55.06it/s, est. speed input: 66102.54 toks/s, output: 64.55 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:06<00:01, 55.11it/s, est. speed input: 65882.83 toks/s, output: 64.34 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:06<00:01, 55.21it/s, est. speed input: 65679.63 toks/s, output: 64.14 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:06<00:01, 55.22it/s, est. speed input: 65479.91 toks/s, output: 63.95 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:06<00:01, 55.26it/s, est. speed input: 65291.86 toks/s, output: 63.76 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:06<00:01, 55.29it/s, est. speed input: 65110.76 toks/s, output: 63.58 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:07<00:01, 55.27it/s, est. speed input: 64934.50 toks/s, output: 63.41 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:07<00:01, 55.31it/s, est. speed input: 64769.73 toks/s, output: 63.25 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:07<00:00, 55.31it/s, est. speed input: 64608.84 toks/s, output: 63.09 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:07<00:00, 55.33it/s, est. speed input: 64456.04 toks/s, output: 62.95 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:07<00:00, 55.36it/s, est. speed input: 64310.04 toks/s, output: 62.80 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:07<00:00, 55.37it/s, est. speed input: 64168.84 toks/s, output: 62.66 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:07<00:00, 55.33it/s, est. speed input: 64029.31 toks/s, output: 62.53 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:08<00:00, 55.23it/s, est. speed input: 63890.06 toks/s, output: 62.39 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:08<00:00, 56.43it/s, est. speed input: 63840.25 toks/s, output: 62.34 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 56.43it/s, est. speed input: 64089.16 toks/s, output: 62.59 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 62.59it/s, est. speed input: 64089.16 toks/s, output: 62.59 toks/s]
[rank0]:[W128 12:03:52.113997964 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 59.8s

测试结果:
  Requests/s:   53.54
  Tokens/s:     54880.48
  Total Reqs:   512
  Elapsed:      9.56s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     54826.94

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:04:06 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:04:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=40762) WARNING 01-28 12:04:16 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=40762) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=40762) WARNING 01-28 12:04:26 [backends.py:609] Failed to read file <frozen os>
Throughput: 53.60 requests/s, 54938.78 total tokens/s, 53.60 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 12:04:06] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:04:06] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:04:06] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:04:06] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:06] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:06] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:06] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:06] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:06] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:04:06] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:04:06] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:04:06] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:04:06] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:04:06] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:04:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:04:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:04:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:04:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:04:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:04:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:04:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:04:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:04:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:04:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:16] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:16] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:16] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:16] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:16] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:16] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=40762) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=40762) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.64it/s]
(EngineCore_DP0 pid=40762) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.64it/s]
(EngineCore_DP0 pid=40762) 
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=40762) [2026-01-28 12:04:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=40762) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  4.07it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  5.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  6.82it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  7.46it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.32it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  6.77it/s]
(EngineCore_DP0 pid=40762) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.13it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.15it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  8.47it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.63it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.40it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 37/1024 [00:00<00:02, 368.24it/s]
Adding requests:   7%|▋         | 76/1024 [00:00<00:02, 376.25it/s]
Adding requests:  11%|█         | 114/1024 [00:00<00:02, 361.88it/s]
Adding requests:  15%|█▍        | 151/1024 [00:00<00:02, 354.27it/s]
Adding requests:  19%|█▊        | 190/1024 [00:00<00:02, 365.40it/s]
Adding requests:  22%|██▏       | 230/1024 [00:00<00:02, 374.63it/s]
Adding requests:  26%|██▋       | 270/1024 [00:00<00:01, 379.97it/s]
Adding requests:  30%|███       | 309/1024 [00:00<00:01, 378.64it/s]
Adding requests:  34%|███▍      | 347/1024 [00:00<00:01, 375.68it/s]
Adding requests:  38%|███▊      | 386/1024 [00:01<00:01, 379.61it/s]
Adding requests:  42%|████▏     | 426/1024 [00:01<00:01, 383.33it/s]
Adding requests:  45%|████▌     | 465/1024 [00:01<00:01, 379.30it/s]
Adding requests:  49%|████▉     | 503/1024 [00:01<00:01, 377.75it/s]
Adding requests:  53%|█████▎    | 541/1024 [00:01<00:01, 368.35it/s]
Adding requests:  57%|█████▋    | 581/1024 [00:01<00:01, 377.28it/s]
Adding requests:  61%|██████    | 620/1024 [00:01<00:01, 380.99it/s]
Adding requests:  64%|██████▍   | 660/1024 [00:01<00:00, 384.99it/s]
Adding requests:  68%|██████▊   | 700/1024 [00:01<00:00, 388.59it/s]
Adding requests:  72%|███████▏  | 739/1024 [00:01<00:00, 383.23it/s]
Adding requests:  76%|███████▌  | 778/1024 [00:02<00:00, 384.76it/s]
Adding requests:  80%|███████▉  | 817/1024 [00:02<00:00, 382.16it/s]
Adding requests:  84%|████████▎ | 856/1024 [00:02<00:00, 383.37it/s]
Adding requests:  88%|████████▊ | 897/1024 [00:02<00:00, 390.27it/s]
Adding requests:  92%|█████████▏| 937/1024 [00:02<00:00, 388.74it/s]
Adding requests:  96%|█████████▌| 978/1024 [00:02<00:00, 392.27it/s]
Adding requests: 100%|█████████▉| 1019/1024 [00:02<00:00, 396.53it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 381.59it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:00<00:01, 636.66it/s, est. speed input: 652025.46 toks/s, output: 636.69 toks/s]
Processed prompts:  20%|█▉        | 202/1024 [00:01<00:06, 120.94it/s, est. speed input: 148495.26 toks/s, output: 145.01 toks/s]
Processed prompts:  23%|██▎       | 232/1024 [00:01<00:07, 103.80it/s, est. speed input: 129430.15 toks/s, output: 126.40 toks/s]
Processed prompts:  25%|██▍       | 252/1024 [00:02<00:09, 85.36it/s, est. speed input: 113312.50 toks/s, output: 110.66 toks/s] 
Processed prompts:  26%|██▌       | 266/1024 [00:04<00:27, 27.16it/s, est. speed input: 55638.20 toks/s, output: 54.33 toks/s]  
Processed prompts:  27%|██▋       | 275/1024 [00:05<00:25, 29.02it/s, est. speed input: 55827.70 toks/s, output: 54.52 toks/s]
Processed prompts:  28%|██▊       | 283/1024 [00:05<00:24, 30.86it/s, est. speed input: 55814.88 toks/s, output: 54.51 toks/s]
Processed prompts:  28%|██▊       | 291/1024 [00:05<00:22, 33.05it/s, est. speed input: 55796.88 toks/s, output: 54.49 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:05<00:20, 34.75it/s, est. speed input: 55595.59 toks/s, output: 54.29 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:05<00:19, 37.56it/s, est. speed input: 55588.89 toks/s, output: 54.29 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:05<00:17, 40.37it/s, est. speed input: 55577.33 toks/s, output: 54.27 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:05<00:16, 43.02it/s, est. speed input: 55564.11 toks/s, output: 54.26 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:06<00:15, 45.43it/s, est. speed input: 55556.44 toks/s, output: 54.25 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:06<00:14, 47.42it/s, est. speed input: 55542.87 toks/s, output: 54.24 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:06<00:13, 49.09it/s, est. speed input: 55536.69 toks/s, output: 54.23 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:06<00:13, 50.37it/s, est. speed input: 55529.67 toks/s, output: 54.23 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:06<00:12, 51.32it/s, est. speed input: 55519.01 toks/s, output: 54.22 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:06<00:12, 52.03it/s, est. speed input: 55510.91 toks/s, output: 54.21 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:06<00:12, 52.53it/s, est. speed input: 55502.22 toks/s, output: 54.20 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:07<00:12, 52.93it/s, est. speed input: 55494.89 toks/s, output: 54.19 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:07<00:11, 53.25it/s, est. speed input: 55492.05 toks/s, output: 54.19 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:07<00:11, 53.45it/s, est. speed input: 55485.50 toks/s, output: 54.18 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:07<00:11, 53.55it/s, est. speed input: 55477.17 toks/s, output: 54.18 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:07<00:11, 53.61it/s, est. speed input: 55469.59 toks/s, output: 54.17 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:07<00:11, 53.73it/s, est. speed input: 55465.97 toks/s, output: 54.17 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:08<00:10, 53.79it/s, est. speed input: 55461.23 toks/s, output: 54.16 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:08<00:10, 53.81it/s, est. speed input: 55455.81 toks/s, output: 54.16 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:08<00:10, 53.81it/s, est. speed input: 55450.16 toks/s, output: 54.15 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:08<00:10, 53.81it/s, est. speed input: 55442.99 toks/s, output: 54.14 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:08<00:10, 53.85it/s, est. speed input: 55439.48 toks/s, output: 54.14 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:08<00:10, 53.84it/s, est. speed input: 55435.12 toks/s, output: 54.13 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:08<00:10, 53.87it/s, est. speed input: 55430.98 toks/s, output: 54.13 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:09<00:09, 53.87it/s, est. speed input: 55426.58 toks/s, output: 54.13 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:09<00:09, 53.88it/s, est. speed input: 55422.57 toks/s, output: 54.12 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:09<00:09, 53.85it/s, est. speed input: 55416.97 toks/s, output: 54.12 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:09<00:09, 53.82it/s, est. speed input: 55411.03 toks/s, output: 54.11 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:09<00:09, 53.81it/s, est. speed input: 55405.88 toks/s, output: 54.11 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:09<00:09, 53.81it/s, est. speed input: 55401.36 toks/s, output: 54.10 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:09<00:09, 53.83it/s, est. speed input: 55397.64 toks/s, output: 54.10 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:10<00:08, 53.78it/s, est. speed input: 55391.46 toks/s, output: 54.09 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:10<00:08, 53.81it/s, est. speed input: 55388.07 toks/s, output: 54.09 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:10<00:08, 53.79it/s, est. speed input: 55382.74 toks/s, output: 54.08 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:10<00:08, 53.81it/s, est. speed input: 55379.51 toks/s, output: 54.08 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:10<00:08, 53.78it/s, est. speed input: 55374.46 toks/s, output: 54.08 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:10<00:08, 53.84it/s, est. speed input: 55373.09 toks/s, output: 54.08 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:10<00:07, 53.83it/s, est. speed input: 55369.46 toks/s, output: 54.07 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:11<00:07, 53.81it/s, est. speed input: 55365.20 toks/s, output: 54.07 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:11<00:07, 53.85it/s, est. speed input: 55363.38 toks/s, output: 54.07 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:11<00:07, 53.79it/s, est. speed input: 55358.35 toks/s, output: 54.06 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:11<00:07, 53.82it/s, est. speed input: 55356.22 toks/s, output: 54.06 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:11<00:07, 53.83it/s, est. speed input: 55353.13 toks/s, output: 54.06 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:11<00:07, 53.81it/s, est. speed input: 55349.30 toks/s, output: 54.05 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:12<00:06, 53.78it/s, est. speed input: 55345.14 toks/s, output: 54.05 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:12<00:06, 53.79it/s, est. speed input: 55342.25 toks/s, output: 54.05 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:12<00:06, 53.75it/s, est. speed input: 55337.32 toks/s, output: 54.04 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:12<00:06, 53.70it/s, est. speed input: 55331.78 toks/s, output: 54.03 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:12<00:06, 53.75it/s, est. speed input: 55330.17 toks/s, output: 54.03 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:12<00:06, 53.98it/s, est. speed input: 55335.20 toks/s, output: 54.04 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:12<00:06, 54.15it/s, est. speed input: 55341.29 toks/s, output: 54.04 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:13<00:05, 54.32it/s, est. speed input: 55349.15 toks/s, output: 54.05 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:13<00:05, 54.42it/s, est. speed input: 55355.72 toks/s, output: 54.06 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:13<00:05, 54.50it/s, est. speed input: 55363.62 toks/s, output: 54.07 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:13<00:05, 54.58it/s, est. speed input: 55370.73 toks/s, output: 54.07 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:13<00:05, 54.66it/s, est. speed input: 55379.19 toks/s, output: 54.08 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:13<00:05, 54.68it/s, est. speed input: 55386.03 toks/s, output: 54.09 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:13<00:04, 54.65it/s, est. speed input: 55391.46 toks/s, output: 54.09 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:14<00:04, 54.67it/s, est. speed input: 55398.03 toks/s, output: 54.10 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:14<00:04, 54.71it/s, est. speed input: 55405.31 toks/s, output: 54.11 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:14<00:04, 54.68it/s, est. speed input: 55411.33 toks/s, output: 54.11 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:14<00:04, 54.69it/s, est. speed input: 55416.89 toks/s, output: 54.12 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:14<00:04, 54.69it/s, est. speed input: 55422.52 toks/s, output: 54.12 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:14<00:04, 54.70it/s, est. speed input: 55428.72 toks/s, output: 54.13 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:14<00:03, 54.70it/s, est. speed input: 55434.19 toks/s, output: 54.13 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:15<00:03, 54.64it/s, est. speed input: 55438.48 toks/s, output: 54.14 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:15<00:03, 54.63it/s, est. speed input: 55443.00 toks/s, output: 54.14 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:15<00:03, 54.66it/s, est. speed input: 55448.20 toks/s, output: 54.15 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:15<00:03, 54.71it/s, est. speed input: 55454.91 toks/s, output: 54.16 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:15<00:03, 54.68it/s, est. speed input: 55459.44 toks/s, output: 54.16 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:15<00:03, 54.70it/s, est. speed input: 55464.61 toks/s, output: 54.16 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:15<00:02, 54.65it/s, est. speed input: 55468.31 toks/s, output: 54.17 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:16<00:02, 54.63it/s, est. speed input: 55471.97 toks/s, output: 54.17 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:16<00:02, 54.65it/s, est. speed input: 55476.90 toks/s, output: 54.18 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:16<00:02, 54.63it/s, est. speed input: 55480.42 toks/s, output: 54.18 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:16<00:02, 54.59it/s, est. speed input: 55483.53 toks/s, output: 54.18 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:16<00:02, 54.61it/s, est. speed input: 55488.19 toks/s, output: 54.19 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:16<00:02, 54.63it/s, est. speed input: 55492.07 toks/s, output: 54.19 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:17<00:01, 54.60it/s, est. speed input: 55495.15 toks/s, output: 54.19 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:17<00:01, 54.65it/s, est. speed input: 55500.07 toks/s, output: 54.20 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:17<00:01, 54.65it/s, est. speed input: 55504.38 toks/s, output: 54.20 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:17<00:01, 54.65it/s, est. speed input: 55507.93 toks/s, output: 54.21 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:17<00:01, 54.66it/s, est. speed input: 55511.89 toks/s, output: 54.21 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:17<00:01, 54.61it/s, est. speed input: 55514.36 toks/s, output: 54.21 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:17<00:00, 54.54it/s, est. speed input: 55515.57 toks/s, output: 54.21 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:18<00:00, 54.58it/s, est. speed input: 55519.37 toks/s, output: 54.22 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:18<00:00, 56.18it/s, est. speed input: 55565.35 toks/s, output: 54.26 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:18<00:00, 55.69it/s, est. speed input: 55567.84 toks/s, output: 54.27 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:18<00:00, 55.34it/s, est. speed input: 55569.93 toks/s, output: 54.27 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:18<00:00, 55.11it/s, est. speed input: 55572.49 toks/s, output: 54.27 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:18<00:00, 56.82it/s, est. speed input: 55622.25 toks/s, output: 54.32 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:18<00:00, 56.82it/s, est. speed input: 55949.41 toks/s, output: 54.64 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:18<00:00, 54.64it/s, est. speed input: 55949.41 toks/s, output: 54.64 toks/s]
[rank0]:[W128 12:05:04.227007978 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 72.8s

测试结果:
  Requests/s:   53.60
  Tokens/s:     54938.78
  Total Reqs:   1024
  Elapsed:      19.10s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     54885.19

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:05:26 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:05:27 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=41497) WARNING 01-28 12:05:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=41497) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=41497) WARNING 01-28 12:05:43 [backends.py:609] Failed to read file <frozen os>
Throughput: 54.26 requests/s, 55619.69 total tokens/s, 54.26 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 12:05:26] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:05:26] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:05:26] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:05:26] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:26] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:26] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:26] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:26] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:26] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:05:26] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:05:26] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:05:26] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:05:26] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:05:26] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:05:33] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:05:33] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:05:33] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:05:33] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:33] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:33] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:33] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:33] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:05:33] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:05:33] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:05:33] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:05:33] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:05:33] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:05:33] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:34] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:34] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:34] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:34] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:34] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:34] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=41497) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=41497) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.68it/s]
(EngineCore_DP0 pid=41497) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.68it/s]
(EngineCore_DP0 pid=41497) 
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=41497) [2026-01-28 12:05:35] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=41497) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.57it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.76it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.01it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.20it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.36it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.38it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  7.92it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.03it/s]
(EngineCore_DP0 pid=41497) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.03it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  8.03it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.31it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  8.54it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.79it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.47it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 36/2048 [00:00<00:05, 357.32it/s]
Adding requests:   4%|▎         | 74/2048 [00:00<00:05, 370.32it/s]
Adding requests:   5%|▌         | 112/2048 [00:00<00:05, 374.37it/s]
Adding requests:   7%|▋         | 150/2048 [00:00<00:05, 375.02it/s]
Adding requests:   9%|▉         | 188/2048 [00:00<00:05, 367.86it/s]
Adding requests:  11%|█         | 226/2048 [00:00<00:04, 370.60it/s]
Adding requests:  13%|█▎        | 264/2048 [00:00<00:04, 366.91it/s]
Adding requests:  15%|█▍        | 301/2048 [00:00<00:04, 364.85it/s]
Adding requests:  17%|█▋        | 341/2048 [00:00<00:04, 373.21it/s]
Adding requests:  19%|█▊        | 381/2048 [00:01<00:04, 379.07it/s]
Adding requests:  21%|██        | 421/2048 [00:01<00:04, 385.08it/s]
Adding requests:  22%|██▏       | 460/2048 [00:01<00:04, 383.08it/s]
Adding requests:  24%|██▍       | 499/2048 [00:01<00:04, 382.11it/s]
Adding requests:  26%|██▋       | 538/2048 [00:01<00:04, 376.43it/s]
Adding requests:  28%|██▊       | 578/2048 [00:01<00:03, 383.15it/s]
Adding requests:  30%|███       | 619/2048 [00:01<00:03, 389.09it/s]
Adding requests:  32%|███▏      | 660/2048 [00:01<00:03, 393.71it/s]
Adding requests:  34%|███▍      | 702/2048 [00:01<00:03, 398.87it/s]
Adding requests:  36%|███▌      | 742/2048 [00:01<00:03, 398.03it/s]
Adding requests:  38%|███▊      | 782/2048 [00:02<00:03, 398.27it/s]
Adding requests:  40%|████      | 822/2048 [00:02<00:03, 389.66it/s]
Adding requests:  42%|████▏     | 862/2048 [00:02<00:03, 384.92it/s]
Adding requests:  44%|████▍     | 904/2048 [00:02<00:02, 393.70it/s]
Adding requests:  46%|████▌     | 944/2048 [00:02<00:02, 391.89it/s]
Adding requests:  48%|████▊     | 985/2048 [00:02<00:02, 395.30it/s]
Adding requests:  50%|█████     | 1026/2048 [00:02<00:02, 398.78it/s]
Adding requests:  52%|█████▏    | 1066/2048 [00:02<00:02, 391.99it/s]
Adding requests:  54%|█████▍    | 1106/2048 [00:02<00:02, 388.85it/s]
Adding requests:  56%|█████▌    | 1146/2048 [00:02<00:02, 389.55it/s]
Adding requests:  58%|█████▊    | 1188/2048 [00:03<00:02, 397.15it/s]
Adding requests:  60%|█████▉    | 1228/2048 [00:03<00:02, 383.76it/s]
Adding requests:  62%|██████▏   | 1267/2048 [00:03<00:02, 364.09it/s]
Adding requests:  64%|██████▎   | 1305/2048 [00:03<00:02, 367.31it/s]
Adding requests:  66%|██████▌   | 1346/2048 [00:03<00:01, 378.14it/s]
Adding requests:  68%|██████▊   | 1386/2048 [00:03<00:01, 382.05it/s]
Adding requests:  70%|██████▉   | 1427/2048 [00:03<00:01, 388.65it/s]
Adding requests:  72%|███████▏  | 1470/2048 [00:03<00:01, 399.50it/s]
Adding requests:  74%|███████▍  | 1514/2048 [00:03<00:01, 411.19it/s]
Adding requests:  76%|███████▌  | 1557/2048 [00:04<00:01, 415.44it/s]
Adding requests:  78%|███████▊  | 1603/2048 [00:04<00:01, 425.68it/s]
Adding requests:  80%|████████  | 1646/2048 [00:04<00:00, 422.84it/s]
Adding requests:  82%|████████▏ | 1689/2048 [00:04<00:00, 421.42it/s]
Adding requests:  85%|████████▍ | 1733/2048 [00:04<00:00, 424.64it/s]
Adding requests:  87%|████████▋ | 1776/2048 [00:04<00:00, 417.54it/s]
Adding requests:  89%|████████▉ | 1820/2048 [00:04<00:00, 422.49it/s]
Adding requests:  91%|█████████ | 1863/2048 [00:04<00:00, 419.43it/s]
Adding requests:  93%|█████████▎| 1905/2048 [00:04<00:00, 419.57it/s]
Adding requests:  95%|█████████▌| 1948/2048 [00:04<00:00, 422.41it/s]
Adding requests:  97%|█████████▋| 1991/2048 [00:05<00:00, 423.61it/s]
Adding requests:  99%|█████████▉| 2034/2048 [00:05<00:00, 414.97it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 394.99it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:00<00:02, 749.35it/s, est. speed input: 767397.56 toks/s, output: 749.37 toks/s]
Processed prompts:  17%|█▋        | 349/2048 [00:01<00:08, 191.73it/s, est. speed input: 238057.09 toks/s, output: 232.48 toks/s]
Processed prompts:  19%|█▉        | 384/2048 [00:02<00:11, 143.80it/s, est. speed input: 190020.73 toks/s, output: 185.57 toks/s]
Processed prompts:  20%|█▉        | 406/2048 [00:02<00:15, 107.60it/s, est. speed input: 157664.18 toks/s, output: 153.97 toks/s]
Processed prompts:  21%|██        | 421/2048 [00:02<00:16, 96.79it/s, est. speed input: 147600.76 toks/s, output: 144.14 toks/s] 
Processed prompts:  21%|██        | 434/2048 [00:03<00:18, 85.56it/s, est. speed input: 138681.84 toks/s, output: 135.43 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:03<00:20, 78.14it/s, est. speed input: 131844.20 toks/s, output: 128.75 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:03<00:21, 72.60it/s, est. speed input: 126267.59 toks/s, output: 123.31 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:04<00:22, 68.26it/s, est. speed input: 121466.93 toks/s, output: 118.62 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:04<00:23, 64.95it/s, est. speed input: 117287.10 toks/s, output: 114.54 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:04<00:24, 62.50it/s, est. speed input: 113624.21 toks/s, output: 110.96 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:04<00:24, 60.73it/s, est. speed input: 110392.59 toks/s, output: 107.80 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:05<00:25, 59.44it/s, est. speed input: 107511.24 toks/s, output: 104.99 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:05<00:25, 58.53it/s, est. speed input: 104931.47 toks/s, output: 102.47 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:05<00:25, 57.89it/s, est. speed input: 102607.39 toks/s, output: 100.20 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:06<00:25, 57.42it/s, est. speed input: 100496.77 toks/s, output: 98.14 toks/s] 
Processed prompts:  30%|██▉       | 610/2048 [00:06<00:25, 57.09it/s, est. speed input: 98577.54 toks/s, output: 96.27 toks/s] 
Processed prompts:  31%|███       | 626/2048 [00:06<00:25, 56.81it/s, est. speed input: 96810.53 toks/s, output: 94.54 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:06<00:24, 56.62it/s, est. speed input: 95189.92 toks/s, output: 92.96 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:07<00:24, 56.52it/s, est. speed input: 93704.30 toks/s, output: 91.51 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:07<00:24, 56.35it/s, est. speed input: 92312.51 toks/s, output: 90.15 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:07<00:24, 56.30it/s, est. speed input: 91035.69 toks/s, output: 88.90 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:08<00:23, 56.24it/s, est. speed input: 89845.21 toks/s, output: 87.74 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:08<00:23, 56.20it/s, est. speed input: 88736.85 toks/s, output: 86.66 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:08<00:23, 56.18it/s, est. speed input: 87703.14 toks/s, output: 85.65 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:08<00:23, 56.17it/s, est. speed input: 86736.28 toks/s, output: 84.70 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:09<00:22, 56.14it/s, est. speed input: 85825.95 toks/s, output: 83.81 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:09<00:22, 56.11it/s, est. speed input: 84968.90 toks/s, output: 82.98 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:09<00:22, 56.12it/s, est. speed input: 84166.18 toks/s, output: 82.19 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:10<00:21, 56.12it/s, est. speed input: 83407.97 toks/s, output: 81.45 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:10<00:21, 56.11it/s, est. speed input: 82691.04 toks/s, output: 80.75 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:10<00:21, 56.11it/s, est. speed input: 82013.01 toks/s, output: 80.09 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:10<00:21, 56.10it/s, est. speed input: 81368.75 toks/s, output: 79.46 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:11<00:20, 56.10it/s, est. speed input: 80758.68 toks/s, output: 78.87 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:11<00:20, 56.11it/s, est. speed input: 80179.85 toks/s, output: 78.30 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:11<00:20, 56.10it/s, est. speed input: 79627.49 toks/s, output: 77.76 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:12<00:19, 56.10it/s, est. speed input: 79101.67 toks/s, output: 77.25 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:12<00:19, 56.09it/s, est. speed input: 78600.04 toks/s, output: 76.76 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:12<00:19, 56.09it/s, est. speed input: 78120.71 toks/s, output: 76.29 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:12<00:18, 56.88it/s, est. speed input: 77742.70 toks/s, output: 75.92 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:13<00:18, 56.62it/s, est. speed input: 77301.40 toks/s, output: 75.49 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:13<00:18, 56.46it/s, est. speed input: 76879.71 toks/s, output: 75.08 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:13<00:18, 55.81it/s, est. speed input: 76425.17 toks/s, output: 74.63 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:14<00:18, 55.10it/s, est. speed input: 75964.60 toks/s, output: 74.18 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:14<00:18, 54.60it/s, est. speed input: 75522.52 toks/s, output: 73.75 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:14<00:17, 54.25it/s, est. speed input: 75097.81 toks/s, output: 73.34 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:14<00:17, 54.01it/s, est. speed input: 74690.00 toks/s, output: 72.94 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:15<00:17, 53.84it/s, est. speed input: 74298.23 toks/s, output: 72.56 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:15<00:17, 53.72it/s, est. speed input: 73921.26 toks/s, output: 72.19 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:15<00:16, 53.65it/s, est. speed input: 73559.85 toks/s, output: 71.84 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:16<00:16, 54.41it/s, est. speed input: 73278.28 toks/s, output: 71.56 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:16<00:16, 54.12it/s, est. speed input: 72940.40 toks/s, output: 71.23 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:16<00:15, 53.90it/s, est. speed input: 72613.24 toks/s, output: 70.91 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:17<00:15, 53.74it/s, est. speed input: 72297.31 toks/s, output: 70.60 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:17<00:15, 53.64it/s, est. speed input: 71992.23 toks/s, output: 70.30 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:17<00:15, 53.58it/s, est. speed input: 71699.30 toks/s, output: 70.02 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:17<00:14, 53.55it/s, est. speed input: 71416.26 toks/s, output: 69.74 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:18<00:14, 53.49it/s, est. speed input: 71139.91 toks/s, output: 69.47 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:18<00:14, 53.48it/s, est. speed input: 70874.83 toks/s, output: 69.21 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:18<00:14, 53.47it/s, est. speed input: 70617.91 toks/s, output: 68.96 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:19<00:13, 53.46it/s, est. speed input: 70368.85 toks/s, output: 68.72 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:19<00:13, 53.49it/s, est. speed input: 70130.02 toks/s, output: 68.49 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:19<00:13, 53.44it/s, est. speed input: 69894.15 toks/s, output: 68.26 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:20<00:12, 53.45it/s, est. speed input: 69667.95 toks/s, output: 68.04 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:20<00:12, 53.44it/s, est. speed input: 69447.38 toks/s, output: 67.82 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:20<00:12, 53.45it/s, est. speed input: 69234.09 toks/s, output: 67.61 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:20<00:11, 53.46it/s, est. speed input: 69026.82 toks/s, output: 67.41 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:21<00:11, 53.45it/s, est. speed input: 68825.00 toks/s, output: 67.21 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:21<00:11, 53.44it/s, est. speed input: 68628.41 toks/s, output: 67.02 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:21<00:11, 53.44it/s, est. speed input: 68437.58 toks/s, output: 66.83 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:22<00:10, 53.45it/s, est. speed input: 68252.22 toks/s, output: 66.65 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:22<00:10, 53.36it/s, est. speed input: 68066.80 toks/s, output: 66.47 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:22<00:10, 53.23it/s, est. speed input: 67882.00 toks/s, output: 66.29 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:23<00:09, 53.13it/s, est. speed input: 67702.26 toks/s, output: 66.12 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:23<00:09, 53.05it/s, est. speed input: 67525.85 toks/s, output: 65.94 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:23<00:09, 52.99it/s, est. speed input: 67354.07 toks/s, output: 65.78 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:23<00:09, 52.96it/s, est. speed input: 67187.18 toks/s, output: 65.61 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:26<00:32, 14.42it/s, est. speed input: 60327.71 toks/s, output: 58.91 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:27<00:24, 18.45it/s, est. speed input: 60259.20 toks/s, output: 58.85 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:27<00:18, 22.93it/s, est. speed input: 60191.47 toks/s, output: 58.78 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:27<00:14, 27.61it/s, est. speed input: 60124.80 toks/s, output: 58.72 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:28<00:12, 32.23it/s, est. speed input: 60060.12 toks/s, output: 58.65 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:28<00:10, 36.50it/s, est. speed input: 59996.60 toks/s, output: 58.59 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:28<00:09, 40.23it/s, est. speed input: 59934.17 toks/s, output: 58.53 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:29<00:08, 43.33it/s, est. speed input: 59873.63 toks/s, output: 58.47 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:29<00:07, 45.82it/s, est. speed input: 59814.98 toks/s, output: 58.41 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:29<00:06, 47.73it/s, est. speed input: 59757.05 toks/s, output: 58.36 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:29<00:06, 49.17it/s, est. speed input: 59700.35 toks/s, output: 58.30 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:30<00:05, 50.27it/s, est. speed input: 59646.73 toks/s, output: 58.25 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:30<00:05, 50.98it/s, est. speed input: 59590.43 toks/s, output: 58.19 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:30<00:04, 51.54it/s, est. speed input: 59537.36 toks/s, output: 58.14 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:31<00:04, 51.93it/s, est. speed input: 59484.83 toks/s, output: 58.09 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:31<00:04, 52.21it/s, est. speed input: 59433.37 toks/s, output: 58.04 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:31<00:03, 52.44it/s, est. speed input: 59384.23 toks/s, output: 57.99 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:32<00:03, 52.53it/s, est. speed input: 59333.39 toks/s, output: 57.94 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:32<00:03, 53.43it/s, est. speed input: 59312.42 toks/s, output: 57.92 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:32<00:02, 53.27it/s, est. speed input: 59264.92 toks/s, output: 57.88 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:32<00:02, 53.17it/s, est. speed input: 59218.43 toks/s, output: 57.83 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:33<00:02, 53.11it/s, est. speed input: 59173.39 toks/s, output: 57.79 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:33<00:02, 53.95it/s, est. speed input: 59157.92 toks/s, output: 57.77 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:33<00:01, 54.55it/s, est. speed input: 59142.75 toks/s, output: 57.76 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:34<00:01, 54.97it/s, est. speed input: 59127.38 toks/s, output: 57.74 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:34<00:01, 55.27it/s, est. speed input: 59112.34 toks/s, output: 57.73 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:34<00:00, 55.48it/s, est. speed input: 59097.73 toks/s, output: 57.71 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:34<00:00, 55.64it/s, est. speed input: 59083.43 toks/s, output: 57.70 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:35<00:00, 56.73it/s, est. speed input: 59097.12 toks/s, output: 57.71 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:35<00:00, 56.73it/s, est. speed input: 59503.31 toks/s, output: 58.11 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:35<00:00, 58.11it/s, est. speed input: 59503.31 toks/s, output: 58.11 toks/s]
[rank0]:[W128 12:06:44.265444746 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 99.5s

测试结果:
  Requests/s:   54.26
  Tokens/s:     55619.69
  Total Reqs:   2048
  Elapsed:      37.74s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     55565.43

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:07:17 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:07:18 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=42417) WARNING 01-28 12:07:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=42417) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=42417) WARNING 01-28 12:07:47 [backends.py:609] Failed to read file <frozen os>
Throughput: 55.07 requests/s, 56447.19 total tokens/s, 55.07 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 12:07:17] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:07:17] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:07:17] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:07:17] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:17] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:17] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:17] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:17] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:17] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:07:17] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:07:17] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:07:17] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:07:17] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:07:17] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:07:24] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:07:24] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:07:24] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:07:24] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:24] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:24] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:24] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:24] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:07:24] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:07:24] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:07:24] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:07:24] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:07:24] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:07:24] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 12:07:34.355347584 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:35] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:35] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:35] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:35] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:35] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:35] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=42417) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=42417) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=42417) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=42417) 
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 9891840 bytes
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 6594560 bytes
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 35610624 bytes
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=42417) [2026-01-28 12:07:36] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 17694720 bytes
(EngineCore_DP0 pid=42417) [rank0]:W0128 12:07:55.366000 42417 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=42417) [rank0]:W0128 12:07:55.472000 42417 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=42417) [rank0]:W0128 12:07:56.826000 42417 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=42417) [rank0]:W0128 12:07:56.982000 42417 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=42417) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.84it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  8.10it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.42it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.71it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  8.79it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.80it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  8.84it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  8.90it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.96it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.33it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.57it/s]
(EngineCore_DP0 pid=42417) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.32it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.21it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.57it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  8.77it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.95it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  9.07it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.17it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.86it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 37/4096 [00:00<00:11, 368.00it/s]
Adding requests:   2%|▏         | 77/4096 [00:00<00:10, 383.93it/s]
Adding requests:   3%|▎         | 116/4096 [00:00<00:10, 385.75it/s]
Adding requests:   4%|▍         | 155/4096 [00:00<00:10, 383.83it/s]
Adding requests:   5%|▍         | 194/4096 [00:00<00:10, 383.28it/s]
Adding requests:   6%|▌         | 234/4096 [00:00<00:09, 387.21it/s]
Adding requests:   7%|▋         | 276/4096 [00:00<00:09, 395.91it/s]
Adding requests:   8%|▊         | 316/4096 [00:00<00:09, 395.54it/s]
Adding requests:   9%|▊         | 357/4096 [00:00<00:09, 399.20it/s]
Adding requests:  10%|▉         | 399/4096 [00:01<00:09, 404.77it/s]
Adding requests:  11%|█         | 440/4096 [00:01<00:09, 399.89it/s]
Adding requests:  12%|█▏        | 482/4096 [00:01<00:08, 403.45it/s]
Adding requests:  13%|█▎        | 523/4096 [00:01<00:09, 396.73it/s]
Adding requests:  14%|█▍        | 566/4096 [00:01<00:08, 404.26it/s]
Adding requests:  15%|█▍        | 608/4096 [00:01<00:08, 406.09it/s]
Adding requests:  16%|█▌        | 652/4096 [00:01<00:08, 413.53it/s]
Adding requests:  17%|█▋        | 696/4096 [00:01<00:08, 420.04it/s]
Adding requests:  18%|█▊        | 739/4096 [00:01<00:07, 422.54it/s]
Adding requests:  19%|█▉        | 782/4096 [00:01<00:07, 418.90it/s]
Adding requests:  20%|██        | 824/4096 [00:02<00:08, 407.98it/s]
Adding requests:  21%|██        | 866/4096 [00:02<00:07, 408.92it/s]
Adding requests:  22%|██▏       | 909/4096 [00:02<00:07, 414.67it/s]
Adding requests:  23%|██▎       | 952/4096 [00:02<00:07, 416.50it/s]
Adding requests:  24%|██▍       | 995/4096 [00:02<00:07, 419.09it/s]
Adding requests:  25%|██▌       | 1038/4096 [00:02<00:07, 419.91it/s]
Adding requests:  26%|██▋       | 1081/4096 [00:02<00:07, 416.71it/s]
Adding requests:  27%|██▋       | 1123/4096 [00:02<00:07, 414.12it/s]
Adding requests:  28%|██▊       | 1167/4096 [00:02<00:06, 420.55it/s]
Adding requests:  30%|██▉       | 1210/4096 [00:02<00:07, 411.41it/s]
Adding requests:  31%|███       | 1252/4096 [00:03<00:07, 404.91it/s]
Adding requests:  32%|███▏      | 1293/4096 [00:03<00:07, 399.40it/s]
Adding requests:  33%|███▎      | 1335/4096 [00:03<00:06, 403.94it/s]
Adding requests:  34%|███▎      | 1378/4096 [00:03<00:06, 408.43it/s]
Adding requests:  35%|███▍      | 1421/4096 [00:03<00:06, 413.25it/s]
Adding requests:  36%|███▌      | 1464/4096 [00:03<00:06, 418.05it/s]
Adding requests:  37%|███▋      | 1506/4096 [00:03<00:06, 417.52it/s]
Adding requests:  38%|███▊      | 1549/4096 [00:03<00:06, 418.85it/s]
Adding requests:  39%|███▉      | 1592/4096 [00:03<00:05, 421.58it/s]
Adding requests:  40%|███▉      | 1636/4096 [00:03<00:05, 424.26it/s]
Adding requests:  41%|████      | 1679/4096 [00:04<00:05, 415.37it/s]
Adding requests:  42%|████▏     | 1721/4096 [00:04<00:05, 414.19it/s]
Adding requests:  43%|████▎     | 1763/4096 [00:04<00:05, 414.69it/s]
Adding requests:  44%|████▍     | 1805/4096 [00:04<00:05, 415.76it/s]
Adding requests:  45%|████▌     | 1848/4096 [00:04<00:05, 417.59it/s]
Adding requests:  46%|████▌     | 1891/4096 [00:04<00:05, 418.85it/s]
Adding requests:  47%|████▋     | 1934/4096 [00:04<00:05, 419.59it/s]
Adding requests:  48%|████▊     | 1976/4096 [00:04<00:05, 418.50it/s]
Adding requests:  49%|████▉     | 2019/4096 [00:04<00:04, 419.85it/s]
Adding requests:  50%|█████     | 2062/4096 [00:05<00:04, 420.71it/s]
Adding requests:  51%|█████▏    | 2105/4096 [00:05<00:04, 421.06it/s]
Adding requests:  52%|█████▏    | 2148/4096 [00:05<00:04, 412.73it/s]
Adding requests:  53%|█████▎    | 2190/4096 [00:05<00:04, 411.72it/s]
Adding requests:  55%|█████▍    | 2233/4096 [00:05<00:04, 415.48it/s]
Adding requests:  56%|█████▌    | 2275/4096 [00:05<00:04, 415.99it/s]
Adding requests:  57%|█████▋    | 2318/4096 [00:05<00:04, 420.06it/s]
Adding requests:  58%|█████▊    | 2361/4096 [00:05<00:04, 411.34it/s]
Adding requests:  59%|█████▊    | 2403/4096 [00:05<00:04, 410.90it/s]
Adding requests:  60%|█████▉    | 2445/4096 [00:05<00:04, 396.75it/s]
Adding requests:  61%|██████    | 2486/4096 [00:06<00:04, 400.33it/s]
Adding requests:  62%|██████▏   | 2527/4096 [00:06<00:03, 401.54it/s]
Adding requests:  63%|██████▎   | 2570/4096 [00:06<00:03, 407.58it/s]
Adding requests:  64%|██████▍   | 2612/4096 [00:06<00:03, 410.30it/s]
Adding requests:  65%|██████▍   | 2655/4096 [00:06<00:03, 415.22it/s]
Adding requests:  66%|██████▌   | 2697/4096 [00:06<00:03, 412.05it/s]
Adding requests:  67%|██████▋   | 2739/4096 [00:06<00:03, 409.02it/s]
Adding requests:  68%|██████▊   | 2780/4096 [00:06<00:03, 407.91it/s]
Adding requests:  69%|██████▉   | 2821/4096 [00:06<00:03, 405.77it/s]
Adding requests:  70%|██████▉   | 2863/4096 [00:06<00:03, 409.16it/s]
Adding requests:  71%|███████   | 2905/4096 [00:07<00:02, 412.08it/s]
Adding requests:  72%|███████▏  | 2947/4096 [00:07<00:02, 407.02it/s]
Adding requests:  73%|███████▎  | 2988/4096 [00:07<00:02, 406.52it/s]
Adding requests:  74%|███████▍  | 3030/4096 [00:07<00:02, 407.66it/s]
Adding requests:  75%|███████▌  | 3072/4096 [00:07<00:02, 408.79it/s]
Adding requests:  76%|███████▌  | 3114/4096 [00:07<00:02, 410.65it/s]
Adding requests:  77%|███████▋  | 3156/4096 [00:07<00:02, 406.77it/s]
Adding requests:  78%|███████▊  | 3197/4096 [00:07<00:02, 405.49it/s]
Adding requests:  79%|███████▉  | 3240/4096 [00:07<00:02, 411.01it/s]
Adding requests:  80%|████████  | 3283/4096 [00:08<00:01, 414.54it/s]
Adding requests:  81%|████████  | 3325/4096 [00:08<00:01, 410.88it/s]
Adding requests:  82%|████████▏ | 3368/4096 [00:08<00:01, 415.36it/s]
Adding requests:  83%|████████▎ | 3410/4096 [00:08<00:01, 409.08it/s]
Adding requests:  84%|████████▍ | 3451/4096 [00:08<00:01, 408.52it/s]
Adding requests:  85%|████████▌ | 3492/4096 [00:08<00:01, 401.38it/s]
Adding requests:  86%|████████▋ | 3533/4096 [00:08<00:01, 401.08it/s]
Adding requests:  87%|████████▋ | 3574/4096 [00:08<00:01, 400.99it/s]
Adding requests:  88%|████████▊ | 3615/4096 [00:08<00:01, 401.85it/s]
Adding requests:  89%|████████▉ | 3656/4096 [00:08<00:01, 401.83it/s]
Adding requests:  90%|█████████ | 3699/4096 [00:09<00:00, 408.10it/s]
Adding requests:  91%|█████████▏| 3740/4096 [00:09<00:00, 406.64it/s]
Adding requests:  92%|█████████▏| 3781/4096 [00:09<00:00, 400.65it/s]
Adding requests:  93%|█████████▎| 3822/4096 [00:09<00:00, 399.32it/s]
Adding requests:  94%|█████████▍| 3864/4096 [00:09<00:00, 403.52it/s]
Adding requests:  95%|█████████▌| 3905/4096 [00:09<00:00, 402.33it/s]
Adding requests:  96%|█████████▋| 3947/4096 [00:09<00:00, 406.75it/s]
Adding requests:  97%|█████████▋| 3988/4096 [00:09<00:00, 404.34it/s]
Adding requests:  98%|█████████▊| 4030/4096 [00:09<00:00, 408.89it/s]
Adding requests:  99%|█████████▉| 4071/4096 [00:09<00:00, 408.12it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 408.99it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 546/4096 [00:00<00:03, 1076.23it/s, est. speed input: 1102112.13 toks/s, output: 1076.25 toks/s]
Processed prompts:  16%|█▌        | 654/4096 [00:02<00:15, 224.05it/s, est. speed input: 286184.79 toks/s, output: 279.48 toks/s]   
Processed prompts:  17%|█▋        | 702/4096 [00:02<00:18, 182.55it/s, est. speed input: 243575.61 toks/s, output: 237.87 toks/s]
Processed prompts:  18%|█▊        | 732/4096 [00:06<00:53, 62.95it/s, est. speed input: 119403.72 toks/s, output: 116.61 toks/s] 
Processed prompts:  18%|█▊        | 751/4096 [00:06<00:57, 58.04it/s, est. speed input: 111606.42 toks/s, output: 108.99 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:07<01:02, 53.20it/s, est. speed input: 105103.58 toks/s, output: 102.64 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:08<01:02, 53.02it/s, est. speed input: 101218.43 toks/s, output: 98.85 toks/s] 
Processed prompts:  20%|██        | 834/4096 [00:08<01:01, 53.29it/s, est. speed input: 98125.76 toks/s, output: 95.83 toks/s] 
Processed prompts:  21%|██        | 866/4096 [00:09<01:00, 53.56it/s, est. speed input: 95443.14 toks/s, output: 93.21 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:09<00:59, 53.78it/s, est. speed input: 93078.88 toks/s, output: 90.90 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:10<00:58, 53.94it/s, est. speed input: 90976.39 toks/s, output: 88.84 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:11<00:57, 54.56it/s, est. speed input: 89256.11 toks/s, output: 87.16 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:11<00:56, 54.95it/s, est. speed input: 87681.30 toks/s, output: 85.63 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:12<00:55, 55.22it/s, est. speed input: 86250.44 toks/s, output: 84.23 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:12<00:54, 55.41it/s, est. speed input: 84948.01 toks/s, output: 82.96 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:13<00:54, 55.56it/s, est. speed input: 83758.91 toks/s, output: 81.80 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:13<00:53, 55.64it/s, est. speed input: 82662.82 toks/s, output: 80.73 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:14<00:52, 56.19it/s, est. speed input: 81749.35 toks/s, output: 79.83 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:15<00:51, 56.08it/s, est. speed input: 80810.80 toks/s, output: 78.92 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:15<00:51, 55.97it/s, est. speed input: 79936.72 toks/s, output: 78.06 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:16<00:50, 55.94it/s, est. speed input: 79131.08 toks/s, output: 77.28 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:16<00:50, 55.92it/s, est. speed input: 78381.53 toks/s, output: 76.54 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:17<00:49, 55.89it/s, est. speed input: 77680.11 toks/s, output: 75.86 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:17<00:49, 55.88it/s, est. speed input: 77024.20 toks/s, output: 75.22 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:18<00:48, 55.88it/s, est. speed input: 76410.14 toks/s, output: 74.62 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:19<00:48, 55.91it/s, est. speed input: 75837.56 toks/s, output: 74.06 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:19<00:47, 56.02it/s, est. speed input: 75309.07 toks/s, output: 73.54 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:20<00:46, 56.10it/s, est. speed input: 74810.73 toks/s, output: 73.06 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:20<00:46, 56.19it/s, est. speed input: 74344.98 toks/s, output: 72.60 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:21<00:45, 56.16it/s, est. speed input: 73892.13 toks/s, output: 72.16 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:21<00:44, 56.19it/s, est. speed input: 73468.96 toks/s, output: 71.75 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:22<00:44, 56.20it/s, est. speed input: 73066.26 toks/s, output: 71.35 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:23<00:43, 56.22it/s, est. speed input: 72684.21 toks/s, output: 70.98 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:23<00:43, 56.22it/s, est. speed input: 72319.78 toks/s, output: 70.62 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:24<00:42, 56.23it/s, est. speed input: 71973.15 toks/s, output: 70.29 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:24<00:42, 56.23it/s, est. speed input: 71641.84 toks/s, output: 69.96 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:25<00:41, 56.23it/s, est. speed input: 71325.32 toks/s, output: 69.65 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:25<00:40, 56.24it/s, est. speed input: 71024.04 toks/s, output: 69.36 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:26<00:40, 56.17it/s, est. speed input: 70728.66 toks/s, output: 69.07 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:26<00:39, 56.50it/s, est. speed input: 70478.34 toks/s, output: 68.83 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:27<00:39, 55.99it/s, est. speed input: 70175.45 toks/s, output: 68.53 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:28<00:39, 55.63it/s, est. speed input: 69884.41 toks/s, output: 68.25 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:28<00:38, 55.38it/s, est. speed input: 69604.78 toks/s, output: 67.97 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:29<00:38, 55.21it/s, est. speed input: 69336.57 toks/s, output: 67.71 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:29<00:37, 55.09it/s, est. speed input: 69078.62 toks/s, output: 67.46 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:30<00:37, 55.01it/s, est. speed input: 68830.95 toks/s, output: 67.22 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:31<00:36, 54.96it/s, est. speed input: 68593.20 toks/s, output: 66.99 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:31<00:36, 54.95it/s, est. speed input: 68365.87 toks/s, output: 66.76 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:32<00:35, 54.89it/s, est. speed input: 68143.00 toks/s, output: 66.55 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:32<00:34, 54.87it/s, est. speed input: 67929.74 toks/s, output: 66.34 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:33<00:34, 54.86it/s, est. speed input: 67723.84 toks/s, output: 66.14 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:33<00:33, 54.85it/s, est. speed input: 67524.89 toks/s, output: 65.94 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:34<00:32, 55.27it/s, est. speed input: 67362.08 toks/s, output: 65.78 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:35<00:32, 54.81it/s, est. speed input: 67153.81 toks/s, output: 65.58 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:35<00:32, 54.07it/s, est. speed input: 66923.67 toks/s, output: 65.36 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:36<00:32, 53.57it/s, est. speed input: 66702.22 toks/s, output: 65.14 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:36<00:31, 53.20it/s, est. speed input: 66485.78 toks/s, output: 64.93 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:37<00:31, 52.95it/s, est. speed input: 66277.20 toks/s, output: 64.72 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:40<01:13, 22.28it/s, est. speed input: 61614.88 toks/s, output: 60.17 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:41<00:59, 27.03it/s, est. speed input: 61521.20 toks/s, output: 60.08 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:42<00:49, 31.62it/s, est. speed input: 61406.71 toks/s, output: 59.97 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:42<00:42, 35.89it/s, est. speed input: 61295.83 toks/s, output: 59.86 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:43<00:37, 39.63it/s, est. speed input: 61187.91 toks/s, output: 59.75 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:44<00:34, 43.11it/s, est. speed input: 61112.11 toks/s, output: 59.68 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:44<00:31, 45.94it/s, est. speed input: 61038.17 toks/s, output: 59.61 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:45<00:29, 48.15it/s, est. speed input: 60966.43 toks/s, output: 59.54 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:45<00:27, 49.88it/s, est. speed input: 60899.41 toks/s, output: 59.47 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:46<00:26, 51.49it/s, est. speed input: 60851.66 toks/s, output: 59.43 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:46<00:24, 52.61it/s, est. speed input: 60801.25 toks/s, output: 59.38 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:47<00:23, 53.47it/s, est. speed input: 60753.93 toks/s, output: 59.33 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:48<00:23, 54.08it/s, est. speed input: 60707.86 toks/s, output: 59.28 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:48<00:22, 54.51it/s, est. speed input: 60662.38 toks/s, output: 59.24 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:49<00:21, 54.82it/s, est. speed input: 60618.10 toks/s, output: 59.20 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:49<00:20, 55.03it/s, est. speed input: 60574.89 toks/s, output: 59.16 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:50<00:20, 55.19it/s, est. speed input: 60532.62 toks/s, output: 59.11 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:50<00:19, 55.30it/s, est. speed input: 60491.49 toks/s, output: 59.07 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:51<00:19, 55.38it/s, est. speed input: 60451.29 toks/s, output: 59.03 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:52<00:18, 55.43it/s, est. speed input: 60411.73 toks/s, output: 59.00 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:52<00:17, 55.47it/s, est. speed input: 60373.33 toks/s, output: 58.96 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:53<00:17, 55.50it/s, est. speed input: 60336.07 toks/s, output: 58.92 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:53<00:16, 55.58it/s, est. speed input: 60301.68 toks/s, output: 58.89 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:54<00:16, 55.79it/s, est. speed input: 60273.73 toks/s, output: 58.86 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:54<00:15, 55.94it/s, est. speed input: 60246.39 toks/s, output: 58.83 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:55<00:14, 56.03it/s, est. speed input: 60219.30 toks/s, output: 58.81 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:56<00:14, 56.11it/s, est. speed input: 60193.19 toks/s, output: 58.78 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:56<00:13, 56.17it/s, est. speed input: 60167.66 toks/s, output: 58.76 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:57<00:13, 56.20it/s, est. speed input: 60142.30 toks/s, output: 58.73 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:57<00:12, 56.22it/s, est. speed input: 60117.56 toks/s, output: 58.71 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:58<00:11, 56.24it/s, est. speed input: 60093.54 toks/s, output: 58.69 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:58<00:11, 56.26it/s, est. speed input: 60069.93 toks/s, output: 58.66 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:59<00:10, 56.27it/s, est. speed input: 60046.66 toks/s, output: 58.64 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:00<00:10, 56.27it/s, est. speed input: 60023.86 toks/s, output: 58.62 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:00<00:09, 56.33it/s, est. speed input: 60003.38 toks/s, output: 58.60 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:01<00:09, 56.27it/s, est. speed input: 59979.95 toks/s, output: 58.57 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:01<00:08, 56.23it/s, est. speed input: 59956.89 toks/s, output: 58.55 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:02<00:07, 55.97it/s, est. speed input: 59926.59 toks/s, output: 58.52 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:02<00:07, 55.79it/s, est. speed input: 59897.21 toks/s, output: 58.49 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:03<00:06, 56.11it/s, est. speed input: 59882.46 toks/s, output: 58.48 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:04<00:06, 55.89it/s, est. speed input: 59853.90 toks/s, output: 58.45 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:04<00:05, 55.73it/s, est. speed input: 59825.58 toks/s, output: 58.42 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:05<00:05, 55.62it/s, est. speed input: 59797.89 toks/s, output: 58.40 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:05<00:04, 55.54it/s, est. speed input: 59770.59 toks/s, output: 58.37 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:06<00:03, 55.54it/s, est. speed input: 59745.49 toks/s, output: 58.35 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:06<00:03, 55.45it/s, est. speed input: 59718.04 toks/s, output: 58.32 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:07<00:02, 55.43it/s, est. speed input: 59692.16 toks/s, output: 58.29 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:08<00:02, 55.40it/s, est. speed input: 59666.49 toks/s, output: 58.27 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:08<00:01, 55.36it/s, est. speed input: 59640.42 toks/s, output: 58.24 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:09<00:01, 55.79it/s, est. speed input: 59628.59 toks/s, output: 58.23 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:09<00:00, 56.00it/s, est. speed input: 59614.32 toks/s, output: 58.22 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:09<00:00, 56.00it/s, est. speed input: 60053.74 toks/s, output: 58.65 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:09<00:00, 58.65it/s, est. speed input: 60053.74 toks/s, output: 58.65 toks/s]
[rank0]:[W128 12:09:25.624669599 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 161.5s

测试结果:
  Requests/s:   55.07
  Tokens/s:     56447.19
  Total Reqs:   4096
  Elapsed:      74.38s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     56392.12


------------------------------------------------------------
  生成 CSV: BitNet-2B-FP8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_6/BitNet-2B-FP8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.1283,8273.8014,7.9364
1024,1024,1,128,128,15.9070,16304.7055,8.0468
2048,1024,2,256,128,32.5583,33372.2512,7.8628
4096,1024,4,512,128,53.5419,54880.4837,9.5626
8192,1024,8,1024,128,53.5988,54938.7848,19.1049
16384,1024,16,2048,128,54.2631,55619.6939,37.7420
32768,1024,32,4096,128,55.0704,56447.1919,74.3775

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-FP8 | cuSPARSELt (2_8) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-FP8-SlideSparse-2_8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_8

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:09:38 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:09:38 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=43548) WARNING 01-28 12:09:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=43548) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=43548) WARNING 01-28 12:10:11 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.65 requests/s, 8541.60 total tokens/s, 16.65 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 12:09:38] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:09:38] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:09:38] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:09:38] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:38] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:38] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:38] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:38] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:38] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:09:38] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:09:38] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:09:38] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:09:38] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:09:38] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:09:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:09:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:09:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:09:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:09:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:09:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:09:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:09:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:09:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:09:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 12:09:55.071706305 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:55] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:55] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:55] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:55] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:55] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:55] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=43548) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=43548) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.38s/it]
(EngineCore_DP0 pid=43548) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.38s/it]
(EngineCore_DP0 pid=43548) 
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=43548) [2026-01-28 12:09:59] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=43548) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  2.84it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.86it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.86it/s]
(EngineCore_DP0 pid=43548) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.79it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.78it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  53%|█████▎    | 68/128 [00:00<00:00, 669.92it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 683.48it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:19,  6.65it/s, est. speed input: 3408.01 toks/s, output: 6.66 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:10, 12.08it/s, est. speed input: 5721.20 toks/s, output: 11.17 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:08, 14.30it/s, est. speed input: 6665.86 toks/s, output: 13.02 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:07, 15.48it/s, est. speed input: 7184.59 toks/s, output: 14.03 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:07, 16.08it/s, est. speed input: 7489.89 toks/s, output: 14.63 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:07, 16.55it/s, est. speed input: 7720.84 toks/s, output: 15.08 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:06, 16.88it/s, est. speed input: 7892.52 toks/s, output: 15.41 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:06, 17.09it/s, est. speed input: 8022.68 toks/s, output: 15.67 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:06, 17.22it/s, est. speed input: 8123.83 toks/s, output: 15.87 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 17.33it/s, est. speed input: 8207.29 toks/s, output: 16.03 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 17.39it/s, est. speed input: 8275.24 toks/s, output: 16.16 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 17.33it/s, est. speed input: 8318.53 toks/s, output: 16.25 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 17.40it/s, est. speed input: 8369.01 toks/s, output: 16.35 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 17.47it/s, est. speed input: 8414.66 toks/s, output: 16.43 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.41it/s, est. speed input: 8442.77 toks/s, output: 16.49 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 17.33it/s, est. speed input: 8463.16 toks/s, output: 16.53 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 17.29it/s, est. speed input: 8483.92 toks/s, output: 16.57 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 17.30it/s, est. speed input: 8505.11 toks/s, output: 16.61 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 17.34it/s, est. speed input: 8526.42 toks/s, output: 16.65 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 17.36it/s, est. speed input: 8545.15 toks/s, output: 16.69 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 17.37it/s, est. speed input: 8562.42 toks/s, output: 16.72 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:04, 17.31it/s, est. speed input: 8573.03 toks/s, output: 16.74 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 17.27it/s, est. speed input: 8582.35 toks/s, output: 16.76 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 17.25it/s, est. speed input: 8591.90 toks/s, output: 16.78 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 17.30it/s, est. speed input: 8604.79 toks/s, output: 16.81 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 17.32it/s, est. speed input: 8615.61 toks/s, output: 16.83 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 17.33it/s, est. speed input: 8625.48 toks/s, output: 16.85 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 17.36it/s, est. speed input: 8636.17 toks/s, output: 16.87 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 17.30it/s, est. speed input: 8641.45 toks/s, output: 16.88 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:03, 17.31it/s, est. speed input: 8648.88 toks/s, output: 16.89 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 17.30it/s, est. speed input: 8655.22 toks/s, output: 16.90 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 17.25it/s, est. speed input: 8658.75 toks/s, output: 16.91 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 17.26it/s, est. speed input: 8664.52 toks/s, output: 16.92 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 17.21it/s, est. speed input: 8666.97 toks/s, output: 16.93 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 17.24it/s, est. speed input: 8672.76 toks/s, output: 16.94 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 17.24it/s, est. speed input: 8677.13 toks/s, output: 16.95 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 17.30it/s, est. speed input: 8683.63 toks/s, output: 16.96 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 17.32it/s, est. speed input: 8689.00 toks/s, output: 16.97 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:02, 17.28it/s, est. speed input: 8692.09 toks/s, output: 16.98 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 17.17it/s, est. speed input: 8691.27 toks/s, output: 16.98 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 17.17it/s, est. speed input: 8693.81 toks/s, output: 16.98 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 17.25it/s, est. speed input: 8699.36 toks/s, output: 16.99 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 17.22it/s, est. speed input: 8701.27 toks/s, output: 16.99 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 17.25it/s, est. speed input: 8705.00 toks/s, output: 17.00 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 17.31it/s, est. speed input: 8709.87 toks/s, output: 17.01 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 17.36it/s, est. speed input: 8714.92 toks/s, output: 17.02 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 17.37it/s, est. speed input: 8719.14 toks/s, output: 17.03 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 17.37it/s, est. speed input: 8722.78 toks/s, output: 17.04 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 17.39it/s, est. speed input: 8726.81 toks/s, output: 17.04 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 17.42it/s, est. speed input: 8731.21 toks/s, output: 17.05 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 17.38it/s, est. speed input: 8733.49 toks/s, output: 17.06 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 17.33it/s, est. speed input: 8735.08 toks/s, output: 17.06 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 17.36it/s, est. speed input: 8738.71 toks/s, output: 17.07 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 17.38it/s, est. speed input: 8742.14 toks/s, output: 17.07 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 17.42it/s, est. speed input: 8745.99 toks/s, output: 17.08 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:00, 17.45it/s, est. speed input: 8750.00 toks/s, output: 17.09 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 17.42it/s, est. speed input: 8752.39 toks/s, output: 17.09 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 17.35it/s, est. speed input: 8753.16 toks/s, output: 17.10 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 17.36it/s, est. speed input: 8755.63 toks/s, output: 17.10 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 17.37it/s, est. speed input: 8758.15 toks/s, output: 17.11 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 17.36it/s, est. speed input: 8759.97 toks/s, output: 17.11 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 17.20it/s, est. speed input: 8757.72 toks/s, output: 17.10 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.96it/s, est. speed input: 8752.00 toks/s, output: 17.09 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.67it/s, est. speed input: 8742.72 toks/s, output: 17.08 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.67it/s, est. speed input: 8739.42 toks/s, output: 17.07 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.07it/s, est. speed input: 8739.42 toks/s, output: 17.07 toks/s]
[rank0]:[W128 12:10:35.668856359 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 69.5s

测试结果:
  Requests/s:   16.65
  Tokens/s:     8541.60
  Total Reqs:   128
  Elapsed:      7.69s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8524.95

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:10:48 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:10:48 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=44233) WARNING 01-28 12:10:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=44233) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=44233) WARNING 01-28 12:11:05 [backends.py:609] Failed to read file <frozen os>
Throughput: 17.13 requests/s, 17559.83 total tokens/s, 17.13 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 12:10:48] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:10:48] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:10:48] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:10:48] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:48] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:48] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:48] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:48] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:48] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:10:48] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:10:48] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:10:48] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:10:48] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:10:48] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:10:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:10:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:10:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:10:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:10:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:10:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:10:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:10:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:10:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:10:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:56] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:56] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:56] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:56] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:56] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:56] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=44233) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=44233) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=44233) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=44233) 
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=44233) [2026-01-28 12:10:57] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=44233) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.81it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.12it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.07it/s]
(EngineCore_DP0 pid=44233) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.62it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.61it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  30%|██▉       | 38/128 [00:00<00:00, 374.80it/s]
Adding requests:  62%|██████▏   | 79/128 [00:00<00:00, 394.04it/s]
Adding requests:  93%|█████████▎| 119/128 [00:00<00:00, 394.33it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 393.56it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:02, 55.53it/s, est. speed input: 56871.54 toks/s, output: 55.53 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:04, 23.53it/s, est. speed input: 26374.59 toks/s, output: 25.76 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:05, 20.75it/s, est. speed input: 23428.97 toks/s, output: 22.88 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:00<00:05, 19.71it/s, est. speed input: 22330.20 toks/s, output: 21.81 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:05, 19.03it/s, est. speed input: 21606.32 toks/s, output: 21.10 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 18.49it/s, est. speed input: 21045.81 toks/s, output: 20.55 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 18.24it/s, est. speed input: 20767.13 toks/s, output: 20.28 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 18.07it/s, est. speed input: 20546.95 toks/s, output: 20.07 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 17.87it/s, est. speed input: 20335.54 toks/s, output: 19.86 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 17.73it/s, est. speed input: 20158.89 toks/s, output: 19.69 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 17.66it/s, est. speed input: 20015.71 toks/s, output: 19.55 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:01<00:05, 17.60it/s, est. speed input: 19886.03 toks/s, output: 19.42 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 17.58it/s, est. speed input: 19777.52 toks/s, output: 19.31 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:04, 17.58it/s, est. speed input: 19682.65 toks/s, output: 19.22 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:04, 17.56it/s, est. speed input: 19594.25 toks/s, output: 19.13 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 17.57it/s, est. speed input: 19518.26 toks/s, output: 19.06 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 17.58it/s, est. speed input: 19448.59 toks/s, output: 18.99 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 17.34it/s, est. speed input: 19345.48 toks/s, output: 18.89 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:02<00:04, 17.17it/s, est. speed input: 19250.60 toks/s, output: 18.80 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:02<00:04, 17.23it/s, est. speed input: 19191.78 toks/s, output: 18.74 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:02<00:04, 17.23it/s, est. speed input: 19130.48 toks/s, output: 18.68 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 17.26it/s, est. speed input: 19077.99 toks/s, output: 18.63 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:03, 17.25it/s, est. speed input: 19025.86 toks/s, output: 18.58 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 17.22it/s, est. speed input: 18974.21 toks/s, output: 18.53 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 17.26it/s, est. speed input: 18933.21 toks/s, output: 18.49 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 17.33it/s, est. speed input: 18900.45 toks/s, output: 18.46 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 17.35it/s, est. speed input: 18865.61 toks/s, output: 18.42 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:03<00:03, 17.42it/s, est. speed input: 18839.50 toks/s, output: 18.40 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:03<00:03, 17.42it/s, est. speed input: 18809.56 toks/s, output: 18.37 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:03<00:03, 17.42it/s, est. speed input: 18781.41 toks/s, output: 18.34 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 17.42it/s, est. speed input: 18755.40 toks/s, output: 18.32 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:02, 17.48it/s, est. speed input: 18736.02 toks/s, output: 18.30 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 17.47it/s, est. speed input: 18712.72 toks/s, output: 18.27 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 17.35it/s, est. speed input: 18680.72 toks/s, output: 18.24 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 17.28it/s, est. speed input: 18651.23 toks/s, output: 18.21 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:04<00:02, 17.13it/s, est. speed input: 18614.29 toks/s, output: 18.18 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:04<00:02, 17.14it/s, est. speed input: 18589.10 toks/s, output: 18.15 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:04<00:02, 17.22it/s, est. speed input: 18571.16 toks/s, output: 18.14 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 17.23it/s, est. speed input: 18550.19 toks/s, output: 18.12 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 17.33it/s, est. speed input: 18538.02 toks/s, output: 18.10 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 17.30it/s, est. speed input: 18517.96 toks/s, output: 18.08 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 17.35it/s, est. speed input: 18504.88 toks/s, output: 18.07 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 17.39it/s, est. speed input: 18492.24 toks/s, output: 18.06 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 17.42it/s, est. speed input: 18480.38 toks/s, output: 18.05 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:05<00:01, 17.45it/s, est. speed input: 18469.51 toks/s, output: 18.04 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:05<00:01, 17.38it/s, est. speed input: 18453.11 toks/s, output: 18.02 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:05<00:01, 17.34it/s, est. speed input: 18437.77 toks/s, output: 18.01 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 17.33it/s, est. speed input: 18423.89 toks/s, output: 17.99 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:00, 17.38it/s, est. speed input: 18414.43 toks/s, output: 17.98 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 17.42it/s, est. speed input: 18405.89 toks/s, output: 17.97 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 17.48it/s, est. speed input: 18399.28 toks/s, output: 17.97 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 17.51it/s, est. speed input: 18392.72 toks/s, output: 17.96 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 17.52it/s, est. speed input: 18385.06 toks/s, output: 17.95 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:06<00:00, 17.36it/s, est. speed input: 18368.21 toks/s, output: 17.94 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:06<00:00, 17.39it/s, est. speed input: 18360.03 toks/s, output: 17.93 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:06<00:00, 17.41it/s, est. speed input: 18352.11 toks/s, output: 17.92 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 17.46it/s, est. speed input: 18346.27 toks/s, output: 17.92 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.46it/s, est. speed input: 18344.98 toks/s, output: 17.91 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.91it/s, est. speed input: 18344.98 toks/s, output: 17.91 toks/s]
[rank0]:[W128 12:11:31.408559921 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 56.3s

测试结果:
  Requests/s:   17.13
  Tokens/s:     17559.83
  Total Reqs:   128
  Elapsed:      7.47s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     17542.70

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:11:42 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:11:42 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=44796) WARNING 01-28 12:11:49 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=44796) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=44796) WARNING 01-28 12:12:02 [backends.py:609] Failed to read file <frozen os>
Throughput: 30.59 requests/s, 31352.23 total tokens/s, 30.59 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 12:11:41] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:11:42] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:11:42] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:11:42] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:42] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:42] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:42] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:42] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:42] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:11:42] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:11:42] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:11:42] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:11:42] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:11:42] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:11:48] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:11:48] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:11:48] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:11:48] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:48] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:48] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:48] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:48] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:11:48] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:11:48] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:11:48] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:11:48] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:11:48] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:11:48] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:50] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:50] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:50] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:50] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:50] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:50] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=44796) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=44796) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.53s/it]
(EngineCore_DP0 pid=44796) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.53s/it]
(EngineCore_DP0 pid=44796) 
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=44796) [2026-01-28 12:11:54] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=44796) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.85it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.28it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.67it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.78it/s]
(EngineCore_DP0 pid=44796) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.30it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.28it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.11it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  15%|█▍        | 38/256 [00:00<00:00, 377.29it/s]
Adding requests:  30%|██▉       | 76/256 [00:00<00:00, 373.71it/s]
Adding requests:  45%|████▌     | 116/256 [00:00<00:00, 383.23it/s]
Adding requests:  61%|██████    | 155/256 [00:00<00:00, 384.00it/s]
Adding requests:  76%|███████▌  | 194/256 [00:00<00:00, 378.45it/s]
Adding requests:  92%|█████████▏| 235/256 [00:00<00:00, 387.94it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 385.27it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:00<00:01, 177.64it/s, est. speed input: 181938.74 toks/s, output: 177.65 toks/s]
Processed prompts:  14%|█▍        | 36/256 [00:00<00:04, 51.22it/s, est. speed input: 58719.09 toks/s, output: 57.34 toks/s]   
Processed prompts:  18%|█▊        | 46/256 [00:00<00:04, 44.13it/s, est. speed input: 51112.94 toks/s, output: 49.91 toks/s]
Processed prompts:  21%|██        | 53/256 [00:01<00:04, 41.69it/s, est. speed input: 48517.57 toks/s, output: 47.38 toks/s]
Processed prompts:  23%|██▎       | 59/256 [00:01<00:05, 38.25it/s, est. speed input: 45792.03 toks/s, output: 44.72 toks/s]
Processed prompts:  25%|██▌       | 64/256 [00:01<00:05, 34.38it/s, est. speed input: 43149.61 toks/s, output: 42.14 toks/s]
Processed prompts:  27%|██▋       | 68/256 [00:01<00:05, 33.43it/s, est. speed input: 42147.30 toks/s, output: 41.16 toks/s]
Processed prompts:  28%|██▊       | 72/256 [00:01<00:05, 32.83it/s, est. speed input: 41381.34 toks/s, output: 40.41 toks/s]
Processed prompts:  30%|██▉       | 76/256 [00:01<00:05, 32.38it/s, est. speed input: 40730.79 toks/s, output: 39.78 toks/s]
Processed prompts:  31%|███▏      | 80/256 [00:02<00:05, 32.05it/s, est. speed input: 40172.11 toks/s, output: 39.23 toks/s]
Processed prompts:  33%|███▎      | 84/256 [00:02<00:05, 31.74it/s, est. speed input: 39663.50 toks/s, output: 38.73 toks/s]
Processed prompts:  34%|███▍      | 88/256 [00:02<00:05, 31.49it/s, est. speed input: 39208.73 toks/s, output: 38.29 toks/s]
Processed prompts:  36%|███▌      | 92/256 [00:02<00:05, 31.33it/s, est. speed input: 38806.15 toks/s, output: 37.90 toks/s]
Processed prompts:  38%|███▊      | 96/256 [00:02<00:05, 31.27it/s, est. speed input: 38457.43 toks/s, output: 37.56 toks/s]
Processed prompts:  39%|███▉      | 100/256 [00:02<00:05, 31.08it/s, est. speed input: 38113.92 toks/s, output: 37.22 toks/s]
Processed prompts:  41%|████      | 104/256 [00:02<00:04, 31.05it/s, est. speed input: 37820.01 toks/s, output: 36.93 toks/s]
Processed prompts:  42%|████▏     | 108/256 [00:02<00:04, 30.83it/s, est. speed input: 37516.33 toks/s, output: 36.64 toks/s]
Processed prompts:  44%|████▍     | 112/256 [00:03<00:04, 30.75it/s, est. speed input: 37251.97 toks/s, output: 36.38 toks/s]
Processed prompts:  45%|████▌     | 116/256 [00:03<00:04, 30.54it/s, est. speed input: 36983.89 toks/s, output: 36.12 toks/s]
Processed prompts:  47%|████▋     | 120/256 [00:03<00:04, 30.43it/s, est. speed input: 36743.33 toks/s, output: 35.88 toks/s]
Processed prompts:  48%|████▊     | 124/256 [00:03<00:04, 30.47it/s, est. speed input: 36537.36 toks/s, output: 35.68 toks/s]
Processed prompts:  50%|█████     | 128/256 [00:03<00:04, 30.37it/s, est. speed input: 36329.43 toks/s, output: 35.48 toks/s]
Processed prompts:  52%|█████▏    | 132/256 [00:03<00:04, 30.26it/s, est. speed input: 36129.69 toks/s, output: 35.28 toks/s]
Processed prompts:  53%|█████▎    | 136/256 [00:03<00:03, 30.32it/s, est. speed input: 35961.90 toks/s, output: 35.12 toks/s]
Processed prompts:  55%|█████▍    | 140/256 [00:04<00:03, 30.39it/s, est. speed input: 35808.96 toks/s, output: 34.97 toks/s]
Processed prompts:  56%|█████▋    | 144/256 [00:04<00:03, 30.30it/s, est. speed input: 35649.03 toks/s, output: 34.81 toks/s]
Processed prompts:  58%|█████▊    | 148/256 [00:04<00:03, 30.25it/s, est. speed input: 35500.06 toks/s, output: 34.67 toks/s]
Processed prompts:  59%|█████▉    | 152/256 [00:04<00:03, 30.15it/s, est. speed input: 35352.04 toks/s, output: 34.52 toks/s]
Processed prompts:  61%|██████    | 156/256 [00:04<00:03, 30.14it/s, est. speed input: 35219.62 toks/s, output: 34.39 toks/s]
Processed prompts:  62%|██████▎   | 160/256 [00:04<00:03, 30.17it/s, est. speed input: 35099.50 toks/s, output: 34.28 toks/s]
Processed prompts:  64%|██████▍   | 164/256 [00:04<00:03, 30.21it/s, est. speed input: 34987.83 toks/s, output: 34.17 toks/s]
Processed prompts:  66%|██████▌   | 168/256 [00:04<00:02, 30.30it/s, est. speed input: 34887.63 toks/s, output: 34.07 toks/s]
Processed prompts:  67%|██████▋   | 172/256 [00:05<00:02, 30.38it/s, est. speed input: 34795.39 toks/s, output: 33.98 toks/s]
Processed prompts:  69%|██████▉   | 176/256 [00:05<00:02, 30.40it/s, est. speed input: 34704.21 toks/s, output: 33.89 toks/s]
Processed prompts:  70%|███████   | 180/256 [00:05<00:02, 30.27it/s, est. speed input: 34603.16 toks/s, output: 33.79 toks/s]
Processed prompts:  72%|███████▏  | 184/256 [00:05<00:02, 30.22it/s, est. speed input: 34511.80 toks/s, output: 33.70 toks/s]
Processed prompts:  73%|███████▎  | 188/256 [00:05<00:02, 30.30it/s, est. speed input: 34434.06 toks/s, output: 33.63 toks/s]
Processed prompts:  75%|███████▌  | 192/256 [00:05<00:02, 30.18it/s, est. speed input: 34345.04 toks/s, output: 33.54 toks/s]
Processed prompts:  77%|███████▋  | 196/256 [00:05<00:01, 30.23it/s, est. speed input: 34271.13 toks/s, output: 33.47 toks/s]
Processed prompts:  78%|███████▊  | 200/256 [00:05<00:01, 30.32it/s, est. speed input: 34205.83 toks/s, output: 33.40 toks/s]
Processed prompts:  80%|███████▉  | 204/256 [00:06<00:01, 30.41it/s, est. speed input: 34144.46 toks/s, output: 33.34 toks/s]
Processed prompts:  81%|████████▏ | 208/256 [00:06<00:01, 30.42it/s, est. speed input: 34082.47 toks/s, output: 33.28 toks/s]
Processed prompts:  83%|████████▎ | 212/256 [00:06<00:01, 30.47it/s, est. speed input: 34025.66 toks/s, output: 33.23 toks/s]
Processed prompts:  84%|████████▍ | 216/256 [00:06<00:01, 31.29it/s, est. speed input: 34028.89 toks/s, output: 33.23 toks/s]
Processed prompts:  86%|████████▌ | 220/256 [00:06<00:01, 31.95it/s, est. speed input: 34035.68 toks/s, output: 33.24 toks/s]
Processed prompts:  88%|████████▊ | 224/256 [00:06<00:00, 32.36it/s, est. speed input: 34037.57 toks/s, output: 33.24 toks/s]
Processed prompts:  89%|████████▉ | 228/256 [00:06<00:00, 32.75it/s, est. speed input: 34046.10 toks/s, output: 33.25 toks/s]
Processed prompts:  91%|█████████ | 232/256 [00:06<00:00, 33.02it/s, est. speed input: 34053.17 toks/s, output: 33.25 toks/s]
Processed prompts:  92%|█████████▏| 236/256 [00:09<00:04,  4.20it/s, est. speed input: 24483.01 toks/s, output: 23.91 toks/s]
Processed prompts:  94%|█████████▍| 240/256 [00:09<00:02,  5.69it/s, est. speed input: 24596.62 toks/s, output: 24.02 toks/s]
Processed prompts:  95%|█████████▌| 244/256 [00:10<00:01,  7.55it/s, est. speed input: 24700.52 toks/s, output: 24.12 toks/s]
Processed prompts:  97%|█████████▋| 248/256 [00:10<00:00,  9.81it/s, est. speed input: 24802.48 toks/s, output: 24.22 toks/s]
Processed prompts:  98%|█████████▊| 252/256 [00:10<00:00, 12.45it/s, est. speed input: 24911.99 toks/s, output: 24.33 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:10<00:00, 15.34it/s, est. speed input: 25017.90 toks/s, output: 24.43 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:10<00:00, 15.34it/s, est. speed input: 25017.90 toks/s, output: 24.43 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:10<00:00, 24.43it/s, est. speed input: 25017.90 toks/s, output: 24.43 toks/s]
[rank0]:[W128 12:12:29.238732923 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 57.5s

测试结果:
  Requests/s:   30.59
  Tokens/s:     31352.23
  Total Reqs:   256
  Elapsed:      8.37s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     31321.65

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:12:41 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:12:41 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=45377) WARNING 01-28 12:12:48 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=45377) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=45377) WARNING 01-28 12:12:58 [backends.py:609] Failed to read file <frozen os>
Throughput: 52.58 requests/s, 53897.03 total tokens/s, 52.58 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 12:12:41] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:12:41] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:12:41] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:12:41] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:41] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:41] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:41] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:41] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:41] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:12:41] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:12:41] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:12:41] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:12:41] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:12:41] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:12:47] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:12:47] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:12:47] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:12:47] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:47] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:47] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:47] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:47] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:12:47] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:12:47] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:12:47] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:12:47] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:12:47] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:12:47] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:48] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:48] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:48] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:48] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:48] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:48] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=45377) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=45377) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.47it/s]
(EngineCore_DP0 pid=45377) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.47it/s]
(EngineCore_DP0 pid=45377) 
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=45377) [2026-01-28 12:12:50] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=45377) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  7.58it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.10it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.27it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.72it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  7.84it/s]
(EngineCore_DP0 pid=45377) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.11it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  7.96it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.37it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.15it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 37/512 [00:00<00:01, 365.68it/s]
Adding requests:  15%|█▌        | 77/512 [00:00<00:01, 382.92it/s]
Adding requests:  23%|██▎       | 117/512 [00:00<00:01, 388.23it/s]
Adding requests:  30%|███       | 156/512 [00:00<00:00, 380.20it/s]
Adding requests:  38%|███▊      | 195/512 [00:00<00:00, 377.69it/s]
Adding requests:  46%|████▌     | 236/512 [00:00<00:00, 386.16it/s]
Adding requests:  54%|█████▎    | 275/512 [00:00<00:00, 387.38it/s]
Adding requests:  61%|██████▏   | 314/512 [00:00<00:00, 385.98it/s]
Adding requests:  69%|██████▉   | 354/512 [00:00<00:00, 388.88it/s]
Adding requests:  77%|███████▋  | 393/512 [00:01<00:00, 387.42it/s]
Adding requests:  84%|████████▍ | 432/512 [00:01<00:00, 385.43it/s]
Adding requests:  92%|█████████▏| 471/512 [00:01<00:00, 384.24it/s]
Adding requests: 100%|█████████▉| 510/512 [00:01<00:00, 377.81it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 383.01it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 62/512 [00:00<00:01, 427.87it/s, est. speed input: 438217.97 toks/s, output: 427.89 toks/s]
Processed prompts:  21%|██        | 105/512 [00:00<00:03, 103.12it/s, est. speed input: 121999.38 toks/s, output: 119.14 toks/s]
Processed prompts:  25%|██▍       | 127/512 [00:01<00:04, 79.94it/s, est. speed input: 98031.35 toks/s, output: 95.73 toks/s]   
Processed prompts:  28%|██▊       | 141/512 [00:01<00:04, 76.09it/s, est. speed input: 93326.34 toks/s, output: 91.14 toks/s]
Processed prompts:  30%|██▉       | 152/512 [00:01<00:05, 69.54it/s, est. speed input: 88061.90 toks/s, output: 86.00 toks/s]
Processed prompts:  31%|███▏      | 161/512 [00:01<00:05, 67.92it/s, est. speed input: 86103.96 toks/s, output: 84.09 toks/s]
Processed prompts:  33%|███▎      | 169/512 [00:02<00:05, 65.00it/s, est. speed input: 83934.06 toks/s, output: 81.97 toks/s]
Processed prompts:  35%|███▍      | 177/512 [00:02<00:05, 62.48it/s, est. speed input: 82048.12 toks/s, output: 80.12 toks/s]
Processed prompts:  36%|███▌      | 184/512 [00:02<00:05, 58.71it/s, est. speed input: 79961.68 toks/s, output: 78.09 toks/s]
Processed prompts:  37%|███▋      | 190/512 [00:02<00:05, 53.94it/s, est. speed input: 77708.89 toks/s, output: 75.89 toks/s]
Processed prompts:  39%|███▊      | 198/512 [00:02<00:05, 54.04it/s, est. speed input: 76479.80 toks/s, output: 74.69 toks/s]
Processed prompts:  40%|████      | 206/512 [00:02<00:05, 53.99it/s, est. speed input: 75353.45 toks/s, output: 73.58 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:02<00:05, 54.02it/s, est. speed input: 74348.04 toks/s, output: 72.60 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:03<00:05, 54.11it/s, est. speed input: 73457.20 toks/s, output: 71.74 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:03<00:05, 54.15it/s, est. speed input: 72643.10 toks/s, output: 70.94 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:03<00:05, 54.20it/s, est. speed input: 71903.33 toks/s, output: 70.22 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:03<00:04, 54.25it/s, est. speed input: 71228.64 toks/s, output: 69.56 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:03<00:04, 54.31it/s, est. speed input: 70610.58 toks/s, output: 68.96 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:03<00:04, 54.30it/s, est. speed input: 70032.07 toks/s, output: 68.39 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:03<00:04, 54.30it/s, est. speed input: 69497.91 toks/s, output: 67.87 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:04<00:04, 54.30it/s, est. speed input: 69001.60 toks/s, output: 67.38 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:04<00:04, 54.32it/s, est. speed input: 68542.55 toks/s, output: 66.94 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:04<00:04, 54.20it/s, est. speed input: 68095.65 toks/s, output: 66.50 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:04<00:03, 54.23it/s, est. speed input: 67692.70 toks/s, output: 66.11 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:04<00:03, 54.27it/s, est. speed input: 67317.47 toks/s, output: 65.74 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:04<00:03, 54.30it/s, est. speed input: 66965.67 toks/s, output: 65.40 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:05<00:03, 54.30it/s, est. speed input: 66630.70 toks/s, output: 65.07 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:05<00:03, 54.27it/s, est. speed input: 66312.36 toks/s, output: 64.76 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:05<00:03, 54.13it/s, est. speed input: 65998.32 toks/s, output: 64.45 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:05<00:02, 54.13it/s, est. speed input: 65711.41 toks/s, output: 64.17 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:05<00:02, 54.09it/s, est. speed input: 65436.08 toks/s, output: 63.90 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:05<00:02, 54.12it/s, est. speed input: 65181.17 toks/s, output: 63.65 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:05<00:02, 54.20it/s, est. speed input: 64944.30 toks/s, output: 63.42 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:06<00:02, 54.23it/s, est. speed input: 64716.89 toks/s, output: 63.20 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:06<00:02, 54.22it/s, est. speed input: 64497.11 toks/s, output: 62.99 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:06<00:02, 54.22it/s, est. speed input: 64287.75 toks/s, output: 62.78 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:06<00:01, 54.22it/s, est. speed input: 64088.18 toks/s, output: 62.59 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:06<00:01, 54.23it/s, est. speed input: 63899.16 toks/s, output: 62.40 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:06<00:01, 54.25it/s, est. speed input: 63718.64 toks/s, output: 62.22 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:06<00:01, 54.17it/s, est. speed input: 63537.71 toks/s, output: 62.05 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:07<00:01, 54.14it/s, est. speed input: 63367.03 toks/s, output: 61.88 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:07<00:01, 54.13it/s, est. speed input: 63204.52 toks/s, output: 61.72 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:07<00:01, 54.16it/s, est. speed input: 63050.83 toks/s, output: 61.57 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:07<00:00, 54.18it/s, est. speed input: 62903.36 toks/s, output: 61.43 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:07<00:00, 54.20it/s, est. speed input: 62761.49 toks/s, output: 61.29 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:07<00:00, 54.20it/s, est. speed input: 62624.69 toks/s, output: 61.16 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:07<00:00, 54.20it/s, est. speed input: 62492.39 toks/s, output: 61.03 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:08<00:00, 54.11it/s, est. speed input: 62359.27 toks/s, output: 60.90 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:08<00:00, 54.07it/s, est. speed input: 62231.60 toks/s, output: 60.77 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:08<00:00, 55.14it/s, est. speed input: 62181.73 toks/s, output: 60.72 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 55.14it/s, est. speed input: 62424.24 toks/s, output: 60.96 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 60.96it/s, est. speed input: 62424.24 toks/s, output: 60.96 toks/s]
[rank0]:[W128 12:13:27.640452792 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 57.9s

测试结果:
  Requests/s:   52.58
  Tokens/s:     53897.03
  Total Reqs:   512
  Elapsed:      9.74s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     53844.44

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:13:44 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:13:44 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=45993) WARNING 01-28 12:13:51 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=45993) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=45993) WARNING 01-28 12:14:01 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.41 requests/s, 52698.40 total tokens/s, 51.41 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 12:13:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:13:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:13:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:13:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:13:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:13:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:13:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:13:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:13:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:13:50] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:13:51] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:13:51] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:13:51] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:51] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:51] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:51] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:51] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:13:51] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:13:51] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:13:51] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:13:51] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:13:51] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:13:51] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:52] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:52] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:52] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:52] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:52] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:52] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=45993) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=45993) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.45it/s]
(EngineCore_DP0 pid=45993) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.45it/s]
(EngineCore_DP0 pid=45993) 
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=45993) [2026-01-28 12:13:53] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=45993) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  4.01it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  5.75it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  6.82it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  7.47it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.31it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  6.75it/s]
(EngineCore_DP0 pid=45993) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.19it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.14it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  8.39it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.67it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.42it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 36/1024 [00:00<00:02, 357.59it/s]
Adding requests:   7%|▋         | 75/1024 [00:00<00:02, 375.59it/s]
Adding requests:  11%|█         | 114/1024 [00:00<00:02, 381.62it/s]
Adding requests:  15%|█▍        | 153/1024 [00:00<00:02, 378.39it/s]
Adding requests:  19%|█▉        | 192/1024 [00:00<00:02, 380.67it/s]
Adding requests:  23%|██▎       | 232/1024 [00:00<00:02, 386.83it/s]
Adding requests:  27%|██▋       | 272/1024 [00:00<00:01, 389.96it/s]
Adding requests:  30%|███       | 312/1024 [00:00<00:01, 388.47it/s]
Adding requests:  34%|███▍      | 351/1024 [00:00<00:01, 387.93it/s]
Adding requests:  38%|███▊      | 390/1024 [00:01<00:01, 385.62it/s]
Adding requests:  42%|████▏     | 429/1024 [00:01<00:01, 385.57it/s]
Adding requests:  46%|████▌     | 468/1024 [00:01<00:01, 382.34it/s]
Adding requests:  50%|████▉     | 507/1024 [00:01<00:01, 379.96it/s]
Adding requests:  53%|█████▎    | 546/1024 [00:01<00:01, 371.07it/s]
Adding requests:  57%|█████▋    | 586/1024 [00:01<00:01, 378.20it/s]
Adding requests:  61%|██████    | 626/1024 [00:01<00:01, 383.33it/s]
Adding requests:  65%|██████▌   | 667/1024 [00:01<00:00, 389.47it/s]
Adding requests:  69%|██████▉   | 709/1024 [00:01<00:00, 398.27it/s]
Adding requests:  73%|███████▎  | 749/1024 [00:01<00:00, 397.19it/s]
Adding requests:  77%|███████▋  | 789/1024 [00:02<00:00, 396.41it/s]
Adding requests:  81%|████████  | 829/1024 [00:02<00:00, 390.74it/s]
Adding requests:  85%|████████▍ | 870/1024 [00:02<00:00, 395.77it/s]
Adding requests:  89%|████████▉ | 911/1024 [00:02<00:00, 398.33it/s]
Adding requests:  93%|█████████▎| 951/1024 [00:02<00:00, 397.47it/s]
Adding requests:  97%|█████████▋| 991/1024 [00:02<00:00, 398.11it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 388.88it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:00<00:01, 577.16it/s, est. speed input: 591095.39 toks/s, output: 577.20 toks/s]
Processed prompts:  18%|█▊        | 188/1024 [00:01<00:06, 121.05it/s, est. speed input: 148258.27 toks/s, output: 144.78 toks/s]
Processed prompts:  21%|██        | 215/1024 [00:01<00:08, 99.32it/s, est. speed input: 125170.84 toks/s, output: 122.24 toks/s] 
Processed prompts:  23%|██▎       | 233/1024 [00:02<00:08, 89.20it/s, est. speed input: 115509.59 toks/s, output: 112.80 toks/s]
Processed prompts:  24%|██▍       | 246/1024 [00:02<00:10, 76.92it/s, est. speed input: 106183.83 toks/s, output: 103.69 toks/s]
Processed prompts:  25%|██▌       | 256/1024 [00:02<00:10, 75.07it/s, est. speed input: 103788.19 toks/s, output: 101.36 toks/s]
Processed prompts:  26%|██▌       | 265/1024 [00:02<00:10, 72.06it/s, est. speed input: 101288.34 toks/s, output: 98.91 toks/s] 
Processed prompts:  27%|██▋       | 273/1024 [00:02<00:11, 67.91it/s, est. speed input: 98692.94 toks/s, output: 96.38 toks/s] 
Processed prompts:  27%|██▋       | 280/1024 [00:02<00:11, 62.81it/s, est. speed input: 96025.98 toks/s, output: 93.78 toks/s]
Processed prompts:  28%|██▊       | 287/1024 [00:03<00:12, 58.57it/s, est. speed input: 93617.06 toks/s, output: 91.42 toks/s]
Processed prompts:  29%|██▊       | 293/1024 [00:03<00:13, 53.49it/s, est. speed input: 91119.34 toks/s, output: 88.98 toks/s]
Processed prompts:  29%|██▉       | 299/1024 [00:03<00:14, 49.62it/s, est. speed input: 88854.50 toks/s, output: 86.77 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:03<00:14, 48.50it/s, est. speed input: 87056.56 toks/s, output: 85.02 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:03<00:14, 49.54it/s, est. speed input: 85681.96 toks/s, output: 83.67 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:03<00:13, 50.31it/s, est. speed input: 84416.09 toks/s, output: 82.44 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:04<00:13, 50.79it/s, est. speed input: 83232.87 toks/s, output: 81.28 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:04<00:13, 51.17it/s, est. speed input: 82142.42 toks/s, output: 80.22 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:04<00:13, 51.44it/s, est. speed input: 81128.52 toks/s, output: 79.23 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:04<00:12, 51.64it/s, est. speed input: 80186.01 toks/s, output: 78.31 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:04<00:12, 51.79it/s, est. speed input: 79306.51 toks/s, output: 77.45 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:04<00:12, 51.86it/s, est. speed input: 78477.82 toks/s, output: 76.64 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:04<00:12, 51.94it/s, est. speed input: 77704.67 toks/s, output: 75.88 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:05<00:12, 51.99it/s, est. speed input: 76976.99 toks/s, output: 75.17 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:05<00:12, 52.03it/s, est. speed input: 76291.29 toks/s, output: 74.50 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:05<00:11, 52.07it/s, est. speed input: 75646.78 toks/s, output: 73.87 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:05<00:11, 52.08it/s, est. speed input: 75035.62 toks/s, output: 73.28 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:11, 52.10it/s, est. speed input: 74458.11 toks/s, output: 72.71 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:11, 52.13it/s, est. speed input: 73911.96 toks/s, output: 72.18 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:06<00:11, 52.13it/s, est. speed input: 73391.48 toks/s, output: 71.67 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:06<00:11, 52.16it/s, est. speed input: 72900.69 toks/s, output: 71.19 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:06<00:11, 52.16it/s, est. speed input: 72431.08 toks/s, output: 70.73 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:06<00:10, 52.15it/s, est. speed input: 71982.47 toks/s, output: 70.30 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:06<00:10, 52.13it/s, est. speed input: 71552.86 toks/s, output: 69.88 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:10, 52.10it/s, est. speed input: 71140.64 toks/s, output: 69.47 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:10, 52.06it/s, est. speed input: 70745.74 toks/s, output: 69.09 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:07<00:10, 52.02it/s, est. speed input: 70365.45 toks/s, output: 68.72 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:07<00:10, 52.06it/s, est. speed input: 70008.37 toks/s, output: 68.37 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:07<00:09, 52.08it/s, est. speed input: 69665.09 toks/s, output: 68.03 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:07<00:09, 52.09it/s, est. speed input: 69335.72 toks/s, output: 67.71 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:07<00:09, 52.08it/s, est. speed input: 69017.35 toks/s, output: 67.40 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:09, 52.04it/s, est. speed input: 68709.27 toks/s, output: 67.10 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:08<00:09, 52.01it/s, est. speed input: 68412.02 toks/s, output: 66.81 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:08<00:09, 51.99it/s, est. speed input: 68126.35 toks/s, output: 66.53 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:08<00:09, 52.00it/s, est. speed input: 67853.55 toks/s, output: 66.26 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:08<00:08, 52.02it/s, est. speed input: 67590.75 toks/s, output: 66.01 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:08<00:08, 51.99it/s, est. speed input: 67334.87 toks/s, output: 65.76 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:08<00:08, 51.99it/s, est. speed input: 67088.62 toks/s, output: 65.52 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:08, 51.96it/s, est. speed input: 66849.06 toks/s, output: 65.28 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:09<00:08, 51.99it/s, est. speed input: 66621.01 toks/s, output: 65.06 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:09<00:08, 51.95it/s, est. speed input: 66396.53 toks/s, output: 64.84 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:09<00:07, 51.95it/s, est. speed input: 66181.28 toks/s, output: 64.63 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:09<00:07, 51.93it/s, est. speed input: 65971.06 toks/s, output: 64.42 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:09<00:07, 51.91it/s, est. speed input: 65767.65 toks/s, output: 64.23 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:09<00:07, 51.91it/s, est. speed input: 65571.54 toks/s, output: 64.03 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:10<00:07, 51.95it/s, est. speed input: 65383.48 toks/s, output: 63.85 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:10<00:07, 51.94it/s, est. speed input: 65199.00 toks/s, output: 63.67 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:10<00:07, 51.95it/s, est. speed input: 65020.91 toks/s, output: 63.50 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:10<00:06, 51.94it/s, est. speed input: 64847.50 toks/s, output: 63.33 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:10<00:06, 51.95it/s, est. speed input: 64679.45 toks/s, output: 63.16 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:10<00:06, 51.93it/s, est. speed input: 64514.97 toks/s, output: 63.00 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:10<00:06, 51.90it/s, est. speed input: 64354.34 toks/s, output: 62.85 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:11<00:06, 51.90it/s, est. speed input: 64198.76 toks/s, output: 62.69 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:11<00:06, 51.87it/s, est. speed input: 64046.55 toks/s, output: 62.55 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:11<00:05, 51.88it/s, est. speed input: 63899.52 toks/s, output: 62.40 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:11<00:05, 51.87it/s, est. speed input: 63755.86 toks/s, output: 62.26 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:11<00:05, 51.88it/s, est. speed input: 63616.67 toks/s, output: 62.13 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:11<00:05, 51.86it/s, est. speed input: 63479.53 toks/s, output: 61.99 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:12<00:05, 51.84it/s, est. speed input: 63345.72 toks/s, output: 61.86 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:12<00:05, 51.82it/s, est. speed input: 63215.19 toks/s, output: 61.73 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:12<00:05, 51.83it/s, est. speed input: 63088.79 toks/s, output: 61.61 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:12<00:04, 51.77it/s, est. speed input: 62962.48 toks/s, output: 61.49 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:12<00:04, 51.78it/s, est. speed input: 62841.63 toks/s, output: 61.37 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:12<00:04, 51.80it/s, est. speed input: 62724.44 toks/s, output: 61.25 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:12<00:04, 51.82it/s, est. speed input: 62610.37 toks/s, output: 61.14 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:13<00:04, 51.75it/s, est. speed input: 62495.01 toks/s, output: 61.03 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:04, 51.74it/s, est. speed input: 62383.89 toks/s, output: 60.92 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:03, 51.74it/s, est. speed input: 62275.81 toks/s, output: 60.82 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:13<00:03, 51.75it/s, est. speed input: 62170.73 toks/s, output: 60.71 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:13<00:03, 51.79it/s, est. speed input: 62069.51 toks/s, output: 60.61 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:13<00:03, 51.78it/s, est. speed input: 61968.72 toks/s, output: 60.52 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:14<00:03, 51.78it/s, est. speed input: 61870.44 toks/s, output: 60.42 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:14<00:03, 51.78it/s, est. speed input: 61774.43 toks/s, output: 60.33 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:14<00:03, 51.76it/s, est. speed input: 61679.52 toks/s, output: 60.23 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 51.80it/s, est. speed input: 61588.93 toks/s, output: 60.15 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:14<00:02, 51.80it/s, est. speed input: 61499.09 toks/s, output: 60.06 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:14<00:02, 51.78it/s, est. speed input: 61410.01 toks/s, output: 59.97 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:14<00:02, 51.78it/s, est. speed input: 61323.57 toks/s, output: 59.89 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:15<00:02, 51.74it/s, est. speed input: 61237.32 toks/s, output: 59.80 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:15<00:02, 51.72it/s, est. speed input: 61153.08 toks/s, output: 59.72 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:15<00:01, 51.72it/s, est. speed input: 61071.15 toks/s, output: 59.64 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 51.72it/s, est. speed input: 60990.82 toks/s, output: 59.56 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 51.70it/s, est. speed input: 60911.43 toks/s, output: 59.48 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:15<00:01, 51.68it/s, est. speed input: 60833.24 toks/s, output: 59.41 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:16<00:01, 51.71it/s, est. speed input: 60758.04 toks/s, output: 59.33 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:16<00:01, 51.73it/s, est. speed input: 60684.38 toks/s, output: 59.26 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:16<00:01, 51.74it/s, est. speed input: 60612.06 toks/s, output: 59.19 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 51.77it/s, est. speed input: 60541.64 toks/s, output: 59.12 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 53.41it/s, est. speed input: 60529.51 toks/s, output: 59.11 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:16<00:00, 52.88it/s, est. speed input: 60459.35 toks/s, output: 59.04 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:16<00:00, 52.50it/s, est. speed input: 60390.11 toks/s, output: 58.97 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:17<00:00, 52.23it/s, est. speed input: 60322.13 toks/s, output: 58.91 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:17<00:00, 53.98it/s, est. speed input: 60319.28 toks/s, output: 58.91 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 53.98it/s, est. speed input: 60674.00 toks/s, output: 59.25 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 59.25it/s, est. speed input: 60674.00 toks/s, output: 59.25 toks/s]
[rank0]:[W128 12:14:41.271331895 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 73.8s

测试结果:
  Requests/s:   51.41
  Tokens/s:     52698.40
  Total Reqs:   1024
  Elapsed:      19.92s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     52646.98

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:15:03 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:15:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=46749) WARNING 01-28 12:15:10 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=46749) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=46749) WARNING 01-28 12:15:20 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.81 requests/s, 53104.73 total tokens/s, 51.81 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 12:15:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:15:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:15:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:15:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:15:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:15:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:15:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:15:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:15:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:15:10] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:15:10] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:15:10] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:15:10] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:10] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:10] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:10] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:10] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:15:10] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:15:10] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:15:10] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:15:10] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:15:10] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:15:10] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:11] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:11] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:11] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:11] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:11] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:11] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=46749) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=46749) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.53it/s]
(EngineCore_DP0 pid=46749) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.53it/s]
(EngineCore_DP0 pid=46749) 
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=46749) [2026-01-28 12:15:12] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=46749) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.61it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.83it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.16it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.33it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.50it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.55it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.00it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.14it/s]
(EngineCore_DP0 pid=46749) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.00it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  8.05it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.43it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  8.66it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.84it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.54it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 37/2048 [00:00<00:05, 366.00it/s]
Adding requests:   4%|▍         | 77/2048 [00:00<00:05, 382.83it/s]
Adding requests:   6%|▌         | 117/2048 [00:00<00:04, 386.90it/s]
Adding requests:   8%|▊         | 156/2048 [00:00<00:04, 385.32it/s]
Adding requests:  10%|▉         | 195/2048 [00:00<00:04, 386.25it/s]
Adding requests:  12%|█▏        | 237/2048 [00:00<00:04, 395.34it/s]
Adding requests:  14%|█▎        | 277/2048 [00:00<00:04, 394.13it/s]
Adding requests:  15%|█▌        | 317/2048 [00:00<00:04, 394.16it/s]
Adding requests:  17%|█▋        | 358/2048 [00:00<00:04, 395.85it/s]
Adding requests:  19%|█▉        | 399/2048 [00:01<00:04, 398.34it/s]
Adding requests:  21%|██▏       | 440/2048 [00:01<00:04, 399.86it/s]
Adding requests:  23%|██▎       | 480/2048 [00:01<00:03, 399.10it/s]
Adding requests:  25%|██▌       | 520/2048 [00:01<00:03, 389.45it/s]
Adding requests:  27%|██▋       | 561/2048 [00:01<00:03, 393.67it/s]
Adding requests:  29%|██▉       | 601/2048 [00:01<00:03, 392.37it/s]
Adding requests:  31%|███▏      | 643/2048 [00:01<00:03, 398.99it/s]
Adding requests:  33%|███▎      | 685/2048 [00:01<00:03, 404.18it/s]
Adding requests:  35%|███▌      | 726/2048 [00:01<00:03, 403.07it/s]
Adding requests:  37%|███▋      | 767/2048 [00:01<00:03, 391.68it/s]
Adding requests:  39%|███▉      | 807/2048 [00:02<00:03, 388.88it/s]
Adding requests:  41%|████▏     | 846/2048 [00:02<00:03, 386.94it/s]
Adding requests:  43%|████▎     | 888/2048 [00:02<00:02, 396.53it/s]
Adding requests:  45%|████▌     | 931/2048 [00:02<00:02, 403.85it/s]
Adding requests:  48%|████▊     | 973/2048 [00:02<00:02, 406.45it/s]
Adding requests:  50%|████▉     | 1016/2048 [00:02<00:02, 410.69it/s]
Adding requests:  52%|█████▏    | 1058/2048 [00:02<00:02, 410.65it/s]
Adding requests:  54%|█████▎    | 1100/2048 [00:02<00:02, 410.97it/s]
Adding requests:  56%|█████▌    | 1142/2048 [00:02<00:02, 400.21it/s]
Adding requests:  58%|█████▊    | 1186/2048 [00:02<00:02, 410.87it/s]
Adding requests:  60%|██████    | 1229/2048 [00:03<00:01, 413.27it/s]
Adding requests:  62%|██████▏   | 1271/2048 [00:03<00:01, 410.07it/s]
Adding requests:  64%|██████▍   | 1313/2048 [00:03<00:01, 405.30it/s]
Adding requests:  66%|██████▌   | 1355/2048 [00:03<00:01, 408.13it/s]
Adding requests:  68%|██████▊   | 1398/2048 [00:03<00:01, 412.59it/s]
Adding requests:  70%|███████   | 1440/2048 [00:03<00:01, 407.49it/s]
Adding requests:  72%|███████▏  | 1482/2048 [00:03<00:01, 410.53it/s]
Adding requests:  74%|███████▍  | 1524/2048 [00:03<00:01, 413.25it/s]
Adding requests:  77%|███████▋  | 1567/2048 [00:03<00:01, 416.36it/s]
Adding requests:  79%|███████▊  | 1611/2048 [00:04<00:01, 419.09it/s]
Adding requests:  81%|████████  | 1653/2048 [00:04<00:00, 417.25it/s]
Adding requests:  83%|████████▎ | 1695/2048 [00:04<00:00, 414.12it/s]
Adding requests:  85%|████████▍ | 1737/2048 [00:04<00:00, 414.94it/s]
Adding requests:  87%|████████▋ | 1779/2048 [00:04<00:00, 411.27it/s]
Adding requests:  89%|████████▉ | 1821/2048 [00:04<00:00, 413.61it/s]
Adding requests:  91%|█████████ | 1863/2048 [00:04<00:00, 405.45it/s]
Adding requests:  93%|█████████▎| 1905/2048 [00:04<00:00, 395.64it/s]
Adding requests:  95%|█████████▍| 1945/2048 [00:04<00:00, 396.84it/s]
Adding requests:  97%|█████████▋| 1986/2048 [00:04<00:00, 399.59it/s]
Adding requests:  99%|█████████▉| 2028/2048 [00:05<00:00, 404.85it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 402.75it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:00<00:00, 2288.89it/s, est. speed input: 2344329.86 toks/s, output: 2289.05 toks/s]
Processed prompts:  23%|██▎       | 471/2048 [00:04<00:17, 91.31it/s, est. speed input: 109746.69 toks/s, output: 107.17 toks/s]    
Processed prompts:  28%|██▊       | 569/2048 [00:06<00:19, 77.04it/s, est. speed input: 93486.48 toks/s, output: 91.30 toks/s]  
Processed prompts:  31%|███       | 625/2048 [00:07<00:19, 73.63it/s, est. speed input: 89491.37 toks/s, output: 87.39 toks/s]
Processed prompts:  32%|███▏      | 661/2048 [00:08<00:21, 65.63it/s, est. speed input: 83865.96 toks/s, output: 81.90 toks/s]
Processed prompts:  33%|███▎      | 686/2048 [00:08<00:20, 67.21it/s, est. speed input: 83848.59 toks/s, output: 81.88 toks/s]
Processed prompts:  34%|███▍      | 705/2048 [00:08<00:20, 66.57it/s, est. speed input: 83132.34 toks/s, output: 81.18 toks/s]
Processed prompts:  35%|███▌      | 720/2048 [00:08<00:20, 63.89it/s, est. speed input: 82003.37 toks/s, output: 80.08 toks/s]
Processed prompts:  36%|███▌      | 732/2048 [00:09<00:22, 59.51it/s, est. speed input: 80623.70 toks/s, output: 78.73 toks/s]
Processed prompts:  36%|███▌      | 742/2048 [00:09<00:24, 54.07it/s, est. speed input: 79117.10 toks/s, output: 77.26 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:09<00:25, 50.72it/s, est. speed input: 77908.17 toks/s, output: 76.08 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:10<00:25, 51.06it/s, est. speed input: 77171.67 toks/s, output: 75.36 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:10<00:24, 51.35it/s, est. speed input: 76479.63 toks/s, output: 74.69 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:10<00:24, 51.54it/s, est. speed input: 75822.43 toks/s, output: 74.05 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:13<01:19, 15.46it/s, est. speed input: 60998.93 toks/s, output: 59.57 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:14<01:02, 19.34it/s, est. speed input: 60833.40 toks/s, output: 59.41 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:14<00:50, 23.65it/s, est. speed input: 60674.28 toks/s, output: 59.25 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:14<00:41, 28.16it/s, est. speed input: 60522.37 toks/s, output: 59.10 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:14<00:35, 32.58it/s, est. speed input: 60375.91 toks/s, output: 58.96 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:15<00:31, 36.65it/s, est. speed input: 60234.19 toks/s, output: 58.82 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:15<00:28, 40.19it/s, est. speed input: 60098.76 toks/s, output: 58.69 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:15<00:25, 43.13it/s, est. speed input: 59967.63 toks/s, output: 58.56 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:16<00:24, 45.46it/s, est. speed input: 59841.43 toks/s, output: 58.44 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:16<00:22, 47.25it/s, est. speed input: 59719.44 toks/s, output: 58.32 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:16<00:21, 49.27it/s, est. speed input: 59655.54 toks/s, output: 58.26 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:17<00:21, 50.07it/s, est. speed input: 59540.97 toks/s, output: 58.15 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:17<00:20, 50.65it/s, est. speed input: 59431.20 toks/s, output: 58.04 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:17<00:20, 51.05it/s, est. speed input: 59323.77 toks/s, output: 57.93 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:18<00:19, 51.34it/s, est. speed input: 59220.84 toks/s, output: 57.83 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:18<00:19, 51.56it/s, est. speed input: 59122.34 toks/s, output: 57.74 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:18<00:18, 51.71it/s, est. speed input: 59026.16 toks/s, output: 57.64 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:18<00:18, 51.81it/s, est. speed input: 58933.02 toks/s, output: 57.55 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:19<00:18, 51.90it/s, est. speed input: 58844.10 toks/s, output: 57.46 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:19<00:17, 51.94it/s, est. speed input: 58756.82 toks/s, output: 57.38 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:19<00:17, 51.98it/s, est. speed input: 58672.62 toks/s, output: 57.30 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:20<00:16, 52.81it/s, est. speed input: 58636.55 toks/s, output: 57.26 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:20<00:16, 52.59it/s, est. speed input: 58556.78 toks/s, output: 57.18 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:20<00:16, 52.41it/s, est. speed input: 58477.84 toks/s, output: 57.11 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:21<00:16, 52.26it/s, est. speed input: 58400.39 toks/s, output: 57.03 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:21<00:15, 52.17it/s, est. speed input: 58325.51 toks/s, output: 56.96 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:21<00:15, 52.09it/s, est. speed input: 58252.11 toks/s, output: 56.89 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:22<00:15, 52.03it/s, est. speed input: 58180.75 toks/s, output: 56.82 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:22<00:15, 52.01it/s, est. speed input: 58111.66 toks/s, output: 56.75 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:22<00:14, 52.00it/s, est. speed input: 58044.87 toks/s, output: 56.68 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:22<00:14, 51.98it/s, est. speed input: 57979.77 toks/s, output: 56.62 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:23<00:14, 51.98it/s, est. speed input: 57916.57 toks/s, output: 56.56 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:23<00:13, 51.96it/s, est. speed input: 57854.54 toks/s, output: 56.50 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:23<00:13, 51.95it/s, est. speed input: 57793.81 toks/s, output: 56.44 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:24<00:13, 51.95it/s, est. speed input: 57735.53 toks/s, output: 56.38 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:24<00:12, 51.93it/s, est. speed input: 57677.43 toks/s, output: 56.33 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:24<00:12, 51.92it/s, est. speed input: 57621.10 toks/s, output: 56.27 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:25<00:12, 51.93it/s, est. speed input: 57566.50 toks/s, output: 56.22 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:25<00:11, 51.93it/s, est. speed input: 57513.35 toks/s, output: 56.17 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:25<00:11, 51.93it/s, est. speed input: 57461.50 toks/s, output: 56.11 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:26<00:11, 51.94it/s, est. speed input: 57410.98 toks/s, output: 56.07 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:26<00:11, 51.93it/s, est. speed input: 57361.21 toks/s, output: 56.02 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:26<00:10, 51.94it/s, est. speed input: 57313.16 toks/s, output: 55.97 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:26<00:10, 51.93it/s, est. speed input: 57265.73 toks/s, output: 55.92 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:27<00:10, 51.94it/s, est. speed input: 57219.95 toks/s, output: 55.88 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:27<00:09, 51.94it/s, est. speed input: 57174.71 toks/s, output: 55.83 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:27<00:09, 51.95it/s, est. speed input: 57131.01 toks/s, output: 55.79 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:28<00:09, 51.94it/s, est. speed input: 57087.78 toks/s, output: 55.75 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:28<00:08, 51.94it/s, est. speed input: 57045.46 toks/s, output: 55.71 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:28<00:08, 51.98it/s, est. speed input: 57005.64 toks/s, output: 55.67 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:29<00:08, 52.00it/s, est. speed input: 56966.60 toks/s, output: 55.63 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:29<00:07, 52.03it/s, est. speed input: 56928.62 toks/s, output: 55.59 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:29<00:07, 52.05it/s, est. speed input: 56891.63 toks/s, output: 55.56 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:30<00:07, 52.06it/s, est. speed input: 56855.23 toks/s, output: 55.52 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:30<00:07, 52.07it/s, est. speed input: 56819.65 toks/s, output: 55.49 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:30<00:06, 52.08it/s, est. speed input: 56784.88 toks/s, output: 55.45 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:30<00:06, 52.07it/s, est. speed input: 56750.03 toks/s, output: 55.42 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:31<00:06, 52.08it/s, est. speed input: 56716.79 toks/s, output: 55.39 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:31<00:05, 52.08it/s, est. speed input: 56683.67 toks/s, output: 55.36 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:31<00:05, 52.09it/s, est. speed input: 56651.57 toks/s, output: 55.32 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:32<00:05, 52.10it/s, est. speed input: 56620.44 toks/s, output: 55.29 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:32<00:04, 52.11it/s, est. speed input: 56589.75 toks/s, output: 55.26 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:32<00:04, 52.10it/s, est. speed input: 56559.30 toks/s, output: 55.23 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:33<00:04, 52.10it/s, est. speed input: 56529.39 toks/s, output: 55.20 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:33<00:03, 52.09it/s, est. speed input: 56499.91 toks/s, output: 55.18 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:33<00:03, 52.09it/s, est. speed input: 56471.05 toks/s, output: 55.15 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:33<00:03, 52.90it/s, est. speed input: 56468.90 toks/s, output: 55.15 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:34<00:03, 52.66it/s, est. speed input: 56440.90 toks/s, output: 55.12 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:34<00:02, 52.48it/s, est. speed input: 56413.34 toks/s, output: 55.09 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:34<00:02, 52.36it/s, est. speed input: 56386.24 toks/s, output: 55.06 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:35<00:02, 52.29it/s, est. speed input: 56360.04 toks/s, output: 55.04 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:35<00:01, 52.23it/s, est. speed input: 56333.84 toks/s, output: 55.01 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:35<00:01, 52.19it/s, est. speed input: 56308.22 toks/s, output: 54.99 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:36<00:01, 52.15it/s, est. speed input: 56282.82 toks/s, output: 54.96 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:36<00:00, 52.14it/s, est. speed input: 56258.13 toks/s, output: 54.94 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:36<00:00, 52.13it/s, est. speed input: 56233.81 toks/s, output: 54.92 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:37<00:00, 53.06it/s, est. speed input: 56237.37 toks/s, output: 54.92 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:37<00:00, 53.06it/s, est. speed input: 56623.95 toks/s, output: 55.30 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:37<00:00, 55.30it/s, est. speed input: 56623.95 toks/s, output: 55.30 toks/s]
[rank0]:[W128 12:16:22.173754208 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 101.6s

测试结果:
  Requests/s:   51.81
  Tokens/s:     53104.73
  Total Reqs:   2048
  Elapsed:      39.53s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     53052.92

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:16:55 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:16:56 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=47691) WARNING 01-28 12:17:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=47691) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=47691) WARNING 01-28 12:17:15 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.54 requests/s, 52831.44 total tokens/s, 51.54 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 12:16:55] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:16:55] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:16:55] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:16:55] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:16:55] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:16:55] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:16:55] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:16:55] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:16:55] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:16:55] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:16:55] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:16:55] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:16:55] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:16:55] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:17:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:17:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:17:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:17:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:17:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:17:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:17:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:17:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:17:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:17:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:17:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:17:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:17:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:17:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:03] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:03] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:03] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:03] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:03] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:03] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=47691) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=47691) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=47691) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=47691) 
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11059200 bytes
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 39813120 bytes
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=47691) [2026-01-28 12:17:04] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 19906560 bytes
(EngineCore_DP0 pid=47691) [rank0]:W0128 12:17:23.318000 47691 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=47691) [rank0]:W0128 12:17:23.418000 47691 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=47691) [rank0]:W0128 12:17:24.691000 47691 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=47691) [rank0]:W0128 12:17:24.852000 47691 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=47691) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.49it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  7.77it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.06it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.28it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.30it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  8.35it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.46it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  8.50it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  8.58it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.68it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.26it/s]
(EngineCore_DP0 pid=47691) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.21it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.19it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.58it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  8.73it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.87it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  8.98it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  9.07it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.78it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 37/4096 [00:00<00:11, 367.55it/s]
Adding requests:   2%|▏         | 76/4096 [00:00<00:10, 379.75it/s]
Adding requests:   3%|▎         | 115/4096 [00:00<00:10, 382.43it/s]
Adding requests:   4%|▍         | 154/4096 [00:00<00:10, 380.38it/s]
Adding requests:   5%|▍         | 193/4096 [00:00<00:10, 381.07it/s]
Adding requests:   6%|▌         | 233/4096 [00:00<00:10, 385.93it/s]
Adding requests:   7%|▋         | 274/4096 [00:00<00:09, 390.72it/s]
Adding requests:   8%|▊         | 314/4096 [00:00<00:09, 389.27it/s]
Adding requests:   9%|▊         | 353/4096 [00:00<00:09, 388.71it/s]
Adding requests:  10%|▉         | 393/4096 [00:01<00:09, 389.90it/s]
Adding requests:  11%|█         | 433/4096 [00:01<00:09, 392.12it/s]
Adding requests:  12%|█▏        | 473/4096 [00:01<00:09, 388.87it/s]
Adding requests:  12%|█▎        | 512/4096 [00:01<00:09, 386.77it/s]
Adding requests:  13%|█▎        | 551/4096 [00:01<00:09, 384.22it/s]
Adding requests:  14%|█▍        | 592/4096 [00:01<00:08, 391.67it/s]
Adding requests:  15%|█▌        | 633/4096 [00:01<00:08, 394.75it/s]
Adding requests:  16%|█▋        | 675/4096 [00:01<00:08, 401.25it/s]
Adding requests:  18%|█▊        | 717/4096 [00:01<00:08, 404.73it/s]
Adding requests:  19%|█▊        | 759/4096 [00:01<00:08, 406.01it/s]
Adding requests:  20%|█▉        | 800/4096 [00:02<00:08, 400.83it/s]
Adding requests:  21%|██        | 841/4096 [00:02<00:08, 389.10it/s]
Adding requests:  22%|██▏       | 883/4096 [00:02<00:08, 396.15it/s]
Adding requests:  23%|██▎       | 923/4096 [00:02<00:08, 396.53it/s]
Adding requests:  24%|██▎       | 963/4096 [00:02<00:07, 395.63it/s]
Adding requests:  24%|██▍       | 1003/4096 [00:02<00:07, 393.73it/s]
Adding requests:  26%|██▌       | 1045/4096 [00:02<00:07, 400.17it/s]
Adding requests:  27%|██▋       | 1086/4096 [00:02<00:07, 387.33it/s]
Adding requests:  27%|██▋       | 1126/4096 [00:02<00:07, 390.70it/s]
Adding requests:  29%|██▊       | 1169/4096 [00:02<00:07, 401.39it/s]
Adding requests:  30%|██▉       | 1212/4096 [00:03<00:07, 409.35it/s]
Adding requests:  31%|███       | 1254/4096 [00:03<00:07, 402.25it/s]
Adding requests:  32%|███▏      | 1295/4096 [00:03<00:06, 402.17it/s]
Adding requests:  33%|███▎      | 1338/4096 [00:03<00:06, 406.45it/s]
Adding requests:  34%|███▎      | 1380/4096 [00:03<00:06, 408.76it/s]
Adding requests:  35%|███▍      | 1422/4096 [00:03<00:06, 411.61it/s]
Adding requests:  36%|███▌      | 1465/4096 [00:03<00:06, 416.81it/s]
Adding requests:  37%|███▋      | 1507/4096 [00:03<00:06, 417.41it/s]
Adding requests:  38%|███▊      | 1549/4096 [00:03<00:06, 418.15it/s]
Adding requests:  39%|███▉      | 1591/4096 [00:03<00:06, 415.67it/s]
Adding requests:  40%|███▉      | 1633/4096 [00:04<00:05, 414.87it/s]
Adding requests:  41%|████      | 1675/4096 [00:04<00:05, 407.25it/s]
Adding requests:  42%|████▏     | 1717/4096 [00:04<00:05, 409.86it/s]
Adding requests:  43%|████▎     | 1759/4096 [00:04<00:05, 410.78it/s]
Adding requests:  44%|████▍     | 1801/4096 [00:04<00:05, 411.23it/s]
Adding requests:  45%|████▍     | 1843/4096 [00:04<00:05, 410.06it/s]
Adding requests:  46%|████▌     | 1885/4096 [00:04<00:05, 408.28it/s]
Adding requests:  47%|████▋     | 1927/4096 [00:04<00:05, 408.74it/s]
Adding requests:  48%|████▊     | 1968/4096 [00:04<00:05, 404.06it/s]
Adding requests:  49%|████▉     | 2009/4096 [00:05<00:05, 402.86it/s]
Adding requests:  50%|█████     | 2050/4096 [00:05<00:05, 402.08it/s]
Adding requests:  51%|█████     | 2091/4096 [00:05<00:05, 397.82it/s]
Adding requests:  52%|█████▏    | 2131/4096 [00:05<00:04, 394.50it/s]
Adding requests:  53%|█████▎    | 2171/4096 [00:05<00:04, 393.93it/s]
Adding requests:  54%|█████▍    | 2211/4096 [00:05<00:04, 393.88it/s]
Adding requests:  55%|█████▌    | 2253/4096 [00:05<00:04, 401.27it/s]
Adding requests:  56%|█████▌    | 2294/4096 [00:05<00:04, 387.93it/s]
Adding requests:  57%|█████▋    | 2335/4096 [00:05<00:04, 391.42it/s]
Adding requests:  58%|█████▊    | 2377/4096 [00:05<00:04, 396.70it/s]
Adding requests:  59%|█████▉    | 2419/4096 [00:06<00:04, 401.86it/s]
Adding requests:  60%|██████    | 2461/4096 [00:06<00:04, 405.62it/s]
Adding requests:  61%|██████    | 2502/4096 [00:06<00:03, 406.53it/s]
Adding requests:  62%|██████▏   | 2544/4096 [00:06<00:03, 408.25it/s]
Adding requests:  63%|██████▎   | 2585/4096 [00:06<00:03, 408.75it/s]
Adding requests:  64%|██████▍   | 2626/4096 [00:06<00:03, 407.41it/s]
Adding requests:  65%|██████▌   | 2669/4096 [00:06<00:03, 412.08it/s]
Adding requests:  66%|██████▌   | 2711/4096 [00:06<00:03, 407.30it/s]
Adding requests:  67%|██████▋   | 2752/4096 [00:06<00:03, 406.44it/s]
Adding requests:  68%|██████▊   | 2793/4096 [00:06<00:03, 406.82it/s]
Adding requests:  69%|██████▉   | 2834/4096 [00:07<00:03, 406.11it/s]
Adding requests:  70%|███████   | 2875/4096 [00:07<00:03, 406.58it/s]
Adding requests:  71%|███████   | 2916/4096 [00:07<00:02, 402.55it/s]
Adding requests:  72%|███████▏  | 2957/4096 [00:07<00:02, 398.81it/s]
Adding requests:  73%|███████▎  | 2998/4096 [00:07<00:02, 400.95it/s]
Adding requests:  74%|███████▍  | 3039/4096 [00:07<00:02, 402.00it/s]
Adding requests:  75%|███████▌  | 3080/4096 [00:07<00:02, 393.80it/s]
Adding requests:  76%|███████▌  | 3122/4096 [00:07<00:02, 398.53it/s]
Adding requests:  77%|███████▋  | 3162/4096 [00:07<00:02, 396.79it/s]
Adding requests:  78%|███████▊  | 3202/4096 [00:08<00:02, 349.57it/s]
Adding requests:  79%|███████▉  | 3238/4096 [00:08<00:02, 335.29it/s]
Adding requests:  80%|████████  | 3278/4096 [00:08<00:02, 352.11it/s]
Adding requests:  81%|████████  | 3314/4096 [00:10<00:17, 43.76it/s] 
Adding requests:  82%|████████▏ | 3356/4096 [00:11<00:12, 61.24it/s]
Adding requests:  83%|████████▎ | 3397/4096 [00:11<00:08, 82.88it/s]
Adding requests:  84%|████████▍ | 3438/4096 [00:11<00:06, 109.58it/s]
Adding requests:  85%|████████▍ | 3477/4096 [00:11<00:04, 138.72it/s]
Adding requests:  86%|████████▌ | 3519/4096 [00:11<00:03, 174.84it/s]
Adding requests:  87%|████████▋ | 3560/4096 [00:11<00:02, 210.80it/s]
Adding requests:  88%|████████▊ | 3601/4096 [00:11<00:02, 246.28it/s]
Adding requests:  89%|████████▉ | 3641/4096 [00:11<00:01, 271.07it/s]
Adding requests:  90%|████████▉ | 3682/4096 [00:11<00:01, 301.34it/s]
Adding requests:  91%|█████████ | 3721/4096 [00:11<00:01, 322.16it/s]
Adding requests:  92%|█████████▏| 3762/4096 [00:12<00:00, 344.05it/s]
Adding requests:  93%|█████████▎| 3804/4096 [00:12<00:00, 362.77it/s]
Adding requests:  94%|█████████▍| 3846/4096 [00:12<00:00, 378.22it/s]
Adding requests:  95%|█████████▍| 3888/4096 [00:12<00:00, 387.17it/s]
Adding requests:  96%|█████████▌| 3930/4096 [00:12<00:00, 396.00it/s]
Adding requests:  97%|█████████▋| 3972/4096 [00:12<00:00, 402.22it/s]
Adding requests:  98%|█████████▊| 4014/4096 [00:12<00:00, 403.62it/s]
Adding requests:  99%|█████████▉| 4056/4096 [00:12<00:00, 399.81it/s]
Adding requests: 100%|██████████| 4096/4096 [00:12<00:00, 318.22it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:00<00:03, 1175.60it/s, est. speed input: 1203875.10 toks/s, output: 1175.62 toks/s]
Processed prompts:  15%|█▌        | 632/4096 [00:02<00:15, 221.31it/s, est. speed input: 282588.20 toks/s, output: 275.96 toks/s]   
Processed prompts:  17%|█▋        | 685/4096 [00:03<00:24, 141.01it/s, est. speed input: 198897.47 toks/s, output: 194.24 toks/s]
Processed prompts:  17%|█▋        | 716/4096 [00:04<00:28, 118.83it/s, est. speed input: 176821.70 toks/s, output: 172.68 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:04<00:34, 97.39it/s, est. speed input: 158616.90 toks/s, output: 154.90 toks/s] 
Processed prompts:  19%|█▉        | 770/4096 [00:05<00:39, 84.95it/s, est. speed input: 146367.88 toks/s, output: 142.94 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:06<00:43, 75.68it/s, est. speed input: 136711.41 toks/s, output: 133.51 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:06<00:47, 68.81it/s, est. speed input: 128851.73 toks/s, output: 125.83 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:07<00:50, 63.83it/s, est. speed input: 122339.02 toks/s, output: 119.47 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:07<00:53, 60.22it/s, est. speed input: 116840.26 toks/s, output: 114.10 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:08<00:54, 57.66it/s, est. speed input: 112154.77 toks/s, output: 109.53 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:09<00:55, 56.10it/s, est. speed input: 108220.89 toks/s, output: 105.68 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:09<00:56, 54.73it/s, est. speed input: 104678.03 toks/s, output: 102.22 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:10<00:57, 53.77it/s, est. speed input: 101560.24 toks/s, output: 99.18 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:10<00:57, 53.09it/s, est. speed input: 98793.70 toks/s, output: 96.48 toks/s] 
Processed prompts:  27%|██▋       | 1090/4096 [00:11<00:57, 52.62it/s, est. speed input: 96324.15 toks/s, output: 94.07 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:12<00:56, 52.33it/s, est. speed input: 94119.64 toks/s, output: 91.91 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:12<00:56, 52.51it/s, est. speed input: 92237.44 toks/s, output: 90.08 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:13<00:55, 52.25it/s, est. speed input: 90422.45 toks/s, output: 88.30 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:14<00:55, 52.07it/s, est. speed input: 88766.26 toks/s, output: 86.69 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:14<00:54, 51.98it/s, est. speed input: 87259.41 toks/s, output: 85.21 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:15<00:54, 51.83it/s, est. speed input: 85855.90 toks/s, output: 83.84 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:15<00:53, 51.77it/s, est. speed input: 84570.11 toks/s, output: 82.59 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:16<00:53, 51.72it/s, est. speed input: 83380.53 toks/s, output: 81.43 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:17<00:52, 51.69it/s, est. speed input: 82276.69 toks/s, output: 80.35 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:17<00:51, 51.67it/s, est. speed input: 81251.28 toks/s, output: 79.35 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:18<00:51, 51.65it/s, est. speed input: 80293.84 toks/s, output: 78.41 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:19<00:50, 51.63it/s, est. speed input: 79397.78 toks/s, output: 77.54 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:19<00:50, 51.63it/s, est. speed input: 78559.14 toks/s, output: 76.72 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:20<00:49, 51.66it/s, est. speed input: 77777.48 toks/s, output: 75.95 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:20<00:48, 51.59it/s, est. speed input: 77029.11 toks/s, output: 75.22 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:21<00:48, 51.59it/s, est. speed input: 76329.77 toks/s, output: 74.54 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:22<00:47, 51.58it/s, est. speed input: 75670.14 toks/s, output: 73.90 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:22<00:47, 51.57it/s, est. speed input: 75045.27 toks/s, output: 73.29 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:23<00:46, 51.56it/s, est. speed input: 74453.00 toks/s, output: 72.71 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:23<00:45, 51.56it/s, est. speed input: 73891.78 toks/s, output: 72.16 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:24<00:45, 51.49it/s, est. speed input: 73351.98 toks/s, output: 71.63 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:25<00:44, 51.46it/s, est. speed input: 72839.83 toks/s, output: 71.13 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:25<00:44, 51.49it/s, est. speed input: 72358.05 toks/s, output: 70.66 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:26<00:43, 51.89it/s, est. speed input: 71941.14 toks/s, output: 70.25 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:27<00:42, 51.79it/s, est. speed input: 71502.17 toks/s, output: 69.83 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:27<00:42, 51.73it/s, est. speed input: 71083.25 toks/s, output: 69.42 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:28<00:41, 51.68it/s, est. speed input: 70682.36 toks/s, output: 69.03 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:28<00:40, 51.64it/s, est. speed input: 70298.34 toks/s, output: 68.65 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:29<00:40, 51.61it/s, est. speed input: 69930.22 toks/s, output: 68.29 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:30<00:39, 51.59it/s, est. speed input: 69577.79 toks/s, output: 67.95 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:33<01:28, 22.82it/s, est. speed input: 63836.43 toks/s, output: 62.34 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:34<01:12, 27.40it/s, est. speed input: 63634.34 toks/s, output: 62.14 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:34<01:01, 31.88it/s, est. speed input: 63439.95 toks/s, output: 61.95 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:35<00:53, 36.00it/s, est. speed input: 63252.42 toks/s, output: 61.77 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:35<00:47, 39.58it/s, est. speed input: 63071.20 toks/s, output: 61.59 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:36<00:43, 42.54it/s, est. speed input: 62896.07 toks/s, output: 61.42 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:37<00:40, 45.18it/s, est. speed input: 62752.28 toks/s, output: 61.28 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:37<00:38, 46.92it/s, est. speed input: 62588.48 toks/s, output: 61.12 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:38<00:36, 48.21it/s, est. speed input: 62429.39 toks/s, output: 60.97 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:38<00:35, 49.18it/s, est. speed input: 62276.34 toks/s, output: 60.82 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:39<00:34, 49.79it/s, est. speed input: 62122.53 toks/s, output: 60.67 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:40<00:33, 50.27it/s, est. speed input: 61976.35 toks/s, output: 60.52 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:40<00:32, 50.62it/s, est. speed input: 61834.83 toks/s, output: 60.39 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:41<00:31, 51.25it/s, est. speed input: 61720.88 toks/s, output: 60.27 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:42<00:30, 51.31it/s, est. speed input: 61587.53 toks/s, output: 60.14 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:42<00:29, 51.35it/s, est. speed input: 61457.66 toks/s, output: 60.02 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:43<00:29, 51.39it/s, est. speed input: 61331.88 toks/s, output: 59.89 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:43<00:28, 51.42it/s, est. speed input: 61210.08 toks/s, output: 59.78 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:44<00:27, 51.43it/s, est. speed input: 61091.48 toks/s, output: 59.66 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:45<00:27, 51.45it/s, est. speed input: 60976.17 toks/s, output: 59.55 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:45<00:26, 51.46it/s, est. speed input: 60864.16 toks/s, output: 59.44 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:46<00:26, 51.48it/s, est. speed input: 60755.56 toks/s, output: 59.33 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:47<00:25, 51.52it/s, est. speed input: 60651.75 toks/s, output: 59.23 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:47<00:24, 51.57it/s, est. speed input: 60551.14 toks/s, output: 59.13 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:48<00:24, 51.60it/s, est. speed input: 60453.01 toks/s, output: 59.04 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:48<00:23, 51.61it/s, est. speed input: 60357.25 toks/s, output: 58.94 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:49<00:22, 51.63it/s, est. speed input: 60263.95 toks/s, output: 58.85 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:50<00:22, 51.64it/s, est. speed input: 60173.13 toks/s, output: 58.76 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:50<00:21, 51.65it/s, est. speed input: 60084.30 toks/s, output: 58.68 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:51<00:21, 51.65it/s, est. speed input: 59997.85 toks/s, output: 58.59 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:51<00:20, 51.66it/s, est. speed input: 59913.47 toks/s, output: 58.51 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:52<00:19, 51.66it/s, est. speed input: 59830.85 toks/s, output: 58.43 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:53<00:19, 51.66it/s, est. speed input: 59750.15 toks/s, output: 58.35 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:53<00:18, 51.66it/s, est. speed input: 59671.30 toks/s, output: 58.27 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:54<00:17, 51.66it/s, est. speed input: 59594.33 toks/s, output: 58.20 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:55<00:17, 51.65it/s, est. speed input: 59518.74 toks/s, output: 58.12 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:55<00:16, 51.65it/s, est. speed input: 59444.94 toks/s, output: 58.05 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:56<00:16, 51.66it/s, est. speed input: 59373.24 toks/s, output: 57.98 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:56<00:15, 51.66it/s, est. speed input: 59302.79 toks/s, output: 57.91 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:57<00:14, 51.66it/s, est. speed input: 59233.99 toks/s, output: 57.85 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:58<00:14, 51.70it/s, est. speed input: 59168.09 toks/s, output: 57.78 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:58<00:13, 51.64it/s, est. speed input: 59100.13 toks/s, output: 57.71 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:59<00:12, 51.64it/s, est. speed input: 59035.27 toks/s, output: 57.65 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:00<00:12, 51.64it/s, est. speed input: 58971.76 toks/s, output: 57.59 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:00<00:11, 51.64it/s, est. speed input: 58909.69 toks/s, output: 57.53 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:01<00:11, 51.64it/s, est. speed input: 58848.66 toks/s, output: 57.47 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:01<00:10, 51.65it/s, est. speed input: 58789.42 toks/s, output: 57.41 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:02<00:09, 51.60it/s, est. speed input: 58729.08 toks/s, output: 57.35 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:03<00:09, 51.60it/s, est. speed input: 58671.14 toks/s, output: 57.30 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:03<00:08, 51.60it/s, est. speed input: 58614.49 toks/s, output: 57.24 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:04<00:08, 51.60it/s, est. speed input: 58558.94 toks/s, output: 57.19 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:04<00:07, 52.00it/s, est. speed input: 58518.50 toks/s, output: 57.15 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:08<00:15, 22.85it/s, est. speed input: 56225.97 toks/s, output: 54.91 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:08<00:11, 27.44it/s, est. speed input: 56195.75 toks/s, output: 54.88 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:09<00:08, 31.92it/s, est. speed input: 56165.94 toks/s, output: 54.85 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:10<00:07, 36.05it/s, est. speed input: 56136.71 toks/s, output: 54.82 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:10<00:05, 39.64it/s, est. speed input: 56108.04 toks/s, output: 54.79 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:11<00:04, 42.60it/s, est. speed input: 56079.81 toks/s, output: 54.77 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:11<00:03, 44.96it/s, est. speed input: 56052.08 toks/s, output: 54.74 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:12<00:02, 46.76it/s, est. speed input: 56024.58 toks/s, output: 54.71 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:13<00:01, 48.12it/s, est. speed input: 55997.74 toks/s, output: 54.69 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:13<00:01, 49.46it/s, est. speed input: 55982.64 toks/s, output: 54.67 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:14<00:00, 50.57it/s, est. speed input: 55971.76 toks/s, output: 54.66 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:14<00:00, 50.57it/s, est. speed input: 56384.30 toks/s, output: 55.06 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:14<00:00, 55.06it/s, est. speed input: 56384.30 toks/s, output: 55.06 toks/s]
[rank0]:[W128 12:19:00.402755839 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 158.3s

测试结果:
  Requests/s:   51.54
  Tokens/s:     52831.44
  Total Reqs:   4096
  Elapsed:      79.47s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     52779.89


------------------------------------------------------------
  生成 CSV: BitNet-2B-FP8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_8/BitNet-2B-FP8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.6503,8541.5963,7.6876
1024,1024,1,128,128,17.1315,17559.8317,7.4716
2048,1024,2,256,128,30.5875,31352.2335,8.3694
4096,1024,4,512,128,52.5825,53897.0265,9.7371
8192,1024,8,1024,128,51.4131,52698.3975,19.9171
16384,1024,16,2048,128,51.8095,53104.7312,39.5294
32768,1024,32,4096,128,51.5429,52831.4360,79.4678

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-FP8 | cuSPARSELt (2_10) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-FP8-SlideSparse-2_10
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_10

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:19:10 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:19:11 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=48749) WARNING 01-28 12:19:17 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=48749) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=48749) WARNING 01-28 12:19:32 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.04 requests/s, 8227.81 total tokens/s, 16.04 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 12:19:10] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:19:10] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:19:10] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:19:10] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:10] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:10] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:10] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:10] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:10] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:19:10] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:19:10] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:19:10] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:19:10] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:19:10] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:19:17] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:19:17] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:19:17] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:19:17] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:17] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:17] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:17] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:17] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:19:17] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:19:17] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:19:17] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:19:17] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:19:17] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:19:17] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:18] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:18] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:18] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:18] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:18] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:18] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=48749) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=48749) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.13s/it]
(EngineCore_DP0 pid=48749) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.13s/it]
(EngineCore_DP0 pid=48749) 
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=48749) [2026-01-28 12:19:21] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=48749) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  2.72it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.73it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.73it/s]
(EngineCore_DP0 pid=48749) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.48it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.47it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  51%|█████     | 65/128 [00:00<00:00, 645.60it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 655.78it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:20,  6.24it/s, est. speed input: 3195.93 toks/s, output: 6.24 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:10, 11.55it/s, est. speed input: 5449.48 toks/s, output: 10.64 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:08, 13.70it/s, est. speed input: 6365.92 toks/s, output: 12.43 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:08, 14.83it/s, est. speed input: 6867.68 toks/s, output: 13.41 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:07, 15.46it/s, est. speed input: 7176.32 toks/s, output: 14.02 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:07, 15.77it/s, est. speed input: 7368.82 toks/s, output: 14.39 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:07, 16.01it/s, est. speed input: 7517.34 toks/s, output: 14.68 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:01<00:06, 16.16it/s, est. speed input: 7628.70 toks/s, output: 14.90 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:06, 16.34it/s, est. speed input: 7729.29 toks/s, output: 15.10 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.43it/s, est. speed input: 7805.50 toks/s, output: 15.24 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.44it/s, est. speed input: 7860.59 toks/s, output: 15.35 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.46it/s, est. speed input: 7908.32 toks/s, output: 15.45 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.39it/s, est. speed input: 7939.04 toks/s, output: 15.51 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.44it/s, est. speed input: 7976.64 toks/s, output: 15.58 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:06, 16.50it/s, est. speed input: 8011.61 toks/s, output: 15.65 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 16.49it/s, est. speed input: 8037.27 toks/s, output: 15.70 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:02<00:05, 16.54it/s, est. speed input: 8065.82 toks/s, output: 15.75 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.64it/s, est. speed input: 8096.14 toks/s, output: 15.81 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.57it/s, est. speed input: 8111.90 toks/s, output: 15.84 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.62it/s, est. speed input: 8134.57 toks/s, output: 15.89 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.66it/s, est. speed input: 8155.12 toks/s, output: 15.93 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.72it/s, est. speed input: 8175.85 toks/s, output: 15.97 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 16.66it/s, est. speed input: 8188.10 toks/s, output: 15.99 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 16.61it/s, est. speed input: 8198.98 toks/s, output: 16.01 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:03<00:04, 16.55it/s, est. speed input: 8207.17 toks/s, output: 16.03 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 16.55it/s, est. speed input: 8217.33 toks/s, output: 16.05 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 16.60it/s, est. speed input: 8229.92 toks/s, output: 16.07 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.67it/s, est. speed input: 8243.14 toks/s, output: 16.10 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.71it/s, est. speed input: 8255.17 toks/s, output: 16.12 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.73it/s, est. speed input: 8266.31 toks/s, output: 16.15 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:04, 16.75it/s, est. speed input: 8276.72 toks/s, output: 16.17 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 16.74it/s, est. speed input: 8285.29 toks/s, output: 16.18 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:04<00:03, 16.73it/s, est. speed input: 8293.49 toks/s, output: 16.20 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 16.65it/s, est. speed input: 8297.41 toks/s, output: 16.21 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.63it/s, est. speed input: 8302.97 toks/s, output: 16.22 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.60it/s, est. speed input: 8307.41 toks/s, output: 16.23 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.57it/s, est. speed input: 8311.00 toks/s, output: 16.23 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.61it/s, est. speed input: 8317.34 toks/s, output: 16.24 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.66it/s, est. speed input: 8324.07 toks/s, output: 16.26 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 16.59it/s, est. speed input: 8326.57 toks/s, output: 16.26 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 16.60it/s, est. speed input: 8331.10 toks/s, output: 16.27 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:05<00:02, 16.56it/s, est. speed input: 8333.24 toks/s, output: 16.28 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 16.60it/s, est. speed input: 8338.26 toks/s, output: 16.29 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.68it/s, est. speed input: 8344.93 toks/s, output: 16.30 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.74it/s, est. speed input: 8351.45 toks/s, output: 16.31 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.77it/s, est. speed input: 8357.34 toks/s, output: 16.32 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.80it/s, est. speed input: 8363.12 toks/s, output: 16.33 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 16.83it/s, est. speed input: 8368.98 toks/s, output: 16.35 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 16.85it/s, est. speed input: 8374.57 toks/s, output: 16.36 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:06<00:01, 16.82it/s, est. speed input: 8378.66 toks/s, output: 16.36 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 16.81it/s, est. speed input: 8382.68 toks/s, output: 16.37 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 16.82it/s, est. speed input: 8387.45 toks/s, output: 16.38 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.85it/s, est. speed input: 8392.32 toks/s, output: 16.39 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.87it/s, est. speed input: 8397.38 toks/s, output: 16.40 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.86it/s, est. speed input: 8401.34 toks/s, output: 16.41 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.88it/s, est. speed input: 8405.90 toks/s, output: 16.42 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 16.77it/s, est. speed input: 8406.94 toks/s, output: 16.42 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:07<00:00, 16.67it/s, est. speed input: 8406.97 toks/s, output: 16.42 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 16.59it/s, est. speed input: 8407.04 toks/s, output: 16.42 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 16.56it/s, est. speed input: 8407.47 toks/s, output: 16.42 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 16.63it/s, est. speed input: 8410.52 toks/s, output: 16.43 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.71it/s, est. speed input: 8414.39 toks/s, output: 16.43 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.61it/s, est. speed input: 8414.04 toks/s, output: 16.43 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.69it/s, est. speed input: 8417.58 toks/s, output: 16.44 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.69it/s, est. speed input: 8419.34 toks/s, output: 16.44 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.44it/s, est. speed input: 8419.34 toks/s, output: 16.44 toks/s]
[rank0]:[W128 12:19:57.629382068 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 56.6s

测试结果:
  Requests/s:   16.04
  Tokens/s:     8227.81
  Total Reqs:   128
  Elapsed:      7.98s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8211.77

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:20:09 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:20:10 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=49397) WARNING 01-28 12:20:17 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=49397) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=49397) WARNING 01-28 12:20:26 [backends.py:609] Failed to read file <frozen os>
Throughput: 16.39 requests/s, 16796.54 total tokens/s, 16.39 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 12:20:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:20:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:20:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:20:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:20:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:20:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:20:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:20:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:20:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:20:16] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:20:16] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:20:16] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:20:16] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:16] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:16] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:16] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:16] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:20:16] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:20:16] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:20:16] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:20:16] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:20:16] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:20:16] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:17] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:17] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:17] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:17] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:17] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:17] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=49397) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=49397) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=49397) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=49397) 
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=49397) [2026-01-28 12:20:18] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=49397) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  7.85it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.08it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  8.04it/s]
(EngineCore_DP0 pid=49397) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.44it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  7.43it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  27%|██▋       | 35/128 [00:00<00:00, 347.79it/s]
Adding requests:  55%|█████▌    | 71/128 [00:00<00:00, 351.89it/s]
Adding requests:  84%|████████▎ | 107/128 [00:00<00:00, 342.42it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 346.34it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:03, 36.18it/s, est. speed input: 37055.67 toks/s, output: 36.18 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:05, 22.37it/s, est. speed input: 24462.29 toks/s, output: 23.89 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:05, 20.06it/s, est. speed input: 22209.81 toks/s, output: 21.69 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:05, 18.99it/s, est. speed input: 21110.79 toks/s, output: 20.62 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:06, 18.48it/s, est. speed input: 20608.43 toks/s, output: 20.12 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:00<00:06, 18.09it/s, est. speed input: 20229.14 toks/s, output: 19.75 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 17.82it/s, est. speed input: 19938.23 toks/s, output: 19.47 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:05, 17.61it/s, est. speed input: 19699.01 toks/s, output: 19.24 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:05, 17.42it/s, est. speed input: 19489.01 toks/s, output: 19.03 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:05, 17.29it/s, est. speed input: 19317.78 toks/s, output: 18.86 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 17.14it/s, est. speed input: 19153.05 toks/s, output: 18.70 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 17.08it/s, est. speed input: 19026.20 toks/s, output: 18.58 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 17.09it/s, est. speed input: 18926.57 toks/s, output: 18.48 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:01<00:05, 17.02it/s, est. speed input: 18824.34 toks/s, output: 18.38 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.98it/s, est. speed input: 18733.86 toks/s, output: 18.29 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 17.03it/s, est. speed input: 18668.90 toks/s, output: 18.23 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 17.06it/s, est. speed input: 18611.59 toks/s, output: 18.18 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:04, 17.03it/s, est. speed input: 18550.14 toks/s, output: 18.12 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 17.02it/s, est. speed input: 18495.84 toks/s, output: 18.06 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 17.00it/s, est. speed input: 18445.07 toks/s, output: 18.01 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 17.00it/s, est. speed input: 18399.88 toks/s, output: 17.97 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:02<00:04, 16.94it/s, est. speed input: 18349.64 toks/s, output: 17.92 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:02<00:04, 16.93it/s, est. speed input: 18308.30 toks/s, output: 17.88 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.94it/s, est. speed input: 18272.57 toks/s, output: 17.84 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.94it/s, est. speed input: 18238.15 toks/s, output: 17.81 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.96it/s, est. speed input: 18209.38 toks/s, output: 17.78 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 16.96it/s, est. speed input: 18180.84 toks/s, output: 17.75 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 16.84it/s, est. speed input: 18139.59 toks/s, output: 17.71 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 16.81it/s, est. speed input: 18106.93 toks/s, output: 17.68 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 16.81it/s, est. speed input: 18078.81 toks/s, output: 17.65 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:03<00:03, 16.84it/s, est. speed input: 18055.43 toks/s, output: 17.63 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.79it/s, est. speed input: 18026.60 toks/s, output: 17.60 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.86it/s, est. speed input: 18009.46 toks/s, output: 17.59 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.88it/s, est. speed input: 17991.21 toks/s, output: 17.57 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.72it/s, est. speed input: 17956.74 toks/s, output: 17.54 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 16.67it/s, est. speed input: 17929.33 toks/s, output: 17.51 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 16.64it/s, est. speed input: 17904.56 toks/s, output: 17.48 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 16.55it/s, est. speed input: 17874.81 toks/s, output: 17.46 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:04<00:02, 16.62it/s, est. speed input: 17857.70 toks/s, output: 17.44 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:04<00:02, 16.57it/s, est. speed input: 17833.17 toks/s, output: 17.42 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.56it/s, est. speed input: 17812.21 toks/s, output: 17.39 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.59it/s, est. speed input: 17795.18 toks/s, output: 17.38 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.63it/s, est. speed input: 17780.10 toks/s, output: 17.36 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 16.59it/s, est. speed input: 17760.68 toks/s, output: 17.34 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 16.53it/s, est. speed input: 17739.38 toks/s, output: 17.32 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 16.45it/s, est. speed input: 17716.18 toks/s, output: 17.30 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:05<00:01, 16.52it/s, est. speed input: 17702.88 toks/s, output: 17.29 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:05<00:01, 16.50it/s, est. speed input: 17685.76 toks/s, output: 17.27 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.61it/s, est. speed input: 17677.76 toks/s, output: 17.26 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.76it/s, est. speed input: 17674.99 toks/s, output: 17.26 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.83it/s, est. speed input: 17669.63 toks/s, output: 17.26 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.91it/s, est. speed input: 17667.10 toks/s, output: 17.25 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 16.97it/s, est. speed input: 17664.42 toks/s, output: 17.25 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 16.99it/s, est. speed input: 17660.45 toks/s, output: 17.25 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:06<00:00, 16.99it/s, est. speed input: 17656.01 toks/s, output: 17.24 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:06<00:00, 17.05it/s, est. speed input: 17655.00 toks/s, output: 17.24 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 17.03it/s, est. speed input: 17650.64 toks/s, output: 17.24 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.89it/s, est. speed input: 17639.16 toks/s, output: 17.23 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.86it/s, est. speed input: 17631.75 toks/s, output: 17.22 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.79it/s, est. speed input: 17621.71 toks/s, output: 17.21 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.79it/s, est. speed input: 17617.15 toks/s, output: 17.20 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 17.20it/s, est. speed input: 17617.15 toks/s, output: 17.20 toks/s]
[rank0]:[W128 12:20:53.173345890 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 56.0s

测试结果:
  Requests/s:   16.39
  Tokens/s:     16796.54
  Total Reqs:   128
  Elapsed:      7.81s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16780.15

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:21:03 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:21:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=50008) WARNING 01-28 12:21:11 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=50008) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=50008) WARNING 01-28 12:21:24 [backends.py:609] Failed to read file <frozen os>
Throughput: 31.95 requests/s, 32745.15 total tokens/s, 31.95 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 12:21:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:21:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:21:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:21:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:21:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:21:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:21:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:21:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:21:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:21:10] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:21:10] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:21:10] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:21:10] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:10] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:10] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:10] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:10] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:21:10] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:21:10] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:21:10] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:21:10] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:21:10] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:21:10] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:11] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:11] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:11] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:11] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:11] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:11] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=50008) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=50008) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.46s/it]
(EngineCore_DP0 pid=50008) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.46s/it]
(EngineCore_DP0 pid=50008) 
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=50008) [2026-01-28 12:21:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=50008) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:00<00:00,  7.83it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:00<00:00,  8.40it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.76it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:00<00:00,  7.86it/s]
(EngineCore_DP0 pid=50008) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  7.16it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  8.11it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:00<00:00,  7.95it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  13%|█▎        | 34/256 [00:00<00:00, 333.82it/s]
Adding requests:  28%|██▊       | 71/256 [00:00<00:00, 351.46it/s]
Adding requests:  42%|████▏     | 107/256 [00:00<00:00, 351.11it/s]
Adding requests:  56%|█████▌    | 143/256 [00:00<00:00, 349.70it/s]
Adding requests:  70%|██████▉   | 178/256 [00:00<00:00, 341.03it/s]
Adding requests:  83%|████████▎ | 213/256 [00:00<00:00, 340.97it/s]
Adding requests:  98%|█████████▊| 252/256 [00:00<00:00, 355.00it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 349.50it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   8%|▊         | 20/256 [00:00<00:01, 157.70it/s, est. speed input: 161510.78 toks/s, output: 157.71 toks/s]
Processed prompts:  14%|█▍        | 36/256 [00:00<00:04, 52.36it/s, est. speed input: 60336.02 toks/s, output: 58.92 toks/s]   
Processed prompts:  18%|█▊        | 45/256 [00:00<00:04, 46.92it/s, est. speed input: 54252.17 toks/s, output: 52.98 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:05, 40.75it/s, est. speed input: 48900.06 toks/s, output: 47.75 toks/s]
Processed prompts:  22%|██▏       | 57/256 [00:01<00:04, 40.99it/s, est. speed input: 48317.55 toks/s, output: 47.18 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 36.99it/s, est. speed input: 45721.38 toks/s, output: 44.65 toks/s]
Processed prompts:  26%|██▌       | 67/256 [00:01<00:04, 38.09it/s, est. speed input: 45503.95 toks/s, output: 44.44 toks/s]
Processed prompts:  28%|██▊       | 72/256 [00:01<00:05, 34.89it/s, est. speed input: 43737.88 toks/s, output: 42.71 toks/s]
Processed prompts:  30%|██▉       | 76/256 [00:01<00:05, 34.66it/s, est. speed input: 43148.37 toks/s, output: 42.14 toks/s]
Processed prompts:  31%|███▏      | 80/256 [00:01<00:05, 34.46it/s, est. speed input: 42626.93 toks/s, output: 41.63 toks/s]
Processed prompts:  33%|███▎      | 84/256 [00:02<00:05, 34.34it/s, est. speed input: 42176.07 toks/s, output: 41.19 toks/s]
Processed prompts:  34%|███▍      | 88/256 [00:02<00:04, 34.13it/s, est. speed input: 41746.07 toks/s, output: 40.77 toks/s]
Processed prompts:  36%|███▌      | 92/256 [00:02<00:04, 33.98it/s, est. speed input: 41361.47 toks/s, output: 40.39 toks/s]
Processed prompts:  38%|███▊      | 96/256 [00:02<00:04, 33.92it/s, est. speed input: 41026.46 toks/s, output: 40.06 toks/s]
Processed prompts:  39%|███▉      | 100/256 [00:02<00:04, 33.87it/s, est. speed input: 40722.54 toks/s, output: 39.77 toks/s]
Processed prompts:  41%|████      | 104/256 [00:02<00:04, 33.82it/s, est. speed input: 40442.67 toks/s, output: 39.49 toks/s]
Processed prompts:  42%|████▏     | 108/256 [00:02<00:04, 33.83it/s, est. speed input: 40194.58 toks/s, output: 39.25 toks/s]
Processed prompts:  44%|████▍     | 112/256 [00:02<00:04, 33.81it/s, est. speed input: 39961.88 toks/s, output: 39.02 toks/s]
Processed prompts:  45%|████▌     | 116/256 [00:02<00:04, 33.66it/s, est. speed input: 39727.10 toks/s, output: 38.80 toks/s]
Processed prompts:  47%|████▋     | 120/256 [00:03<00:04, 33.39it/s, est. speed input: 39484.47 toks/s, output: 38.56 toks/s]
Processed prompts:  48%|████▊     | 124/256 [00:03<00:03, 33.03it/s, est. speed input: 39235.30 toks/s, output: 38.32 toks/s]
Processed prompts:  50%|█████     | 128/256 [00:03<00:03, 32.53it/s, est. speed input: 38968.59 toks/s, output: 38.05 toks/s]
Processed prompts:  52%|█████▏    | 132/256 [00:03<00:03, 32.49it/s, est. speed input: 38762.98 toks/s, output: 37.85 toks/s]
Processed prompts:  53%|█████▎    | 136/256 [00:03<00:03, 32.59it/s, est. speed input: 38589.41 toks/s, output: 37.68 toks/s]
Processed prompts:  55%|█████▍    | 140/256 [00:03<00:03, 32.53it/s, est. speed input: 38410.16 toks/s, output: 37.51 toks/s]
Processed prompts:  56%|█████▋    | 144/256 [00:03<00:03, 32.45it/s, est. speed input: 38236.96 toks/s, output: 37.34 toks/s]
Processed prompts:  58%|█████▊    | 148/256 [00:03<00:03, 32.56it/s, est. speed input: 38095.89 toks/s, output: 37.20 toks/s]
Processed prompts:  59%|█████▉    | 152/256 [00:04<00:03, 32.66it/s, est. speed input: 37964.95 toks/s, output: 37.07 toks/s]
Processed prompts:  61%|██████    | 156/256 [00:04<00:03, 32.69it/s, est. speed input: 37837.01 toks/s, output: 36.95 toks/s]
Processed prompts:  62%|██████▎   | 160/256 [00:04<00:02, 32.76it/s, est. speed input: 37721.44 toks/s, output: 36.84 toks/s]
Processed prompts:  64%|██████▍   | 164/256 [00:04<00:02, 32.77it/s, est. speed input: 37609.00 toks/s, output: 36.73 toks/s]
Processed prompts:  66%|██████▌   | 168/256 [00:04<00:02, 32.80it/s, est. speed input: 37503.94 toks/s, output: 36.62 toks/s]
Processed prompts:  67%|██████▋   | 172/256 [00:04<00:02, 32.91it/s, est. speed input: 37412.78 toks/s, output: 36.54 toks/s]
Processed prompts:  69%|██████▉   | 176/256 [00:04<00:02, 32.87it/s, est. speed input: 37316.08 toks/s, output: 36.44 toks/s]
Processed prompts:  70%|███████   | 180/256 [00:04<00:02, 32.96it/s, est. speed input: 37234.11 toks/s, output: 36.36 toks/s]
Processed prompts:  72%|███████▏  | 184/256 [00:05<00:02, 32.80it/s, est. speed input: 37136.34 toks/s, output: 36.27 toks/s]
Processed prompts:  73%|███████▎  | 188/256 [00:05<00:02, 32.78it/s, est. speed input: 37050.89 toks/s, output: 36.18 toks/s]
Processed prompts:  75%|███████▌  | 192/256 [00:05<00:01, 32.81it/s, est. speed input: 36973.67 toks/s, output: 36.11 toks/s]
Processed prompts:  77%|███████▋  | 196/256 [00:05<00:01, 32.63it/s, est. speed input: 36883.09 toks/s, output: 36.02 toks/s]
Processed prompts:  78%|███████▊  | 200/256 [00:05<00:01, 32.58it/s, est. speed input: 36802.62 toks/s, output: 35.94 toks/s]
Processed prompts:  80%|███████▉  | 204/256 [00:05<00:01, 32.61it/s, est. speed input: 36731.15 toks/s, output: 35.87 toks/s]
Processed prompts:  81%|████████▏ | 208/256 [00:05<00:01, 32.55it/s, est. speed input: 36655.04 toks/s, output: 35.80 toks/s]
Processed prompts:  83%|████████▎ | 212/256 [00:05<00:01, 32.57it/s, est. speed input: 36588.18 toks/s, output: 35.73 toks/s]
Processed prompts:  84%|████████▍ | 216/256 [00:06<00:01, 32.58it/s, est. speed input: 36522.91 toks/s, output: 35.67 toks/s]
Processed prompts:  86%|████████▌ | 220/256 [00:06<00:01, 32.58it/s, est. speed input: 36460.39 toks/s, output: 35.61 toks/s]
Processed prompts:  88%|████████▊ | 224/256 [00:06<00:00, 32.81it/s, est. speed input: 36416.65 toks/s, output: 35.56 toks/s]
Processed prompts:  89%|████████▉ | 228/256 [00:06<00:00, 32.71it/s, est. speed input: 36355.68 toks/s, output: 35.50 toks/s]
Processed prompts:  91%|█████████ | 232/256 [00:08<00:05,  4.66it/s, est. speed input: 26408.11 toks/s, output: 25.79 toks/s]
Processed prompts:  92%|█████████▏| 236/256 [00:09<00:03,  6.28it/s, est. speed input: 26502.16 toks/s, output: 25.88 toks/s]
Processed prompts:  94%|█████████▍| 240/256 [00:09<00:01,  8.29it/s, est. speed input: 26595.00 toks/s, output: 25.97 toks/s]
Processed prompts:  95%|█████████▌| 244/256 [00:09<00:01, 10.68it/s, est. speed input: 26687.30 toks/s, output: 26.06 toks/s]
Processed prompts:  97%|█████████▋| 248/256 [00:09<00:00, 13.39it/s, est. speed input: 26774.86 toks/s, output: 26.15 toks/s]
Processed prompts:  98%|█████████▊| 252/256 [00:09<00:00, 16.23it/s, est. speed input: 26854.83 toks/s, output: 26.23 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 19.13it/s, est. speed input: 26939.02 toks/s, output: 26.31 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 19.13it/s, est. speed input: 26939.02 toks/s, output: 26.31 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 26.31it/s, est. speed input: 26939.02 toks/s, output: 26.31 toks/s]
[rank0]:[W128 12:21:51.444071275 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 57.6s

测试结果:
  Requests/s:   31.95
  Tokens/s:     32745.15
  Total Reqs:   256
  Elapsed:      8.01s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     32713.20

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:22:02 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:22:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=50659) WARNING 01-28 12:22:10 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=50659) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=50659) WARNING 01-28 12:22:20 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.00 requests/s, 52274.16 total tokens/s, 51.00 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 12:22:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:22:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:22:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:22:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:22:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:22:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:22:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:22:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:22:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:22:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:22:09] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:22:09] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:22:09] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:09] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:09] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:09] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:09] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:22:09] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:22:09] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:22:09] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:22:09] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:22:09] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:22:09] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:10] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:10] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:10] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:10] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:10] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:10] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=50659) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=50659) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=50659) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=50659) 
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=50659) [2026-01-28 12:22:11] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=50659) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:00<00:00,  7.92it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:00<00:00,  8.46it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:00<00:00,  8.71it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.03it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:00<00:00,  8.18it/s]
(EngineCore_DP0 pid=50659) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  7.37it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  8.26it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.81it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  8.54it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 34/512 [00:00<00:01, 339.11it/s]
Adding requests:  14%|█▍        | 71/512 [00:00<00:01, 355.75it/s]
Adding requests:  21%|██▏       | 110/512 [00:00<00:01, 368.70it/s]
Adding requests:  29%|██▊       | 147/512 [00:00<00:00, 366.67it/s]
Adding requests:  36%|███▌      | 185/512 [00:00<00:00, 368.07it/s]
Adding requests:  44%|████▍     | 224/512 [00:00<00:00, 373.84it/s]
Adding requests:  51%|█████▏    | 263/512 [00:00<00:00, 378.00it/s]
Adding requests:  59%|█████▉    | 301/512 [00:00<00:00, 374.66it/s]
Adding requests:  66%|██████▋   | 340/512 [00:00<00:00, 377.72it/s]
Adding requests:  74%|███████▍  | 379/512 [00:01<00:00, 381.03it/s]
Adding requests:  82%|████████▏ | 418/512 [00:01<00:00, 382.83it/s]
Adding requests:  89%|████████▉ | 457/512 [00:01<00:00, 380.45it/s]
Adding requests:  97%|█████████▋| 496/512 [00:01<00:00, 380.24it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 375.11it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 62/512 [00:00<00:00, 506.38it/s, est. speed input: 518611.80 toks/s, output: 506.40 toks/s]
Processed prompts:  22%|██▏       | 113/512 [00:01<00:04, 94.81it/s, est. speed input: 112077.05 toks/s, output: 109.45 toks/s]
Processed prompts:  27%|██▋       | 138/512 [00:01<00:05, 74.22it/s, est. speed input: 90432.81 toks/s, output: 88.31 toks/s]  
Processed prompts:  30%|███       | 154/512 [00:01<00:05, 68.57it/s, est. speed input: 84476.71 toks/s, output: 82.50 toks/s]
Processed prompts:  32%|███▏      | 166/512 [00:02<00:05, 65.10it/s, est. speed input: 81161.10 toks/s, output: 79.26 toks/s]
Processed prompts:  34%|███▍      | 176/512 [00:02<00:05, 65.23it/s, est. speed input: 80229.70 toks/s, output: 78.35 toks/s]
Processed prompts:  36%|███▌      | 185/512 [00:02<00:05, 64.07it/s, est. speed input: 79000.94 toks/s, output: 77.15 toks/s]
Processed prompts:  38%|███▊      | 193/512 [00:02<00:05, 61.46it/s, est. speed input: 77473.53 toks/s, output: 75.66 toks/s]
Processed prompts:  39%|███▉      | 200/512 [00:02<00:05, 57.70it/s, est. speed input: 75744.78 toks/s, output: 73.97 toks/s]
Processed prompts:  40%|████      | 207/512 [00:02<00:05, 54.67it/s, est. speed input: 74203.67 toks/s, output: 72.46 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:03<00:05, 52.27it/s, est. speed input: 72810.81 toks/s, output: 71.10 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:03<00:05, 52.25it/s, est. speed input: 71872.93 toks/s, output: 70.19 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:03<00:05, 52.23it/s, est. speed input: 71020.86 toks/s, output: 69.36 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:03<00:05, 52.22it/s, est. speed input: 70244.48 toks/s, output: 68.60 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:03<00:05, 52.22it/s, est. speed input: 69535.76 toks/s, output: 67.91 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:03<00:04, 52.24it/s, est. speed input: 68887.70 toks/s, output: 67.27 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:03<00:04, 52.28it/s, est. speed input: 68294.28 toks/s, output: 66.69 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:04<00:04, 52.27it/s, est. speed input: 67739.22 toks/s, output: 66.15 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:04<00:04, 52.27it/s, est. speed input: 67225.92 toks/s, output: 65.65 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:04<00:04, 52.17it/s, est. speed input: 66732.15 toks/s, output: 65.17 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:04<00:04, 52.11it/s, est. speed input: 66274.84 toks/s, output: 64.72 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:04<00:04, 52.16it/s, est. speed input: 65859.02 toks/s, output: 64.32 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:04<00:03, 52.17it/s, est. speed input: 65466.60 toks/s, output: 63.93 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:05<00:03, 52.12it/s, est. speed input: 65091.59 toks/s, output: 63.57 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:05<00:03, 52.11it/s, est. speed input: 64741.16 toks/s, output: 63.22 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:05<00:03, 52.14it/s, est. speed input: 64416.24 toks/s, output: 62.91 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:05<00:03, 52.15it/s, est. speed input: 64106.83 toks/s, output: 62.60 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:05<00:03, 52.18it/s, est. speed input: 63817.78 toks/s, output: 62.32 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:05<00:02, 52.19it/s, est. speed input: 63543.43 toks/s, output: 62.05 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:05<00:02, 52.21it/s, est. speed input: 63283.65 toks/s, output: 61.80 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:06<00:02, 52.19it/s, est. speed input: 63033.75 toks/s, output: 61.56 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:06<00:02, 52.19it/s, est. speed input: 62797.80 toks/s, output: 61.33 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:06<00:02, 52.16it/s, est. speed input: 62570.71 toks/s, output: 61.10 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:06<00:02, 52.07it/s, est. speed input: 62347.62 toks/s, output: 60.89 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:06<00:02, 52.11it/s, est. speed input: 62143.85 toks/s, output: 60.69 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:06<00:01, 52.14it/s, est. speed input: 61948.92 toks/s, output: 60.50 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:06<00:01, 52.12it/s, est. speed input: 61759.95 toks/s, output: 60.31 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:07<00:01, 52.03it/s, est. speed input: 61571.83 toks/s, output: 60.13 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:07<00:01, 51.91it/s, est. speed input: 61387.52 toks/s, output: 59.95 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:07<00:01, 51.96it/s, est. speed input: 61221.91 toks/s, output: 59.79 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:07<00:01, 51.97it/s, est. speed input: 61060.02 toks/s, output: 59.63 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:07<00:00, 52.03it/s, est. speed input: 60909.32 toks/s, output: 59.48 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:07<00:00, 52.09it/s, est. speed input: 60765.65 toks/s, output: 59.34 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:08<00:00, 52.08it/s, est. speed input: 60623.51 toks/s, output: 59.20 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:08<00:00, 52.11it/s, est. speed input: 60490.06 toks/s, output: 59.07 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:08<00:00, 52.13it/s, est. speed input: 60360.70 toks/s, output: 58.95 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:08<00:00, 52.13it/s, est. speed input: 60234.93 toks/s, output: 58.82 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:08<00:00, 53.69it/s, est. speed input: 60217.24 toks/s, output: 58.81 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 53.69it/s, est. speed input: 60452.06 toks/s, output: 59.04 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 59.03it/s, est. speed input: 60452.06 toks/s, output: 59.04 toks/s]
[rank0]:[W128 12:22:49.208734631 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 58.3s

测试结果:
  Requests/s:   51.00
  Tokens/s:     52274.16
  Total Reqs:   512
  Elapsed:      10.04s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     52223.16

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:23:06 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:23:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=51275) WARNING 01-28 12:23:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=51275) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=51275) WARNING 01-28 12:23:23 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.52 requests/s, 52807.92 total tokens/s, 51.52 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 12:23:06] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:23:06] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:23:06] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:23:06] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:06] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:06] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:06] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:06] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:06] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:23:06] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:23:06] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:23:06] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:23:06] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:23:06] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:23:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:23:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:23:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:23:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:23:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:23:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:23:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:23:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:23:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:23:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:14] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:14] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:14] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:14] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:14] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:14] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=51275) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=51275) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=51275) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=51275) 
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=51275) [2026-01-28 12:23:15] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=51275) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:00<00:00,  4.01it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:00<00:00,  5.74it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:00<00:00,  6.83it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:00<00:00,  7.52it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  7.37it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:00<00:00,  6.78it/s]
(EngineCore_DP0 pid=51275) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:00,  7.32it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  8.25it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:00<00:00,  8.55it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.81it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:00<00:00,  8.56it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 35/1024 [00:00<00:02, 349.42it/s]
Adding requests:   7%|▋         | 73/1024 [00:00<00:02, 365.60it/s]
Adding requests:  11%|█         | 112/1024 [00:00<00:02, 375.41it/s]
Adding requests:  15%|█▍        | 150/1024 [00:00<00:02, 376.15it/s]
Adding requests:  18%|█▊        | 188/1024 [00:00<00:02, 374.09it/s]
Adding requests:  22%|██▏       | 227/1024 [00:00<00:02, 379.24it/s]
Adding requests:  26%|██▌       | 266/1024 [00:00<00:01, 382.02it/s]
Adding requests:  30%|██▉       | 305/1024 [00:00<00:01, 375.08it/s]
Adding requests:  33%|███▎      | 343/1024 [00:00<00:01, 372.41it/s]
Adding requests:  37%|███▋      | 383/1024 [00:01<00:01, 376.92it/s]
Adding requests:  41%|████▏     | 423/1024 [00:01<00:01, 381.69it/s]
Adding requests:  45%|████▌     | 463/1024 [00:01<00:01, 385.23it/s]
Adding requests:  49%|████▉     | 503/1024 [00:01<00:01, 388.91it/s]
Adding requests:  53%|█████▎    | 542/1024 [00:01<00:01, 384.08it/s]
Adding requests:  57%|█████▋    | 584/1024 [00:01<00:01, 392.80it/s]
Adding requests:  61%|██████    | 624/1024 [00:01<00:01, 389.33it/s]
Adding requests:  65%|██████▍   | 665/1024 [00:01<00:00, 394.49it/s]
Adding requests:  69%|██████▉   | 708/1024 [00:01<00:00, 403.73it/s]
Adding requests:  73%|███████▎  | 749/1024 [00:01<00:00, 401.87it/s]
Adding requests:  77%|███████▋  | 790/1024 [00:02<00:00, 402.47it/s]
Adding requests:  81%|████████  | 831/1024 [00:02<00:00, 397.47it/s]
Adding requests:  85%|████████▌ | 873/1024 [00:02<00:00, 402.02it/s]
Adding requests:  89%|████████▉ | 915/1024 [00:02<00:00, 406.11it/s]
Adding requests:  93%|█████████▎| 956/1024 [00:02<00:00, 404.28it/s]
Adding requests:  97%|█████████▋| 997/1024 [00:02<00:00, 404.60it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 390.78it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:00<00:00, 1189.54it/s, est. speed input: 1218424.77 toks/s, output: 1189.64 toks/s]
Processed prompts:  24%|██▎       | 241/1024 [00:02<00:08, 93.10it/s, est. speed input: 110849.45 toks/s, output: 108.25 toks/s]    
Processed prompts:  29%|██▊       | 294/1024 [00:03<00:09, 75.36it/s, est. speed input: 91472.13 toks/s, output: 89.33 toks/s]  
Processed prompts:  32%|███▏      | 325/1024 [00:03<00:10, 69.27it/s, est. speed input: 85352.79 toks/s, output: 83.35 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:04<00:10, 64.34it/s, est. speed input: 81345.91 toks/s, output: 79.44 toks/s]
Processed prompts:  35%|███▌      | 361/1024 [00:04<00:09, 67.47it/s, est. speed input: 82004.76 toks/s, output: 80.08 toks/s]
Processed prompts:  37%|███▋      | 375/1024 [00:04<00:10, 63.04it/s, est. speed input: 79806.10 toks/s, output: 77.94 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:05<00:11, 56.89it/s, est. speed input: 77260.96 toks/s, output: 75.45 toks/s]
Processed prompts:  39%|███▊      | 395/1024 [00:05<00:10, 57.20it/s, est. speed input: 76775.77 toks/s, output: 74.98 toks/s]
Processed prompts:  39%|███▉      | 403/1024 [00:05<00:11, 56.41it/s, est. speed input: 76128.40 toks/s, output: 74.34 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:05<00:11, 54.41it/s, est. speed input: 75336.28 toks/s, output: 73.57 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:11, 54.04it/s, est. speed input: 74769.39 toks/s, output: 73.02 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:11, 53.70it/s, est. speed input: 74228.90 toks/s, output: 72.49 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:06<00:11, 53.44it/s, est. speed input: 73716.99 toks/s, output: 71.99 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:06<00:10, 53.23it/s, est. speed input: 73230.01 toks/s, output: 71.51 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:06<00:10, 53.05it/s, est. speed input: 72764.46 toks/s, output: 71.06 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:06<00:10, 52.91it/s, est. speed input: 72319.87 toks/s, output: 70.62 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:06<00:10, 52.76it/s, est. speed input: 71890.06 toks/s, output: 70.20 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:10, 52.67it/s, est. speed input: 71481.14 toks/s, output: 69.81 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:10, 52.61it/s, est. speed input: 71091.63 toks/s, output: 69.43 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:07<00:10, 52.58it/s, est. speed input: 70719.60 toks/s, output: 69.06 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:07<00:10, 52.55it/s, est. speed input: 70362.58 toks/s, output: 68.71 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:07<00:09, 52.50it/s, est. speed input: 70017.14 toks/s, output: 68.38 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:07<00:09, 52.48it/s, est. speed input: 69687.69 toks/s, output: 68.05 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:07<00:09, 52.46it/s, est. speed input: 69370.57 toks/s, output: 67.74 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:09, 52.46it/s, est. speed input: 69066.67 toks/s, output: 67.45 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:08<00:09, 52.46it/s, est. speed input: 68774.11 toks/s, output: 67.16 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:08<00:09, 52.43it/s, est. speed input: 68490.23 toks/s, output: 66.88 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:08<00:08, 52.42it/s, est. speed input: 68218.27 toks/s, output: 66.62 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:08<00:08, 52.43it/s, est. speed input: 67957.27 toks/s, output: 66.36 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:08<00:08, 52.39it/s, est. speed input: 67701.33 toks/s, output: 66.11 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:08<00:08, 52.40it/s, est. speed input: 67457.70 toks/s, output: 65.88 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:08, 52.43it/s, est. speed input: 67224.05 toks/s, output: 65.65 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:09<00:08, 52.45it/s, est. speed input: 66997.63 toks/s, output: 65.43 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:09<00:08, 52.45it/s, est. speed input: 66778.26 toks/s, output: 65.21 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:09<00:07, 52.41it/s, est. speed input: 66562.71 toks/s, output: 65.00 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:09<00:07, 52.38it/s, est. speed input: 66354.23 toks/s, output: 64.80 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:09<00:07, 52.42it/s, est. speed input: 66156.72 toks/s, output: 64.61 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:09<00:07, 52.43it/s, est. speed input: 65963.54 toks/s, output: 64.42 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:07, 52.44it/s, est. speed input: 65776.89 toks/s, output: 64.24 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:10<00:07, 52.48it/s, est. speed input: 65597.53 toks/s, output: 64.06 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:10<00:06, 52.49it/s, est. speed input: 65422.52 toks/s, output: 63.89 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:10<00:06, 52.49it/s, est. speed input: 65252.74 toks/s, output: 63.72 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:10<00:06, 52.47it/s, est. speed input: 65086.23 toks/s, output: 63.56 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:10<00:06, 52.44it/s, est. speed input: 64923.41 toks/s, output: 63.40 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:10<00:06, 52.40it/s, est. speed input: 64764.08 toks/s, output: 63.25 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:11<00:06, 52.41it/s, est. speed input: 64611.17 toks/s, output: 63.10 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:11<00:06, 52.41it/s, est. speed input: 64462.44 toks/s, output: 62.95 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:11<00:05, 52.39it/s, est. speed input: 64316.36 toks/s, output: 62.81 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:11<00:05, 52.38it/s, est. speed input: 64174.22 toks/s, output: 62.67 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:11<00:05, 52.38it/s, est. speed input: 64036.67 toks/s, output: 62.54 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:11<00:05, 52.39it/s, est. speed input: 63902.83 toks/s, output: 62.41 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:11<00:05, 52.38it/s, est. speed input: 63771.59 toks/s, output: 62.28 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:12<00:05, 52.39it/s, est. speed input: 63644.26 toks/s, output: 62.15 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:12<00:05, 52.35it/s, est. speed input: 63518.33 toks/s, output: 62.03 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:12<00:04, 52.36it/s, est. speed input: 63396.68 toks/s, output: 61.91 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:12<00:04, 52.35it/s, est. speed input: 63277.50 toks/s, output: 61.79 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:12<00:04, 52.34it/s, est. speed input: 63161.23 toks/s, output: 61.68 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:12<00:04, 52.38it/s, est. speed input: 63049.62 toks/s, output: 61.57 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:13<00:04, 52.38it/s, est. speed input: 62939.71 toks/s, output: 61.46 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:04, 52.39it/s, est. speed input: 62832.28 toks/s, output: 61.36 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:03, 52.36it/s, est. speed input: 62726.09 toks/s, output: 61.26 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:13<00:03, 52.35it/s, est. speed input: 62622.56 toks/s, output: 61.15 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:13<00:03, 52.04it/s, est. speed input: 62507.74 toks/s, output: 61.04 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:13<00:03, 51.64it/s, est. speed input: 62387.25 toks/s, output: 60.92 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:13<00:03, 51.37it/s, est. speed input: 62269.83 toks/s, output: 60.81 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:14<00:03, 51.19it/s, est. speed input: 62155.03 toks/s, output: 60.70 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:14<00:03, 51.04it/s, est. speed input: 62041.96 toks/s, output: 60.59 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 50.94it/s, est. speed input: 61931.71 toks/s, output: 60.48 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:14<00:02, 50.91it/s, est. speed input: 61825.48 toks/s, output: 60.38 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:14<00:02, 50.88it/s, est. speed input: 61720.85 toks/s, output: 60.27 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:14<00:02, 50.87it/s, est. speed input: 61618.89 toks/s, output: 60.17 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:15<00:02, 50.88it/s, est. speed input: 61520.04 toks/s, output: 60.08 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:15<00:02, 50.88it/s, est. speed input: 61422.96 toks/s, output: 59.98 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:15<00:02, 50.87it/s, est. speed input: 61327.28 toks/s, output: 59.89 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 50.84it/s, est. speed input: 61232.61 toks/s, output: 59.80 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 50.85it/s, est. speed input: 61141.03 toks/s, output: 59.71 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:15<00:01, 50.85it/s, est. speed input: 61051.01 toks/s, output: 59.62 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:16<00:01, 50.85it/s, est. speed input: 60963.09 toks/s, output: 59.53 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:16<00:01, 50.83it/s, est. speed input: 60875.94 toks/s, output: 59.45 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:16<00:01, 50.80it/s, est. speed input: 60789.63 toks/s, output: 59.36 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 50.77it/s, est. speed input: 60704.60 toks/s, output: 59.28 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 52.17it/s, est. speed input: 60673.63 toks/s, output: 59.25 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:16<00:00, 51.76it/s, est. speed input: 60592.64 toks/s, output: 59.17 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:16<00:00, 51.49it/s, est. speed input: 60513.95 toks/s, output: 59.10 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:17<00:00, 51.32it/s, est. speed input: 60437.02 toks/s, output: 59.02 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:17<00:00, 52.86it/s, est. speed input: 60418.93 toks/s, output: 59.00 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 52.86it/s, est. speed input: 60774.18 toks/s, output: 59.35 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 59.35it/s, est. speed input: 60774.18 toks/s, output: 59.35 toks/s]
[rank0]:[W128 12:24:03.754809807 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 74.0s

测试结果:
  Requests/s:   51.52
  Tokens/s:     52807.92
  Total Reqs:   1024
  Elapsed:      19.88s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     52756.40

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:24:26 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:24:26 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=52018) WARNING 01-28 12:24:33 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=52018) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=52018) WARNING 01-28 12:24:43 [backends.py:609] Failed to read file <frozen os>
Throughput: 50.82 requests/s, 52091.29 total tokens/s, 50.82 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 12:24:26] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:24:26] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:24:26] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:24:26] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:26] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:26] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:26] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:26] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:26] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:24:26] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:24:26] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:24:26] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:24:26] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:24:26] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:24:32] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:24:32] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:24:32] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:24:32] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:32] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:32] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:32] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:32] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:24:32] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:24:32] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:24:32] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:24:32] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:24:32] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:24:32] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:33] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:33] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:33] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:33] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:33] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:33] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=52018) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=52018) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.44it/s]
(EngineCore_DP0 pid=52018) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.44it/s]
(EngineCore_DP0 pid=52018) 
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=52018) [2026-01-28 12:24:34] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=52018) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:00,  7.58it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:00<00:00,  7.99it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:00<00:00,  8.00it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:00<00:00,  8.35it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:00<00:00,  8.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:00<00:00,  8.74it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.21it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:00<00:00,  8.27it/s]
(EngineCore_DP0 pid=52018) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:00,  7.15it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:00<00:00,  8.24it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:00<00:00,  8.72it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:00<00:00,  8.96it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  9.12it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:00<00:00,  8.80it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 37/2048 [00:00<00:05, 365.72it/s]
Adding requests:   4%|▎         | 76/2048 [00:00<00:05, 378.07it/s]
Adding requests:   6%|▌         | 115/2048 [00:00<00:05, 382.57it/s]
Adding requests:   8%|▊         | 154/2048 [00:00<00:04, 382.83it/s]
Adding requests:   9%|▉         | 193/2048 [00:00<00:04, 380.39it/s]
Adding requests:  11%|█▏        | 232/2048 [00:00<00:04, 381.80it/s]
Adding requests:  13%|█▎        | 271/2048 [00:00<00:04, 381.93it/s]
Adding requests:  15%|█▌        | 310/2048 [00:00<00:04, 380.74it/s]
Adding requests:  17%|█▋        | 349/2048 [00:00<00:04, 381.60it/s]
Adding requests:  19%|█▉        | 389/2048 [00:01<00:04, 386.03it/s]
Adding requests:  21%|██        | 429/2048 [00:01<00:04, 390.04it/s]
Adding requests:  23%|██▎       | 469/2048 [00:01<00:04, 388.04it/s]
Adding requests:  25%|██▍       | 508/2048 [00:01<00:03, 386.25it/s]
Adding requests:  27%|██▋       | 547/2048 [00:01<00:03, 380.30it/s]
Adding requests:  29%|██▊       | 586/2048 [00:01<00:03, 373.31it/s]
Adding requests:  31%|███       | 626/2048 [00:01<00:03, 378.22it/s]
Adding requests:  33%|███▎      | 666/2048 [00:01<00:03, 382.04it/s]
Adding requests:  35%|███▍      | 708/2048 [00:01<00:03, 390.90it/s]
Adding requests:  37%|███▋      | 748/2048 [00:01<00:03, 381.48it/s]
Adding requests:  39%|███▊      | 789/2048 [00:02<00:03, 387.07it/s]
Adding requests:  40%|████      | 828/2048 [00:02<00:03, 384.14it/s]
Adding requests:  42%|████▏     | 869/2048 [00:02<00:03, 389.85it/s]
Adding requests:  44%|████▍     | 911/2048 [00:02<00:02, 398.27it/s]
Adding requests:  46%|████▋     | 951/2048 [00:02<00:02, 397.16it/s]
Adding requests:  48%|████▊     | 991/2048 [00:02<00:02, 395.42it/s]
Adding requests:  50%|█████     | 1032/2048 [00:02<00:02, 397.20it/s]
Adding requests:  52%|█████▏    | 1072/2048 [00:02<00:02, 385.36it/s]
Adding requests:  54%|█████▍    | 1112/2048 [00:02<00:02, 388.91it/s]
Adding requests:  56%|█████▌    | 1151/2048 [00:02<00:02, 388.22it/s]
Adding requests:  58%|█████▊    | 1191/2048 [00:03<00:02, 389.67it/s]
Adding requests:  60%|██████    | 1230/2048 [00:03<00:02, 387.86it/s]
Adding requests:  62%|██████▏   | 1269/2048 [00:03<00:02, 382.82it/s]
Adding requests:  64%|██████▍   | 1309/2048 [00:03<00:01, 386.87it/s]
Adding requests:  66%|██████▌   | 1351/2048 [00:03<00:01, 395.15it/s]
Adding requests:  68%|██████▊   | 1393/2048 [00:03<00:01, 399.90it/s]
Adding requests:  70%|███████   | 1434/2048 [00:03<00:01, 396.25it/s]
Adding requests:  72%|███████▏  | 1475/2048 [00:03<00:01, 397.89it/s]
Adding requests:  74%|███████▍  | 1517/2048 [00:03<00:01, 403.90it/s]
Adding requests:  76%|███████▌  | 1558/2048 [00:04<00:01, 403.97it/s]
Adding requests:  78%|███████▊  | 1602/2048 [00:04<00:01, 412.71it/s]
Adding requests:  80%|████████  | 1644/2048 [00:04<00:00, 405.56it/s]
Adding requests:  82%|████████▏ | 1685/2048 [00:04<00:00, 405.43it/s]
Adding requests:  84%|████████▍ | 1727/2048 [00:04<00:00, 408.52it/s]
Adding requests:  86%|████████▋ | 1768/2048 [00:04<00:00, 406.47it/s]
Adding requests:  88%|████████▊ | 1809/2048 [00:04<00:00, 406.80it/s]
Adding requests:  90%|█████████ | 1851/2048 [00:04<00:00, 410.12it/s]
Adding requests:  92%|█████████▏| 1893/2048 [00:04<00:00, 406.17it/s]
Adding requests:  94%|█████████▍| 1934/2048 [00:04<00:00, 394.37it/s]
Adding requests:  96%|█████████▋| 1976/2048 [00:05<00:00, 399.89it/s]
Adding requests:  99%|█████████▊| 2018/2048 [00:05<00:00, 404.79it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 392.87it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 258/2048 [00:00<00:01, 1178.01it/s, est. speed input: 1206429.16 toks/s, output: 1178.06 toks/s]
Processed prompts:  18%|█▊        | 376/2048 [00:02<00:12, 129.16it/s, est. speed input: 161942.96 toks/s, output: 158.15 toks/s]   
Processed prompts:  21%|██        | 428/2048 [00:03<00:15, 102.34it/s, est. speed input: 132415.46 toks/s, output: 129.31 toks/s]
Processed prompts:  22%|██▏       | 459/2048 [00:03<00:17, 88.56it/s, est. speed input: 119368.17 toks/s, output: 116.57 toks/s] 
Processed prompts:  23%|██▎       | 480/2048 [00:04<00:18, 85.31it/s, est. speed input: 115704.28 toks/s, output: 112.99 toks/s]
Processed prompts:  24%|██▍       | 496/2048 [00:04<00:19, 79.17it/s, est. speed input: 111413.71 toks/s, output: 108.80 toks/s]
Processed prompts:  25%|██▍       | 509/2048 [00:04<00:21, 71.51it/s, est. speed input: 107053.10 toks/s, output: 104.54 toks/s]
Processed prompts:  25%|██▌       | 519/2048 [00:05<00:24, 62.54it/s, est. speed input: 102597.73 toks/s, output: 100.19 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:05<00:27, 55.89it/s, est. speed input: 98846.81 toks/s, output: 96.53 toks/s]  
Processed prompts:  27%|██▋       | 546/2048 [00:05<00:27, 54.76it/s, est. speed input: 96379.71 toks/s, output: 94.12 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:06<00:27, 53.88it/s, est. speed input: 94162.69 toks/s, output: 91.96 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:06<00:27, 53.22it/s, est. speed input: 92159.21 toks/s, output: 90.00 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:06<00:27, 52.74it/s, est. speed input: 90341.81 toks/s, output: 88.22 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:07<00:27, 52.38it/s, est. speed input: 88683.62 toks/s, output: 86.60 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:07<00:27, 52.12it/s, est. speed input: 87163.18 toks/s, output: 85.12 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:07<00:27, 51.95it/s, est. speed input: 85771.52 toks/s, output: 83.76 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:07<00:26, 51.81it/s, est. speed input: 84483.66 toks/s, output: 82.50 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:08<00:26, 51.71it/s, est. speed input: 83291.03 toks/s, output: 81.34 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:08<00:26, 51.65it/s, est. speed input: 82186.85 toks/s, output: 80.26 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:08<00:26, 51.60it/s, est. speed input: 81158.99 toks/s, output: 79.26 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:09<00:25, 51.56it/s, est. speed input: 80199.03 toks/s, output: 78.32 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:09<00:25, 51.48it/s, est. speed input: 79293.62 toks/s, output: 77.44 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:09<00:25, 50.61it/s, est. speed input: 78311.83 toks/s, output: 76.48 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:12<01:29, 14.25it/s, est. speed input: 61277.21 toks/s, output: 59.84 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:13<01:09, 18.09it/s, est. speed input: 60992.45 toks/s, output: 59.56 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:13<00:55, 22.28it/s, est. speed input: 60719.02 toks/s, output: 59.30 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:13<00:46, 26.61it/s, est. speed input: 60461.89 toks/s, output: 59.04 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:14<00:39, 30.79it/s, est. speed input: 60214.86 toks/s, output: 58.80 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:14<00:34, 34.60it/s, est. speed input: 59979.60 toks/s, output: 58.57 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:14<00:31, 37.88it/s, est. speed input: 59754.15 toks/s, output: 58.35 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:15<00:28, 40.57it/s, est. speed input: 59537.65 toks/s, output: 58.14 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:15<00:26, 42.69it/s, est. speed input: 59331.31 toks/s, output: 57.94 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:15<00:25, 44.31it/s, est. speed input: 59132.51 toks/s, output: 57.75 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:16<00:24, 45.52it/s, est. speed input: 58941.81 toks/s, output: 57.56 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:16<00:23, 46.41it/s, est. speed input: 58759.10 toks/s, output: 57.38 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:16<00:23, 47.05it/s, est. speed input: 58583.45 toks/s, output: 57.21 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:17<00:22, 48.13it/s, est. speed input: 58463.76 toks/s, output: 57.09 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:17<00:21, 48.27it/s, est. speed input: 58299.97 toks/s, output: 56.93 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:17<00:21, 48.37it/s, est. speed input: 58141.91 toks/s, output: 56.78 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:18<00:21, 48.44it/s, est. speed input: 57989.97 toks/s, output: 56.63 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:18<00:20, 48.50it/s, est. speed input: 57843.74 toks/s, output: 56.49 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:18<00:20, 48.61it/s, est. speed input: 57707.70 toks/s, output: 56.36 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:19<00:19, 49.08it/s, est. speed input: 57602.92 toks/s, output: 56.25 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:19<00:19, 49.42it/s, est. speed input: 57501.71 toks/s, output: 56.15 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:19<00:18, 49.65it/s, est. speed input: 57402.91 toks/s, output: 56.06 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:20<00:18, 49.83it/s, est. speed input: 57308.47 toks/s, output: 55.97 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:20<00:18, 50.01it/s, est. speed input: 57220.21 toks/s, output: 55.88 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:20<00:17, 50.91it/s, est. speed input: 57179.29 toks/s, output: 55.84 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:20<00:17, 50.84it/s, est. speed input: 57099.85 toks/s, output: 55.76 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:21<00:16, 50.80it/s, est. speed input: 57023.31 toks/s, output: 55.69 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:21<00:16, 50.77it/s, est. speed input: 56948.75 toks/s, output: 55.61 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:21<00:16, 50.75it/s, est. speed input: 56876.58 toks/s, output: 55.54 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:22<00:16, 50.73it/s, est. speed input: 56805.85 toks/s, output: 55.47 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:22<00:15, 50.72it/s, est. speed input: 56737.22 toks/s, output: 55.41 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:22<00:15, 50.69it/s, est. speed input: 56669.70 toks/s, output: 55.34 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:23<00:15, 50.69it/s, est. speed input: 56604.57 toks/s, output: 55.28 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:23<00:14, 50.68it/s, est. speed input: 56541.34 toks/s, output: 55.22 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:23<00:14, 50.68it/s, est. speed input: 56479.88 toks/s, output: 55.16 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:24<00:14, 50.69it/s, est. speed input: 56420.23 toks/s, output: 55.10 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:24<00:13, 50.69it/s, est. speed input: 56361.96 toks/s, output: 55.04 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:24<00:13, 50.69it/s, est. speed input: 56305.16 toks/s, output: 54.99 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:25<00:13, 50.68it/s, est. speed input: 56249.48 toks/s, output: 54.93 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:25<00:12, 50.67it/s, est. speed input: 56194.98 toks/s, output: 54.88 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:25<00:12, 50.67it/s, est. speed input: 56142.10 toks/s, output: 54.83 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:26<00:12, 50.67it/s, est. speed input: 56090.52 toks/s, output: 54.78 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:26<00:11, 50.67it/s, est. speed input: 56039.84 toks/s, output: 54.73 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:26<00:11, 50.67it/s, est. speed input: 55990.89 toks/s, output: 54.68 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:26<00:11, 50.69it/s, est. speed input: 55943.67 toks/s, output: 54.63 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:27<00:11, 50.68it/s, est. speed input: 55896.66 toks/s, output: 54.59 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:27<00:10, 50.69it/s, est. speed input: 55851.05 toks/s, output: 54.54 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:27<00:10, 50.68it/s, est. speed input: 55806.17 toks/s, output: 54.50 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:28<00:10, 50.73it/s, est. speed input: 55764.64 toks/s, output: 54.46 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:28<00:09, 51.12it/s, est. speed input: 55737.97 toks/s, output: 54.43 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:28<00:09, 51.42it/s, est. speed input: 55712.89 toks/s, output: 54.41 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:29<00:08, 51.58it/s, est. speed input: 55686.42 toks/s, output: 54.38 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:29<00:08, 51.73it/s, est. speed input: 55661.83 toks/s, output: 54.36 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:29<00:08, 51.82it/s, est. speed input: 55637.61 toks/s, output: 54.33 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:30<00:07, 51.89it/s, est. speed input: 55613.54 toks/s, output: 54.31 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:30<00:07, 51.94it/s, est. speed input: 55590.08 toks/s, output: 54.29 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:30<00:07, 51.96it/s, est. speed input: 55566.78 toks/s, output: 54.26 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:31<00:07, 51.98it/s, est. speed input: 55543.93 toks/s, output: 54.24 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:31<00:06, 51.98it/s, est. speed input: 55521.27 toks/s, output: 54.22 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:31<00:06, 51.98it/s, est. speed input: 55499.03 toks/s, output: 54.20 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:31<00:06, 52.00it/s, est. speed input: 55477.69 toks/s, output: 54.18 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:32<00:05, 52.01it/s, est. speed input: 55456.74 toks/s, output: 54.16 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:32<00:05, 52.00it/s, est. speed input: 55435.79 toks/s, output: 54.14 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:32<00:05, 52.02it/s, est. speed input: 55415.75 toks/s, output: 54.12 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:33<00:04, 52.02it/s, est. speed input: 55395.86 toks/s, output: 54.10 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:33<00:04, 52.05it/s, est. speed input: 55377.41 toks/s, output: 54.08 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:33<00:04, 52.01it/s, est. speed input: 55357.14 toks/s, output: 54.06 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:34<00:03, 52.01it/s, est. speed input: 55338.17 toks/s, output: 54.04 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:34<00:03, 52.02it/s, est. speed input: 55319.81 toks/s, output: 54.02 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:34<00:03, 52.75it/s, est. speed input: 55324.37 toks/s, output: 54.03 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:34<00:03, 52.53it/s, est. speed input: 55306.22 toks/s, output: 54.01 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:35<00:02, 52.38it/s, est. speed input: 55288.62 toks/s, output: 53.99 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:35<00:02, 52.28it/s, est. speed input: 55271.37 toks/s, output: 53.98 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:35<00:02, 52.20it/s, est. speed input: 55254.33 toks/s, output: 53.96 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:36<00:01, 52.14it/s, est. speed input: 55237.12 toks/s, output: 53.94 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:36<00:01, 51.92it/s, est. speed input: 55215.01 toks/s, output: 53.92 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:36<00:01, 51.77it/s, est. speed input: 55193.62 toks/s, output: 53.90 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:37<00:00, 51.67it/s, est. speed input: 55172.38 toks/s, output: 53.88 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:37<00:00, 51.60it/s, est. speed input: 55151.67 toks/s, output: 53.86 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:37<00:00, 52.40it/s, est. speed input: 55155.69 toks/s, output: 53.86 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:37<00:00, 52.40it/s, est. speed input: 55534.82 toks/s, output: 54.23 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:37<00:00, 54.23it/s, est. speed input: 55534.82 toks/s, output: 54.23 toks/s]
[rank0]:[W128 12:25:46.695582609 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 103.4s

测试结果:
  Requests/s:   50.82
  Tokens/s:     52091.29
  Total Reqs:   2048
  Elapsed:      40.30s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     52040.47

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 12:26:19 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 12:26:20 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=53210) WARNING 01-28 12:26:27 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=53210) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=53210) WARNING 01-28 12:26:40 [backends.py:609] Failed to read file <frozen os>
Throughput: 50.73 requests/s, 51995.61 total tokens/s, 50.73 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 12:26:19] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:26:19] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:26:19] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:26:19] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:19] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:19] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:19] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:19] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:19] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:26:19] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:26:19] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:26:19] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:26:19] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:26:19] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 12:26:26] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 12:26:26] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 12:26:26] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 12:26:26] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:26] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:26] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:26] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:26] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 12:26:26] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 12:26:26] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 12:26:26] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 12:26:26] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 12:26:26] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 12:26:26] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:28] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:28] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:28] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:28] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:28] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:28] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=53210) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=53210) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.40it/s]
(EngineCore_DP0 pid=53210) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.40it/s]
(EngineCore_DP0 pid=53210) 
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:29] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:29] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 11796480 bytes
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:29] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:29] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7864320 bytes
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:29] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:29] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 42467328 bytes
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:32] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=53210) [2026-01-28 12:26:32] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 21299200 bytes
(EngineCore_DP0 pid=53210) [rank0]:W0128 12:26:48.286000 53210 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=53210) [rank0]:W0128 12:26:48.385000 53210 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=53210) [rank0]:W0128 12:26:49.723000 53210 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=53210) [rank0]:W0128 12:26:49.877000 53210 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=53210) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:00<00:01,  7.55it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:00<00:01,  7.87it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:00<00:00,  8.24it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:00<00:00,  8.39it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:00<00:00,  8.49it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:00<00:00,  8.57it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:00<00:00,  8.64it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:00<00:00,  8.62it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:01<00:00,  8.60it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:01<00:00,  8.64it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.13it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:01<00:00,  8.35it/s]
(EngineCore_DP0 pid=53210) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:00,  7.35it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:00<00:00,  8.19it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:00<00:00,  8.51it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:00<00:00,  8.65it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:00<00:00,  8.70it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:00<00:00,  8.79it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.95it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:00<00:00,  8.68it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 36/4096 [00:00<00:11, 355.40it/s]
Adding requests:   2%|▏         | 75/4096 [00:00<00:10, 370.76it/s]
Adding requests:   3%|▎         | 114/4096 [00:00<00:10, 374.99it/s]
Adding requests:   4%|▎         | 152/4096 [00:00<00:10, 375.52it/s]
Adding requests:   5%|▍         | 190/4096 [00:00<00:10, 375.96it/s]
Adding requests:   6%|▌         | 230/4096 [00:00<00:10, 382.59it/s]
Adding requests:   7%|▋         | 269/4096 [00:00<00:10, 378.34it/s]
Adding requests:   7%|▋         | 307/4096 [00:00<00:10, 375.47it/s]
Adding requests:   8%|▊         | 345/4096 [00:00<00:09, 376.29it/s]
Adding requests:   9%|▉         | 383/4096 [00:01<00:09, 375.88it/s]
Adding requests:  10%|█         | 422/4096 [00:01<00:09, 377.94it/s]
Adding requests:  11%|█▏        | 461/4096 [00:01<00:09, 379.76it/s]
Adding requests:  12%|█▏        | 500/4096 [00:01<00:09, 381.53it/s]
Adding requests:  13%|█▎        | 539/4096 [00:01<00:09, 376.92it/s]
Adding requests:  14%|█▍        | 579/4096 [00:01<00:09, 383.65it/s]
Adding requests:  15%|█▌        | 618/4096 [00:01<00:09, 384.30it/s]
Adding requests:  16%|█▌        | 658/4096 [00:01<00:08, 387.92it/s]
Adding requests:  17%|█▋        | 700/4096 [00:01<00:08, 396.37it/s]
Adding requests:  18%|█▊        | 740/4096 [00:01<00:08, 395.53it/s]
Adding requests:  19%|█▉        | 780/4096 [00:02<00:08, 389.89it/s]
Adding requests:  20%|██        | 820/4096 [00:02<00:08, 385.09it/s]
Adding requests:  21%|██        | 859/4096 [00:02<00:08, 385.58it/s]
Adding requests:  22%|██▏       | 900/4096 [00:02<00:08, 391.87it/s]
Adding requests:  23%|██▎       | 940/4096 [00:02<00:08, 393.91it/s]
Adding requests:  24%|██▍       | 980/4096 [00:02<00:07, 394.13it/s]
Adding requests:  25%|██▍       | 1021/4096 [00:02<00:07, 398.30it/s]
Adding requests:  26%|██▌       | 1062/4096 [00:02<00:07, 401.00it/s]
Adding requests:  27%|██▋       | 1103/4096 [00:02<00:07, 397.68it/s]
Adding requests:  28%|██▊       | 1143/4096 [00:02<00:07, 393.63it/s]
Adding requests:  29%|██▉       | 1186/4096 [00:03<00:07, 390.23it/s]
Adding requests:  30%|██▉       | 1227/4096 [00:03<00:07, 393.35it/s]
Adding requests:  31%|███       | 1267/4096 [00:03<00:07, 393.12it/s]
Adding requests:  32%|███▏      | 1307/4096 [00:03<00:07, 394.71it/s]
Adding requests:  33%|███▎      | 1347/4096 [00:03<00:07, 392.32it/s]
Adding requests:  34%|███▍      | 1387/4096 [00:03<00:06, 391.65it/s]
Adding requests:  35%|███▍      | 1427/4096 [00:03<00:06, 391.23it/s]
Adding requests:  36%|███▌      | 1467/4096 [00:03<00:06, 392.52it/s]
Adding requests:  37%|███▋      | 1508/4096 [00:03<00:06, 396.60it/s]
Adding requests:  38%|███▊      | 1549/4096 [00:03<00:06, 399.60it/s]
Adding requests:  39%|███▉      | 1589/4096 [00:04<00:06, 396.95it/s]
Adding requests:  40%|███▉      | 1629/4096 [00:04<00:06, 396.31it/s]
Adding requests:  41%|████      | 1669/4096 [00:04<00:06, 389.14it/s]
Adding requests:  42%|████▏     | 1708/4096 [00:04<00:06, 389.24it/s]
Adding requests:  43%|████▎     | 1747/4096 [00:04<00:06, 387.43it/s]
Adding requests:  44%|████▎     | 1786/4096 [00:04<00:05, 386.75it/s]
Adding requests:  45%|████▍     | 1825/4096 [00:04<00:05, 385.89it/s]
Adding requests:  46%|████▌     | 1864/4096 [00:04<00:05, 379.50it/s]
Adding requests:  46%|████▋     | 1904/4096 [00:04<00:05, 384.20it/s]
Adding requests:  47%|████▋     | 1943/4096 [00:05<00:05, 384.49it/s]
Adding requests:  48%|████▊     | 1982/4096 [00:05<00:05, 383.24it/s]
Adding requests:  49%|████▉     | 2021/4096 [00:05<00:05, 381.17it/s]
Adding requests:  50%|█████     | 2061/4096 [00:05<00:05, 385.40it/s]
Adding requests:  51%|█████▏    | 2100/4096 [00:05<00:05, 382.20it/s]
Adding requests:  52%|█████▏    | 2139/4096 [00:05<00:05, 376.33it/s]
Adding requests:  53%|█████▎    | 2177/4096 [00:05<00:05, 374.70it/s]
Adding requests:  54%|█████▍    | 2215/4096 [00:05<00:05, 373.75it/s]
Adding requests:  55%|█████▌    | 2253/4096 [00:05<00:04, 375.33it/s]
Adding requests:  56%|█████▌    | 2291/4096 [00:05<00:04, 373.25it/s]
Adding requests:  57%|█████▋    | 2329/4096 [00:08<00:42, 41.36it/s] 
Adding requests:  58%|█████▊    | 2365/4096 [00:08<00:31, 55.46it/s]
Adding requests:  59%|█████▊    | 2402/4096 [00:08<00:22, 74.18it/s]
Adding requests:  59%|█████▉    | 2436/4096 [00:09<00:17, 94.81it/s]
Adding requests:  60%|██████    | 2474/4096 [00:09<00:13, 123.37it/s]
Adding requests:  61%|██████▏   | 2512/4096 [00:09<00:10, 155.37it/s]
Adding requests:  62%|██████▏   | 2549/4096 [00:09<00:08, 187.70it/s]
Adding requests:  63%|██████▎   | 2588/4096 [00:09<00:06, 223.05it/s]
Adding requests:  64%|██████▍   | 2626/4096 [00:09<00:05, 253.85it/s]
Adding requests:  65%|██████▌   | 2666/4096 [00:09<00:05, 285.10it/s]
Adding requests:  66%|██████▌   | 2704/4096 [00:09<00:04, 306.11it/s]
Adding requests:  67%|██████▋   | 2743/4096 [00:09<00:04, 326.64it/s]
Adding requests:  68%|██████▊   | 2781/4096 [00:10<00:03, 337.92it/s]
Adding requests:  69%|██████▉   | 2819/4096 [00:10<00:03, 346.64it/s]
Adding requests:  70%|██████▉   | 2857/4096 [00:10<00:03, 352.22it/s]
Adding requests:  71%|███████   | 2896/4096 [00:10<00:03, 362.31it/s]
Adding requests:  72%|███████▏  | 2934/4096 [00:10<00:03, 365.27it/s]
Adding requests:  73%|███████▎  | 2973/4096 [00:10<00:03, 370.18it/s]
Adding requests:  74%|███████▎  | 3012/4096 [00:10<00:02, 374.52it/s]
Adding requests:  74%|███████▍  | 3051/4096 [00:10<00:02, 376.04it/s]
Adding requests:  75%|███████▌  | 3089/4096 [00:10<00:02, 374.80it/s]
Adding requests:  76%|███████▋  | 3127/4096 [00:10<00:02, 373.80it/s]
Adding requests:  77%|███████▋  | 3165/4096 [00:11<00:02, 374.20it/s]
Adding requests:  78%|███████▊  | 3203/4096 [00:11<00:02, 373.92it/s]
Adding requests:  79%|███████▉  | 3242/4096 [00:11<00:02, 378.44it/s]
Adding requests:  80%|████████  | 3281/4096 [00:11<00:02, 381.01it/s]
Adding requests:  81%|████████  | 3320/4096 [00:11<00:02, 380.24it/s]
Adding requests:  82%|████████▏ | 3359/4096 [00:11<00:01, 380.36it/s]
Adding requests:  83%|████████▎ | 3398/4096 [00:11<00:01, 378.21it/s]
Adding requests:  84%|████████▍ | 3438/4096 [00:11<00:01, 380.45it/s]
Adding requests:  85%|████████▍ | 3477/4096 [00:11<00:01, 374.58it/s]
Adding requests:  86%|████████▌ | 3515/4096 [00:11<00:01, 375.20it/s]
Adding requests:  87%|████████▋ | 3553/4096 [00:12<00:01, 366.90it/s]
Adding requests:  88%|████████▊ | 3590/4096 [00:12<00:01, 365.62it/s]
Adding requests:  89%|████████▊ | 3627/4096 [00:12<00:01, 362.76it/s]
Adding requests:  90%|████████▉ | 3666/4096 [00:12<00:01, 369.88it/s]
Adding requests:  91%|█████████ | 3707/4096 [00:12<00:01, 379.28it/s]
Adding requests:  91%|█████████▏| 3746/4096 [00:12<00:00, 381.98it/s]
Adding requests:  92%|█████████▏| 3785/4096 [00:12<00:00, 377.04it/s]
Adding requests:  93%|█████████▎| 3825/4096 [00:12<00:00, 381.48it/s]
Adding requests:  94%|█████████▍| 3865/4096 [00:12<00:00, 385.25it/s]
Adding requests:  95%|█████████▌| 3904/4096 [00:12<00:00, 384.20it/s]
Adding requests:  96%|█████████▋| 3944/4096 [00:13<00:00, 388.11it/s]
Adding requests:  97%|█████████▋| 3984/4096 [00:13<00:00, 390.47it/s]
Adding requests:  98%|█████████▊| 4024/4096 [00:13<00:00, 392.97it/s]
Adding requests:  99%|█████████▉| 4064/4096 [00:13<00:00, 389.75it/s]
Adding requests: 100%|██████████| 4096/4096 [00:13<00:00, 304.13it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:00<00:03, 970.80it/s, est. speed input: 994155.25 toks/s, output: 970.81 toks/s]
Processed prompts:  15%|█▍        | 612/4096 [00:02<00:17, 204.09it/s, est. speed input: 260909.29 toks/s, output: 254.79 toks/s]
Processed prompts:  16%|█▌        | 656/4096 [00:03<00:20, 166.63it/s, est. speed input: 222506.99 toks/s, output: 217.29 toks/s]
Processed prompts:  17%|█▋        | 683/4096 [00:03<00:25, 131.37it/s, est. speed input: 192380.75 toks/s, output: 187.87 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:04<00:32, 104.00it/s, est. speed input: 170015.55 toks/s, output: 166.03 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:04<00:37, 88.70it/s, est. speed input: 155211.87 toks/s, output: 151.57 toks/s] 
Processed prompts:  19%|█▉        | 770/4096 [00:05<00:42, 77.83it/s, est. speed input: 143737.48 toks/s, output: 140.37 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:06<00:46, 70.12it/s, est. speed input: 134576.07 toks/s, output: 131.42 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:06<00:50, 64.68it/s, est. speed input: 127096.13 toks/s, output: 124.12 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:07<00:53, 60.85it/s, est. speed input: 120872.35 toks/s, output: 118.04 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:07<00:54, 58.17it/s, est. speed input: 115617.51 toks/s, output: 112.91 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:08<00:56, 56.28it/s, est. speed input: 111116.44 toks/s, output: 108.51 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:09<00:57, 54.96it/s, est. speed input: 107220.09 toks/s, output: 104.71 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:09<00:57, 54.10it/s, est. speed input: 103842.27 toks/s, output: 101.41 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:10<00:57, 53.51it/s, est. speed input: 100867.57 toks/s, output: 98.50 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:11<00:57, 53.09it/s, est. speed input: 98224.40 toks/s, output: 95.92 toks/s] 
Processed prompts:  27%|██▋       | 1090/4096 [00:11<00:56, 52.80it/s, est. speed input: 95857.78 toks/s, output: 93.61 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:12<00:56, 52.59it/s, est. speed input: 93729.19 toks/s, output: 91.53 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:12<00:55, 52.83it/s, est. speed input: 91909.68 toks/s, output: 89.76 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:13<00:55, 52.62it/s, est. speed input: 90155.08 toks/s, output: 88.04 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:14<00:54, 52.47it/s, est. speed input: 88551.53 toks/s, output: 86.48 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:14<00:54, 52.37it/s, est. speed input: 87082.23 toks/s, output: 85.04 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:15<00:53, 52.29it/s, est. speed input: 85730.46 toks/s, output: 83.72 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:15<00:53, 52.23it/s, est. speed input: 84481.19 toks/s, output: 82.50 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:16<00:52, 52.19it/s, est. speed input: 83324.62 toks/s, output: 81.37 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:17<00:52, 52.10it/s, est. speed input: 82239.88 toks/s, output: 80.31 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:17<00:51, 51.70it/s, est. speed input: 81169.07 toks/s, output: 79.27 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:18<00:51, 51.38it/s, est. speed input: 80163.75 toks/s, output: 78.28 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:19<00:51, 51.15it/s, est. speed input: 79224.51 toks/s, output: 77.37 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:19<00:50, 51.00it/s, est. speed input: 78345.78 toks/s, output: 76.51 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:20<00:50, 50.89it/s, est. speed input: 77522.00 toks/s, output: 75.70 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:20<00:49, 50.81it/s, est. speed input: 76747.42 toks/s, output: 74.95 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:21<00:49, 50.76it/s, est. speed input: 76018.00 toks/s, output: 74.24 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:22<00:48, 50.72it/s, est. speed input: 75330.55 toks/s, output: 73.56 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:22<00:47, 50.69it/s, est. speed input: 74680.83 toks/s, output: 72.93 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:23<00:47, 50.67it/s, est. speed input: 74065.56 toks/s, output: 72.33 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:24<00:46, 50.67it/s, est. speed input: 73483.80 toks/s, output: 71.76 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:24<00:46, 50.65it/s, est. speed input: 72930.17 toks/s, output: 71.22 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:25<00:45, 50.61it/s, est. speed input: 72401.42 toks/s, output: 70.70 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:26<00:45, 49.94it/s, est. speed input: 71822.53 toks/s, output: 70.14 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:26<00:44, 49.87it/s, est. speed input: 71317.74 toks/s, output: 69.65 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:27<00:44, 49.40it/s, est. speed input: 70789.51 toks/s, output: 69.13 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:30<01:40, 21.68it/s, est. speed input: 64007.78 toks/s, output: 62.51 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:31<01:22, 25.98it/s, est. speed input: 63704.09 toks/s, output: 62.21 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:32<01:09, 30.18it/s, est. speed input: 63413.79 toks/s, output: 61.93 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:32<01:01, 34.03it/s, est. speed input: 63134.39 toks/s, output: 61.65 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:33<00:54, 37.64it/s, est. speed input: 62906.86 toks/s, output: 61.43 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:34<00:49, 40.71it/s, est. speed input: 62693.32 toks/s, output: 61.22 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:34<00:45, 43.18it/s, est. speed input: 62487.66 toks/s, output: 61.02 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:35<00:43, 45.10it/s, est. speed input: 62289.62 toks/s, output: 60.83 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:35<00:41, 46.54it/s, est. speed input: 62098.51 toks/s, output: 60.64 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:36<00:39, 47.95it/s, est. speed input: 61941.21 toks/s, output: 60.49 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:37<00:37, 49.13it/s, est. speed input: 61799.69 toks/s, output: 60.35 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:37<00:36, 50.34it/s, est. speed input: 61686.98 toks/s, output: 60.24 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:38<00:35, 50.86it/s, est. speed input: 61553.68 toks/s, output: 60.11 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:38<00:34, 51.27it/s, est. speed input: 61427.45 toks/s, output: 59.99 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:39<00:33, 51.49it/s, est. speed input: 61300.26 toks/s, output: 59.86 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:40<00:32, 51.72it/s, est. speed input: 61181.76 toks/s, output: 59.75 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:40<00:32, 51.78it/s, est. speed input: 61060.95 toks/s, output: 59.63 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:41<00:31, 51.89it/s, est. speed input: 60947.13 toks/s, output: 59.52 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:42<00:30, 52.33it/s, est. speed input: 60857.96 toks/s, output: 59.43 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:42<00:29, 52.28it/s, est. speed input: 60750.49 toks/s, output: 59.33 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:43<00:29, 52.22it/s, est. speed input: 60645.53 toks/s, output: 59.22 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:43<00:28, 52.19it/s, est. speed input: 60543.44 toks/s, output: 59.12 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:44<00:28, 52.17it/s, est. speed input: 60444.63 toks/s, output: 59.03 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:45<00:27, 52.16it/s, est. speed input: 60348.49 toks/s, output: 58.93 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:45<00:26, 52.14it/s, est. speed input: 60254.48 toks/s, output: 58.84 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:46<00:26, 52.17it/s, est. speed input: 60165.26 toks/s, output: 58.76 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:46<00:25, 52.10it/s, est. speed input: 60073.61 toks/s, output: 58.67 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:47<00:25, 52.12it/s, est. speed input: 59987.47 toks/s, output: 58.58 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:48<00:24, 52.11it/s, est. speed input: 59902.99 toks/s, output: 58.50 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:48<00:23, 52.11it/s, est. speed input: 59820.66 toks/s, output: 58.42 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:49<00:23, 52.11it/s, est. speed input: 59740.49 toks/s, output: 58.34 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:50<00:22, 52.11it/s, est. speed input: 59662.02 toks/s, output: 58.26 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:50<00:22, 52.11it/s, est. speed input: 59585.52 toks/s, output: 58.19 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:51<00:21, 52.11it/s, est. speed input: 59510.96 toks/s, output: 58.12 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:51<00:20, 52.11it/s, est. speed input: 59438.07 toks/s, output: 58.04 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:52<00:20, 51.82it/s, est. speed input: 59354.05 toks/s, output: 57.96 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:53<00:19, 51.42it/s, est. speed input: 59263.19 toks/s, output: 57.87 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:53<00:19, 51.16it/s, est. speed input: 59174.94 toks/s, output: 57.79 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:54<00:18, 50.97it/s, est. speed input: 59088.42 toks/s, output: 57.70 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:55<00:18, 50.84it/s, est. speed input: 59004.06 toks/s, output: 57.62 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:55<00:17, 50.75it/s, est. speed input: 58921.67 toks/s, output: 57.54 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:56<00:17, 50.69it/s, est. speed input: 58841.04 toks/s, output: 57.46 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:56<00:16, 50.64it/s, est. speed input: 58762.08 toks/s, output: 57.38 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:57<00:15, 50.62it/s, est. speed input: 58685.19 toks/s, output: 57.31 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:58<00:15, 50.60it/s, est. speed input: 58609.91 toks/s, output: 57.24 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:58<00:14, 50.58it/s, est. speed input: 58536.19 toks/s, output: 57.16 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:59<00:13, 50.57it/s, est. speed input: 58464.09 toks/s, output: 57.09 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [01:00<00:13, 50.56it/s, est. speed input: 58393.24 toks/s, output: 57.02 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:00<00:12, 49.84it/s, est. speed input: 58294.87 toks/s, output: 56.93 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:01<00:12, 49.31it/s, est. speed input: 58197.06 toks/s, output: 56.83 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:02<00:11, 48.94it/s, est. speed input: 58101.12 toks/s, output: 56.74 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:02<00:11, 48.68it/s, est. speed input: 58007.27 toks/s, output: 56.65 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:06<00:23, 21.40it/s, est. speed input: 55479.16 toks/s, output: 54.18 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:06<00:18, 25.69it/s, est. speed input: 55418.04 toks/s, output: 54.12 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:07<00:14, 30.10it/s, est. speed input: 55380.63 toks/s, output: 54.08 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:08<00:12, 34.22it/s, est. speed input: 55344.27 toks/s, output: 54.05 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:08<00:10, 38.06it/s, est. speed input: 55320.96 toks/s, output: 54.02 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:09<00:08, 41.04it/s, est. speed input: 55285.53 toks/s, output: 53.99 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:10<00:07, 43.44it/s, est. speed input: 55251.29 toks/s, output: 53.96 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:10<00:06, 45.29it/s, est. speed input: 55217.25 toks/s, output: 53.92 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:11<00:05, 46.96it/s, est. speed input: 55194.54 toks/s, output: 53.90 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:11<00:04, 48.40it/s, est. speed input: 55178.95 toks/s, output: 53.89 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:12<00:03, 49.45it/s, est. speed input: 55163.54 toks/s, output: 53.87 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:13<00:03, 50.22it/s, est. speed input: 55148.42 toks/s, output: 53.86 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:13<00:02, 50.82it/s, est. speed input: 55134.81 toks/s, output: 53.84 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:14<00:01, 51.17it/s, est. speed input: 55119.29 toks/s, output: 53.83 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:14<00:01, 51.82it/s, est. speed input: 55115.94 toks/s, output: 53.82 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:15<00:00, 52.41it/s, est. speed input: 55116.08 toks/s, output: 53.82 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:15<00:00, 52.41it/s, est. speed input: 55522.40 toks/s, output: 54.22 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:15<00:00, 54.22it/s, est. speed input: 55522.40 toks/s, output: 54.22 toks/s]
[rank0]:[W128 12:28:27.964629058 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 160.9s

测试结果:
  Requests/s:   50.73
  Tokens/s:     51995.61
  Total Reqs:   4096
  Elapsed:      80.75s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     51944.89


------------------------------------------------------------
  生成 CSV: BitNet-2B-FP8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_10/BitNet-2B-FP8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,16.0386,8227.8102,7.9807
1024,1024,1,128,128,16.3869,16796.5378,7.8111
2048,1024,2,256,128,31.9465,32745.1489,8.0134
4096,1024,4,512,128,50.9992,52274.1594,10.0394
8192,1024,8,1024,128,51.5199,52807.9236,19.8758
16384,1024,16,2048,128,50.8208,52091.2944,40.2985
32768,1024,32,4096,128,50.7274,51995.6129,80.7453

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败


============================================================
  Benchmark 完成!
============================================================


总计: 35 成功, 0 失败
============================================================
