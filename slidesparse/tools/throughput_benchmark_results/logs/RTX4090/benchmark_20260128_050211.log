======================================================================
SlideSparse vLLM Throughput Benchmark Log
Created: 2026-01-28 05:02:11
======================================================================

原始命令:
  /root/vllmbench/slidesparse/tools/throughput_benchmark.py --model bitnet1.58-2b-int8 --backend cublaslt,cusparselt --stage prefill --sparsity 2_4,2_6,2_8,2_10 --M 512,1024,2048,4096,8192,16384,32768

命令行参数:
  --model: bitnet1.58-2b-int8
  --backend: cublaslt,cusparselt
  --sparsity: 2_4,2_6,2_8,2_10
  --stage: prefill
  --M: 512,1024,2048,4096,8192,16384,32768
  --N: None
  --inner-32: False
  --eager: False
  --gpu-id: 0
  --gpu-mem: 0.8
  --dry-run: False
  --list-models: False

硬件信息:
  GPU: RTX4090
  Compute Capability: cc89
  VRAM: 24.0 GB
  CUDA: 12.9
  Python: py312

Backend 环境变量 (初始状态):
  DISABLE_SLIDESPARSE: 未设置
  USE_CUBLASLT: 未设置
  USE_CUSPARSELT: 未设置
  SPARSITY: 未设置
  INNER_DTYPE_32: 未设置

======================================================================


============================================================
  BitNet-2B-INT8 | cuBLASLt | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints/BitNet-2B-INT8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cublaslt

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:02:49 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:02:50 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=755796) WARNING 01-28 05:04:09 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=755796) WARNING 01-28 05:04:42 [backends.py:609] Failed to read file <frozen os>
Throughput: 13.92 requests/s, 7143.01 total tokens/s, 13.92 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 05:02:34] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:02:49] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:02:49] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:02:49] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:02:49] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:02:49] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:02:49] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:02:49] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:02:49] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:02:49] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:02:49] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:02:49] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:02:49] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:02:49] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:03:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:03:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:03:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:03:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:03:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:03:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:03:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:03:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:03:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:03:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:03:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:03:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:03:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:03:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=755796) [2026-01-28 05:04:13] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=755796) [2026-01-28 05:04:13] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=755796) [2026-01-28 05:04:13] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=755796) [2026-01-28 05:04:13] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=755796) [2026-01-28 05:04:13] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=755796) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=755796) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.48s/it]
(EngineCore_DP0 pid=755796) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.48s/it]
(EngineCore_DP0 pid=755796) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=755796) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:01<00:01,  1.70s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:09<00:00,  5.10s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:09<00:00,  4.59s/it]
(EngineCore_DP0 pid=755796) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.24it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.24it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  51%|█████     | 65/128 [00:00<00:00, 642.02it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 654.14it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<01:01,  2.06it/s, est. speed input: 1056.63 toks/s, output: 2.06 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:44,  2.84it/s, est. speed input: 1376.77 toks/s, output: 2.69 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:30,  4.06it/s, est. speed input: 1775.88 toks/s, output: 3.47 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:17,  6.99it/s, est. speed input: 2579.64 toks/s, output: 5.04 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:01<00:12,  9.32it/s, est. speed input: 3204.98 toks/s, output: 6.26 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:01<00:10, 10.95it/s, est. speed input: 3683.84 toks/s, output: 7.19 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:01<00:09, 12.26it/s, est. speed input: 4083.78 toks/s, output: 7.98 toks/s]
Processed prompts:  10%|█         | 13/128 [00:01<00:08, 13.19it/s, est. speed input: 4412.73 toks/s, output: 8.62 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:01<00:08, 13.83it/s, est. speed input: 4687.61 toks/s, output: 9.16 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:07, 14.34it/s, est. speed input: 4926.14 toks/s, output: 9.62 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:07, 14.66it/s, est. speed input: 5129.39 toks/s, output: 10.02 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:02<00:07, 14.88it/s, est. speed input: 5305.60 toks/s, output: 10.36 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:02<00:06, 15.09it/s, est. speed input: 5465.10 toks/s, output: 10.67 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:02<00:06, 15.22it/s, est. speed input: 5605.50 toks/s, output: 10.95 toks/s]
Processed prompts:  21%|██        | 27/128 [00:02<00:06, 15.31it/s, est. speed input: 5730.13 toks/s, output: 11.19 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:02<00:06, 15.37it/s, est. speed input: 5842.41 toks/s, output: 11.41 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:02<00:06, 15.30it/s, est. speed input: 5937.02 toks/s, output: 11.60 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:02<00:06, 15.28it/s, est. speed input: 6023.94 toks/s, output: 11.77 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:06, 15.29it/s, est. speed input: 6104.83 toks/s, output: 11.92 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:03<00:05, 15.37it/s, est. speed input: 6183.08 toks/s, output: 12.08 toks/s]
Processed prompts:  30%|███       | 39/128 [00:03<00:05, 15.49it/s, est. speed input: 6258.07 toks/s, output: 12.22 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:03<00:05, 15.55it/s, est. speed input: 6326.68 toks/s, output: 12.36 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:03<00:05, 15.60it/s, est. speed input: 6389.92 toks/s, output: 12.48 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:03<00:05, 15.49it/s, est. speed input: 6441.95 toks/s, output: 12.58 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:03<00:05, 15.38it/s, est. speed input: 6488.60 toks/s, output: 12.67 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:03<00:05, 15.31it/s, est. speed input: 6532.13 toks/s, output: 12.76 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:05, 15.32it/s, est. speed input: 6575.59 toks/s, output: 12.84 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:04<00:04, 15.36it/s, est. speed input: 6617.70 toks/s, output: 12.93 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:04<00:04, 15.40it/s, est. speed input: 6657.74 toks/s, output: 13.00 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:04<00:04, 15.39it/s, est. speed input: 6693.84 toks/s, output: 13.07 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:04<00:04, 15.43it/s, est. speed input: 6729.82 toks/s, output: 13.14 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:04<00:04, 15.41it/s, est. speed input: 6761.95 toks/s, output: 13.21 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:04<00:04, 15.24it/s, est. speed input: 6785.76 toks/s, output: 13.25 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:04<00:04, 15.29it/s, est. speed input: 6815.32 toks/s, output: 13.31 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:05<00:03, 15.40it/s, est. speed input: 6845.90 toks/s, output: 13.37 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:05<00:03, 15.49it/s, est. speed input: 6875.40 toks/s, output: 13.43 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:05<00:03, 15.51it/s, est. speed input: 6901.96 toks/s, output: 13.48 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:05<00:03, 15.43it/s, est. speed input: 6924.07 toks/s, output: 13.52 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:05<00:03, 15.41it/s, est. speed input: 6946.19 toks/s, output: 13.57 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:05<00:03, 15.33it/s, est. speed input: 6965.10 toks/s, output: 13.60 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:05<00:03, 15.29it/s, est. speed input: 6983.71 toks/s, output: 13.64 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:05<00:03, 15.28it/s, est. speed input: 7001.87 toks/s, output: 13.68 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:06<00:02, 15.34it/s, est. speed input: 7021.61 toks/s, output: 13.71 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:06<00:02, 15.33it/s, est. speed input: 7038.78 toks/s, output: 13.75 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:06<00:02, 15.33it/s, est. speed input: 7055.49 toks/s, output: 13.78 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:06<00:02, 15.34it/s, est. speed input: 7072.00 toks/s, output: 13.81 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:06<00:02, 15.33it/s, est. speed input: 7087.20 toks/s, output: 13.84 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:06<00:02, 15.30it/s, est. speed input: 7101.06 toks/s, output: 13.87 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:06<00:02, 15.27it/s, est. speed input: 7114.11 toks/s, output: 13.89 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:06<00:02, 15.32it/s, est. speed input: 7128.85 toks/s, output: 13.92 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:07<00:01, 15.34it/s, est. speed input: 7142.58 toks/s, output: 13.95 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:07<00:01, 15.36it/s, est. speed input: 7156.01 toks/s, output: 13.98 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:07<00:01, 15.36it/s, est. speed input: 7168.63 toks/s, output: 14.00 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:07<00:01, 15.35it/s, est. speed input: 7180.36 toks/s, output: 14.02 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:07<00:01, 15.37it/s, est. speed input: 7192.53 toks/s, output: 14.05 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:07<00:01, 15.33it/s, est. speed input: 7202.88 toks/s, output: 14.07 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:07<00:01, 15.33it/s, est. speed input: 7213.44 toks/s, output: 14.09 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:08<00:00, 15.33it/s, est. speed input: 7223.85 toks/s, output: 14.11 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:08<00:00, 15.37it/s, est. speed input: 7234.81 toks/s, output: 14.13 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:08<00:00, 15.37it/s, est. speed input: 7244.96 toks/s, output: 14.15 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:08<00:00, 15.37it/s, est. speed input: 7254.66 toks/s, output: 14.17 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:08<00:00, 15.31it/s, est. speed input: 7262.48 toks/s, output: 14.18 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:08<00:00, 15.26it/s, est. speed input: 7270.06 toks/s, output: 14.20 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:08<00:00, 15.19it/s, est. speed input: 7276.47 toks/s, output: 14.21 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:08<00:00, 15.11it/s, est. speed input: 7282.01 toks/s, output: 14.22 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 15.11it/s, est. speed input: 7285.37 toks/s, output: 14.23 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 14.23it/s, est. speed input: 7285.37 toks/s, output: 14.23 toks/s]
[rank0]:[W128 05:05:54.204090729 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 330.8s

测试结果:
  Requests/s:   13.92
  Tokens/s:     7143.01
  Total Reqs:   128
  Elapsed:      9.19s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7129.09

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:08:07 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:08:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=758476) WARNING 01-28 05:09:13 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=758476) WARNING 01-28 05:10:20 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.38 requests/s, 15769.12 total tokens/s, 15.38 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 05:08:00] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:08:07] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:08:07] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:08:07] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:07] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:07] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:07] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:07] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:07] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:08:07] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:08:07] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:08:07] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:08:07] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:08:07] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:08:34] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:08:45] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:08:45] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:08:45] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:45] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:45] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:45] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:45] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:08:45] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:08:45] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:08:45] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:08:45] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:08:45] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:08:45] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=758476) [2026-01-28 05:09:16] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=758476) [2026-01-28 05:09:16] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=758476) [2026-01-28 05:09:16] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=758476) [2026-01-28 05:09:16] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=758476) [2026-01-28 05:09:16] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=758476) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=758476) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.49it/s]
(EngineCore_DP0 pid=758476) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.49it/s]
(EngineCore_DP0 pid=758476) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=758476) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:13<00:13, 13.28s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:22<00:00, 11.05s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:22<00:00, 11.39s/it]
(EngineCore_DP0 pid=758476) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.99it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.98it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  27%|██▋       | 35/128 [00:00<00:00, 349.53it/s]
Adding requests:  57%|█████▋    | 73/128 [00:00<00:00, 362.56it/s]
Adding requests:  86%|████████▌ | 110/128 [00:00<00:00, 364.88it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 364.53it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:06, 19.98it/s, est. speed input: 20462.26 toks/s, output: 19.98 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:07, 16.39it/s, est. speed input: 17250.08 toks/s, output: 16.84 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:07, 16.22it/s, est. speed input: 16962.31 toks/s, output: 16.56 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:07, 16.11it/s, est. speed input: 16797.18 toks/s, output: 16.40 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:07, 16.01it/s, est. speed input: 16680.43 toks/s, output: 16.29 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:07, 15.96it/s, est. speed input: 16604.49 toks/s, output: 16.21 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:07, 15.89it/s, est. speed input: 16536.10 toks/s, output: 16.15 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 16.07it/s, est. speed input: 16573.55 toks/s, output: 16.18 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:06, 16.23it/s, est. speed input: 16619.99 toks/s, output: 16.23 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 16.21it/s, est. speed input: 16613.96 toks/s, output: 16.22 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 16.31it/s, est. speed input: 16642.18 toks/s, output: 16.25 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.39it/s, est. speed input: 16670.30 toks/s, output: 16.28 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.41it/s, est. speed input: 16682.55 toks/s, output: 16.29 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:06, 16.36it/s, est. speed input: 16679.32 toks/s, output: 16.29 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.36it/s, est. speed input: 16684.37 toks/s, output: 16.29 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.34it/s, est. speed input: 16683.79 toks/s, output: 16.29 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:02<00:05, 16.35it/s, est. speed input: 16688.17 toks/s, output: 16.30 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 16.40it/s, est. speed input: 16700.80 toks/s, output: 16.31 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.41it/s, est. speed input: 16708.37 toks/s, output: 16.32 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.40it/s, est. speed input: 16711.68 toks/s, output: 16.32 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 16.37it/s, est. speed input: 16709.76 toks/s, output: 16.32 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 16.31it/s, est. speed input: 16703.34 toks/s, output: 16.31 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:05, 16.34it/s, est. speed input: 16707.06 toks/s, output: 16.32 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:04, 16.38it/s, est. speed input: 16714.38 toks/s, output: 16.32 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:03<00:04, 16.40it/s, est. speed input: 16719.00 toks/s, output: 16.33 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 16.40it/s, est. speed input: 16721.83 toks/s, output: 16.33 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 16.45it/s, est. speed input: 16730.64 toks/s, output: 16.34 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.47it/s, est. speed input: 16736.79 toks/s, output: 16.34 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 16.48it/s, est. speed input: 16742.51 toks/s, output: 16.35 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 16.49it/s, est. speed input: 16747.82 toks/s, output: 16.36 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:04, 16.43it/s, est. speed input: 16746.02 toks/s, output: 16.35 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:03, 16.39it/s, est. speed input: 16744.55 toks/s, output: 16.35 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:04<00:03, 16.43it/s, est. speed input: 16749.35 toks/s, output: 16.36 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 16.41it/s, est. speed input: 16749.88 toks/s, output: 16.36 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 16.39it/s, est. speed input: 16749.84 toks/s, output: 16.36 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 16.45it/s, est. speed input: 16755.86 toks/s, output: 16.36 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 16.45it/s, est. speed input: 16758.71 toks/s, output: 16.37 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 16.46it/s, est. speed input: 16761.97 toks/s, output: 16.37 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 16.43it/s, est. speed input: 16761.26 toks/s, output: 16.37 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:02, 16.42it/s, est. speed input: 16762.00 toks/s, output: 16.37 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:05<00:02, 16.42it/s, est. speed input: 16763.73 toks/s, output: 16.37 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 16.42it/s, est. speed input: 16764.72 toks/s, output: 16.37 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 16.43it/s, est. speed input: 16766.26 toks/s, output: 16.37 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 16.41it/s, est. speed input: 16766.06 toks/s, output: 16.37 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 16.43it/s, est. speed input: 16768.70 toks/s, output: 16.38 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 16.44it/s, est. speed input: 16770.57 toks/s, output: 16.38 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 16.44it/s, est. speed input: 16771.81 toks/s, output: 16.38 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 16.43it/s, est. speed input: 16772.53 toks/s, output: 16.38 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 16.41it/s, est. speed input: 16771.99 toks/s, output: 16.38 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 16.03it/s, est. speed input: 16746.51 toks/s, output: 16.35 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 15.74it/s, est. speed input: 16719.00 toks/s, output: 16.33 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 15.52it/s, est. speed input: 16691.27 toks/s, output: 16.30 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 15.38it/s, est. speed input: 16665.35 toks/s, output: 16.27 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 15.30it/s, est. speed input: 16642.16 toks/s, output: 16.25 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 15.19it/s, est. speed input: 16615.74 toks/s, output: 16.23 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:01, 15.13it/s, est. speed input: 16591.38 toks/s, output: 16.20 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:07<00:00, 15.15it/s, est. speed input: 16571.95 toks/s, output: 16.18 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 15.17it/s, est. speed input: 16553.79 toks/s, output: 16.17 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 15.20it/s, est. speed input: 16537.16 toks/s, output: 16.15 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 15.20it/s, est. speed input: 16520.14 toks/s, output: 16.13 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 15.19it/s, est. speed input: 16503.10 toks/s, output: 16.12 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 15.19it/s, est. speed input: 16486.55 toks/s, output: 16.10 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 15.15it/s, est. speed input: 16468.28 toks/s, output: 16.08 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 15.13it/s, est. speed input: 16451.36 toks/s, output: 16.07 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 15.13it/s, est. speed input: 16451.36 toks/s, output: 16.07 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.07it/s, est. speed input: 16451.36 toks/s, output: 16.07 toks/s]
[rank0]:[W128 05:12:05.138491218 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 276.8s

测试结果:
  Requests/s:   15.38
  Tokens/s:     15769.12
  Total Reqs:   128
  Elapsed:      8.32s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     15753.73

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:13:06 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:13:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=760896) WARNING 01-28 05:14:00 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=760896) WARNING 01-28 05:15:00 [backends.py:609] Failed to read file <frozen os>
Throughput: 24.84 requests/s, 25462.14 total tokens/s, 24.84 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 05:12:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:13:06] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:13:06] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:13:06] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:06] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:06] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:06] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:06] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:06] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:13:06] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:13:06] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:13:06] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:13:06] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:13:06] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:13:40] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:13:47] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:13:47] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:13:47] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:47] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:47] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:47] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:47] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:13:47] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:13:47] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:13:47] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:13:47] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:13:47] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:13:47] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=760896) [2026-01-28 05:14:08] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=760896) [2026-01-28 05:14:08] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=760896) [2026-01-28 05:14:08] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=760896) [2026-01-28 05:14:08] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=760896) [2026-01-28 05:14:08] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=760896) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=760896) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.26it/s]
(EngineCore_DP0 pid=760896) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.26it/s]
(EngineCore_DP0 pid=760896) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=760896) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:07<00:15,  7.82s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:10<00:04,  4.59s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:12<00:00,  3.53s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:12<00:00,  4.14s/it]
(EngineCore_DP0 pid=760896) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  1.24it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.00it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.03it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 37/256 [00:00<00:00, 361.50it/s]
Adding requests:  30%|███       | 77/256 [00:00<00:00, 380.51it/s]
Adding requests:  45%|████▌     | 116/256 [00:00<00:00, 381.57it/s]
Adding requests:  61%|██████    | 155/256 [00:00<00:00, 379.41it/s]
Adding requests:  75%|███████▌  | 193/256 [00:00<00:00, 378.18it/s]
Adding requests:  90%|█████████ | 231/256 [00:00<00:00, 377.29it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 377.47it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 1/256 [00:00<00:37,  6.73it/s, est. speed input: 6894.60 toks/s, output: 6.73 toks/s]
Processed prompts:   1%|          | 2/256 [00:01<03:11,  1.33it/s, est. speed input: 1543.46 toks/s, output: 1.51 toks/s]
Processed prompts:   2%|▏         | 6/256 [00:01<00:49,  5.05it/s, est. speed input: 4216.17 toks/s, output: 4.12 toks/s]
Processed prompts:   4%|▍         | 10/256 [00:01<00:27,  8.99it/s, est. speed input: 6455.14 toks/s, output: 6.30 toks/s]
Processed prompts:   5%|▌         | 14/256 [00:01<00:18, 13.03it/s, est. speed input: 8387.38 toks/s, output: 8.19 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:01<00:14, 16.69it/s, est. speed input: 10023.26 toks/s, output: 9.79 toks/s]
Processed prompts:   9%|▊         | 22/256 [00:01<00:11, 20.10it/s, est. speed input: 11477.52 toks/s, output: 11.21 toks/s]
Processed prompts:  10%|█         | 26/256 [00:02<00:09, 23.03it/s, est. speed input: 12762.55 toks/s, output: 12.46 toks/s]
Processed prompts:  12%|█▏        | 30/256 [00:02<00:08, 25.26it/s, est. speed input: 13885.91 toks/s, output: 13.56 toks/s]
Processed prompts:  13%|█▎        | 34/256 [00:02<00:08, 27.24it/s, est. speed input: 14914.78 toks/s, output: 14.57 toks/s]
Processed prompts:  15%|█▍        | 38/256 [00:02<00:07, 28.76it/s, est. speed input: 15842.61 toks/s, output: 15.47 toks/s]
Processed prompts:  16%|█▋        | 42/256 [00:02<00:07, 29.75it/s, est. speed input: 16668.49 toks/s, output: 16.28 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:02<00:06, 30.38it/s, est. speed input: 17410.03 toks/s, output: 17.00 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:02<00:07, 28.58it/s, est. speed input: 17874.03 toks/s, output: 17.45 toks/s]
Processed prompts:  21%|██        | 54/256 [00:02<00:06, 29.59it/s, est. speed input: 18501.72 toks/s, output: 18.07 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:03<00:06, 30.31it/s, est. speed input: 19077.74 toks/s, output: 18.63 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:03<00:06, 30.90it/s, est. speed input: 19614.10 toks/s, output: 19.15 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:03<00:06, 31.21it/s, est. speed input: 20102.52 toks/s, output: 19.63 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:03<00:05, 31.43it/s, est. speed input: 20555.49 toks/s, output: 20.07 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:03<00:05, 31.59it/s, est. speed input: 20977.36 toks/s, output: 20.49 toks/s]
Processed prompts:  30%|███       | 78/256 [00:03<00:05, 31.73it/s, est. speed input: 21372.81 toks/s, output: 20.87 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:03<00:05, 31.68it/s, est. speed input: 21732.30 toks/s, output: 21.22 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:03<00:05, 31.67it/s, est. speed input: 22070.53 toks/s, output: 21.55 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:04<00:05, 31.70it/s, est. speed input: 22390.33 toks/s, output: 21.87 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:04<00:05, 31.77it/s, est. speed input: 22694.90 toks/s, output: 22.16 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:04<00:04, 31.79it/s, est. speed input: 22979.68 toks/s, output: 22.44 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:04<00:04, 31.67it/s, est. speed input: 23239.92 toks/s, output: 22.70 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:04<00:04, 31.76it/s, est. speed input: 23497.32 toks/s, output: 22.95 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:04<00:04, 31.81it/s, est. speed input: 23739.65 toks/s, output: 23.18 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:04<00:04, 31.83it/s, est. speed input: 23968.92 toks/s, output: 23.41 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:04<00:04, 31.76it/s, est. speed input: 24181.87 toks/s, output: 23.62 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:05<00:04, 31.78it/s, est. speed input: 24387.79 toks/s, output: 23.82 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:05<00:04, 31.83it/s, est. speed input: 24586.32 toks/s, output: 24.01 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:05<00:03, 31.91it/s, est. speed input: 24778.68 toks/s, output: 24.20 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:05<00:03, 31.82it/s, est. speed input: 24953.18 toks/s, output: 24.37 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:05<00:03, 31.84it/s, est. speed input: 25125.02 toks/s, output: 24.54 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:05<00:03, 31.77it/s, est. speed input: 25284.42 toks/s, output: 24.69 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:05<00:03, 31.81it/s, est. speed input: 25441.70 toks/s, output: 24.85 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:06<00:03, 31.24it/s, est. speed input: 25558.59 toks/s, output: 24.96 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:06<00:03, 30.70it/s, est. speed input: 25661.34 toks/s, output: 25.06 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:06<00:03, 30.45it/s, est. speed input: 25766.55 toks/s, output: 25.16 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:06<00:03, 30.30it/s, est. speed input: 25868.87 toks/s, output: 25.26 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:06<00:02, 30.18it/s, est. speed input: 25966.04 toks/s, output: 25.36 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:06<00:02, 30.10it/s, est. speed input: 26059.50 toks/s, output: 25.45 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:06<00:02, 30.07it/s, est. speed input: 26150.87 toks/s, output: 25.54 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:06<00:02, 29.99it/s, est. speed input: 26235.35 toks/s, output: 25.62 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:07<00:02, 27.91it/s, est. speed input: 26197.01 toks/s, output: 25.58 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:07<00:02, 28.26it/s, est. speed input: 26265.66 toks/s, output: 25.65 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:07<00:02, 28.59it/s, est. speed input: 26335.80 toks/s, output: 25.72 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:07<00:02, 28.89it/s, est. speed input: 26407.65 toks/s, output: 25.79 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:07<00:01, 29.08it/s, est. speed input: 26475.45 toks/s, output: 25.85 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:07<00:01, 29.28it/s, est. speed input: 26544.37 toks/s, output: 25.92 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:07<00:01, 29.38it/s, est. speed input: 26608.79 toks/s, output: 25.99 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:08<00:01, 29.18it/s, est. speed input: 26657.11 toks/s, output: 26.03 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:08<00:01, 29.22it/s, est. speed input: 26712.99 toks/s, output: 26.09 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:08<00:01, 29.26it/s, est. speed input: 26767.66 toks/s, output: 26.14 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:08<00:01, 29.39it/s, est. speed input: 26825.63 toks/s, output: 26.20 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:08<00:01, 29.45it/s, est. speed input: 26879.95 toks/s, output: 26.25 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:08<00:00, 29.48it/s, est. speed input: 26932.47 toks/s, output: 26.30 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:08<00:00, 29.47it/s, est. speed input: 26981.75 toks/s, output: 26.35 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:09<00:00, 29.48it/s, est. speed input: 27030.11 toks/s, output: 26.40 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:09<00:00, 29.40it/s, est. speed input: 27073.32 toks/s, output: 26.44 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:09<00:00, 29.46it/s, est. speed input: 27120.61 toks/s, output: 26.48 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:09<00:00, 29.48it/s, est. speed input: 27165.44 toks/s, output: 26.53 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:09<00:00, 29.53it/s, est. speed input: 27210.45 toks/s, output: 26.57 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 29.53it/s, est. speed input: 27234.10 toks/s, output: 26.60 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:09<00:00, 26.60it/s, est. speed input: 27234.10 toks/s, output: 26.60 toks/s]
[rank0]:[W128 05:17:06.853205968 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 323.7s

测试结果:
  Requests/s:   24.84
  Tokens/s:     25462.14
  Total Reqs:   256
  Elapsed:      10.31s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     25437.30

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:18:13 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:18:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=763393) WARNING 01-28 05:19:52 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=763393) WARNING 01-28 05:20:33 [backends.py:609] Failed to read file <frozen os>
Throughput: 39.75 requests/s, 40747.94 total tokens/s, 39.75 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 05:18:04] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:18:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:18:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:18:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:18:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:18:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:18:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:18:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:18:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:18:47] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:18:55] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:18:55] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:18:55] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:55] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:55] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:55] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:55] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:18:55] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:18:55] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:18:55] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:18:55] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:18:55] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:18:55] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 05:19:52.013528454 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=763393) [2026-01-28 05:20:06] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=763393) [2026-01-28 05:20:06] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=763393) [2026-01-28 05:20:06] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=763393) [2026-01-28 05:20:06] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=763393) [2026-01-28 05:20:06] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=763393) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=763393) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=763393) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.51it/s]
(EngineCore_DP0 pid=763393) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=763393) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:01<00:04,  1.40s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:03<00:04,  2.07s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:06<00:02,  2.35s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:07<00:00,  1.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:07<00:00,  1.84s/it]
(EngineCore_DP0 pid=763393) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:00,  5.08it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:00<00:00,  5.27it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  3.35it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:00<00:00,  3.71it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 356.03it/s]
Adding requests:  15%|█▍        | 75/512 [00:00<00:01, 375.26it/s]
Adding requests:  22%|██▏       | 113/512 [00:00<00:01, 369.91it/s]
Adding requests:  29%|██▉       | 151/512 [00:00<00:00, 366.46it/s]
Adding requests:  37%|███▋      | 188/512 [00:00<00:00, 366.39it/s]
Adding requests:  44%|████▍     | 227/512 [00:00<00:00, 371.30it/s]
Adding requests:  52%|█████▏    | 265/512 [00:00<00:00, 372.43it/s]
Adding requests:  59%|█████▉    | 303/512 [00:00<00:00, 370.03it/s]
Adding requests:  67%|██████▋   | 342/512 [00:00<00:00, 373.85it/s]
Adding requests:  74%|███████▍  | 381/512 [00:01<00:00, 377.19it/s]
Adding requests:  82%|████████▏ | 419/512 [00:01<00:00, 376.54it/s]
Adding requests:  89%|████████▉ | 457/512 [00:01<00:00, 375.11it/s]
Adding requests:  97%|█████████▋| 495/512 [00:01<00:00, 373.09it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 371.89it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/512 [00:00<01:43,  4.93it/s, est. speed input: 5053.12 toks/s, output: 4.93 toks/s]
Processed prompts:   2%|▏         | 10/512 [00:00<00:24, 20.39it/s, est. speed input: 17575.02 toks/s, output: 17.16 toks/s]
Processed prompts:   4%|▎         | 18/512 [00:00<00:16, 29.28it/s, est. speed input: 24324.04 toks/s, output: 23.75 toks/s]
Processed prompts:   5%|▌         | 26/512 [00:00<00:13, 34.75it/s, est. speed input: 28531.30 toks/s, output: 27.86 toks/s]
Processed prompts:   7%|▋         | 34/512 [00:01<00:12, 38.24it/s, est. speed input: 31395.70 toks/s, output: 30.66 toks/s]
Processed prompts:   8%|▊         | 42/512 [00:01<00:11, 40.56it/s, est. speed input: 33484.09 toks/s, output: 32.70 toks/s]
Processed prompts:  10%|▉         | 50/512 [00:01<00:10, 42.11it/s, est. speed input: 35066.48 toks/s, output: 34.24 toks/s]
Processed prompts:  11%|█▏        | 58/512 [00:01<00:10, 43.20it/s, est. speed input: 36318.53 toks/s, output: 35.47 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:01<00:10, 43.91it/s, est. speed input: 37318.72 toks/s, output: 36.44 toks/s]
Processed prompts:  14%|█▍        | 74/512 [00:01<00:09, 44.39it/s, est. speed input: 38138.67 toks/s, output: 37.24 toks/s]
Processed prompts:  16%|█▌        | 82/512 [00:02<00:09, 44.74it/s, est. speed input: 38828.97 toks/s, output: 37.92 toks/s]
Processed prompts:  18%|█▊        | 90/512 [00:02<00:09, 45.02it/s, est. speed input: 39422.39 toks/s, output: 38.50 toks/s]
Processed prompts:  19%|█▉        | 98/512 [00:02<00:09, 45.19it/s, est. speed input: 39929.68 toks/s, output: 38.99 toks/s]
Processed prompts:  21%|██        | 106/512 [00:02<00:08, 45.29it/s, est. speed input: 40367.28 toks/s, output: 39.42 toks/s]
Processed prompts:  22%|██▏       | 114/512 [00:02<00:08, 45.37it/s, est. speed input: 40751.85 toks/s, output: 39.80 toks/s]
Processed prompts:  24%|██▍       | 122/512 [00:03<00:08, 45.38it/s, est. speed input: 41083.84 toks/s, output: 40.12 toks/s]
Processed prompts:  25%|██▌       | 130/512 [00:03<00:08, 45.35it/s, est. speed input: 41374.51 toks/s, output: 40.40 toks/s]
Processed prompts:  27%|██▋       | 138/512 [00:03<00:08, 45.50it/s, est. speed input: 41661.03 toks/s, output: 40.68 toks/s]
Processed prompts:  29%|██▊       | 146/512 [00:03<00:08, 45.58it/s, est. speed input: 41915.61 toks/s, output: 40.93 toks/s]
Processed prompts:  30%|███       | 154/512 [00:03<00:07, 45.69it/s, est. speed input: 42155.60 toks/s, output: 41.17 toks/s]
Processed prompts:  32%|███▏      | 162/512 [00:03<00:07, 45.75it/s, est. speed input: 42370.52 toks/s, output: 41.38 toks/s]
Processed prompts:  33%|███▎      | 170/512 [00:04<00:07, 45.73it/s, est. speed input: 42559.87 toks/s, output: 41.56 toks/s]
Processed prompts:  35%|███▍      | 178/512 [00:04<00:07, 45.75it/s, est. speed input: 42737.62 toks/s, output: 41.74 toks/s]
Processed prompts:  36%|███▋      | 186/512 [00:04<00:07, 45.78it/s, est. speed input: 42903.08 toks/s, output: 41.90 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:04<00:06, 45.80it/s, est. speed input: 43055.81 toks/s, output: 42.05 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:04<00:06, 45.83it/s, est. speed input: 43198.98 toks/s, output: 42.19 toks/s]
Processed prompts:  41%|████      | 210/512 [00:04<00:06, 45.81it/s, est. speed input: 43328.83 toks/s, output: 42.31 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:05<00:06, 45.76it/s, est. speed input: 43444.96 toks/s, output: 42.43 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:05<00:06, 45.76it/s, est. speed input: 43557.17 toks/s, output: 42.54 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:05<00:06, 45.76it/s, est. speed input: 43661.90 toks/s, output: 42.64 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:05<00:05, 45.74it/s, est. speed input: 43758.86 toks/s, output: 42.73 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:05<00:05, 45.74it/s, est. speed input: 43851.31 toks/s, output: 42.82 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:06<00:05, 45.72it/s, est. speed input: 43936.01 toks/s, output: 42.91 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:06<00:05, 45.70it/s, est. speed input: 44015.45 toks/s, output: 42.98 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:06<00:05, 45.73it/s, est. speed input: 44094.90 toks/s, output: 43.06 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:06<00:05, 45.74it/s, est. speed input: 44168.57 toks/s, output: 43.13 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:06<00:04, 45.74it/s, est. speed input: 44238.39 toks/s, output: 43.20 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:06<00:04, 45.74it/s, est. speed input: 44304.14 toks/s, output: 43.27 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:07<00:04, 45.75it/s, est. speed input: 44367.77 toks/s, output: 43.33 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:07<00:04, 45.76it/s, est. speed input: 44428.78 toks/s, output: 43.39 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:07<00:04, 45.79it/s, est. speed input: 44487.85 toks/s, output: 43.45 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:07<00:03, 45.83it/s, est. speed input: 44546.15 toks/s, output: 43.50 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:07<00:03, 45.79it/s, est. speed input: 44597.29 toks/s, output: 43.55 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:07<00:03, 45.78it/s, est. speed input: 44646.52 toks/s, output: 43.60 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:08<00:03, 45.76it/s, est. speed input: 44693.69 toks/s, output: 43.65 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:08<00:03, 45.75it/s, est. speed input: 44738.30 toks/s, output: 43.69 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:08<00:03, 45.72it/s, est. speed input: 44780.18 toks/s, output: 43.73 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:08<00:02, 45.75it/s, est. speed input: 44823.05 toks/s, output: 43.77 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:08<00:02, 45.76it/s, est. speed input: 44863.81 toks/s, output: 43.81 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:08<00:02, 45.72it/s, est. speed input: 44900.51 toks/s, output: 43.85 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:09<00:02, 45.74it/s, est. speed input: 44938.10 toks/s, output: 43.88 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:09<00:02, 45.72it/s, est. speed input: 44972.18 toks/s, output: 43.92 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:09<00:02, 45.72it/s, est. speed input: 45006.37 toks/s, output: 43.95 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:09<00:01, 45.71it/s, est. speed input: 45038.56 toks/s, output: 43.98 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:09<00:01, 45.71it/s, est. speed input: 45069.83 toks/s, output: 44.01 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:10<00:01, 45.73it/s, est. speed input: 45101.20 toks/s, output: 44.04 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:10<00:01, 45.74it/s, est. speed input: 45131.85 toks/s, output: 44.07 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:10<00:01, 45.72it/s, est. speed input: 45159.16 toks/s, output: 44.10 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:10<00:01, 45.68it/s, est. speed input: 45184.17 toks/s, output: 44.13 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:10<00:00, 45.70it/s, est. speed input: 45211.30 toks/s, output: 44.15 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:10<00:00, 45.73it/s, est. speed input: 45238.49 toks/s, output: 44.18 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:11<00:00, 45.78it/s, est. speed input: 45265.94 toks/s, output: 44.20 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:11<00:00, 45.78it/s, est. speed input: 45291.08 toks/s, output: 44.23 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:11<00:00, 45.74it/s, est. speed input: 45313.07 toks/s, output: 44.25 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:11<00:00, 45.74it/s, est. speed input: 45587.92 toks/s, output: 44.52 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:11<00:00, 44.52it/s, est. speed input: 45587.92 toks/s, output: 44.52 toks/s]
[rank0]:[W128 05:21:30.504974795 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 313.9s

测试结果:
  Requests/s:   39.75
  Tokens/s:     40747.94
  Total Reqs:   512
  Elapsed:      12.88s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     40708.19

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:23:29 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:23:30 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=765838) WARNING 01-28 05:24:36 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=765838) WARNING 01-28 05:25:32 [backends.py:609] Failed to read file <frozen os>
Throughput: 39.88 requests/s, 40881.34 total tokens/s, 39.88 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 05:23:27] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:23:29] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:23:29] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:23:29] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:23:29] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:23:29] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:23:29] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:23:29] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:23:29] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:23:29] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:23:29] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:23:29] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:23:29] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:23:29] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:23:57] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:24:00] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:24:00] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:24:00] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:24:00] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:24:00] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:24:00] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:24:00] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:24:00] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:24:00] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:24:00] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:24:00] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:24:00] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:24:00] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=765838) [2026-01-28 05:24:43] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=765838) [2026-01-28 05:24:43] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=765838) [2026-01-28 05:24:43] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=765838) [2026-01-28 05:24:43] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=765838) [2026-01-28 05:24:43] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=765838) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=765838) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=765838) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=765838) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=765838) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:02<00:11,  2.94s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:04<00:05,  1.90s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:04<00:02,  1.44s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:06<00:01,  1.47s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:07<00:00,  1.43s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]
(EngineCore_DP0 pid=765838) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:01,  1.52it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:01<00:01,  1.10it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:02<00:00,  1.20it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:02<00:00,  1.63it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:02<00:00,  1.45it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▍         | 39/1024 [00:00<00:02, 386.64it/s]
Adding requests:   8%|▊         | 81/1024 [00:00<00:02, 402.80it/s]
Adding requests:  12%|█▏        | 122/1024 [00:00<00:02, 405.40it/s]
Adding requests:  16%|█▌        | 163/1024 [00:00<00:02, 400.65it/s]
Adding requests:  20%|█▉        | 204/1024 [00:00<00:02, 401.07it/s]
Adding requests:  24%|██▍       | 245/1024 [00:00<00:01, 402.86it/s]
Adding requests:  28%|██▊       | 286/1024 [00:00<00:01, 403.30it/s]
Adding requests:  32%|███▏      | 327/1024 [00:00<00:01, 400.61it/s]
Adding requests:  36%|███▌      | 369/1024 [00:00<00:01, 404.07it/s]
Adding requests:  40%|████      | 411/1024 [00:01<00:01, 405.89it/s]
Adding requests:  44%|████▍     | 452/1024 [00:01<00:01, 403.61it/s]
Adding requests:  48%|████▊     | 493/1024 [00:01<00:01, 405.39it/s]
Adding requests:  52%|█████▏    | 534/1024 [00:01<00:01, 397.45it/s]
Adding requests:  56%|█████▋    | 577/1024 [00:01<00:01, 404.44it/s]
Adding requests:  60%|██████    | 619/1024 [00:01<00:00, 408.00it/s]
Adding requests:  64%|██████▍   | 660/1024 [00:01<00:00, 404.46it/s]
Adding requests:  69%|██████▊   | 703/1024 [00:01<00:00, 410.19it/s]
Adding requests:  73%|███████▎  | 745/1024 [00:01<00:00, 397.31it/s]
Adding requests:  77%|███████▋  | 785/1024 [00:01<00:00, 392.23it/s]
Adding requests:  81%|████████  | 825/1024 [00:02<00:00, 383.62it/s]
Adding requests:  84%|████████▍ | 865/1024 [00:02<00:00, 385.49it/s]
Adding requests:  88%|████████▊ | 904/1024 [00:02<00:00, 376.03it/s]
Adding requests:  92%|█████████▏| 942/1024 [00:02<00:00, 375.73it/s]
Adding requests:  96%|█████████▌| 982/1024 [00:02<00:00, 381.56it/s]
Adding requests: 100%|█████████▉| 1023/1024 [00:02<00:00, 387.23it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 395.89it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/1024 [00:02<24:49,  1.46s/it, est. speed input: 702.75 toks/s, output: 0.69 toks/s]
Processed prompts:   1%|          | 10/1024 [00:03<03:57,  4.28it/s, est. speed input: 3332.76 toks/s, output: 3.25 toks/s]
Processed prompts:   2%|▏         | 18/1024 [00:03<01:57,  8.60it/s, est. speed input: 5706.87 toks/s, output: 5.57 toks/s]
Processed prompts:   3%|▎         | 26/1024 [00:03<01:13, 13.54it/s, est. speed input: 7860.60 toks/s, output: 7.68 toks/s]
Processed prompts:   3%|▎         | 34/1024 [00:03<00:52, 18.89it/s, est. speed input: 9823.74 toks/s, output: 9.59 toks/s]
Processed prompts:   4%|▍         | 42/1024 [00:03<00:40, 24.32it/s, est. speed input: 11619.50 toks/s, output: 11.35 toks/s]
Processed prompts:   5%|▍         | 50/1024 [00:03<00:33, 29.50it/s, est. speed input: 13268.47 toks/s, output: 12.96 toks/s]
Processed prompts:   6%|▌         | 58/1024 [00:04<00:28, 34.14it/s, est. speed input: 14787.55 toks/s, output: 14.44 toks/s]
Processed prompts:   6%|▋         | 66/1024 [00:04<00:25, 38.09it/s, est. speed input: 16191.46 toks/s, output: 15.81 toks/s]
Processed prompts:   7%|▋         | 74/1024 [00:04<00:23, 41.28it/s, est. speed input: 17492.01 toks/s, output: 17.08 toks/s]
Processed prompts:   8%|▊         | 82/1024 [00:04<00:21, 43.80it/s, est. speed input: 18702.56 toks/s, output: 18.26 toks/s]
Processed prompts:   9%|▉         | 90/1024 [00:04<00:20, 45.72it/s, est. speed input: 19831.30 toks/s, output: 19.37 toks/s]
Processed prompts:  10%|▉         | 98/1024 [00:04<00:19, 47.15it/s, est. speed input: 20886.28 toks/s, output: 20.40 toks/s]
Processed prompts:  10%|█         | 106/1024 [00:04<00:19, 48.18it/s, est. speed input: 21873.25 toks/s, output: 21.36 toks/s]
Processed prompts:  11%|█         | 114/1024 [00:05<00:18, 48.92it/s, est. speed input: 22799.46 toks/s, output: 22.27 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:05<00:18, 49.45it/s, est. speed input: 23670.54 toks/s, output: 23.12 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:05<00:17, 49.82it/s, est. speed input: 24490.46 toks/s, output: 23.92 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:05<00:17, 50.07it/s, est. speed input: 25263.58 toks/s, output: 24.67 toks/s]
Processed prompts:  14%|█▍        | 146/1024 [00:05<00:17, 50.26it/s, est. speed input: 25994.81 toks/s, output: 25.39 toks/s]
Processed prompts:  15%|█▌        | 154/1024 [00:05<00:17, 50.41it/s, est. speed input: 26687.78 toks/s, output: 26.06 toks/s]
Processed prompts:  16%|█▌        | 162/1024 [00:06<00:17, 50.47it/s, est. speed input: 27342.97 toks/s, output: 26.70 toks/s]
Processed prompts:  17%|█▋        | 170/1024 [00:06<00:16, 50.55it/s, est. speed input: 27966.83 toks/s, output: 27.31 toks/s]
Processed prompts:  17%|█▋        | 178/1024 [00:06<00:16, 50.64it/s, est. speed input: 28560.58 toks/s, output: 27.89 toks/s]
Processed prompts:  18%|█▊        | 186/1024 [00:06<00:16, 50.66it/s, est. speed input: 29124.05 toks/s, output: 28.44 toks/s]
Processed prompts:  19%|█▉        | 194/1024 [00:06<00:16, 50.67it/s, est. speed input: 29660.93 toks/s, output: 28.97 toks/s]
Processed prompts:  20%|█▉        | 202/1024 [00:06<00:16, 50.65it/s, est. speed input: 30171.85 toks/s, output: 29.46 toks/s]
Processed prompts:  21%|██        | 210/1024 [00:07<00:16, 50.67it/s, est. speed input: 30661.26 toks/s, output: 29.94 toks/s]
Processed prompts:  21%|██▏       | 218/1024 [00:07<00:15, 50.66it/s, est. speed input: 31128.20 toks/s, output: 30.40 toks/s]
Processed prompts:  22%|██▏       | 226/1024 [00:07<00:15, 50.67it/s, est. speed input: 31575.74 toks/s, output: 30.84 toks/s]
Processed prompts:  23%|██▎       | 234/1024 [00:07<00:15, 50.67it/s, est. speed input: 32003.83 toks/s, output: 31.25 toks/s]
Processed prompts:  24%|██▎       | 242/1024 [00:07<00:15, 50.66it/s, est. speed input: 32414.13 toks/s, output: 31.65 toks/s]
Processed prompts:  24%|██▍       | 250/1024 [00:07<00:15, 50.66it/s, est. speed input: 32808.01 toks/s, output: 32.04 toks/s]
Processed prompts:  25%|██▌       | 258/1024 [00:07<00:15, 50.66it/s, est. speed input: 33186.04 toks/s, output: 32.41 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:08<00:14, 50.67it/s, est. speed input: 33549.99 toks/s, output: 32.76 toks/s]
Processed prompts:  27%|██▋       | 274/1024 [00:08<00:14, 50.67it/s, est. speed input: 33899.96 toks/s, output: 33.11 toks/s]
Processed prompts:  28%|██▊       | 282/1024 [00:08<00:14, 50.66it/s, est. speed input: 34236.38 toks/s, output: 33.43 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:08<00:14, 50.62it/s, est. speed input: 34558.79 toks/s, output: 33.75 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:08<00:14, 50.64it/s, est. speed input: 34871.46 toks/s, output: 34.05 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:08<00:14, 50.66it/s, est. speed input: 35173.60 toks/s, output: 34.35 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:09<00:14, 50.66it/s, est. speed input: 35464.39 toks/s, output: 34.63 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:09<00:13, 50.66it/s, est. speed input: 35745.27 toks/s, output: 34.91 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:09<00:13, 50.65it/s, est. speed input: 36016.28 toks/s, output: 35.17 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:09<00:13, 50.65it/s, est. speed input: 36278.70 toks/s, output: 35.43 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:09<00:13, 50.63it/s, est. speed input: 36531.83 toks/s, output: 35.68 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:09<00:13, 50.59it/s, est. speed input: 36775.78 toks/s, output: 35.91 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:10<00:13, 50.56it/s, est. speed input: 37011.97 toks/s, output: 36.14 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:10<00:12, 50.55it/s, est. speed input: 37241.09 toks/s, output: 36.37 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:10<00:12, 50.51it/s, est. speed input: 37462.27 toks/s, output: 36.58 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:10<00:12, 50.50it/s, est. speed input: 37676.98 toks/s, output: 36.79 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:10<00:12, 50.52it/s, est. speed input: 37886.51 toks/s, output: 37.00 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:10<00:12, 50.54it/s, est. speed input: 38089.88 toks/s, output: 37.20 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:10<00:12, 50.50it/s, est. speed input: 38285.96 toks/s, output: 37.39 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:11<00:12, 50.49it/s, est. speed input: 38476.68 toks/s, output: 37.57 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:11<00:11, 50.52it/s, est. speed input: 38663.41 toks/s, output: 37.76 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:11<00:11, 50.49it/s, est. speed input: 38843.18 toks/s, output: 37.93 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:11<00:11, 50.50it/s, est. speed input: 39019.05 toks/s, output: 38.10 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:11<00:11, 50.50it/s, est. speed input: 39190.13 toks/s, output: 38.27 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:11<00:11, 50.47it/s, est. speed input: 39356.01 toks/s, output: 38.43 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:12<00:11, 50.48it/s, est. speed input: 39517.67 toks/s, output: 38.59 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:12<00:10, 50.48it/s, est. speed input: 39675.60 toks/s, output: 38.75 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:12<00:10, 50.50it/s, est. speed input: 39829.81 toks/s, output: 38.90 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:12<00:10, 50.48it/s, est. speed input: 39979.42 toks/s, output: 39.04 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:12<00:10, 50.47it/s, est. speed input: 40124.86 toks/s, output: 39.18 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:12<00:10, 50.45it/s, est. speed input: 40266.61 toks/s, output: 39.32 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:13<00:10, 50.46it/s, est. speed input: 40405.62 toks/s, output: 39.46 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:13<00:09, 50.45it/s, est. speed input: 40540.61 toks/s, output: 39.59 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:13<00:09, 50.46it/s, est. speed input: 40673.09 toks/s, output: 39.72 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:13<00:09, 50.47it/s, est. speed input: 40802.50 toks/s, output: 39.85 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:13<00:09, 50.48it/s, est. speed input: 40929.18 toks/s, output: 39.97 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:13<00:09, 50.50it/s, est. speed input: 41053.13 toks/s, output: 40.09 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:13<00:09, 50.47it/s, est. speed input: 41172.92 toks/s, output: 40.21 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:14<00:08, 50.48it/s, est. speed input: 41291.07 toks/s, output: 40.32 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:14<00:08, 50.49it/s, est. speed input: 41407.00 toks/s, output: 40.44 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:14<00:08, 50.49it/s, est. speed input: 41519.53 toks/s, output: 40.55 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:14<00:08, 50.50it/s, est. speed input: 41630.35 toks/s, output: 40.65 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:14<00:08, 50.52it/s, est. speed input: 41739.09 toks/s, output: 40.76 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:14<00:08, 50.53it/s, est. speed input: 41845.35 toks/s, output: 40.86 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:15<00:08, 50.53it/s, est. speed input: 41949.11 toks/s, output: 40.97 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:15<00:07, 50.53it/s, est. speed input: 42051.01 toks/s, output: 41.07 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:15<00:07, 50.52it/s, est. speed input: 42150.41 toks/s, output: 41.16 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:15<00:07, 50.50it/s, est. speed input: 42247.34 toks/s, output: 41.26 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:15<00:07, 50.50it/s, est. speed input: 42342.59 toks/s, output: 41.35 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:15<00:07, 50.50it/s, est. speed input: 42435.96 toks/s, output: 41.44 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:16<00:07, 50.49it/s, est. speed input: 42527.30 toks/s, output: 41.53 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:16<00:06, 50.46it/s, est. speed input: 42616.40 toks/s, output: 41.62 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:16<00:06, 50.48it/s, est. speed input: 42704.90 toks/s, output: 41.70 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:16<00:06, 50.47it/s, est. speed input: 42790.65 toks/s, output: 41.79 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:16<00:06, 50.48it/s, est. speed input: 42875.58 toks/s, output: 41.87 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:16<00:06, 50.48it/s, est. speed input: 42958.54 toks/s, output: 41.95 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:16<00:06, 50.50it/s, est. speed input: 43040.40 toks/s, output: 42.03 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:17<00:05, 50.49it/s, est. speed input: 43120.44 toks/s, output: 42.11 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:17<00:05, 50.47it/s, est. speed input: 43198.52 toks/s, output: 42.19 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:17<00:05, 50.48it/s, est. speed input: 43275.83 toks/s, output: 42.26 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:18<00:17, 16.07it/s, est. speed input: 40736.42 toks/s, output: 39.78 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:18<00:13, 20.15it/s, est. speed input: 40821.70 toks/s, output: 39.86 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:19<00:10, 24.51it/s, est. speed input: 40905.31 toks/s, output: 39.95 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:19<00:08, 28.88it/s, est. speed input: 40986.97 toks/s, output: 40.03 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:19<00:07, 33.01it/s, est. speed input: 41068.10 toks/s, output: 40.11 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:19<00:06, 36.67it/s, est. speed input: 41147.23 toks/s, output: 40.18 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:19<00:05, 39.75it/s, est. speed input: 41224.98 toks/s, output: 40.26 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:19<00:05, 42.21it/s, est. speed input: 41300.70 toks/s, output: 40.33 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:20<00:04, 44.14it/s, est. speed input: 41375.89 toks/s, output: 40.41 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:20<00:04, 45.61it/s, est. speed input: 41450.02 toks/s, output: 40.48 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:20<00:04, 46.71it/s, est. speed input: 41523.26 toks/s, output: 40.55 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:20<00:04, 47.48it/s, est. speed input: 41594.50 toks/s, output: 40.62 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:20<00:03, 48.03it/s, est. speed input: 41664.73 toks/s, output: 40.69 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:20<00:03, 48.44it/s, est. speed input: 41734.23 toks/s, output: 40.76 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:21<00:03, 48.77it/s, est. speed input: 41803.34 toks/s, output: 40.82 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:21<00:03, 48.98it/s, est. speed input: 41870.95 toks/s, output: 40.89 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:21<00:03, 49.12it/s, est. speed input: 41937.45 toks/s, output: 40.95 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:21<00:02, 49.25it/s, est. speed input: 42003.68 toks/s, output: 41.02 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:21<00:02, 49.30it/s, est. speed input: 42067.90 toks/s, output: 41.08 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:21<00:02, 49.36it/s, est. speed input: 42131.67 toks/s, output: 41.14 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:21<00:02, 49.39it/s, est. speed input: 42194.45 toks/s, output: 41.21 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:22<00:02, 49.41it/s, est. speed input: 42256.02 toks/s, output: 41.27 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:22<00:02, 49.43it/s, est. speed input: 42316.96 toks/s, output: 41.33 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:22<00:01, 49.40it/s, est. speed input: 42376.23 toks/s, output: 41.38 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:22<00:01, 49.39it/s, est. speed input: 42434.71 toks/s, output: 41.44 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:22<00:01, 49.41it/s, est. speed input: 42492.99 toks/s, output: 41.50 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:22<00:01, 49.43it/s, est. speed input: 42550.51 toks/s, output: 41.55 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:23<00:01, 49.43it/s, est. speed input: 42606.95 toks/s, output: 41.61 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:23<00:01, 49.40it/s, est. speed input: 42662.04 toks/s, output: 41.66 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:23<00:00, 49.42it/s, est. speed input: 42717.08 toks/s, output: 41.72 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:23<00:00, 51.04it/s, est. speed input: 42802.31 toks/s, output: 41.80 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:23<00:00, 50.56it/s, est. speed input: 42855.85 toks/s, output: 41.85 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:23<00:00, 50.23it/s, est. speed input: 42908.63 toks/s, output: 41.90 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:24<00:00, 49.99it/s, est. speed input: 42960.52 toks/s, output: 41.95 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:24<00:00, 51.76it/s, est. speed input: 43047.27 toks/s, output: 42.04 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:24<00:00, 51.76it/s, est. speed input: 43300.51 toks/s, output: 42.29 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:24<00:00, 42.29it/s, est. speed input: 43300.51 toks/s, output: 42.29 toks/s]
[rank0]:[W128 05:27:38.992280883 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 366.6s

测试结果:
  Requests/s:   39.88
  Tokens/s:     40881.34
  Total Reqs:   1024
  Elapsed:      25.67s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     40841.46

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:29:38 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:29:39 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=768742) WARNING 01-28 05:31:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=768742) WARNING 01-28 05:32:21 [backends.py:609] Failed to read file <frozen os>
Throughput: 41.24 requests/s, 42269.93 total tokens/s, 41.24 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 05:29:33] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:29:38] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:29:38] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:29:38] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:29:38] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:29:38] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:29:38] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:29:38] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:29:38] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:29:38] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:29:38] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:29:38] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:29:38] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:29:38] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:30:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:30:21] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:30:21] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:30:21] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:30:21] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:30:21] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:30:21] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:30:21] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:30:21] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:30:21] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:30:21] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:30:21] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:30:21] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:30:21] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=768742) [2026-01-28 05:31:21] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=768742) [2026-01-28 05:31:21] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=768742) [2026-01-28 05:31:21] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=768742) [2026-01-28 05:31:21] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=768742) [2026-01-28 05:31:21] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=768742) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=768742) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.41it/s]
(EngineCore_DP0 pid=768742) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.41it/s]
(EngineCore_DP0 pid=768742) 
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=768742) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:03<00:19,  3.32s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:04<00:10,  2.19s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:05<00:05,  1.50s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:08<00:06,  2.20s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:15<00:07,  3.94s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:23<00:05,  5.38s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:24<00:00,  3.93s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:24<00:00,  3.54s/it]
(EngineCore_DP0 pid=768742) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:03,  1.16it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:01<00:02,  1.38it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:02<00:01,  1.16it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:02<00:00,  1.57it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:04<00:00,  1.15s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:04<00:00,  1.02it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 36/2048 [00:00<00:05, 359.27it/s]
Adding requests:   4%|▎         | 75/2048 [00:00<00:05, 371.04it/s]
Adding requests:   6%|▌         | 113/2048 [00:00<00:05, 372.58it/s]
Adding requests:   7%|▋         | 151/2048 [00:00<00:05, 369.65it/s]
Adding requests:   9%|▉         | 188/2048 [00:00<00:05, 369.45it/s]
Adding requests:  11%|█         | 227/2048 [00:00<00:04, 375.28it/s]
Adding requests:  13%|█▎        | 266/2048 [00:00<00:04, 379.38it/s]
Adding requests:  15%|█▍        | 304/2048 [00:00<00:04, 369.47it/s]
Adding requests:  17%|█▋        | 342/2048 [00:00<00:04, 370.78it/s]
Adding requests:  19%|█▊        | 381/2048 [00:01<00:04, 375.19it/s]
Adding requests:  21%|██        | 420/2048 [00:01<00:04, 376.35it/s]
Adding requests:  22%|██▏       | 458/2048 [00:01<00:04, 374.85it/s]
Adding requests:  24%|██▍       | 496/2048 [00:01<00:04, 375.08it/s]
Adding requests:  26%|██▌       | 534/2048 [00:01<00:04, 369.42it/s]
Adding requests:  28%|██▊       | 574/2048 [00:01<00:03, 376.59it/s]
Adding requests:  30%|██▉       | 612/2048 [00:01<00:03, 376.21it/s]
Adding requests:  32%|███▏      | 652/2048 [00:01<00:03, 381.26it/s]
Adding requests:  34%|███▍      | 692/2048 [00:01<00:03, 386.74it/s]
Adding requests:  36%|███▌      | 733/2048 [00:01<00:03, 390.79it/s]
Adding requests:  38%|███▊      | 773/2048 [00:02<00:03, 384.24it/s]
Adding requests:  40%|███▉      | 812/2048 [00:02<00:03, 382.68it/s]
Adding requests:  42%|████▏     | 851/2048 [00:02<00:03, 380.40it/s]
Adding requests:  43%|████▎     | 890/2048 [00:02<00:03, 374.28it/s]
Adding requests:  45%|████▌     | 930/2048 [00:02<00:02, 379.01it/s]
Adding requests:  47%|████▋     | 968/2048 [00:02<00:02, 379.10it/s]
Adding requests:  49%|████▉     | 1007/2048 [00:02<00:02, 380.05it/s]
Adding requests:  51%|█████     | 1048/2048 [00:02<00:02, 387.19it/s]
Adding requests:  53%|█████▎    | 1087/2048 [00:02<00:02, 382.79it/s]
Adding requests:  55%|█████▍    | 1126/2048 [00:02<00:02, 383.02it/s]
Adding requests:  57%|█████▋    | 1169/2048 [00:03<00:02, 396.09it/s]
Adding requests:  59%|█████▉    | 1214/2048 [00:03<00:02, 410.35it/s]
Adding requests:  61%|██████▏   | 1256/2048 [00:03<00:01, 410.89it/s]
Adding requests:  63%|██████▎   | 1299/2048 [00:03<00:01, 414.61it/s]
Adding requests:  66%|██████▌   | 1344/2048 [00:03<00:01, 422.15it/s]
Adding requests:  68%|██████▊   | 1387/2048 [00:03<00:01, 422.31it/s]
Adding requests:  70%|██████▉   | 1430/2048 [00:03<00:01, 421.30it/s]
Adding requests:  72%|███████▏  | 1473/2048 [00:03<00:01, 419.75it/s]
Adding requests:  74%|███████▍  | 1517/2048 [00:03<00:01, 423.18it/s]
Adding requests:  76%|███████▌  | 1560/2048 [00:03<00:01, 421.10it/s]
Adding requests:  78%|███████▊  | 1603/2048 [00:04<00:01, 422.75it/s]
Adding requests:  80%|████████  | 1646/2048 [00:04<00:00, 422.19it/s]
Adding requests:  82%|████████▏ | 1689/2048 [00:04<00:00, 418.12it/s]
Adding requests:  85%|████████▍ | 1731/2048 [00:04<00:00, 418.00it/s]
Adding requests:  87%|████████▋ | 1773/2048 [00:04<00:00, 410.67it/s]
Adding requests:  89%|████████▊ | 1816/2048 [00:04<00:00, 414.81it/s]
Adding requests:  91%|█████████ | 1858/2048 [00:04<00:00, 415.41it/s]
Adding requests:  93%|█████████▎| 1901/2048 [00:04<00:00, 418.14it/s]
Adding requests:  95%|█████████▍| 1943/2048 [00:04<00:00, 414.64it/s]
Adding requests:  97%|█████████▋| 1985/2048 [00:05<00:00, 414.96it/s]
Adding requests:  99%|█████████▉| 2028/2048 [00:05<00:00, 417.13it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 395.27it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/2048 [00:04<1:17:00,  2.26s/it, est. speed input: 453.48 toks/s, output: 0.44 toks/s]
Processed prompts:   1%|          | 18/2048 [00:04<06:46,  4.99it/s, est. speed input: 3809.22 toks/s, output: 3.72 toks/s]
Processed prompts:   2%|▏         | 34/2048 [00:05<03:17, 10.20it/s, est. speed input: 6745.07 toks/s, output: 6.59 toks/s]
Processed prompts:   2%|▏         | 50/2048 [00:05<02:06, 15.84it/s, est. speed input: 9335.22 toks/s, output: 9.12 toks/s]
Processed prompts:   3%|▎         | 66/2048 [00:05<01:31, 21.57it/s, est. speed input: 11638.77 toks/s, output: 11.37 toks/s]
Processed prompts:   4%|▍         | 82/2048 [00:06<01:11, 27.43it/s, est. speed input: 13752.52 toks/s, output: 13.43 toks/s]
Processed prompts:   5%|▍         | 98/2048 [00:06<00:59, 32.91it/s, est. speed input: 15675.32 toks/s, output: 15.31 toks/s]
Processed prompts:   6%|▌         | 114/2048 [00:06<00:51, 37.71it/s, est. speed input: 17428.15 toks/s, output: 17.02 toks/s]
Processed prompts:   6%|▋         | 130/2048 [00:06<00:45, 41.71it/s, est. speed input: 19032.57 toks/s, output: 18.59 toks/s]
Processed prompts:   7%|▋         | 146/2048 [00:07<00:42, 44.90it/s, est. speed input: 20506.20 toks/s, output: 20.03 toks/s]
Processed prompts:   8%|▊         | 162/2048 [00:07<00:39, 47.37it/s, est. speed input: 21865.65 toks/s, output: 21.35 toks/s]
Processed prompts:   9%|▊         | 178/2048 [00:07<00:37, 49.22it/s, est. speed input: 23122.41 toks/s, output: 22.58 toks/s]
Processed prompts:   9%|▉         | 194/2048 [00:08<00:36, 50.58it/s, est. speed input: 24287.59 toks/s, output: 23.72 toks/s]
Processed prompts:  10%|█         | 210/2048 [00:08<00:35, 51.56it/s, est. speed input: 25371.43 toks/s, output: 24.78 toks/s]
Processed prompts:  11%|█         | 226/2048 [00:08<00:34, 52.26it/s, est. speed input: 26381.46 toks/s, output: 25.76 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:09<00:34, 52.77it/s, est. speed input: 27325.86 toks/s, output: 26.69 toks/s]
Processed prompts:  13%|█▎        | 258/2048 [00:09<00:34, 51.93it/s, est. speed input: 28141.19 toks/s, output: 27.48 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:09<00:34, 51.16it/s, est. speed input: 28890.83 toks/s, output: 28.21 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:10<00:34, 50.64it/s, est. speed input: 29592.20 toks/s, output: 28.90 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:10<00:34, 50.28it/s, est. speed input: 30250.00 toks/s, output: 29.54 toks/s]
Processed prompts:  16%|█▌        | 322/2048 [00:10<00:34, 50.02it/s, est. speed input: 30866.97 toks/s, output: 30.14 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:11<00:34, 49.84it/s, est. speed input: 31447.90 toks/s, output: 30.71 toks/s]
Processed prompts:  17%|█▋        | 354/2048 [00:11<00:34, 49.72it/s, est. speed input: 31995.60 toks/s, output: 31.25 toks/s]
Processed prompts:  18%|█▊        | 370/2048 [00:11<00:33, 49.61it/s, est. speed input: 32511.61 toks/s, output: 31.75 toks/s]
Processed prompts:  19%|█▉        | 386/2048 [00:11<00:33, 49.55it/s, est. speed input: 33000.66 toks/s, output: 32.23 toks/s]
Processed prompts:  20%|█▉        | 402/2048 [00:12<00:33, 49.50it/s, est. speed input: 33463.17 toks/s, output: 32.68 toks/s]
Processed prompts:  20%|██        | 418/2048 [00:12<00:32, 49.49it/s, est. speed input: 33903.41 toks/s, output: 33.11 toks/s]
Processed prompts:  21%|██        | 434/2048 [00:12<00:32, 49.46it/s, est. speed input: 34320.50 toks/s, output: 33.52 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:13<00:32, 49.44it/s, est. speed input: 34717.43 toks/s, output: 33.90 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:13<00:32, 49.41it/s, est. speed input: 35094.60 toks/s, output: 34.27 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:13<00:31, 49.56it/s, est. speed input: 35463.47 toks/s, output: 34.63 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:14<00:30, 50.10it/s, est. speed input: 35838.91 toks/s, output: 35.00 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:14<00:30, 50.47it/s, est. speed input: 36198.02 toks/s, output: 35.35 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:14<00:29, 50.74it/s, est. speed input: 36542.39 toks/s, output: 35.69 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:15<00:29, 50.93it/s, est. speed input: 36872.45 toks/s, output: 36.01 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:15<00:29, 51.07it/s, est. speed input: 37189.48 toks/s, output: 36.32 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:15<00:28, 51.17it/s, est. speed input: 37493.87 toks/s, output: 36.62 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:16<00:28, 51.22it/s, est. speed input: 37786.00 toks/s, output: 36.90 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:16<00:28, 51.27it/s, est. speed input: 38067.15 toks/s, output: 37.17 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:16<00:27, 51.29it/s, est. speed input: 38337.52 toks/s, output: 37.44 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:17<00:27, 50.88it/s, est. speed input: 38578.47 toks/s, output: 37.67 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:17<00:27, 50.42it/s, est. speed input: 38801.83 toks/s, output: 37.89 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:17<00:27, 50.09it/s, est. speed input: 39016.85 toks/s, output: 38.10 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:18<00:27, 49.87it/s, est. speed input: 39224.43 toks/s, output: 38.31 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:18<00:26, 49.71it/s, est. speed input: 39424.06 toks/s, output: 38.50 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:18<00:26, 49.60it/s, est. speed input: 39616.97 toks/s, output: 38.69 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:18<00:26, 49.53it/s, est. speed input: 39803.60 toks/s, output: 38.87 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:19<00:26, 49.47it/s, est. speed input: 39983.67 toks/s, output: 39.05 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:19<00:25, 49.44it/s, est. speed input: 40158.19 toks/s, output: 39.22 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:19<00:25, 49.43it/s, est. speed input: 40327.22 toks/s, output: 39.38 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:20<00:25, 49.41it/s, est. speed input: 40490.52 toks/s, output: 39.54 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:20<00:24, 49.39it/s, est. speed input: 40648.49 toks/s, output: 39.70 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:20<00:24, 49.38it/s, est. speed input: 40801.57 toks/s, output: 39.85 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:21<00:24, 49.36it/s, est. speed input: 40949.88 toks/s, output: 39.99 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:21<00:23, 49.36it/s, est. speed input: 41093.94 toks/s, output: 40.13 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:21<00:23, 49.36it/s, est. speed input: 41233.86 toks/s, output: 40.27 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:22<00:23, 49.35it/s, est. speed input: 41369.26 toks/s, output: 40.40 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:22<00:22, 49.35it/s, est. speed input: 41500.96 toks/s, output: 40.53 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:22<00:22, 49.36it/s, est. speed input: 41629.19 toks/s, output: 40.65 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:23<00:22, 49.35it/s, est. speed input: 41753.49 toks/s, output: 40.77 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:23<00:22, 49.34it/s, est. speed input: 41874.23 toks/s, output: 40.89 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:24<00:37, 28.73it/s, est. speed input: 40669.75 toks/s, output: 39.72 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:24<00:32, 32.85it/s, est. speed input: 40797.70 toks/s, output: 39.84 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:25<00:28, 36.51it/s, est. speed input: 40922.57 toks/s, output: 39.96 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:25<00:25, 39.62it/s, est. speed input: 41045.45 toks/s, output: 40.08 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:25<00:23, 42.07it/s, est. speed input: 41162.26 toks/s, output: 40.20 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:26<00:22, 44.01it/s, est. speed input: 41277.76 toks/s, output: 40.31 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:26<00:21, 45.49it/s, est. speed input: 41390.54 toks/s, output: 40.42 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:26<00:20, 46.58it/s, est. speed input: 41500.71 toks/s, output: 40.53 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:27<00:19, 47.36it/s, est. speed input: 41607.85 toks/s, output: 40.63 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:27<00:19, 47.93it/s, est. speed input: 41712.31 toks/s, output: 40.73 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:27<00:18, 48.33it/s, est. speed input: 41814.50 toks/s, output: 40.83 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:28<00:18, 49.44it/s, est. speed input: 41941.45 toks/s, output: 40.96 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:28<00:17, 49.35it/s, est. speed input: 42037.02 toks/s, output: 41.05 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:28<00:17, 49.32it/s, est. speed input: 42131.84 toks/s, output: 41.14 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:29<00:17, 49.30it/s, est. speed input: 42224.34 toks/s, output: 41.23 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:29<00:16, 49.30it/s, est. speed input: 42315.23 toks/s, output: 41.32 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:29<00:16, 49.29it/s, est. speed input: 42403.78 toks/s, output: 41.41 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:30<00:16, 49.29it/s, est. speed input: 42490.71 toks/s, output: 41.49 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:30<00:15, 49.32it/s, est. speed input: 42576.76 toks/s, output: 41.58 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:30<00:15, 49.71it/s, est. speed input: 42672.12 toks/s, output: 41.67 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:31<00:14, 50.85it/s, est. speed input: 42790.45 toks/s, output: 41.79 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:31<00:14, 51.68it/s, est. speed input: 42906.44 toks/s, output: 41.90 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:31<00:13, 52.26it/s, est. speed input: 43020.08 toks/s, output: 42.01 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:31<00:13, 52.69it/s, est. speed input: 43131.74 toks/s, output: 42.12 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:32<00:12, 52.99it/s, est. speed input: 43241.23 toks/s, output: 42.23 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:32<00:12, 53.19it/s, est. speed input: 43348.48 toks/s, output: 42.33 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:32<00:12, 53.32it/s, est. speed input: 43453.49 toks/s, output: 42.44 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:33<00:11, 53.43it/s, est. speed input: 43557.21 toks/s, output: 42.54 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:33<00:11, 53.50it/s, est. speed input: 43658.71 toks/s, output: 42.64 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:33<00:11, 53.55it/s, est. speed input: 43758.61 toks/s, output: 42.73 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:34<00:11, 53.59it/s, est. speed input: 43856.63 toks/s, output: 42.83 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:34<00:10, 53.61it/s, est. speed input: 43952.90 toks/s, output: 42.92 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:34<00:10, 53.62it/s, est. speed input: 44047.52 toks/s, output: 43.02 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:34<00:10, 53.62it/s, est. speed input: 44140.34 toks/s, output: 43.11 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:35<00:09, 53.63it/s, est. speed input: 44231.67 toks/s, output: 43.19 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:35<00:09, 53.62it/s, est. speed input: 44321.26 toks/s, output: 43.28 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:35<00:09, 53.62it/s, est. speed input: 44409.23 toks/s, output: 43.37 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:36<00:08, 53.63it/s, est. speed input: 44496.11 toks/s, output: 43.45 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:36<00:08, 53.60it/s, est. speed input: 44580.87 toks/s, output: 43.54 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:36<00:08, 53.59it/s, est. speed input: 44664.39 toks/s, output: 43.62 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:37<00:08, 53.59it/s, est. speed input: 44746.72 toks/s, output: 43.70 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:37<00:07, 53.57it/s, est. speed input: 44827.37 toks/s, output: 43.78 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:37<00:07, 53.57it/s, est. speed input: 44906.93 toks/s, output: 43.85 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:37<00:07, 53.57it/s, est. speed input: 44985.21 toks/s, output: 43.93 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:38<00:06, 53.36it/s, est. speed input: 45057.84 toks/s, output: 44.00 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:38<00:06, 52.01it/s, est. speed input: 45102.02 toks/s, output: 44.04 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:38<00:06, 51.25it/s, est. speed input: 45148.80 toks/s, output: 44.09 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:39<00:06, 50.82it/s, est. speed input: 45197.10 toks/s, output: 44.14 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:39<00:05, 50.50it/s, est. speed input: 45244.15 toks/s, output: 44.18 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:39<00:05, 50.28it/s, est. speed input: 45290.31 toks/s, output: 44.23 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:40<00:05, 50.14it/s, est. speed input: 45335.99 toks/s, output: 44.27 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:40<00:05, 50.02it/s, est. speed input: 45380.59 toks/s, output: 44.32 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:40<00:04, 49.95it/s, est. speed input: 45424.61 toks/s, output: 44.36 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:41<00:04, 49.89it/s, est. speed input: 45467.76 toks/s, output: 44.40 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:41<00:04, 49.84it/s, est. speed input: 45510.17 toks/s, output: 44.44 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:41<00:03, 49.81it/s, est. speed input: 45551.80 toks/s, output: 44.48 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:42<00:03, 50.60it/s, est. speed input: 45611.65 toks/s, output: 44.54 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:42<00:03, 50.34it/s, est. speed input: 45652.10 toks/s, output: 44.58 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:42<00:02, 50.15it/s, est. speed input: 45691.64 toks/s, output: 44.62 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:43<00:02, 50.03it/s, est. speed input: 45730.86 toks/s, output: 44.66 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:43<00:02, 49.94it/s, est. speed input: 45769.33 toks/s, output: 44.70 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:43<00:01, 49.87it/s, est. speed input: 45807.23 toks/s, output: 44.73 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:44<00:01, 49.82it/s, est. speed input: 45844.51 toks/s, output: 44.77 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:44<00:01, 49.78it/s, est. speed input: 45881.04 toks/s, output: 44.81 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:44<00:00, 49.75it/s, est. speed input: 45917.05 toks/s, output: 44.84 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:44<00:00, 49.73it/s, est. speed input: 45952.48 toks/s, output: 44.88 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:45<00:00, 50.66it/s, est. speed input: 46007.77 toks/s, output: 44.93 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:45<00:00, 50.66it/s, est. speed input: 46324.09 toks/s, output: 45.24 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:45<00:00, 45.24it/s, est. speed input: 46324.09 toks/s, output: 45.24 toks/s]
[rank0]:[W128 05:34:47.665042513 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 450.8s

测试结果:
  Requests/s:   41.24
  Tokens/s:     42269.93
  Total Reqs:   2048
  Elapsed:      49.66s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     42228.69

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuBLASLt [INT32 output]                         │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:37:13 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:37:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=772239) WARNING 01-28 05:38:32 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=772239) WARNING 01-28 05:39:37 [backends.py:609] Failed to read file <frozen os>
Throughput: 44.81 requests/s, 45928.13 total tokens/s, 44.81 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 05:37:11] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:37:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:37:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:37:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:37:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:37:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:37:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:37:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:37:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:37:27] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:37:39] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:37:39] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:37:39] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:39] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:39] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:39] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:39] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:37:39] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:37:39] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:37:39] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:37:39] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:37:39] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:37:39] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=772239) [2026-01-28 05:38:36] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=772239) [2026-01-28 05:38:36] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=772239) [2026-01-28 05:38:36] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=772239) [2026-01-28 05:38:36] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=772239) [2026-01-28 05:38:36] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuBLASLt, symmetric=True
(EngineCore_DP0 pid=772239) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=772239) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.28it/s]
(EngineCore_DP0 pid=772239) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.28it/s]
(EngineCore_DP0 pid=772239) 
(EngineCore_DP0 pid=772239) [rank0]:W0128 05:39:46.927000 772239 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=772239) [rank0]:W0128 05:39:48.124000 772239 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
[cuBLASLt] INFO: INT8 GEMM only supports INT32 output. inner_dtype parameter is ignored, always using int32.
(EngineCore_DP0 pid=772239) [rank0]:W0128 05:39:50.850000 772239 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=772239) [rank0]:W0128 05:39:51.025000 772239 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=772239) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:01<00:18,  1.88s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:04<00:23,  2.57s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:06<00:16,  2.01s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:07<00:12,  1.82s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:08<00:08,  1.48s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:10<00:08,  1.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:15<00:10,  2.62s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:25<00:14,  4.93s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:28<00:08,  4.32s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:31<00:04,  4.06s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:34<00:00,  3.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:34<00:00,  3.15s/it]
(EngineCore_DP0 pid=772239) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:01<00:10,  1.76s/it]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:03<00:09,  1.87s/it]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:04<00:06,  1.52s/it]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:05<00:03,  1.15s/it]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:07<00:02,  1.35s/it]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:07<00:00,  1.05it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:07<00:00,  1.31it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:07<00:00,  1.09s/it]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 35/4096 [00:00<00:11, 349.60it/s]
Adding requests:   2%|▏         | 73/4096 [00:00<00:11, 365.52it/s]
Adding requests:   3%|▎         | 111/4096 [00:00<00:10, 367.32it/s]
Adding requests:   4%|▎         | 149/4096 [00:00<00:10, 368.76it/s]
Adding requests:   5%|▍         | 188/4096 [00:00<00:10, 372.10it/s]
Adding requests:   6%|▌         | 227/4096 [00:00<00:10, 377.04it/s]
Adding requests:   7%|▋         | 267/4096 [00:00<00:10, 382.68it/s]
Adding requests:   7%|▋         | 306/4096 [00:00<00:10, 378.97it/s]
Adding requests:   8%|▊         | 345/4096 [00:00<00:09, 381.43it/s]
Adding requests:   9%|▉         | 385/4096 [00:01<00:09, 385.27it/s]
Adding requests:  10%|█         | 426/4096 [00:01<00:09, 390.05it/s]
Adding requests:  11%|█▏        | 466/4096 [00:01<00:09, 391.43it/s]
Adding requests:  12%|█▏        | 506/4096 [00:01<00:09, 390.25it/s]
Adding requests:  13%|█▎        | 546/4096 [00:01<00:09, 384.14it/s]
Adding requests:  14%|█▍        | 587/4096 [00:01<00:08, 390.99it/s]
Adding requests:  15%|█▌        | 627/4096 [00:01<00:08, 392.83it/s]
Adding requests:  16%|█▋        | 668/4096 [00:01<00:08, 395.97it/s]
Adding requests:  17%|█▋        | 709/4096 [00:01<00:08, 397.70it/s]
Adding requests:  18%|█▊        | 749/4096 [00:01<00:08, 395.20it/s]
Adding requests:  19%|█▉        | 789/4096 [00:02<00:08, 394.56it/s]
Adding requests:  20%|██        | 829/4096 [00:02<00:08, 388.91it/s]
Adding requests:  21%|██        | 869/4096 [00:02<00:08, 391.47it/s]
Adding requests:  22%|██▏       | 910/4096 [00:02<00:08, 396.56it/s]
Adding requests:  23%|██▎       | 950/4096 [00:02<00:08, 392.71it/s]
Adding requests:  24%|██▍       | 991/4096 [00:02<00:07, 396.52it/s]
Adding requests:  25%|██▌       | 1032/4096 [00:02<00:07, 397.18it/s]
Adding requests:  26%|██▌       | 1072/4096 [00:02<00:07, 394.79it/s]
Adding requests:  27%|██▋       | 1113/4096 [00:02<00:07, 397.29it/s]
Adding requests:  28%|██▊       | 1153/4096 [00:02<00:07, 396.35it/s]
Adding requests:  29%|██▉       | 1196/4096 [00:03<00:07, 405.03it/s]
Adding requests:  30%|███       | 1237/4096 [00:03<00:07, 388.77it/s]
Adding requests:  31%|███       | 1277/4096 [00:03<00:07, 389.22it/s]
Adding requests:  32%|███▏      | 1319/4096 [00:03<00:07, 395.57it/s]
Adding requests:  33%|███▎      | 1360/4096 [00:03<00:06, 398.53it/s]
Adding requests:  34%|███▍      | 1402/4096 [00:03<00:06, 403.27it/s]
Adding requests:  35%|███▌      | 1443/4096 [00:03<00:06, 402.93it/s]
Adding requests:  36%|███▋      | 1485/4096 [00:03<00:06, 405.44it/s]
Adding requests:  37%|███▋      | 1526/4096 [00:03<00:06, 403.54it/s]
Adding requests:  38%|███▊      | 1567/4096 [00:03<00:06, 403.68it/s]
Adding requests:  39%|███▉      | 1609/4096 [00:04<00:06, 407.84it/s]
Adding requests:  40%|████      | 1650/4096 [00:04<00:06, 407.56it/s]
Adding requests:  41%|████▏     | 1691/4096 [00:04<00:05, 405.42it/s]
Adding requests:  42%|████▏     | 1733/4096 [00:04<00:05, 408.01it/s]
Adding requests:  43%|████▎     | 1774/4096 [00:04<00:05, 398.89it/s]
Adding requests:  44%|████▍     | 1814/4096 [00:04<00:05, 394.77it/s]
Adding requests:  45%|████▌     | 1854/4096 [00:04<00:05, 388.63it/s]
Adding requests:  46%|████▌     | 1893/4096 [00:04<00:05, 385.15it/s]
Adding requests:  47%|████▋     | 1932/4096 [00:04<00:05, 382.36it/s]
Adding requests:  48%|████▊     | 1971/4096 [00:05<00:05, 381.83it/s]
Adding requests:  49%|████▉     | 2011/4096 [00:05<00:05, 384.86it/s]
Adding requests:  50%|█████     | 2051/4096 [00:05<00:05, 386.53it/s]
Adding requests:  51%|█████     | 2091/4096 [00:05<00:05, 389.78it/s]
Adding requests:  52%|█████▏    | 2130/4096 [00:05<00:05, 384.76it/s]
Adding requests:  53%|█████▎    | 2169/4096 [00:05<00:05, 381.76it/s]
Adding requests:  54%|█████▍    | 2208/4096 [00:05<00:04, 379.56it/s]
Adding requests:  55%|█████▍    | 2247/4096 [00:05<00:04, 380.89it/s]
Adding requests:  56%|█████▌    | 2286/4096 [00:05<00:04, 381.05it/s]
Adding requests:  57%|█████▋    | 2325/4096 [00:05<00:04, 380.80it/s]
Adding requests:  58%|█████▊    | 2364/4096 [00:06<00:04, 380.62it/s]
Adding requests:  59%|█████▊    | 2404/4096 [00:06<00:04, 384.83it/s]
Adding requests:  60%|█████▉    | 2445/4096 [00:06<00:04, 389.75it/s]
Adding requests:  61%|██████    | 2484/4096 [00:06<00:04, 377.32it/s]
Adding requests:  62%|██████▏   | 2524/4096 [00:06<00:04, 382.05it/s]
Adding requests:  63%|██████▎   | 2564/4096 [00:06<00:03, 386.66it/s]
Adding requests:  64%|██████▎   | 2604/4096 [00:06<00:03, 387.85it/s]
Adding requests:  65%|██████▍   | 2645/4096 [00:06<00:03, 391.83it/s]
Adding requests:  66%|██████▌   | 2685/4096 [00:06<00:03, 389.92it/s]
Adding requests:  67%|██████▋   | 2725/4096 [00:06<00:03, 389.26it/s]
Adding requests:  68%|██████▊   | 2765/4096 [00:07<00:03, 391.28it/s]
Adding requests:  68%|██████▊   | 2805/4096 [00:07<00:03, 384.85it/s]
Adding requests:  69%|██████▉   | 2845/4096 [00:07<00:03, 388.52it/s]
Adding requests:  70%|███████   | 2886/4096 [00:07<00:03, 392.80it/s]
Adding requests:  71%|███████▏  | 2926/4096 [00:07<00:03, 389.64it/s]
Adding requests:  72%|███████▏  | 2965/4096 [00:07<00:02, 388.39it/s]
Adding requests:  73%|███████▎  | 3006/4096 [00:07<00:02, 393.75it/s]
Adding requests:  74%|███████▍  | 3046/4096 [00:07<00:02, 392.84it/s]
Adding requests:  75%|███████▌  | 3086/4096 [00:07<00:02, 393.44it/s]
Adding requests:  76%|███████▋  | 3126/4096 [00:08<00:02, 394.19it/s]
Adding requests:  77%|███████▋  | 3166/4096 [00:08<00:02, 389.72it/s]
Adding requests:  78%|███████▊  | 3205/4096 [00:08<00:02, 389.65it/s]
Adding requests:  79%|███████▉  | 3246/4096 [00:08<00:02, 395.48it/s]
Adding requests:  80%|████████  | 3286/4096 [00:08<00:02, 396.25it/s]
Adding requests:  81%|████████  | 3326/4096 [00:08<00:01, 393.75it/s]
Adding requests:  82%|████████▏ | 3367/4096 [00:08<00:01, 395.77it/s]
Adding requests:  83%|████████▎ | 3407/4096 [00:08<00:01, 394.16it/s]
Adding requests:  84%|████████▍ | 3447/4096 [00:08<00:01, 393.69it/s]
Adding requests:  85%|████████▌ | 3487/4096 [00:08<00:01, 392.30it/s]
Adding requests:  86%|████████▌ | 3527/4096 [00:09<00:01, 390.06it/s]
Adding requests:  87%|████████▋ | 3567/4096 [00:09<00:01, 390.92it/s]
Adding requests:  88%|████████▊ | 3607/4096 [00:09<00:01, 391.18it/s]
Adding requests:  89%|████████▉ | 3647/4096 [00:09<00:01, 390.60it/s]
Adding requests:  90%|█████████ | 3687/4096 [00:09<00:01, 392.40it/s]
Adding requests:  91%|█████████ | 3727/4096 [00:09<00:00, 390.89it/s]
Adding requests:  92%|█████████▏| 3767/4096 [00:09<00:00, 393.18it/s]
Adding requests:  93%|█████████▎| 3807/4096 [00:09<00:00, 391.44it/s]
Adding requests:  94%|█████████▍| 3847/4096 [00:09<00:00, 379.59it/s]
Adding requests:  95%|█████████▍| 3886/4096 [00:10<00:01, 120.67it/s]
Adding requests:  96%|█████████▌| 3926/4096 [00:10<00:01, 152.68it/s]
Adding requests:  97%|█████████▋| 3965/4096 [00:10<00:00, 185.94it/s]
Adding requests:  98%|█████████▊| 4004/4096 [00:11<00:00, 219.89it/s]
Adding requests:  99%|█████████▊| 4040/4096 [00:11<00:00, 242.11it/s]
Adding requests: 100%|█████████▉| 4078/4096 [00:11<00:00, 270.38it/s]
Adding requests: 100%|██████████| 4096/4096 [00:11<00:00, 363.50it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/4096 [00:01<45:18,  1.51it/s, est. speed input: 1542.29 toks/s, output: 1.51 toks/s]
Processed prompts:   1%|          | 34/4096 [00:01<03:10, 21.34it/s, est. speed input: 17729.83 toks/s, output: 17.31 toks/s]
Processed prompts:   2%|▏         | 66/4096 [00:02<02:06, 31.97it/s, est. speed input: 25993.73 toks/s, output: 25.38 toks/s]
Processed prompts:   2%|▏         | 98/4096 [00:03<01:44, 38.27it/s, est. speed input: 31006.30 toks/s, output: 30.28 toks/s]
Processed prompts:   3%|▎         | 130/4096 [00:03<01:33, 42.58it/s, est. speed input: 34512.35 toks/s, output: 33.70 toks/s]
Processed prompts:   4%|▍         | 162/4096 [00:04<01:26, 45.54it/s, est. speed input: 37089.82 toks/s, output: 36.22 toks/s]
Processed prompts:   5%|▍         | 194/4096 [00:05<01:21, 47.63it/s, est. speed input: 39072.84 toks/s, output: 38.16 toks/s]
Processed prompts:   6%|▌         | 226/4096 [00:05<01:18, 49.06it/s, est. speed input: 40627.83 toks/s, output: 39.68 toks/s]
Processed prompts:   6%|▋         | 258/4096 [00:06<01:16, 50.04it/s, est. speed input: 41879.80 toks/s, output: 40.90 toks/s]
Processed prompts:   7%|▋         | 290/4096 [00:06<01:15, 50.71it/s, est. speed input: 42908.27 toks/s, output: 41.90 toks/s]
Processed prompts:   8%|▊         | 322/4096 [00:07<01:13, 51.18it/s, est. speed input: 43770.70 toks/s, output: 42.74 toks/s]
Processed prompts:   9%|▊         | 354/4096 [00:08<01:12, 51.50it/s, est. speed input: 44501.08 toks/s, output: 43.46 toks/s]
Processed prompts:   9%|▉         | 386/4096 [00:08<01:11, 51.69it/s, est. speed input: 45124.60 toks/s, output: 44.07 toks/s]
Processed prompts:  10%|█         | 418/4096 [00:09<01:11, 51.42it/s, est. speed input: 45587.89 toks/s, output: 44.52 toks/s]
Processed prompts:  11%|█         | 450/4096 [00:10<01:11, 51.04it/s, est. speed input: 45955.71 toks/s, output: 44.88 toks/s]
Processed prompts:  12%|█▏        | 482/4096 [00:10<01:11, 50.77it/s, est. speed input: 46278.82 toks/s, output: 45.19 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:11<01:10, 50.59it/s, est. speed input: 46566.88 toks/s, output: 45.48 toks/s]
Processed prompts:  13%|█▎        | 546/4096 [00:11<01:09, 50.83it/s, est. speed input: 46883.53 toks/s, output: 45.78 toks/s]
Processed prompts:  14%|█▍        | 578/4096 [00:12<01:08, 51.14it/s, est. speed input: 47189.73 toks/s, output: 46.08 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:13<01:07, 51.35it/s, est. speed input: 47466.65 toks/s, output: 46.35 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:13<01:07, 51.51it/s, est. speed input: 47719.81 toks/s, output: 46.60 toks/s]
Processed prompts:  16%|█▋        | 674/4096 [00:14<01:06, 51.59it/s, est. speed input: 47948.18 toks/s, output: 46.82 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:15<01:05, 51.67it/s, est. speed input: 48160.17 toks/s, output: 47.03 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:15<01:04, 51.73it/s, est. speed input: 48355.53 toks/s, output: 47.22 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:16<01:04, 51.75it/s, est. speed input: 48533.97 toks/s, output: 47.40 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:16<01:03, 51.77it/s, est. speed input: 48699.77 toks/s, output: 47.56 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:17<01:03, 51.57it/s, est. speed input: 48829.66 toks/s, output: 47.69 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:18<01:03, 51.11it/s, est. speed input: 48916.18 toks/s, output: 47.77 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:18<01:02, 50.80it/s, est. speed input: 48996.52 toks/s, output: 47.85 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:19<01:02, 50.58it/s, est. speed input: 49071.69 toks/s, output: 47.92 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:20<01:01, 50.83it/s, est. speed input: 49182.87 toks/s, output: 48.03 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:20<01:00, 51.07it/s, est. speed input: 49293.46 toks/s, output: 48.14 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:21<00:59, 51.17it/s, est. speed input: 49391.91 toks/s, output: 48.23 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:21<00:59, 51.33it/s, est. speed input: 49492.25 toks/s, output: 48.33 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:22<00:58, 51.35it/s, est. speed input: 49578.82 toks/s, output: 48.42 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:23<00:57, 51.40it/s, est. speed input: 49664.19 toks/s, output: 48.50 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:23<00:56, 51.85it/s, est. speed input: 49779.67 toks/s, output: 48.61 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:24<00:56, 51.75it/s, est. speed input: 49855.52 toks/s, output: 48.69 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:24<00:55, 51.68it/s, est. speed input: 49927.21 toks/s, output: 48.76 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:25<00:55, 51.61it/s, est. speed input: 49994.26 toks/s, output: 48.82 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:26<00:55, 51.12it/s, est. speed input: 50023.93 toks/s, output: 48.85 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:26<00:54, 50.76it/s, est. speed input: 50050.57 toks/s, output: 48.88 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:27<00:54, 50.53it/s, est. speed input: 50077.43 toks/s, output: 48.90 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:28<00:53, 50.72it/s, est. speed input: 50128.65 toks/s, output: 48.95 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:28<00:52, 50.84it/s, est. speed input: 50177.14 toks/s, output: 49.00 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:29<00:52, 50.92it/s, est. speed input: 50222.70 toks/s, output: 49.05 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:30<00:51, 50.97it/s, est. speed input: 50266.53 toks/s, output: 49.09 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:30<00:50, 51.00it/s, est. speed input: 50308.29 toks/s, output: 49.13 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:31<00:50, 51.02it/s, est. speed input: 50347.72 toks/s, output: 49.17 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:32<01:07, 37.33it/s, est. speed input: 49203.20 toks/s, output: 48.05 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:33<01:01, 40.59it/s, est. speed input: 49259.19 toks/s, output: 48.10 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:33<00:56, 43.22it/s, est. speed input: 49312.85 toks/s, output: 48.16 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:34<00:53, 45.09it/s, est. speed input: 49350.67 toks/s, output: 48.19 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:35<00:51, 46.38it/s, est. speed input: 49378.95 toks/s, output: 48.22 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:35<00:50, 47.31it/s, est. speed input: 49404.66 toks/s, output: 48.25 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:36<00:48, 48.25it/s, est. speed input: 49446.59 toks/s, output: 48.29 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:37<00:46, 49.38it/s, est. speed input: 49513.36 toks/s, output: 48.35 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:37<00:45, 50.20it/s, est. speed input: 49577.74 toks/s, output: 48.42 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:38<00:43, 51.17it/s, est. speed input: 49660.41 toks/s, output: 48.50 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:38<00:42, 51.47it/s, est. speed input: 49719.63 toks/s, output: 48.55 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:39<00:42, 51.67it/s, est. speed input: 49776.96 toks/s, output: 48.61 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:40<00:41, 51.82it/s, est. speed input: 49832.46 toks/s, output: 48.66 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:40<00:40, 51.91it/s, est. speed input: 49885.84 toks/s, output: 48.72 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:41<00:40, 51.48it/s, est. speed input: 49914.00 toks/s, output: 48.74 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:42<00:40, 50.88it/s, est. speed input: 49926.32 toks/s, output: 48.76 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:42<00:39, 50.46it/s, est. speed input: 49937.97 toks/s, output: 48.77 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:43<00:39, 50.17it/s, est. speed input: 49949.27 toks/s, output: 48.78 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:43<00:39, 49.97it/s, est. speed input: 49960.00 toks/s, output: 48.79 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:44<00:38, 50.21it/s, est. speed input: 49989.08 toks/s, output: 48.82 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:45<00:37, 50.69it/s, est. speed input: 50031.47 toks/s, output: 48.86 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:45<00:36, 51.03it/s, est. speed input: 50072.69 toks/s, output: 48.90 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:46<00:35, 51.68it/s, est. speed input: 50130.33 toks/s, output: 48.96 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:47<00:34, 51.74it/s, est. speed input: 50169.61 toks/s, output: 48.99 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:47<00:33, 51.78it/s, est. speed input: 50207.86 toks/s, output: 49.03 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:48<00:33, 51.80it/s, est. speed input: 50244.51 toks/s, output: 49.07 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:48<00:32, 51.71it/s, est. speed input: 50276.20 toks/s, output: 49.10 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:49<00:32, 51.01it/s, est. speed input: 50280.96 toks/s, output: 49.10 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:50<00:32, 50.52it/s, est. speed input: 50285.18 toks/s, output: 49.11 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:50<00:31, 50.60it/s, est. speed input: 50306.36 toks/s, output: 49.13 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:51<00:31, 50.24it/s, est. speed input: 50310.07 toks/s, output: 49.13 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:52<00:30, 50.00it/s, est. speed input: 50314.04 toks/s, output: 49.13 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:52<00:29, 50.25it/s, est. speed input: 50335.02 toks/s, output: 49.16 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:53<00:29, 50.54it/s, est. speed input: 50360.02 toks/s, output: 49.18 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:54<00:28, 50.76it/s, est. speed input: 50384.56 toks/s, output: 49.20 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:54<00:27, 50.90it/s, est. speed input: 50408.23 toks/s, output: 49.23 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:55<00:26, 50.99it/s, est. speed input: 50431.05 toks/s, output: 49.25 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:55<00:26, 51.05it/s, est. speed input: 50453.56 toks/s, output: 49.27 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:56<00:25, 51.09it/s, est. speed input: 50474.99 toks/s, output: 49.29 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:57<00:24, 51.12it/s, est. speed input: 50496.33 toks/s, output: 49.31 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:57<00:24, 50.83it/s, est. speed input: 50506.01 toks/s, output: 49.32 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:58<00:24, 50.40it/s, est. speed input: 50507.17 toks/s, output: 49.32 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:59<00:23, 50.11it/s, est. speed input: 50508.39 toks/s, output: 49.32 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:59<00:23, 49.90it/s, est. speed input: 50509.39 toks/s, output: 49.33 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [01:00<00:22, 49.81it/s, est. speed input: 50512.49 toks/s, output: 49.33 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [01:01<00:21, 50.10it/s, est. speed input: 50528.08 toks/s, output: 49.34 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [01:01<00:20, 50.30it/s, est. speed input: 50543.12 toks/s, output: 49.36 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [01:02<00:20, 50.45it/s, est. speed input: 50557.99 toks/s, output: 49.37 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [01:02<00:19, 50.56it/s, est. speed input: 50572.76 toks/s, output: 49.39 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [01:03<00:18, 50.62it/s, est. speed input: 50586.84 toks/s, output: 49.40 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [01:04<00:18, 50.68it/s, est. speed input: 50601.03 toks/s, output: 49.42 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [01:05<00:24, 36.54it/s, est. speed input: 49985.18 toks/s, output: 48.81 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [01:06<00:21, 39.82it/s, est. speed input: 50000.52 toks/s, output: 48.83 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [01:06<00:19, 42.29it/s, est. speed input: 50006.47 toks/s, output: 48.83 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [01:07<00:18, 44.21it/s, est. speed input: 50012.56 toks/s, output: 48.84 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [01:08<00:16, 45.66it/s, est. speed input: 50018.52 toks/s, output: 48.85 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [01:08<00:15, 46.74it/s, est. speed input: 50024.33 toks/s, output: 48.85 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [01:09<00:14, 48.10it/s, est. speed input: 50049.45 toks/s, output: 48.88 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [01:10<00:13, 49.59it/s, est. speed input: 50089.66 toks/s, output: 48.92 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:10<00:12, 50.69it/s, est. speed input: 50129.11 toks/s, output: 48.95 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:11<00:11, 51.50it/s, est. speed input: 50168.09 toks/s, output: 48.99 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:11<00:11, 52.07it/s, est. speed input: 50206.12 toks/s, output: 49.03 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:12<00:10, 52.48it/s, est. speed input: 50243.73 toks/s, output: 49.07 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:13<00:09, 51.76it/s, est. speed input: 50253.40 toks/s, output: 49.08 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:13<00:09, 51.05it/s, est. speed input: 50257.02 toks/s, output: 49.08 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:14<00:08, 50.60it/s, est. speed input: 50261.52 toks/s, output: 49.08 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:15<00:08, 50.23it/s, est. speed input: 50263.99 toks/s, output: 49.09 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:15<00:07, 50.40it/s, est. speed input: 50278.80 toks/s, output: 49.10 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:16<00:06, 50.12it/s, est. speed input: 50282.09 toks/s, output: 49.10 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:16<00:06, 49.92it/s, est. speed input: 50285.11 toks/s, output: 49.11 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:17<00:05, 50.54it/s, est. speed input: 50308.91 toks/s, output: 49.13 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:18<00:04, 51.29it/s, est. speed input: 50340.45 toks/s, output: 49.16 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:18<00:04, 51.83it/s, est. speed input: 50371.53 toks/s, output: 49.19 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:19<00:03, 52.21it/s, est. speed input: 50402.12 toks/s, output: 49.22 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:19<00:03, 52.49it/s, est. speed input: 50432.38 toks/s, output: 49.25 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:20<00:02, 52.34it/s, est. speed input: 50453.90 toks/s, output: 49.27 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:21<00:01, 51.44it/s, est. speed input: 50455.36 toks/s, output: 49.27 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:21<00:01, 51.25it/s, est. speed input: 50467.54 toks/s, output: 49.28 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:22<00:00, 51.26it/s, est. speed input: 50483.07 toks/s, output: 49.30 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:22<00:00, 51.26it/s, est. speed input: 50855.14 toks/s, output: 49.66 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:22<00:00, 49.66it/s, est. speed input: 50855.14 toks/s, output: 49.66 toks/s]
[rank0]:[W128 05:43:13.128310032 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 429.2s

测试结果:
  Requests/s:   44.81
  Tokens/s:     45928.13
  Total Reqs:   4096
  Elapsed:      91.41s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     45883.32


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cublaslt/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,13.9240,7143.0106,9.1928
1024,1024,1,128,128,15.3845,15769.1189,8.3201
2048,1024,2,256,128,24.8411,25462.1428,10.3055
4096,1024,4,512,128,39.7541,40747.9441,12.8792
8192,1024,8,1024,128,39.8842,40881.3395,25.6743
16384,1024,16,2048,128,41.2390,42269.9254,49.6618
32768,1024,32,4096,128,44.8079,45928.1321,91.4124

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_4) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_4
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_4

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:44:07 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:44:08 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=775556) WARNING 01-28 05:45:54 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=775556) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=775556) WARNING 01-28 05:47:37 [backends.py:609] Failed to read file <frozen os>
Throughput: 14.84 requests/s, 7611.50 total tokens/s, 14.84 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 05:44:03] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:44:07] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:44:07] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:44:07] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:07] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:07] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:07] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:07] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:07] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:44:07] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:44:07] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:44:07] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:44:07] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:44:07] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:44:34] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:44:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:44:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:44:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:44:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:44:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:44:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:44:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:44:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:44:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 05:45:54.575431508 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:07] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:07] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:07] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:07] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:07] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:07] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=775556) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=775556) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.55s/it]
(EngineCore_DP0 pid=775556) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.55s/it]
(EngineCore_DP0 pid=775556) 
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=775556) [2026-01-28 05:46:42] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=775556) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:01<00:01,  1.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:03<00:00,  1.92s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:03<00:00,  1.82s/it]
(EngineCore_DP0 pid=775556) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  4.61it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  4.61it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  49%|████▉     | 63/128 [00:00<00:00, 621.51it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 637.52it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 634.56it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:53,  2.36it/s, est. speed input: 1209.15 toks/s, output: 2.36 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:32,  3.89it/s, est. speed input: 1816.18 toks/s, output: 3.55 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:16,  7.43it/s, est. speed input: 2980.52 toks/s, output: 5.82 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:12, 10.01it/s, est. speed input: 3794.14 toks/s, output: 7.41 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:10, 11.94it/s, est. speed input: 4408.09 toks/s, output: 8.61 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:01<00:08, 13.30it/s, est. speed input: 4876.97 toks/s, output: 9.53 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:01<00:08, 14.28it/s, est. speed input: 5250.63 toks/s, output: 10.25 toks/s]
Processed prompts:  11%|█         | 14/128 [00:01<00:07, 14.97it/s, est. speed input: 5554.14 toks/s, output: 10.85 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:01<00:07, 15.39it/s, est. speed input: 5798.98 toks/s, output: 11.33 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:07, 15.70it/s, est. speed input: 6005.51 toks/s, output: 11.73 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 15.93it/s, est. speed input: 6183.34 toks/s, output: 12.08 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 16.12it/s, est. speed input: 6339.87 toks/s, output: 12.38 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.23it/s, est. speed input: 6474.34 toks/s, output: 12.65 toks/s]
Processed prompts:  20%|██        | 26/128 [00:02<00:06, 16.32it/s, est. speed input: 6593.36 toks/s, output: 12.88 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:02<00:06, 16.40it/s, est. speed input: 6700.08 toks/s, output: 13.09 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:03<00:18,  5.21it/s, est. speed input: 4907.76 toks/s, output: 9.59 toks/s] 
Processed prompts:  25%|██▌       | 32/128 [00:03<00:14,  6.57it/s, est. speed input: 5040.25 toks/s, output: 9.84 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:03<00:11,  8.01it/s, est. speed input: 5161.28 toks/s, output: 10.08 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:03<00:09,  9.45it/s, est. speed input: 5272.65 toks/s, output: 10.30 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:03<00:08, 10.80it/s, est. speed input: 5375.13 toks/s, output: 10.50 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:03<00:07, 12.01it/s, est. speed input: 5472.24 toks/s, output: 10.69 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:03<00:06, 13.04it/s, est. speed input: 5563.53 toks/s, output: 10.87 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:03<00:06, 13.87it/s, est. speed input: 5649.01 toks/s, output: 11.03 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:04<00:05, 14.53it/s, est. speed input: 5729.92 toks/s, output: 11.19 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:04<00:05, 15.02it/s, est. speed input: 5805.72 toks/s, output: 11.34 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:04<00:05, 15.39it/s, est. speed input: 5877.40 toks/s, output: 11.48 toks/s]
Processed prompts:  41%|████      | 52/128 [00:04<00:04, 15.53it/s, est. speed input: 5940.80 toks/s, output: 11.60 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:04<00:04, 15.62it/s, est. speed input: 6000.01 toks/s, output: 11.72 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:04<00:04, 15.72it/s, est. speed input: 6057.65 toks/s, output: 11.83 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:04<00:04, 15.79it/s, est. speed input: 6112.11 toks/s, output: 11.94 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:04<00:04, 15.84it/s, est. speed input: 6163.86 toks/s, output: 12.04 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:05<00:04, 15.88it/s, est. speed input: 6213.15 toks/s, output: 12.14 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:05<00:04, 15.92it/s, est. speed input: 6260.47 toks/s, output: 12.23 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:05<00:03, 15.92it/s, est. speed input: 6304.82 toks/s, output: 12.31 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:05<00:03, 15.94it/s, est. speed input: 6347.68 toks/s, output: 12.40 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:05<00:03, 15.94it/s, est. speed input: 6388.36 toks/s, output: 12.48 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:05<00:03, 15.93it/s, est. speed input: 6426.73 toks/s, output: 12.55 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:05<00:03, 15.93it/s, est. speed input: 6463.95 toks/s, output: 12.62 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:05<00:03, 15.95it/s, est. speed input: 6499.99 toks/s, output: 12.70 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:06<00:03, 15.97it/s, est. speed input: 6534.71 toks/s, output: 12.76 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:06<00:03, 15.91it/s, est. speed input: 6566.08 toks/s, output: 12.82 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:06<00:02, 15.83it/s, est. speed input: 6595.13 toks/s, output: 12.88 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:06<00:02, 15.74it/s, est. speed input: 6622.08 toks/s, output: 12.93 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:06<00:02, 15.70it/s, est. speed input: 6648.61 toks/s, output: 12.99 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:06<00:02, 15.69it/s, est. speed input: 6674.45 toks/s, output: 13.04 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:06<00:02, 15.69it/s, est. speed input: 6699.55 toks/s, output: 13.09 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:07<00:02, 15.69it/s, est. speed input: 6723.89 toks/s, output: 13.13 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:07<00:02, 15.70it/s, est. speed input: 6747.58 toks/s, output: 13.18 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:07<00:02, 15.70it/s, est. speed input: 6770.29 toks/s, output: 13.22 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:07<00:01, 15.70it/s, est. speed input: 6792.12 toks/s, output: 13.27 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:07<00:01, 15.71it/s, est. speed input: 6813.58 toks/s, output: 13.31 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:07<00:01, 15.68it/s, est. speed input: 6833.21 toks/s, output: 13.35 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:07<00:01, 15.64it/s, est. speed input: 6851.89 toks/s, output: 13.38 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:07<00:01, 15.65it/s, est. speed input: 6870.74 toks/s, output: 13.42 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:08<00:01, 15.68it/s, est. speed input: 6889.66 toks/s, output: 13.46 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:08<00:01, 15.69it/s, est. speed input: 6907.67 toks/s, output: 13.49 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:08<00:01, 15.72it/s, est. speed input: 6925.76 toks/s, output: 13.53 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:08<00:00, 15.70it/s, est. speed input: 6942.35 toks/s, output: 13.56 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:08<00:00, 15.67it/s, est. speed input: 6957.99 toks/s, output: 13.59 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:08<00:00, 15.68it/s, est. speed input: 6973.87 toks/s, output: 13.62 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:08<00:00, 15.67it/s, est. speed input: 6988.93 toks/s, output: 13.65 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:08<00:00, 15.65it/s, est. speed input: 7003.42 toks/s, output: 13.68 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:09<00:00, 15.65it/s, est. speed input: 7017.66 toks/s, output: 13.71 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:09<00:00, 15.67it/s, est. speed input: 7031.97 toks/s, output: 13.73 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 16.02it/s, est. speed input: 7052.49 toks/s, output: 13.77 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 16.02it/s, est. speed input: 7052.49 toks/s, output: 13.77 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 13.77it/s, est. speed input: 7052.49 toks/s, output: 13.77 toks/s]
[rank0]:[W128 05:49:10.153144834 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 369.2s

测试结果:
  Requests/s:   14.84
  Tokens/s:     7611.50
  Total Reqs:   128
  Elapsed:      8.63s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7596.66

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:50:16 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:50:17 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=778538) WARNING 01-28 05:51:35 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=778538) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=778538) WARNING 01-28 05:53:31 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.69 requests/s, 16080.02 total tokens/s, 15.69 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 05:50:14] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:50:16] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:50:16] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:50:16] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:16] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:16] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:16] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:16] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:16] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:50:16] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:50:16] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:50:16] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:50:16] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:50:16] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:50:45] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:50:55] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:50:55] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:50:55] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:55] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:55] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:55] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:55] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:50:55] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:50:55] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:50:55] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:50:55] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:50:55] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:50:55] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 05:51:35.836060874 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=778538) [2026-01-28 05:51:48] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=778538) [2026-01-28 05:51:48] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=778538) [2026-01-28 05:51:48] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=778538) [2026-01-28 05:51:48] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=778538) [2026-01-28 05:51:48] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=778538) [2026-01-28 05:51:48] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=778538) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=778538) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=778538) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=778538) 
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:28] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:28] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:29] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:29] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=778538) [2026-01-28 05:52:31] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=778538) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:02<00:02,  2.34s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:03<00:00,  1.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:03<00:00,  1.81s/it]
(EngineCore_DP0 pid=778538) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.47it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.47it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  27%|██▋       | 34/128 [00:00<00:00, 336.54it/s]
Adding requests:  56%|█████▋    | 72/128 [00:00<00:00, 359.25it/s]
Adding requests:  86%|████████▌ | 110/128 [00:00<00:00, 365.51it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 362.55it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:05, 23.32it/s, est. speed input: 23884.73 toks/s, output: 23.32 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:06, 18.63it/s, est. speed input: 19674.58 toks/s, output: 19.21 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:06, 17.79it/s, est. speed input: 18884.04 toks/s, output: 18.44 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:06, 17.34it/s, est. speed input: 18456.11 toks/s, output: 18.02 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:06, 17.18it/s, est. speed input: 18247.11 toks/s, output: 17.82 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:06, 17.07it/s, est. speed input: 18093.80 toks/s, output: 17.67 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 17.03it/s, est. speed input: 17998.44 toks/s, output: 17.58 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:06, 16.99it/s, est. speed input: 17920.03 toks/s, output: 17.50 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 16.91it/s, est. speed input: 17838.80 toks/s, output: 17.42 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 16.89it/s, est. speed input: 17782.17 toks/s, output: 17.37 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.85it/s, est. speed input: 17728.62 toks/s, output: 17.31 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.74it/s, est. speed input: 17660.29 toks/s, output: 17.25 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:06, 16.65it/s, est. speed input: 17600.53 toks/s, output: 17.19 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.57it/s, est. speed input: 17542.74 toks/s, output: 17.13 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.55it/s, est. speed input: 17501.54 toks/s, output: 17.09 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:01<00:05, 16.52it/s, est. speed input: 17460.70 toks/s, output: 17.05 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 16.44it/s, est. speed input: 17414.09 toks/s, output: 17.01 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.40it/s, est. speed input: 17374.41 toks/s, output: 16.97 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.37it/s, est. speed input: 17338.98 toks/s, output: 16.93 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 16.31it/s, est. speed input: 17299.72 toks/s, output: 16.89 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 16.25it/s, est. speed input: 17262.21 toks/s, output: 16.86 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:05, 16.24it/s, est. speed input: 17232.87 toks/s, output: 16.83 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:04, 16.25it/s, est. speed input: 17208.36 toks/s, output: 16.80 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:02<00:04, 16.27it/s, est. speed input: 17188.14 toks/s, output: 16.79 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 16.23it/s, est. speed input: 17161.46 toks/s, output: 16.76 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 16.24it/s, est. speed input: 17141.94 toks/s, output: 16.74 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.24it/s, est. speed input: 17123.03 toks/s, output: 16.72 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 15.95it/s, est. speed input: 17069.43 toks/s, output: 16.67 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 16.01it/s, est. speed input: 17050.83 toks/s, output: 16.65 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:04, 16.04it/s, est. speed input: 17032.09 toks/s, output: 16.63 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:03, 16.09it/s, est. speed input: 17018.02 toks/s, output: 16.62 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 16.11it/s, est. speed input: 17004.00 toks/s, output: 16.61 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 16.17it/s, est. speed input: 16994.30 toks/s, output: 16.60 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 16.00it/s, est. speed input: 16964.46 toks/s, output: 16.57 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 15.93it/s, est. speed input: 16940.36 toks/s, output: 16.54 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 15.94it/s, est. speed input: 16923.35 toks/s, output: 16.53 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 15.99it/s, est. speed input: 16911.93 toks/s, output: 16.52 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 16.00it/s, est. speed input: 16898.30 toks/s, output: 16.50 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:02, 16.02it/s, est. speed input: 16886.70 toks/s, output: 16.49 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 16.06it/s, est. speed input: 16878.31 toks/s, output: 16.48 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 16.10it/s, est. speed input: 16871.55 toks/s, output: 16.48 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 16.08it/s, est. speed input: 16860.46 toks/s, output: 16.47 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 15.45it/s, est. speed input: 16798.50 toks/s, output: 16.40 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 15.70it/s, est. speed input: 16796.01 toks/s, output: 16.40 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 15.76it/s, est. speed input: 16784.80 toks/s, output: 16.39 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 15.87it/s, est. speed input: 16779.03 toks/s, output: 16.39 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 16.02it/s, est. speed input: 16779.11 toks/s, output: 16.39 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 16.09it/s, est. speed input: 16776.18 toks/s, output: 16.38 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 16.09it/s, est. speed input: 16770.24 toks/s, output: 16.38 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 16.13it/s, est. speed input: 16766.76 toks/s, output: 16.37 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 16.16it/s, est. speed input: 16764.11 toks/s, output: 16.37 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 16.25it/s, est. speed input: 16765.85 toks/s, output: 16.37 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 16.37it/s, est. speed input: 16771.39 toks/s, output: 16.38 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 16.38it/s, est. speed input: 16771.92 toks/s, output: 16.38 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:00, 16.38it/s, est. speed input: 16771.58 toks/s, output: 16.38 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 16.32it/s, est. speed input: 16768.28 toks/s, output: 16.38 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 16.38it/s, est. speed input: 16770.78 toks/s, output: 16.38 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 16.47it/s, est. speed input: 16775.69 toks/s, output: 16.38 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 16.55it/s, est. speed input: 16781.90 toks/s, output: 16.39 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 16.62it/s, est. speed input: 16788.38 toks/s, output: 16.39 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 16.61it/s, est. speed input: 16791.71 toks/s, output: 16.40 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 16.56it/s, est. speed input: 16792.38 toks/s, output: 16.40 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.56it/s, est. speed input: 16794.93 toks/s, output: 16.40 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.56it/s, est. speed input: 16794.93 toks/s, output: 16.40 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.40it/s, est. speed input: 16794.93 toks/s, output: 16.40 toks/s]
[rank0]:[W128 05:54:50.841778680 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 372.3s

测试结果:
  Requests/s:   15.69
  Tokens/s:     16080.02
  Total Reqs:   128
  Elapsed:      8.16s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16064.34

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 05:56:32 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 05:56:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=781731) WARNING 01-28 05:57:48 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=781731) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=781731) WARNING 01-28 05:59:40 [backends.py:609] Failed to read file <frozen os>
Throughput: 30.71 requests/s, 31475.63 total tokens/s, 30.71 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 05:56:21] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:56:32] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:56:32] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:56:32] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:56:32] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:56:32] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:56:32] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:56:32] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:56:32] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:56:32] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:56:32] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:56:32] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:56:32] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:56:32] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 05:56:53] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 05:57:12] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 05:57:12] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 05:57:12] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:57:12] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:57:12] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:57:12] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:57:12] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 05:57:12] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 05:57:12] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 05:57:12] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 05:57:12] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 05:57:12] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 05:57:12] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 05:57:48.315584796 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=781731) [2026-01-28 05:57:54] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=781731) [2026-01-28 05:57:54] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=781731) [2026-01-28 05:57:54] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=781731) [2026-01-28 05:57:54] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=781731) [2026-01-28 05:57:54] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=781731) [2026-01-28 05:57:54] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=781731) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=781731) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.43it/s]
(EngineCore_DP0 pid=781731) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.43it/s]
(EngineCore_DP0 pid=781731) 
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=781731) [2026-01-28 05:59:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=781731) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:03<00:06,  3.45s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:05<00:02,  2.43s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:08<00:00,  2.74s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:08<00:00,  2.76s/it]
(EngineCore_DP0 pid=781731) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:04<00:04,  4.18s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:06<00:00,  3.02s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 37/256 [00:00<00:00, 364.41it/s]
Adding requests:  30%|██▉       | 76/256 [00:00<00:00, 379.19it/s]
Adding requests:  45%|████▍     | 114/256 [00:00<00:00, 368.04it/s]
Adding requests:  59%|█████▉    | 152/256 [00:00<00:00, 371.33it/s]
Adding requests:  74%|███████▍  | 190/256 [00:00<00:00, 374.40it/s]
Adding requests:  89%|████████▉ | 228/256 [00:00<00:00, 373.70it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 372.59it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   4%|▍         | 10/256 [00:00<00:02, 86.11it/s, est. speed input: 88195.43 toks/s, output: 86.12 toks/s]
Processed prompts:   7%|▋         | 19/256 [00:00<00:04, 50.89it/s, est. speed input: 55708.43 toks/s, output: 54.40 toks/s]
Processed prompts:  10%|▉         | 25/256 [00:00<00:05, 43.64it/s, est. speed input: 48919.87 toks/s, output: 47.77 toks/s]
Processed prompts:  12%|█▏        | 30/256 [00:00<00:06, 37.29it/s, est. speed input: 43617.15 toks/s, output: 42.59 toks/s]
Processed prompts:  13%|█▎        | 34/256 [00:00<00:06, 36.52it/s, est. speed input: 42424.50 toks/s, output: 41.43 toks/s]
Processed prompts:  15%|█▍        | 38/256 [00:00<00:06, 35.75it/s, est. speed input: 41437.57 toks/s, output: 40.47 toks/s]
Processed prompts:  16%|█▋        | 42/256 [00:01<00:06, 35.26it/s, est. speed input: 40701.69 toks/s, output: 39.75 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:01<00:06, 34.55it/s, est. speed input: 39973.38 toks/s, output: 39.04 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:01<00:06, 34.21it/s, est. speed input: 39439.84 toks/s, output: 38.51 toks/s]
Processed prompts:  21%|██        | 54/256 [00:01<00:05, 33.78it/s, est. speed input: 38934.10 toks/s, output: 38.02 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:05, 33.49it/s, est. speed input: 38512.94 toks/s, output: 37.61 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 33.40it/s, est. speed input: 38183.79 toks/s, output: 37.29 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 33.44it/s, est. speed input: 37925.85 toks/s, output: 37.04 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 33.45it/s, est. speed input: 37697.88 toks/s, output: 36.81 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:02<00:05, 33.36it/s, est. speed input: 37473.03 toks/s, output: 36.59 toks/s]
Processed prompts:  30%|███       | 78/256 [00:02<00:05, 33.33it/s, est. speed input: 37281.95 toks/s, output: 36.41 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:02<00:05, 33.33it/s, est. speed input: 37115.41 toks/s, output: 36.25 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:05, 33.36it/s, est. speed input: 36970.86 toks/s, output: 36.10 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:04, 33.22it/s, est. speed input: 36811.63 toks/s, output: 35.95 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:04, 33.31it/s, est. speed input: 36697.11 toks/s, output: 35.84 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 33.31it/s, est. speed input: 36583.83 toks/s, output: 35.73 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 33.40it/s, est. speed input: 36494.14 toks/s, output: 35.64 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:02<00:04, 33.34it/s, est. speed input: 36393.82 toks/s, output: 35.54 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:03<00:04, 33.34it/s, est. speed input: 36306.28 toks/s, output: 35.46 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:03<00:04, 33.40it/s, est. speed input: 36233.96 toks/s, output: 35.38 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:03<00:04, 33.38it/s, est. speed input: 36157.95 toks/s, output: 35.31 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:03<00:04, 33.44it/s, est. speed input: 36097.91 toks/s, output: 35.25 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:03<00:03, 33.31it/s, est. speed input: 36019.80 toks/s, output: 35.18 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:03<00:03, 33.29it/s, est. speed input: 35955.57 toks/s, output: 35.11 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:03<00:03, 32.89it/s, est. speed input: 35850.58 toks/s, output: 35.01 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:03<00:03, 32.53it/s, est. speed input: 35744.20 toks/s, output: 34.91 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:04<00:03, 32.19it/s, est. speed input: 35631.68 toks/s, output: 34.80 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:04<00:03, 32.14it/s, est. speed input: 35548.53 toks/s, output: 34.71 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:04<00:03, 32.15it/s, est. speed input: 35472.64 toks/s, output: 34.64 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:04<00:03, 32.12it/s, est. speed input: 35399.06 toks/s, output: 34.57 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:04<00:03, 32.12it/s, est. speed input: 35331.41 toks/s, output: 34.50 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:04<00:02, 32.10it/s, est. speed input: 35264.20 toks/s, output: 34.44 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:04<00:02, 32.05it/s, est. speed input: 35197.74 toks/s, output: 34.37 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:04<00:02, 32.02it/s, est. speed input: 35135.29 toks/s, output: 34.31 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:05<00:02, 31.85it/s, est. speed input: 35062.33 toks/s, output: 34.24 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:05<00:02, 31.83it/s, est. speed input: 35001.12 toks/s, output: 34.18 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:05<00:02, 31.87it/s, est. speed input: 34948.01 toks/s, output: 34.13 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:05<00:02, 31.95it/s, est. speed input: 34901.37 toks/s, output: 34.08 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:05<00:02, 31.95it/s, est. speed input: 34852.26 toks/s, output: 34.04 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:05<00:01, 31.98it/s, est. speed input: 34808.02 toks/s, output: 33.99 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:05<00:01, 32.05it/s, est. speed input: 34769.44 toks/s, output: 33.95 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:05<00:01, 32.12it/s, est. speed input: 34733.72 toks/s, output: 33.92 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:06<00:01, 30.86it/s, est. speed input: 34599.76 toks/s, output: 33.79 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:06<00:01, 31.03it/s, est. speed input: 34550.58 toks/s, output: 33.74 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:06<00:01, 31.31it/s, est. speed input: 34514.98 toks/s, output: 33.71 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:06<00:01, 31.44it/s, est. speed input: 34476.27 toks/s, output: 33.67 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:06<00:01, 31.49it/s, est. speed input: 34435.17 toks/s, output: 33.63 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:06<00:00, 31.62it/s, est. speed input: 34402.82 toks/s, output: 33.60 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:06<00:00, 31.70it/s, est. speed input: 34371.01 toks/s, output: 33.57 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:06<00:00, 31.74it/s, est. speed input: 34339.06 toks/s, output: 33.53 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:07<00:00, 31.68it/s, est. speed input: 34302.34 toks/s, output: 33.50 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:07<00:00, 32.03it/s, est. speed input: 34291.92 toks/s, output: 33.49 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:07<00:00, 32.39it/s, est. speed input: 34288.23 toks/s, output: 33.48 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:07<00:00, 32.64it/s, est. speed input: 34284.19 toks/s, output: 33.48 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:07<00:00, 32.81it/s, est. speed input: 34279.73 toks/s, output: 33.48 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 32.81it/s, est. speed input: 34276.60 toks/s, output: 33.47 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 33.47it/s, est. speed input: 34276.60 toks/s, output: 33.47 toks/s]
[rank0]:[W128 06:01:04.346137635 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 389.0s

测试结果:
  Requests/s:   30.71
  Tokens/s:     31475.63
  Total Reqs:   256
  Elapsed:      8.34s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     31444.93

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:03:17 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:03:18 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=785382) WARNING 01-28 06:04:22 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=785382) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=785382) WARNING 01-28 06:06:48 [backends.py:609] Failed to read file <frozen os>
Throughput: 61.50 requests/s, 63032.98 total tokens/s, 61.50 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 06:03:10] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:03:17] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:03:17] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:03:17] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:17] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:17] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:17] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:17] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:17] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:03:17] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:03:17] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:03:17] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:03:17] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:03:17] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:03:31] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:03:40] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:03:40] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:03:40] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:40] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:40] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:40] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:40] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:03:40] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:03:40] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:03:40] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:03:40] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:03:40] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:03:40] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=785382) [2026-01-28 06:04:35] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=785382) [2026-01-28 06:04:35] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=785382) [2026-01-28 06:04:35] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=785382) [2026-01-28 06:04:35] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=785382) [2026-01-28 06:04:35] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=785382) [2026-01-28 06:04:35] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=785382) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=785382) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.44it/s]
(EngineCore_DP0 pid=785382) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.44it/s]
(EngineCore_DP0 pid=785382) 
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:28] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:29] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:29] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:29] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:29] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=785382) [2026-01-28 06:05:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=785382) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:01<00:03,  1.06s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:04<00:04,  2.44s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:08<00:03,  3.19s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:11<00:00,  3.28s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:11<00:00,  2.99s/it]
(EngineCore_DP0 pid=785382) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:01<00:02,  1.22s/it]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:02<00:01,  1.26s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:03<00:00,  1.19s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:03<00:00,  1.21s/it]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 351.25it/s]
Adding requests:  14%|█▍        | 74/512 [00:00<00:01, 366.57it/s]
Adding requests:  22%|██▏       | 112/512 [00:00<00:01, 370.49it/s]
Adding requests:  29%|██▉       | 150/512 [00:00<00:00, 369.85it/s]
Adding requests:  37%|███▋      | 187/512 [00:00<00:00, 367.40it/s]
Adding requests:  44%|████▍     | 225/512 [00:00<00:00, 368.86it/s]
Adding requests:  51%|█████▏    | 263/512 [00:00<00:00, 370.06it/s]
Adding requests:  59%|█████▉    | 301/512 [00:00<00:00, 361.93it/s]
Adding requests:  66%|██████▌   | 339/512 [00:00<00:00, 364.50it/s]
Adding requests:  74%|███████▎  | 377/512 [00:01<00:00, 367.74it/s]
Adding requests:  81%|████████  | 414/512 [00:01<00:00, 367.96it/s]
Adding requests:  88%|████████▊ | 451/512 [00:01<00:00, 366.83it/s]
Adding requests:  95%|█████████▌| 488/512 [00:01<00:00, 355.18it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 363.59it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 62/512 [00:00<00:00, 581.22it/s, est. speed input: 595307.02 toks/s, output: 581.26 toks/s]
Processed prompts:  24%|██▎       | 121/512 [00:00<00:03, 111.02it/s, est. speed input: 129828.76 toks/s, output: 126.79 toks/s]
Processed prompts:  29%|██▉       | 150/512 [00:01<00:04, 89.35it/s, est. speed input: 107003.82 toks/s, output: 104.49 toks/s] 
Processed prompts:  33%|███▎      | 168/512 [00:01<00:04, 85.88it/s, est. speed input: 102583.43 toks/s, output: 100.18 toks/s]
Processed prompts:  36%|███▌      | 182/512 [00:01<00:04, 78.80it/s, est. speed input: 97095.15 toks/s, output: 94.82 toks/s]  
Processed prompts:  38%|███▊      | 193/512 [00:02<00:03, 80.60it/s, est. speed input: 96835.72 toks/s, output: 94.57 toks/s]
Processed prompts:  40%|███▉      | 204/512 [00:02<00:04, 75.74it/s, est. speed input: 94018.35 toks/s, output: 91.81 toks/s]
Processed prompts:  42%|████▏     | 213/512 [00:02<00:03, 75.46it/s, est. speed input: 93090.13 toks/s, output: 90.91 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:02<00:04, 68.07it/s, est. speed input: 90076.91 toks/s, output: 87.96 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:02<00:04, 67.77it/s, est. speed input: 89087.40 toks/s, output: 87.00 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:02<00:04, 67.45it/s, est. speed input: 88168.56 toks/s, output: 86.10 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:02<00:03, 67.06it/s, est. speed input: 87297.92 toks/s, output: 85.25 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:03<00:03, 66.84it/s, est. speed input: 86515.89 toks/s, output: 84.49 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:03<00:03, 66.67it/s, est. speed input: 85792.32 toks/s, output: 83.78 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:03<00:03, 66.46it/s, est. speed input: 85109.15 toks/s, output: 83.11 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:03<00:03, 66.20it/s, est. speed input: 84459.20 toks/s, output: 82.48 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:03<00:03, 66.26it/s, est. speed input: 83890.34 toks/s, output: 81.92 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:03<00:03, 66.12it/s, est. speed input: 83334.93 toks/s, output: 81.38 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:03<00:03, 66.05it/s, est. speed input: 82818.99 toks/s, output: 80.88 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:03<00:03, 66.14it/s, est. speed input: 82353.75 toks/s, output: 80.42 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:03<00:02, 66.03it/s, est. speed input: 81894.72 toks/s, output: 79.97 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:04<00:02, 66.04it/s, est. speed input: 81473.18 toks/s, output: 79.56 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:04<00:02, 66.10it/s, est. speed input: 81083.45 toks/s, output: 79.18 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:04<00:02, 65.44it/s, est. speed input: 80633.16 toks/s, output: 78.74 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:04<00:02, 65.53it/s, est. speed input: 80270.85 toks/s, output: 78.39 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:04<00:02, 65.60it/s, est. speed input: 79928.01 toks/s, output: 78.05 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:04<00:02, 65.92it/s, est. speed input: 79630.64 toks/s, output: 77.76 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:04<00:02, 66.09it/s, est. speed input: 79343.15 toks/s, output: 77.48 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:04<00:01, 66.11it/s, est. speed input: 79060.06 toks/s, output: 77.21 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:05<00:01, 66.04it/s, est. speed input: 78781.83 toks/s, output: 76.94 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:05<00:01, 66.07it/s, est. speed input: 78524.44 toks/s, output: 76.68 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:05<00:01, 66.07it/s, est. speed input: 78276.13 toks/s, output: 76.44 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:05<00:01, 66.07it/s, est. speed input: 78039.63 toks/s, output: 76.21 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:05<00:01, 66.11it/s, est. speed input: 77816.31 toks/s, output: 75.99 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:05<00:01, 65.96it/s, est. speed input: 77588.06 toks/s, output: 75.77 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:05<00:01, 65.91it/s, est. speed input: 77374.01 toks/s, output: 75.56 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:05<00:00, 66.05it/s, est. speed input: 77182.46 toks/s, output: 75.37 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:06<00:00, 65.51it/s, est. speed input: 76948.53 toks/s, output: 75.14 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:06<00:00, 65.29it/s, est. speed input: 76736.17 toks/s, output: 74.94 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:06<00:00, 65.02it/s, est. speed input: 76522.77 toks/s, output: 74.73 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:06<00:00, 64.17it/s, est. speed input: 76267.57 toks/s, output: 74.48 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:06<00:00, 64.20it/s, est. speed input: 76068.79 toks/s, output: 74.29 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:06<00:00, 64.40it/s, est. speed input: 75890.24 toks/s, output: 74.11 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:06<00:00, 64.43it/s, est. speed input: 75710.12 toks/s, output: 73.94 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:06<00:00, 64.14it/s, est. speed input: 75514.84 toks/s, output: 73.74 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:06<00:00, 64.14it/s, est. speed input: 75808.87 toks/s, output: 74.03 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:06<00:00, 74.03it/s, est. speed input: 75808.87 toks/s, output: 74.03 toks/s]
[rank0]:[W128 06:08:50.404628228 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 476.2s

测试结果:
  Requests/s:   61.50
  Tokens/s:     63032.98
  Total Reqs:   512
  Elapsed:      8.33s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     62971.48

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:11:02 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:11:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=789856) WARNING 01-28 06:12:24 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=789856) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=789856) WARNING 01-28 06:14:01 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.51 requests/s, 52793.26 total tokens/s, 51.51 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 06:10:52] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:11:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:11:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:11:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:11:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:11:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:11:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:11:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:11:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:11:32] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:11:35] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:11:35] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:11:35] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:35] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:35] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:35] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:35] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:11:35] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:11:35] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:11:35] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:11:35] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:11:35] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:11:35] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=789856) [2026-01-28 06:12:32] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=789856) [2026-01-28 06:12:32] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=789856) [2026-01-28 06:12:32] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=789856) [2026-01-28 06:12:32] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=789856) [2026-01-28 06:12:32] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=789856) [2026-01-28 06:12:32] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=789856) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=789856) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=789856) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=789856) 
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:26] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:26] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:26] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:26] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=789856) [2026-01-28 06:13:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=789856) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:03<00:13,  3.32s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:10<00:16,  5.49s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:18<00:13,  6.66s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:22<00:05,  5.67s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:29<00:00,  6.02s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:29<00:00,  5.84s/it]
(EngineCore_DP0 pid=789856) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:01<00:05,  1.77s/it]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:02<00:01,  1.07it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:03<00:01,  1.05s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:04<00:00,  1.05s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:04<00:00,  1.09s/it]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 33/1024 [00:00<00:03, 324.49it/s]
Adding requests:   7%|▋         | 70/1024 [00:00<00:02, 346.67it/s]
Adding requests:  10%|█         | 107/1024 [00:00<00:02, 355.71it/s]
Adding requests:  14%|█▍        | 144/1024 [00:00<00:02, 357.36it/s]
Adding requests:  18%|█▊        | 180/1024 [00:00<00:02, 357.21it/s]
Adding requests:  21%|██        | 217/1024 [00:00<00:02, 358.63it/s]
Adding requests:  25%|██▌       | 256/1024 [00:00<00:02, 365.52it/s]
Adding requests:  29%|██▊       | 294/1024 [00:00<00:01, 367.88it/s]
Adding requests:  32%|███▏      | 331/1024 [00:00<00:01, 366.38it/s]
Adding requests:  36%|███▌      | 369/1024 [00:01<00:01, 368.26it/s]
Adding requests:  40%|███▉      | 407/1024 [00:01<00:01, 369.22it/s]
Adding requests:  43%|████▎     | 444/1024 [00:01<00:01, 366.28it/s]
Adding requests:  47%|████▋     | 483/1024 [00:01<00:01, 371.15it/s]
Adding requests:  51%|█████     | 521/1024 [00:01<00:01, 364.13it/s]
Adding requests:  54%|█████▍    | 558/1024 [00:01<00:01, 359.57it/s]
Adding requests:  58%|█████▊    | 596/1024 [00:01<00:01, 364.53it/s]
Adding requests:  62%|██████▏   | 634/1024 [00:01<00:01, 367.69it/s]
Adding requests:  66%|██████▌   | 673/1024 [00:01<00:00, 373.63it/s]
Adding requests:  70%|██████▉   | 713/1024 [00:01<00:00, 381.08it/s]
Adding requests:  73%|███████▎  | 752/1024 [00:02<00:00, 377.96it/s]
Adding requests:  77%|███████▋  | 790/1024 [00:02<00:00, 375.44it/s]
Adding requests:  81%|████████  | 828/1024 [00:02<00:00, 369.29it/s]
Adding requests:  85%|████████▍ | 867/1024 [00:02<00:00, 372.56it/s]
Adding requests:  88%|████████▊ | 905/1024 [00:02<00:00, 371.81it/s]
Adding requests:  92%|█████████▏| 943/1024 [00:02<00:00, 369.28it/s]
Adding requests:  96%|█████████▌| 981/1024 [00:02<00:00, 371.77it/s]
Adding requests: 100%|█████████▉| 1019/1024 [00:02<00:00, 373.20it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 367.78it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/1024 [00:01<13:26,  1.27it/s, est. speed input: 1298.09 toks/s, output: 1.27 toks/s]
Processed prompts:   1%|          | 10/1024 [00:01<02:12,  7.64it/s, est. speed input: 6013.25 toks/s, output: 5.87 toks/s]
Processed prompts:   2%|▏         | 18/1024 [00:01<01:07, 14.81it/s, est. speed input: 10090.25 toks/s, output: 9.85 toks/s]
Processed prompts:   3%|▎         | 26/1024 [00:01<00:44, 22.40it/s, est. speed input: 13651.07 toks/s, output: 13.33 toks/s]
Processed prompts:   3%|▎         | 34/1024 [00:02<00:33, 29.93it/s, est. speed input: 16783.61 toks/s, output: 16.39 toks/s]
Processed prompts:   4%|▍         | 42/1024 [00:02<00:26, 37.00it/s, est. speed input: 19566.57 toks/s, output: 19.11 toks/s]
Processed prompts:   5%|▍         | 50/1024 [00:02<00:22, 43.22it/s, est. speed input: 22052.23 toks/s, output: 21.54 toks/s]
Processed prompts:   6%|▌         | 58/1024 [00:02<00:19, 48.46it/s, est. speed input: 24288.73 toks/s, output: 23.72 toks/s]
Processed prompts:   6%|▋         | 66/1024 [00:02<00:18, 52.61it/s, est. speed input: 26304.97 toks/s, output: 25.69 toks/s]
Processed prompts:   7%|▋         | 74/1024 [00:02<00:17, 55.80it/s, est. speed input: 28134.24 toks/s, output: 27.47 toks/s]
Processed prompts:   8%|▊         | 82/1024 [00:02<00:16, 58.23it/s, est. speed input: 29804.05 toks/s, output: 29.11 toks/s]
Processed prompts:   9%|▉         | 90/1024 [00:02<00:15, 60.04it/s, est. speed input: 31334.72 toks/s, output: 30.60 toks/s]
Processed prompts:  10%|▉         | 98/1024 [00:03<00:15, 61.37it/s, est. speed input: 32742.55 toks/s, output: 31.97 toks/s]
Processed prompts:  10%|█         | 106/1024 [00:03<00:14, 62.33it/s, est. speed input: 34041.14 toks/s, output: 33.24 toks/s]
Processed prompts:  11%|█         | 114/1024 [00:03<00:14, 63.01it/s, est. speed input: 35242.33 toks/s, output: 34.42 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:03<00:14, 63.44it/s, est. speed input: 36353.44 toks/s, output: 35.50 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:03<00:14, 63.75it/s, est. speed input: 37387.50 toks/s, output: 36.51 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:03<00:13, 63.99it/s, est. speed input: 38353.25 toks/s, output: 37.45 toks/s]
Processed prompts:  14%|█▍        | 146/1024 [00:03<00:13, 64.03it/s, est. speed input: 39247.77 toks/s, output: 38.33 toks/s]
Processed prompts:  15%|█▌        | 154/1024 [00:03<00:13, 64.20it/s, est. speed input: 40094.89 toks/s, output: 39.15 toks/s]
Processed prompts:  16%|█▌        | 162/1024 [00:04<00:13, 64.18it/s, est. speed input: 40881.15 toks/s, output: 39.92 toks/s]
Processed prompts:  17%|█▋        | 170/1024 [00:04<00:13, 64.24it/s, est. speed input: 41625.21 toks/s, output: 40.65 toks/s]
Processed prompts:  17%|█▋        | 178/1024 [00:04<00:13, 64.34it/s, est. speed input: 42329.84 toks/s, output: 41.34 toks/s]
Processed prompts:  18%|█▊        | 186/1024 [00:04<00:13, 64.38it/s, est. speed input: 42993.68 toks/s, output: 41.99 toks/s]
Processed prompts:  19%|█▉        | 194/1024 [00:04<00:12, 64.37it/s, est. speed input: 43618.75 toks/s, output: 42.60 toks/s]
Processed prompts:  20%|█▉        | 202/1024 [00:04<00:12, 64.42it/s, est. speed input: 44214.17 toks/s, output: 43.18 toks/s]
Processed prompts:  21%|██        | 210/1024 [00:04<00:12, 64.43it/s, est. speed input: 44777.35 toks/s, output: 43.73 toks/s]
Processed prompts:  21%|██▏       | 218/1024 [00:04<00:12, 64.45it/s, est. speed input: 45312.63 toks/s, output: 44.25 toks/s]
Processed prompts:  22%|██▏       | 226/1024 [00:05<00:12, 64.40it/s, est. speed input: 45818.04 toks/s, output: 44.74 toks/s]
Processed prompts:  23%|██▎       | 234/1024 [00:05<00:12, 64.39it/s, est. speed input: 46300.88 toks/s, output: 45.22 toks/s]
Processed prompts:  24%|██▎       | 242/1024 [00:05<00:12, 64.42it/s, est. speed input: 46762.87 toks/s, output: 45.67 toks/s]
Processed prompts:  24%|██▍       | 250/1024 [00:05<00:12, 64.43it/s, est. speed input: 47203.25 toks/s, output: 46.10 toks/s]
Processed prompts:  25%|██▌       | 258/1024 [00:05<00:11, 64.47it/s, est. speed input: 47625.31 toks/s, output: 46.51 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:05<00:11, 64.46it/s, est. speed input: 48027.29 toks/s, output: 46.90 toks/s]
Processed prompts:  27%|██▋       | 274/1024 [00:05<00:11, 64.44it/s, est. speed input: 48411.16 toks/s, output: 47.28 toks/s]
Processed prompts:  28%|██▊       | 282/1024 [00:05<00:11, 64.43it/s, est. speed input: 48779.26 toks/s, output: 47.64 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:06<00:11, 64.40it/s, est. speed input: 49131.20 toks/s, output: 47.98 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:06<00:11, 64.40it/s, est. speed input: 49469.55 toks/s, output: 48.31 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:06<00:11, 64.37it/s, est. speed input: 49793.28 toks/s, output: 48.63 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:06<00:11, 64.38it/s, est. speed input: 50106.10 toks/s, output: 48.93 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:06<00:10, 64.38it/s, est. speed input: 50407.36 toks/s, output: 49.22 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:06<00:10, 64.34it/s, est. speed input: 50694.07 toks/s, output: 49.51 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:06<00:10, 66.10it/s, est. speed input: 51055.19 toks/s, output: 49.86 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:06<00:10, 65.55it/s, est. speed input: 51321.69 toks/s, output: 50.12 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:07<00:10, 65.21it/s, est. speed input: 51580.75 toks/s, output: 50.37 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:07<00:10, 64.96it/s, est. speed input: 51830.08 toks/s, output: 50.62 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:07<00:10, 64.83it/s, est. speed input: 52072.82 toks/s, output: 50.85 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:07<00:09, 64.72it/s, est. speed input: 52306.39 toks/s, output: 51.08 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:07<00:09, 64.65it/s, est. speed input: 52533.14 toks/s, output: 51.30 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:07<00:09, 65.04it/s, est. speed input: 52771.34 toks/s, output: 51.53 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:07<00:09, 65.39it/s, est. speed input: 53005.30 toks/s, output: 51.76 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:07<00:09, 65.62it/s, est. speed input: 53231.42 toks/s, output: 51.98 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:08<00:09, 65.80it/s, est. speed input: 53451.39 toks/s, output: 52.20 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:08<00:09, 65.92it/s, est. speed input: 53664.58 toks/s, output: 52.41 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:08<00:09, 65.13it/s, est. speed input: 53835.96 toks/s, output: 52.57 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:08<00:08, 65.47it/s, est. speed input: 54038.18 toks/s, output: 52.77 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:08<00:08, 65.70it/s, est. speed input: 54234.27 toks/s, output: 52.96 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:08<00:08, 65.83it/s, est. speed input: 54423.47 toks/s, output: 53.15 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:08<00:08, 65.91it/s, est. speed input: 54607.20 toks/s, output: 53.33 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:08<00:08, 65.81it/s, est. speed input: 54780.05 toks/s, output: 53.50 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:08<00:08, 65.96it/s, est. speed input: 54956.06 toks/s, output: 53.67 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:09<00:08, 65.93it/s, est. speed input: 55122.73 toks/s, output: 53.83 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:09<00:07, 65.94it/s, est. speed input: 55286.14 toks/s, output: 53.99 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:09<00:07, 65.96it/s, est. speed input: 55445.82 toks/s, output: 54.15 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:09<00:07, 65.96it/s, est. speed input: 55600.88 toks/s, output: 54.30 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:09<00:07, 65.94it/s, est. speed input: 55751.07 toks/s, output: 54.44 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:09<00:07, 65.88it/s, est. speed input: 55896.13 toks/s, output: 54.59 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:09<00:07, 65.90it/s, est. speed input: 56039.64 toks/s, output: 54.73 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:09<00:07, 66.00it/s, est. speed input: 56182.57 toks/s, output: 54.87 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:10<00:07, 65.85it/s, est. speed input: 56314.82 toks/s, output: 54.99 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:10<00:07, 65.84it/s, est. speed input: 56446.93 toks/s, output: 55.12 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:10<00:06, 65.89it/s, est. speed input: 56577.77 toks/s, output: 55.25 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:10<00:06, 65.86it/s, est. speed input: 56703.51 toks/s, output: 55.37 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:10<00:06, 65.84it/s, est. speed input: 56826.45 toks/s, output: 55.49 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:10<00:06, 65.84it/s, est. speed input: 56946.86 toks/s, output: 55.61 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:10<00:06, 65.87it/s, est. speed input: 57065.75 toks/s, output: 55.73 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:10<00:06, 65.87it/s, est. speed input: 57181.26 toks/s, output: 55.84 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:11<00:06, 65.88it/s, est. speed input: 57294.40 toks/s, output: 55.95 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:11<00:06, 65.86it/s, est. speed input: 57404.54 toks/s, output: 56.06 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:11<00:05, 65.88it/s, est. speed input: 57512.98 toks/s, output: 56.16 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:11<00:05, 65.88it/s, est. speed input: 57618.90 toks/s, output: 56.27 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:11<00:05, 65.86it/s, est. speed input: 57722.14 toks/s, output: 56.37 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:11<00:05, 65.85it/s, est. speed input: 57822.63 toks/s, output: 56.47 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:11<00:05, 65.91it/s, est. speed input: 57923.41 toks/s, output: 56.57 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:11<00:05, 65.84it/s, est. speed input: 58019.12 toks/s, output: 56.66 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:12<00:05, 65.84it/s, est. speed input: 58114.05 toks/s, output: 56.75 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:12<00:05, 65.85it/s, est. speed input: 58207.62 toks/s, output: 56.84 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:12<00:04, 65.83it/s, est. speed input: 58298.28 toks/s, output: 56.93 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:12<00:04, 65.81it/s, est. speed input: 58387.09 toks/s, output: 57.02 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:12<00:04, 65.85it/s, est. speed input: 58475.97 toks/s, output: 57.11 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:12<00:04, 65.89it/s, est. speed input: 58563.25 toks/s, output: 57.19 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:12<00:04, 65.91it/s, est. speed input: 58648.46 toks/s, output: 57.27 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:12<00:04, 65.91it/s, est. speed input: 58732.11 toks/s, output: 57.36 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:12<00:04, 65.93it/s, est. speed input: 58814.51 toks/s, output: 57.44 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:13<00:04, 65.97it/s, est. speed input: 58896.16 toks/s, output: 57.52 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:13<00:03, 66.00it/s, est. speed input: 58976.13 toks/s, output: 57.59 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:13<00:03, 66.04it/s, est. speed input: 59055.33 toks/s, output: 57.67 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:13<00:03, 66.02it/s, est. speed input: 59131.95 toks/s, output: 57.75 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:13<00:03, 66.05it/s, est. speed input: 59208.16 toks/s, output: 57.82 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:13<00:03, 66.05it/s, est. speed input: 59282.76 toks/s, output: 57.89 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:13<00:03, 66.07it/s, est. speed input: 59356.20 toks/s, output: 57.96 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:03, 66.04it/s, est. speed input: 59427.54 toks/s, output: 58.03 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:14<00:03, 66.07it/s, est. speed input: 59498.74 toks/s, output: 58.10 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:14<00:02, 66.07it/s, est. speed input: 59568.35 toks/s, output: 58.17 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:14<00:02, 66.09it/s, est. speed input: 59637.28 toks/s, output: 58.24 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:14<00:02, 66.03it/s, est. speed input: 59703.16 toks/s, output: 58.30 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:14<00:02, 66.01it/s, est. speed input: 59768.47 toks/s, output: 58.37 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:14<00:02, 66.06it/s, est. speed input: 59834.24 toks/s, output: 58.43 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:14<00:02, 66.09it/s, est. speed input: 59898.92 toks/s, output: 58.49 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 66.07it/s, est. speed input: 59961.47 toks/s, output: 58.56 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:15<00:02, 65.99it/s, est. speed input: 60021.55 toks/s, output: 58.61 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:15<00:02, 65.90it/s, est. speed input: 60079.59 toks/s, output: 58.67 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:15<00:01, 65.84it/s, est. speed input: 60136.85 toks/s, output: 58.73 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:15<00:01, 65.87it/s, est. speed input: 60195.06 toks/s, output: 58.78 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:15<00:01, 65.87it/s, est. speed input: 60251.85 toks/s, output: 58.84 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:15<00:01, 65.87it/s, est. speed input: 60307.61 toks/s, output: 58.89 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 65.86it/s, est. speed input: 60362.43 toks/s, output: 58.95 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 65.91it/s, est. speed input: 60417.61 toks/s, output: 59.00 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:16<00:01, 65.89it/s, est. speed input: 60470.79 toks/s, output: 59.05 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:16<00:01, 65.88it/s, est. speed input: 60523.29 toks/s, output: 59.10 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:16<00:00, 65.89it/s, est. speed input: 60575.20 toks/s, output: 59.16 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:16<00:00, 65.90it/s, est. speed input: 60626.47 toks/s, output: 59.21 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 65.86it/s, est. speed input: 60676.06 toks/s, output: 59.25 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 68.08it/s, est. speed input: 60773.74 toks/s, output: 59.35 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:16<00:00, 67.48it/s, est. speed input: 60823.79 toks/s, output: 59.40 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:16<00:00, 67.03it/s, est. speed input: 60872.46 toks/s, output: 59.45 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:16<00:00, 66.66it/s, est. speed input: 60919.07 toks/s, output: 59.49 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:17<00:00, 67.04it/s, est. speed input: 60978.69 toks/s, output: 59.55 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 67.04it/s, est. speed input: 61337.13 toks/s, output: 59.90 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 59.90it/s, est. speed input: 61337.13 toks/s, output: 59.90 toks/s]
[rank0]:[W128 06:16:17.726087507 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 412.5s

测试结果:
  Requests/s:   51.51
  Tokens/s:     52793.26
  Total Reqs:   1024
  Elapsed:      19.88s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     52741.75

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:18:36 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:18:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=794939) WARNING 01-28 06:19:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=794939) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=794939) WARNING 01-28 06:21:19 [backends.py:609] Failed to read file <frozen os>
Throughput: 59.56 requests/s, 61052.54 total tokens/s, 59.56 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 06:18:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:18:36] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:18:36] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:18:36] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:18:36] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:18:36] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:18:36] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:18:36] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:18:36] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:18:36] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:18:36] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:18:36] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:18:36] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:18:36] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:18:58] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:19:15] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:19:15] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:19:15] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:19:15] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:19:15] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:19:15] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:19:15] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:19:15] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:19:15] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:19:15] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:19:15] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:19:15] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:19:15] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 06:19:54.853517675 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:01] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:01] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:01] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:01] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:01] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:01] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=794939) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=794939) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=794939) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=794939) 
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:18] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:19] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:19] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:19] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:21] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:22] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:22] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=794939) [2026-01-28 06:20:22] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=794939) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:04<00:24,  4.03s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:07<00:18,  3.63s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:11<00:14,  3.71s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:12<00:08,  2.81s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:20<00:09,  4.64s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:24<00:04,  4.38s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:41<00:00,  8.70s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:41<00:00,  6.00s/it]
(EngineCore_DP0 pid=794939) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:06<00:26,  6.54s/it]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:06<00:08,  2.89s/it]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:07<00:03,  1.68s/it]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:09<00:01,  1.81s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:09<00:00,  1.40s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:09<00:00,  1.96s/it]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 35/2048 [00:00<00:05, 345.26it/s]
Adding requests:   4%|▎         | 73/2048 [00:00<00:05, 361.51it/s]
Adding requests:   5%|▌         | 110/2048 [00:00<00:05, 363.25it/s]
Adding requests:   7%|▋         | 147/2048 [00:00<00:05, 363.14it/s]
Adding requests:   9%|▉         | 184/2048 [00:00<00:05, 363.10it/s]
Adding requests:  11%|█         | 222/2048 [00:00<00:04, 367.35it/s]
Adding requests:  13%|█▎        | 261/2048 [00:00<00:04, 374.62it/s]
Adding requests:  15%|█▍        | 299/2048 [00:00<00:04, 371.21it/s]
Adding requests:  16%|█▋        | 337/2048 [00:00<00:04, 369.21it/s]
Adding requests:  18%|█▊        | 375/2048 [00:01<00:04, 370.89it/s]
Adding requests:  20%|██        | 413/2048 [00:01<00:04, 372.53it/s]
Adding requests:  22%|██▏       | 451/2048 [00:01<00:04, 373.87it/s]
Adding requests:  24%|██▍       | 491/2048 [00:01<00:04, 379.75it/s]
Adding requests:  26%|██▌       | 529/2048 [00:01<00:04, 379.31it/s]
Adding requests:  28%|██▊       | 572/2048 [00:01<00:03, 392.80it/s]
Adding requests:  30%|██▉       | 612/2048 [00:01<00:03, 390.89it/s]
Adding requests:  32%|███▏      | 654/2048 [00:01<00:03, 399.46it/s]
Adding requests:  34%|███▍      | 697/2048 [00:01<00:03, 408.07it/s]
Adding requests:  36%|███▌      | 741/2048 [00:01<00:03, 413.82it/s]
Adding requests:  38%|███▊      | 783/2048 [00:02<00:03, 411.93it/s]
Adding requests:  40%|████      | 825/2048 [00:02<00:03, 405.88it/s]
Adding requests:  42%|████▏     | 866/2048 [00:02<00:03, 388.62it/s]
Adding requests:  44%|████▍     | 908/2048 [00:02<00:02, 397.23it/s]
Adding requests:  46%|████▋     | 950/2048 [00:02<00:02, 403.26it/s]
Adding requests:  48%|████▊     | 992/2048 [00:02<00:02, 407.22it/s]
Adding requests:  51%|█████     | 1035/2048 [00:02<00:02, 412.39it/s]
Adding requests:  53%|█████▎    | 1077/2048 [00:02<00:02, 411.92it/s]
Adding requests:  55%|█████▍    | 1119/2048 [00:02<00:02, 412.83it/s]
Adding requests:  57%|█████▋    | 1162/2048 [00:02<00:02, 416.76it/s]
Adding requests:  59%|█████▉    | 1204/2048 [00:03<00:02, 417.33it/s]
Adding requests:  61%|██████    | 1246/2048 [00:03<00:01, 415.71it/s]
Adding requests:  63%|██████▎   | 1288/2048 [00:03<00:01, 398.36it/s]
Adding requests:  65%|██████▍   | 1331/2048 [00:03<00:01, 405.35it/s]
Adding requests:  67%|██████▋   | 1372/2048 [00:03<00:01, 404.95it/s]
Adding requests:  69%|██████▉   | 1415/2048 [00:03<00:01, 409.54it/s]
Adding requests:  71%|███████   | 1457/2048 [00:03<00:01, 405.82it/s]
Adding requests:  73%|███████▎  | 1498/2048 [00:03<00:01, 379.76it/s]
Adding requests:  75%|███████▌  | 1539/2048 [00:03<00:01, 388.12it/s]
Adding requests:  77%|███████▋  | 1582/2048 [00:04<00:01, 397.27it/s]
Adding requests:  79%|███████▉  | 1622/2048 [00:04<00:01, 394.46it/s]
Adding requests:  81%|████████  | 1662/2048 [00:04<00:00, 388.48it/s]
Adding requests:  83%|████████▎ | 1701/2048 [00:04<00:00, 384.26it/s]
Adding requests:  85%|████████▍ | 1740/2048 [00:04<00:00, 383.70it/s]
Adding requests:  87%|████████▋ | 1779/2048 [00:04<00:00, 367.91it/s]
Adding requests:  89%|████████▊ | 1816/2048 [00:04<00:00, 363.67it/s]
Adding requests:  91%|█████████ | 1854/2048 [00:04<00:00, 367.56it/s]
Adding requests:  92%|█████████▏| 1892/2048 [00:04<00:00, 369.74it/s]
Adding requests:  94%|█████████▍| 1930/2048 [00:04<00:00, 371.08it/s]
Adding requests:  96%|█████████▌| 1968/2048 [00:05<00:00, 370.24it/s]
Adding requests:  98%|█████████▊| 2007/2048 [00:05<00:00, 373.90it/s]
Adding requests: 100%|█████████▉| 2045/2048 [00:05<00:00, 362.20it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 387.29it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   7%|▋         | 146/2048 [00:00<00:03, 526.60it/s, est. speed input: 539288.48 toks/s, output: 526.62 toks/s]
Processed prompts:  10%|▉         | 199/2048 [00:01<00:11, 164.32it/s, est. speed input: 198284.61 toks/s, output: 193.64 toks/s]
Processed prompts:  11%|█         | 225/2048 [00:01<00:12, 147.68it/s, est. speed input: 180246.16 toks/s, output: 176.02 toks/s]
Processed prompts:  12%|█▏        | 244/2048 [00:01<00:18, 99.44it/s, est. speed input: 140456.70 toks/s, output: 137.16 toks/s] 
Processed prompts:  13%|█▎        | 258/2048 [00:02<00:20, 89.05it/s, est. speed input: 130202.60 toks/s, output: 127.15 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:02<00:21, 82.66it/s, est. speed input: 123097.40 toks/s, output: 120.21 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:02<00:22, 77.66it/s, est. speed input: 117391.16 toks/s, output: 114.64 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:02<00:23, 73.89it/s, est. speed input: 112722.38 toks/s, output: 110.08 toks/s]
Processed prompts:  16%|█▌        | 322/2048 [00:03<00:24, 71.04it/s, est. speed input: 108806.49 toks/s, output: 106.26 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:03<00:24, 68.99it/s, est. speed input: 105495.55 toks/s, output: 103.02 toks/s]
Processed prompts:  17%|█▋        | 354/2048 [00:03<00:25, 67.50it/s, est. speed input: 102653.45 toks/s, output: 100.25 toks/s]
Processed prompts:  18%|█▊        | 370/2048 [00:03<00:25, 66.46it/s, est. speed input: 100195.80 toks/s, output: 97.85 toks/s] 
Processed prompts:  19%|█▉        | 386/2048 [00:04<00:25, 66.01it/s, est. speed input: 98132.22 toks/s, output: 95.83 toks/s] 
Processed prompts:  20%|█▉        | 402/2048 [00:04<00:24, 66.46it/s, est. speed input: 96527.27 toks/s, output: 94.26 toks/s]
Processed prompts:  20%|██        | 418/2048 [00:04<00:24, 66.79it/s, est. speed input: 95089.50 toks/s, output: 92.86 toks/s]
Processed prompts:  21%|██        | 434/2048 [00:04<00:24, 67.03it/s, est. speed input: 93798.02 toks/s, output: 91.60 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:04<00:23, 67.19it/s, est. speed input: 92626.93 toks/s, output: 90.46 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:05<00:23, 67.32it/s, est. speed input: 91566.16 toks/s, output: 89.42 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:05<00:23, 67.40it/s, est. speed input: 90594.68 toks/s, output: 88.47 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:05<00:22, 67.45it/s, est. speed input: 89703.41 toks/s, output: 87.60 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:05<00:22, 67.51it/s, est. speed input: 88886.43 toks/s, output: 86.80 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:06<00:22, 67.52it/s, est. speed input: 88128.92 toks/s, output: 86.06 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:06<00:22, 67.61it/s, est. speed input: 87439.34 toks/s, output: 85.39 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:06<00:22, 67.54it/s, est. speed input: 86778.49 toks/s, output: 84.74 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:06<00:21, 67.56it/s, est. speed input: 86174.27 toks/s, output: 84.15 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:07<00:21, 67.57it/s, est. speed input: 85609.25 toks/s, output: 83.60 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:07<00:21, 66.87it/s, est. speed input: 84983.81 toks/s, output: 82.99 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:07<00:21, 65.93it/s, est. speed input: 84337.45 toks/s, output: 82.36 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:07<00:21, 65.29it/s, est. speed input: 83732.42 toks/s, output: 81.77 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:08<00:21, 64.85it/s, est. speed input: 83164.11 toks/s, output: 81.21 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:08<00:21, 64.52it/s, est. speed input: 82626.89 toks/s, output: 80.69 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:08<00:21, 64.29it/s, est. speed input: 82121.61 toks/s, output: 80.20 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:08<00:20, 64.06it/s, est. speed input: 81636.45 toks/s, output: 79.72 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:09<00:20, 63.96it/s, est. speed input: 81185.03 toks/s, output: 79.28 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:09<00:20, 63.94it/s, est. speed input: 80762.56 toks/s, output: 78.87 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:09<00:20, 63.90it/s, est. speed input: 80359.99 toks/s, output: 78.48 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:09<00:19, 63.95it/s, est. speed input: 79986.82 toks/s, output: 78.11 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:10<00:19, 63.86it/s, est. speed input: 79617.95 toks/s, output: 77.75 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:10<00:19, 63.86it/s, est. speed input: 79274.38 toks/s, output: 77.42 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:10<00:19, 63.85it/s, est. speed input: 78945.83 toks/s, output: 77.10 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:10<00:19, 63.85it/s, est. speed input: 78632.77 toks/s, output: 76.79 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:11<00:18, 63.84it/s, est. speed input: 78333.31 toks/s, output: 76.50 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:11<00:18, 63.84it/s, est. speed input: 78047.08 toks/s, output: 76.22 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:11<00:18, 63.84it/s, est. speed input: 77773.85 toks/s, output: 75.95 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:11<00:17, 63.90it/s, est. speed input: 77516.91 toks/s, output: 75.70 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:12<00:17, 64.17it/s, est. speed input: 77289.07 toks/s, output: 75.48 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:12<00:17, 64.67it/s, est. speed input: 77095.98 toks/s, output: 75.29 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:12<00:16, 65.03it/s, est. speed input: 76910.19 toks/s, output: 75.11 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:12<00:16, 65.28it/s, est. speed input: 76731.09 toks/s, output: 74.93 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:13<00:16, 66.57it/s, est. speed input: 76638.74 toks/s, output: 74.84 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:13<00:15, 66.37it/s, est. speed input: 76472.19 toks/s, output: 74.68 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:13<00:15, 66.24it/s, est. speed input: 76311.77 toks/s, output: 74.52 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:13<00:15, 66.14it/s, est. speed input: 76156.39 toks/s, output: 74.37 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:14<00:15, 66.07it/s, est. speed input: 76006.63 toks/s, output: 74.23 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:14<00:14, 66.03it/s, est. speed input: 75862.47 toks/s, output: 74.08 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:14<00:14, 65.99it/s, est. speed input: 75722.11 toks/s, output: 73.95 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:14<00:14, 65.97it/s, est. speed input: 75587.08 toks/s, output: 73.82 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:15<00:14, 65.94it/s, est. speed input: 75455.71 toks/s, output: 73.69 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:15<00:14, 65.92it/s, est. speed input: 75327.96 toks/s, output: 73.56 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:15<00:13, 65.90it/s, est. speed input: 75204.47 toks/s, output: 73.44 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:15<00:13, 67.08it/s, est. speed input: 75152.97 toks/s, output: 73.39 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:15<00:13, 66.73it/s, est. speed input: 75036.94 toks/s, output: 73.28 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:17<00:27, 31.48it/s, est. speed input: 71016.92 toks/s, output: 69.35 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:17<00:22, 37.09it/s, est. speed input: 70928.56 toks/s, output: 69.27 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:17<00:19, 42.38it/s, est. speed input: 70844.78 toks/s, output: 69.18 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:17<00:17, 47.12it/s, est. speed input: 70766.66 toks/s, output: 69.11 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:18<00:15, 51.10it/s, est. speed input: 70689.05 toks/s, output: 69.03 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:18<00:14, 54.34it/s, est. speed input: 70615.09 toks/s, output: 68.96 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:18<00:13, 56.84it/s, est. speed input: 70542.52 toks/s, output: 68.89 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:18<00:12, 58.75it/s, est. speed input: 70472.27 toks/s, output: 68.82 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:19<00:12, 60.17it/s, est. speed input: 70404.20 toks/s, output: 68.75 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:19<00:11, 61.19it/s, est. speed input: 70337.49 toks/s, output: 68.69 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:19<00:11, 61.93it/s, est. speed input: 70272.54 toks/s, output: 68.63 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:19<00:10, 62.48it/s, est. speed input: 70210.03 toks/s, output: 68.56 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:20<00:10, 62.82it/s, est. speed input: 70146.75 toks/s, output: 68.50 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:20<00:10, 63.07it/s, est. speed input: 70085.87 toks/s, output: 68.44 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:20<00:10, 63.27it/s, est. speed input: 70027.05 toks/s, output: 68.39 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:20<00:09, 63.43it/s, est. speed input: 69970.77 toks/s, output: 68.33 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:21<00:09, 65.16it/s, est. speed input: 69984.68 toks/s, output: 68.34 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:21<00:08, 66.41it/s, est. speed input: 69997.56 toks/s, output: 68.36 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:21<00:08, 67.33it/s, est. speed input: 70011.06 toks/s, output: 68.37 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:21<00:08, 67.98it/s, est. speed input: 70023.88 toks/s, output: 68.38 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:22<00:07, 68.45it/s, est. speed input: 70036.61 toks/s, output: 68.40 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:22<00:07, 68.77it/s, est. speed input: 70048.59 toks/s, output: 68.41 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:22<00:07, 69.02it/s, est. speed input: 70061.28 toks/s, output: 68.42 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:22<00:07, 69.18it/s, est. speed input: 70072.87 toks/s, output: 68.43 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:22<00:06, 69.29it/s, est. speed input: 70084.32 toks/s, output: 68.44 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:23<00:06, 69.37it/s, est. speed input: 70095.67 toks/s, output: 68.45 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:23<00:06, 69.41it/s, est. speed input: 70106.43 toks/s, output: 68.46 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:23<00:06, 69.47it/s, est. speed input: 70117.88 toks/s, output: 68.47 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:23<00:05, 69.55it/s, est. speed input: 70130.38 toks/s, output: 68.49 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:24<00:05, 69.49it/s, est. speed input: 70138.67 toks/s, output: 68.49 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:24<00:05, 68.03it/s, est. speed input: 70100.89 toks/s, output: 68.46 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:24<00:05, 66.70it/s, est. speed input: 70052.25 toks/s, output: 68.41 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:24<00:05, 65.78it/s, est. speed input: 70003.76 toks/s, output: 68.36 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:25<00:05, 65.13it/s, est. speed input: 69955.46 toks/s, output: 68.32 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:25<00:04, 64.69it/s, est. speed input: 69908.60 toks/s, output: 68.27 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:25<00:04, 64.40it/s, est. speed input: 69862.96 toks/s, output: 68.23 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:25<00:04, 64.20it/s, est. speed input: 69818.40 toks/s, output: 68.18 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:26<00:04, 64.04it/s, est. speed input: 69773.86 toks/s, output: 68.14 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:26<00:03, 63.95it/s, est. speed input: 69730.83 toks/s, output: 68.10 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:26<00:03, 63.86it/s, est. speed input: 69688.03 toks/s, output: 68.05 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:26<00:03, 63.80it/s, est. speed input: 69645.86 toks/s, output: 68.01 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:27<00:03, 63.75it/s, est. speed input: 69604.13 toks/s, output: 67.97 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:27<00:02, 63.72it/s, est. speed input: 69563.48 toks/s, output: 67.93 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:27<00:02, 64.84it/s, est. speed input: 69560.59 toks/s, output: 67.93 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:27<00:02, 64.49it/s, est. speed input: 69521.45 toks/s, output: 67.89 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:28<00:02, 64.25it/s, est. speed input: 69482.92 toks/s, output: 67.85 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:28<00:01, 64.08it/s, est. speed input: 69445.22 toks/s, output: 67.82 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:28<00:01, 63.95it/s, est. speed input: 69407.74 toks/s, output: 67.78 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:28<00:01, 63.86it/s, est. speed input: 69370.89 toks/s, output: 67.74 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:29<00:01, 65.21it/s, est. speed input: 69377.84 toks/s, output: 67.75 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:29<00:00, 66.41it/s, est. speed input: 69390.91 toks/s, output: 67.76 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:29<00:00, 67.28it/s, est. speed input: 69404.00 toks/s, output: 67.78 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:29<00:00, 67.88it/s, est. speed input: 69416.31 toks/s, output: 67.79 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:29<00:00, 69.68it/s, est. speed input: 69464.10 toks/s, output: 67.84 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:29<00:00, 69.68it/s, est. speed input: 69941.39 toks/s, output: 68.30 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:29<00:00, 68.30it/s, est. speed input: 69941.39 toks/s, output: 68.30 toks/s]
[rank0]:[W128 06:23:40.472007807 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 410.0s

测试结果:
  Requests/s:   59.56
  Tokens/s:     61052.54
  Total Reqs:   2048
  Elapsed:      34.38s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     60992.97

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:25:30 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:25:31 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=798216) WARNING 01-28 06:26:27 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=798216) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=798216) WARNING 01-28 06:28:31 [backends.py:609] Failed to read file <frozen os>
Throughput: 62.68 requests/s, 64243.78 total tokens/s, 62.68 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 06:25:24] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:25:30] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:25:30] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:25:30] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:25:30] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:25:30] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:25:30] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:25:30] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:25:30] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:25:30] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:25:30] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:25:30] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:25:30] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:25:30] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:25:49] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:26:02] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:26:02] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:26:02] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:26:02] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:26:02] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:26:02] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:26:02] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:26:02] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:26:02] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:26:02] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:26:02] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:26:02] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:26:02] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=798216) [2026-01-28 06:26:30] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=798216) [2026-01-28 06:26:30] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=798216) [2026-01-28 06:26:30] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=798216) [2026-01-28 06:26:30] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=798216) [2026-01-28 06:26:30] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=798216) [2026-01-28 06:26:30] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=798216) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=798216) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=798216) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.48it/s]
(EngineCore_DP0 pid=798216) 
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:21] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:21] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:21] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:21] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 4915200 bytes
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:21] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:23] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 26542080 bytes
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:23] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=798216) [2026-01-28 06:27:23] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 13271040 bytes
(EngineCore_DP0 pid=798216) [rank0]:W0128 06:28:39.404000 798216 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=798216) [rank0]:W0128 06:28:39.510000 798216 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=798216) [rank0]:W0128 06:28:43.804000 798216 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=798216) [rank0]:W0128 06:28:43.968000 798216 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=798216) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:03<00:39,  3.93s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:05<00:23,  2.60s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:07<00:17,  2.25s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:09<00:14,  2.13s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:14<00:18,  3.15s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:15<00:12,  2.52s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:21<00:14,  3.67s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:33<00:18,  6.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:41<00:13,  6.93s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:43<00:05,  5.45s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:47<00:00,  4.78s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:47<00:00,  4.29s/it]
(EngineCore_DP0 pid=798216) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:00<00:03,  1.90it/s]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:01<00:03,  1.30it/s]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:02<00:04,  1.09s/it]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:03<00:03,  1.06s/it]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:04<00:01,  1.24it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:05<00:00,  1.26it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:05<00:00,  1.65it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:05<00:00,  1.32it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 37/4096 [00:00<00:11, 361.23it/s]
Adding requests:   2%|▏         | 77/4096 [00:00<00:10, 379.38it/s]
Adding requests:   3%|▎         | 117/4096 [00:00<00:10, 384.00it/s]
Adding requests:   4%|▍         | 156/4096 [00:00<00:10, 385.84it/s]
Adding requests:   5%|▍         | 196/4096 [00:00<00:10, 388.87it/s]
Adding requests:   6%|▌         | 236/4096 [00:00<00:09, 392.05it/s]
Adding requests:   7%|▋         | 277/4096 [00:00<00:09, 394.86it/s]
Adding requests:   8%|▊         | 317/4096 [00:00<00:09, 391.97it/s]
Adding requests:   9%|▊         | 358/4096 [00:00<00:09, 395.74it/s]
Adding requests:  10%|▉         | 399/4096 [00:01<00:09, 398.81it/s]
Adding requests:  11%|█         | 439/4096 [00:01<00:09, 394.39it/s]
Adding requests:  12%|█▏        | 480/4096 [00:01<00:09, 398.38it/s]
Adding requests:  13%|█▎        | 520/4096 [00:01<00:09, 392.57it/s]
Adding requests:  14%|█▎        | 562/4096 [00:01<00:08, 398.42it/s]
Adding requests:  15%|█▍        | 602/4096 [00:01<00:08, 398.81it/s]
Adding requests:  16%|█▌        | 642/4096 [00:01<00:08, 396.02it/s]
Adding requests:  17%|█▋        | 682/4096 [00:01<00:08, 394.73it/s]
Adding requests:  18%|█▊        | 722/4096 [00:01<00:08, 390.11it/s]
Adding requests:  19%|█▊        | 762/4096 [00:01<00:08, 385.20it/s]
Adding requests:  20%|█▉        | 801/4096 [00:02<00:08, 379.21it/s]
Adding requests:  20%|██        | 839/4096 [00:02<00:08, 367.28it/s]
Adding requests:  21%|██▏       | 878/4096 [00:02<00:08, 373.52it/s]
Adding requests:  22%|██▏       | 917/4096 [00:02<00:08, 376.29it/s]
Adding requests:  23%|██▎       | 956/4096 [00:02<00:08, 378.16it/s]
Adding requests:  24%|██▍       | 995/4096 [00:02<00:08, 381.33it/s]
Adding requests:  25%|██▌       | 1034/4096 [00:02<00:08, 377.51it/s]
Adding requests:  26%|██▌       | 1072/4096 [00:02<00:08, 375.66it/s]
Adding requests:  27%|██▋       | 1110/4096 [00:02<00:08, 364.85it/s]
Adding requests:  28%|██▊       | 1148/4096 [00:02<00:08, 367.37it/s]
Adding requests:  29%|██▉       | 1187/4096 [00:03<00:07, 373.43it/s]
Adding requests:  30%|██▉       | 1226/4096 [00:03<00:07, 377.11it/s]
Adding requests:  31%|███       | 1264/4096 [00:03<00:07, 376.77it/s]
Adding requests:  32%|███▏      | 1303/4096 [00:03<00:07, 380.49it/s]
Adding requests:  33%|███▎      | 1343/4096 [00:03<00:07, 385.72it/s]
Adding requests:  34%|███▍      | 1383/4096 [00:03<00:07, 387.48it/s]
Adding requests:  35%|███▍      | 1423/4096 [00:03<00:06, 389.45it/s]
Adding requests:  36%|███▌      | 1464/4096 [00:03<00:06, 393.33it/s]
Adding requests:  37%|███▋      | 1504/4096 [00:03<00:06, 395.01it/s]
Adding requests:  38%|███▊      | 1544/4096 [00:04<00:06, 392.72it/s]
Adding requests:  39%|███▊      | 1584/4096 [00:04<00:06, 394.03it/s]
Adding requests:  40%|███▉      | 1624/4096 [00:04<00:06, 391.77it/s]
Adding requests:  41%|████      | 1664/4096 [00:04<00:06, 390.34it/s]
Adding requests:  42%|████▏     | 1704/4096 [00:04<00:06, 391.51it/s]
Adding requests:  43%|████▎     | 1744/4096 [00:04<00:05, 393.41it/s]
Adding requests:  44%|████▎     | 1784/4096 [00:04<00:05, 391.97it/s]
Adding requests:  45%|████▍     | 1824/4096 [00:04<00:06, 366.13it/s]
Adding requests:  45%|████▌     | 1861/4096 [00:04<00:06, 362.61it/s]
Adding requests:  46%|████▋     | 1899/4096 [00:04<00:06, 365.30it/s]
Adding requests:  47%|████▋     | 1936/4096 [00:05<00:05, 366.18it/s]
Adding requests:  48%|████▊     | 1974/4096 [00:05<00:05, 367.34it/s]
Adding requests:  49%|████▉     | 2013/4096 [00:05<00:05, 371.43it/s]
Adding requests:  50%|█████     | 2052/4096 [00:05<00:05, 374.44it/s]
Adding requests:  51%|█████     | 2092/4096 [00:05<00:05, 380.43it/s]
Adding requests:  52%|█████▏    | 2131/4096 [00:05<00:05, 377.85it/s]
Adding requests:  53%|█████▎    | 2169/4096 [00:05<00:05, 374.58it/s]
Adding requests:  54%|█████▍    | 2207/4096 [00:05<00:05, 363.24it/s]
Adding requests:  55%|█████▍    | 2247/4096 [00:05<00:04, 371.76it/s]
Adding requests:  56%|█████▌    | 2285/4096 [00:05<00:04, 372.44it/s]
Adding requests:  57%|█████▋    | 2323/4096 [00:06<00:04, 360.18it/s]
Adding requests:  58%|█████▊    | 2363/4096 [00:06<00:04, 370.00it/s]
Adding requests:  59%|█████▊    | 2404/4096 [00:06<00:04, 380.39it/s]
Adding requests:  60%|█████▉    | 2446/4096 [00:06<00:04, 389.20it/s]
Adding requests:  61%|██████    | 2489/4096 [00:06<00:04, 400.82it/s]
Adding requests:  62%|██████▏   | 2530/4096 [00:06<00:03, 401.22it/s]
Adding requests:  63%|██████▎   | 2572/4096 [00:06<00:03, 405.00it/s]
Adding requests:  64%|██████▍   | 2613/4096 [00:06<00:03, 403.88it/s]
Adding requests:  65%|██████▍   | 2655/4096 [00:06<00:03, 408.64it/s]
Adding requests:  66%|██████▌   | 2696/4096 [00:07<00:03, 405.51it/s]
Adding requests:  67%|██████▋   | 2737/4096 [00:07<00:03, 405.83it/s]
Adding requests:  68%|██████▊   | 2779/4096 [00:07<00:03, 408.32it/s]
Adding requests:  69%|██████▉   | 2820/4096 [00:07<00:03, 405.53it/s]
Adding requests:  70%|██████▉   | 2862/4096 [00:07<00:03, 408.86it/s]
Adding requests:  71%|███████   | 2904/4096 [00:07<00:02, 411.10it/s]
Adding requests:  72%|███████▏  | 2946/4096 [00:07<00:02, 409.16it/s]
Adding requests:  73%|███████▎  | 2989/4096 [00:07<00:02, 413.81it/s]
Adding requests:  74%|███████▍  | 3031/4096 [00:07<00:02, 413.97it/s]
Adding requests:  75%|███████▌  | 3073/4096 [00:07<00:02, 410.83it/s]
Adding requests:  76%|███████▌  | 3115/4096 [00:08<00:02, 410.62it/s]
Adding requests:  77%|███████▋  | 3157/4096 [00:08<00:02, 409.18it/s]
Adding requests:  78%|███████▊  | 3199/4096 [00:08<00:02, 410.01it/s]
Adding requests:  79%|███████▉  | 3241/4096 [00:08<00:02, 407.89it/s]
Adding requests:  80%|████████  | 3283/4096 [00:08<00:01, 410.43it/s]
Adding requests:  81%|████████  | 3325/4096 [00:08<00:01, 408.19it/s]
Adding requests:  82%|████████▏ | 3368/4096 [00:08<00:01, 412.43it/s]
Adding requests:  83%|████████▎ | 3410/4096 [00:08<00:01, 412.19it/s]
Adding requests:  84%|████████▍ | 3452/4096 [00:08<00:01, 402.32it/s]
Adding requests:  85%|████████▌ | 3493/4096 [00:08<00:01, 401.19it/s]
Adding requests:  86%|████████▋ | 3534/4096 [00:09<00:01, 403.64it/s]
Adding requests:  87%|████████▋ | 3576/4096 [00:09<00:01, 405.74it/s]
Adding requests:  88%|████████▊ | 3617/4096 [00:09<00:01, 404.03it/s]
Adding requests:  89%|████████▉ | 3658/4096 [00:09<00:01, 390.48it/s]
Adding requests:  90%|█████████ | 3700/4096 [00:09<00:00, 398.34it/s]
Adding requests:  91%|█████████▏| 3741/4096 [00:09<00:00, 399.55it/s]
Adding requests:  92%|█████████▏| 3784/4096 [00:09<00:00, 407.54it/s]
Adding requests:  93%|█████████▎| 3826/4096 [00:09<00:00, 408.00it/s]
Adding requests:  94%|█████████▍| 3869/4096 [00:09<00:00, 414.32it/s]
Adding requests:  95%|█████████▌| 3911/4096 [00:09<00:00, 411.18it/s]
Adding requests:  97%|█████████▋| 3953/4096 [00:10<00:00, 411.97it/s]
Adding requests:  98%|█████████▊| 3995/4096 [00:10<00:00, 407.01it/s]
Adding requests:  99%|█████████▊| 4036/4096 [00:10<00:00, 397.74it/s]
Adding requests: 100%|█████████▉| 4076/4096 [00:10<00:00, 386.99it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 391.35it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  10%|█         | 418/4096 [00:00<00:04, 741.72it/s, est. speed input: 759616.05 toks/s, output: 741.74 toks/s]
Processed prompts:  12%|█▏        | 493/4096 [00:01<00:13, 268.14it/s, est. speed input: 327816.55 toks/s, output: 320.13 toks/s]
Processed prompts:  13%|█▎        | 529/4096 [00:02<00:17, 203.10it/s, est. speed input: 267564.17 toks/s, output: 261.29 toks/s]
Processed prompts:  13%|█▎        | 552/4096 [00:02<00:23, 152.87it/s, est. speed input: 225452.01 toks/s, output: 220.17 toks/s]
Processed prompts:  14%|█▍        | 578/4096 [00:02<00:29, 121.30it/s, est. speed input: 197712.11 toks/s, output: 193.08 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:03<00:33, 104.08it/s, est. speed input: 179568.64 toks/s, output: 175.36 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:03<00:37, 92.71it/s, est. speed input: 166123.25 toks/s, output: 162.23 toks/s] 
Processed prompts:  16%|█▋        | 674/4096 [00:04<00:40, 85.05it/s, est. speed input: 155706.71 toks/s, output: 152.06 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:04<00:42, 79.72it/s, est. speed input: 147310.07 toks/s, output: 143.86 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:05<00:44, 76.00it/s, est. speed input: 140396.15 toks/s, output: 137.11 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:05<00:45, 73.39it/s, est. speed input: 134598.98 toks/s, output: 131.44 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:06<00:46, 71.58it/s, est. speed input: 129677.54 toks/s, output: 126.64 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:06<00:46, 70.31it/s, est. speed input: 125441.06 toks/s, output: 122.50 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:07<00:46, 69.41it/s, est. speed input: 121753.82 toks/s, output: 118.90 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:07<00:46, 68.78it/s, est. speed input: 118515.53 toks/s, output: 115.74 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:08<00:46, 68.34it/s, est. speed input: 115652.22 toks/s, output: 112.94 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:08<00:45, 68.61it/s, est. speed input: 113275.95 toks/s, output: 110.62 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:09<00:45, 68.22it/s, est. speed input: 110977.48 toks/s, output: 108.38 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:09<00:45, 67.96it/s, est. speed input: 108908.37 toks/s, output: 106.36 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:10<00:44, 67.77it/s, est. speed input: 107032.08 toks/s, output: 104.52 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:10<00:44, 67.62it/s, est. speed input: 105320.51 toks/s, output: 102.85 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:11<00:44, 67.53it/s, est. speed input: 103758.95 toks/s, output: 101.33 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:11<00:43, 67.84it/s, est. speed input: 102403.08 toks/s, output: 100.00 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:12<00:43, 67.23it/s, est. speed input: 100989.36 toks/s, output: 98.62 toks/s] 
Processed prompts:  30%|██▉       | 1218/4096 [00:12<00:43, 66.88it/s, est. speed input: 99699.90 toks/s, output: 97.36 toks/s] 
Processed prompts:  31%|███       | 1250/4096 [00:12<00:42, 66.63it/s, est. speed input: 98503.75 toks/s, output: 96.19 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:13<00:42, 66.47it/s, est. speed input: 97397.50 toks/s, output: 95.11 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:13<00:41, 66.34it/s, est. speed input: 96364.07 toks/s, output: 94.11 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:14<00:41, 66.25it/s, est. speed input: 95400.30 toks/s, output: 93.16 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:14<00:41, 66.25it/s, est. speed input: 94508.38 toks/s, output: 92.29 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:15<00:40, 66.15it/s, est. speed input: 93657.89 toks/s, output: 91.46 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:15<00:40, 66.12it/s, est. speed input: 92864.98 toks/s, output: 90.69 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:16<00:39, 66.09it/s, est. speed input: 92117.58 toks/s, output: 89.96 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:16<00:39, 66.06it/s, est. speed input: 91411.95 toks/s, output: 89.27 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:18<00:59, 43.28it/s, est. speed input: 86510.83 toks/s, output: 84.48 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:18<00:52, 48.27it/s, est. speed input: 86020.83 toks/s, output: 84.00 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:19<00:47, 52.50it/s, est. speed input: 85555.76 toks/s, output: 83.55 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:19<00:44, 55.94it/s, est. speed input: 85113.37 toks/s, output: 83.12 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:20<00:41, 58.63it/s, est. speed input: 84692.09 toks/s, output: 82.71 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:20<00:39, 60.80it/s, est. speed input: 84307.18 toks/s, output: 82.33 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:21<00:37, 63.02it/s, est. speed input: 84004.09 toks/s, output: 82.03 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:21<00:36, 64.69it/s, est. speed input: 83715.12 toks/s, output: 81.75 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:22<00:34, 65.91it/s, est. speed input: 83438.71 toks/s, output: 81.48 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:22<00:33, 66.79it/s, est. speed input: 83173.83 toks/s, output: 81.22 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:22<00:32, 68.01it/s, est. speed input: 82968.76 toks/s, output: 81.02 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:23<00:32, 68.29it/s, est. speed input: 82723.09 toks/s, output: 80.78 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:23<00:31, 68.48it/s, est. speed input: 82486.95 toks/s, output: 80.55 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:24<00:31, 68.61it/s, est. speed input: 82259.88 toks/s, output: 80.33 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:24<00:30, 68.71it/s, est. speed input: 82041.29 toks/s, output: 80.12 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:25<00:30, 68.77it/s, est. speed input: 81829.84 toks/s, output: 79.91 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:25<00:29, 68.28it/s, est. speed input: 81588.54 toks/s, output: 79.68 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:26<00:29, 67.51it/s, est. speed input: 81324.27 toks/s, output: 79.42 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:26<00:29, 66.97it/s, est. speed input: 81069.09 toks/s, output: 79.17 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:27<00:29, 66.60it/s, est. speed input: 80823.13 toks/s, output: 78.93 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:27<00:28, 66.33it/s, est. speed input: 80584.83 toks/s, output: 78.70 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:28<00:28, 66.14it/s, est. speed input: 80354.95 toks/s, output: 78.47 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:28<00:28, 66.17it/s, est. speed input: 80143.44 toks/s, output: 78.27 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:29<00:27, 67.22it/s, est. speed input: 80007.46 toks/s, output: 78.13 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:29<00:26, 67.39it/s, est. speed input: 79837.84 toks/s, output: 77.97 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:30<00:26, 67.49it/s, est. speed input: 79673.30 toks/s, output: 77.81 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:30<00:25, 67.57it/s, est. speed input: 79514.18 toks/s, output: 77.65 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:30<00:25, 67.62it/s, est. speed input: 79359.39 toks/s, output: 77.50 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:31<00:24, 67.65it/s, est. speed input: 79209.00 toks/s, output: 77.35 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:31<00:24, 67.67it/s, est. speed input: 79063.11 toks/s, output: 77.21 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:32<00:23, 68.29it/s, est. speed input: 78955.45 toks/s, output: 77.10 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:32<00:22, 68.13it/s, est. speed input: 78817.78 toks/s, output: 76.97 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:33<00:22, 68.01it/s, est. speed input: 78683.73 toks/s, output: 76.84 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:33<00:22, 67.91it/s, est. speed input: 78552.44 toks/s, output: 76.71 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:34<00:21, 67.83it/s, est. speed input: 78424.51 toks/s, output: 76.59 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:34<00:21, 67.79it/s, est. speed input: 78300.69 toks/s, output: 76.47 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:35<00:20, 67.18it/s, est. speed input: 78149.81 toks/s, output: 76.32 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:35<00:20, 66.72it/s, est. speed input: 78001.18 toks/s, output: 76.17 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:36<00:20, 66.40it/s, est. speed input: 77856.27 toks/s, output: 76.03 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:36<00:19, 66.34it/s, est. speed input: 77723.77 toks/s, output: 75.90 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:37<00:19, 66.68it/s, est. speed input: 77613.72 toks/s, output: 75.79 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:37<00:18, 66.89it/s, est. speed input: 77505.45 toks/s, output: 75.69 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:38<00:18, 67.05it/s, est. speed input: 77399.88 toks/s, output: 75.59 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:38<00:17, 67.16it/s, est. speed input: 77296.90 toks/s, output: 75.49 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:39<00:17, 67.22it/s, est. speed input: 77196.03 toks/s, output: 75.39 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:39<00:16, 67.28it/s, est. speed input: 77097.92 toks/s, output: 75.29 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:40<00:16, 67.30it/s, est. speed input: 77001.23 toks/s, output: 75.20 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:40<00:15, 67.32it/s, est. speed input: 76907.44 toks/s, output: 75.10 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:40<00:15, 67.35it/s, est. speed input: 76816.19 toks/s, output: 75.02 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:41<00:14, 67.36it/s, est. speed input: 76726.59 toks/s, output: 74.93 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:41<00:14, 67.36it/s, est. speed input: 76639.02 toks/s, output: 74.84 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:42<00:13, 67.35it/s, est. speed input: 76552.73 toks/s, output: 74.76 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:42<00:13, 67.37it/s, est. speed input: 76469.34 toks/s, output: 74.68 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:43<00:12, 67.38it/s, est. speed input: 76387.91 toks/s, output: 74.60 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:43<00:12, 67.14it/s, est. speed input: 76297.95 toks/s, output: 74.51 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:44<00:11, 66.68it/s, est. speed input: 76197.89 toks/s, output: 74.41 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:44<00:11, 66.62it/s, est. speed input: 76110.77 toks/s, output: 74.33 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:45<00:10, 66.80it/s, est. speed input: 76034.25 toks/s, output: 74.25 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:45<00:10, 66.92it/s, est. speed input: 75959.28 toks/s, output: 74.18 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:46<00:09, 67.02it/s, est. speed input: 75886.08 toks/s, output: 74.11 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:46<00:09, 67.07it/s, est. speed input: 75813.89 toks/s, output: 74.04 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [00:47<00:09, 67.11it/s, est. speed input: 75743.32 toks/s, output: 73.97 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [00:47<00:08, 67.14it/s, est. speed input: 75674.13 toks/s, output: 73.90 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [00:48<00:08, 67.15it/s, est. speed input: 75605.93 toks/s, output: 73.83 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [00:48<00:07, 67.15it/s, est. speed input: 75538.85 toks/s, output: 73.77 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [00:49<00:07, 67.15it/s, est. speed input: 75473.18 toks/s, output: 73.70 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [00:49<00:06, 67.16it/s, est. speed input: 75408.99 toks/s, output: 73.64 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [00:50<00:06, 67.17it/s, est. speed input: 75345.98 toks/s, output: 73.58 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [00:51<00:08, 45.53it/s, est. speed input: 74176.05 toks/s, output: 72.44 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [00:51<00:06, 50.41it/s, est. speed input: 74127.03 toks/s, output: 72.39 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [00:52<00:05, 54.50it/s, est. speed input: 74078.55 toks/s, output: 72.34 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [00:52<00:04, 57.49it/s, est. speed input: 74018.44 toks/s, output: 72.28 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [00:53<00:04, 59.70it/s, est. speed input: 73955.50 toks/s, output: 72.22 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [00:53<00:03, 61.67it/s, est. speed input: 73905.83 toks/s, output: 72.17 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [00:54<00:03, 63.24it/s, est. speed input: 73861.57 toks/s, output: 72.13 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [00:54<00:02, 64.40it/s, est. speed input: 73818.10 toks/s, output: 72.09 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [00:55<00:01, 65.22it/s, est. speed input: 73775.05 toks/s, output: 72.05 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [00:55<00:01, 65.80it/s, est. speed input: 73732.48 toks/s, output: 72.00 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [00:56<00:00, 66.78it/s, est. speed input: 73708.69 toks/s, output: 71.98 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [00:56<00:00, 67.70it/s, est. speed input: 73691.80 toks/s, output: 71.96 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [00:56<00:00, 67.70it/s, est. speed input: 74234.82 toks/s, output: 72.49 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [00:56<00:00, 72.49it/s, est. speed input: 74234.82 toks/s, output: 72.49 toks/s]
[rank0]:[W128 06:31:46.136370417 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 536.6s

测试结果:
  Requests/s:   62.68
  Tokens/s:     64243.78
  Total Reqs:   4096
  Elapsed:      65.35s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     64181.10


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_4/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,14.8372,7611.4997,8.6269
1024,1024,1,128,128,15.6878,16080.0246,8.1592
2048,1024,2,256,128,30.7079,31475.6348,8.3366
4096,1024,4,512,128,61.4956,63032.9765,8.3258
8192,1024,8,1024,128,51.5056,52793.2593,19.8813
16384,1024,16,2048,128,59.5635,61052.5372,34.3835
32768,1024,32,4096,128,62.6769,64243.7803,65.3511

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_6) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_6
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_6

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:33:47 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:33:47 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=801998) WARNING 01-28 06:35:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=801998) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=801998) WARNING 01-28 06:37:07 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.00 requests/s, 7697.12 total tokens/s, 15.00 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 06:33:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:33:47] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:33:47] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:33:47] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:33:47] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:33:47] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:33:47] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:33:47] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:33:47] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:33:47] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:33:47] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:33:47] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:33:47] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:33:47] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:34:12] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:34:24] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:34:24] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:34:24] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:34:24] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:34:24] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:34:24] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:34:24] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:34:24] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:34:24] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:34:24] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:34:24] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:34:24] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:34:24] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=801998) [2026-01-28 06:35:11] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=801998) [2026-01-28 06:35:11] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=801998) [2026-01-28 06:35:11] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=801998) [2026-01-28 06:35:11] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=801998) [2026-01-28 06:35:11] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=801998) [2026-01-28 06:35:11] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=801998) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=801998) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.76s/it]
(EngineCore_DP0 pid=801998) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.76s/it]
(EngineCore_DP0 pid=801998) 
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:03] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:03] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:03] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:04] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:04] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:04] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:04] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=801998) [2026-01-28 06:36:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=801998) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:03<00:03,  3.81s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:21<00:00, 12.16s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:21<00:00, 10.91s/it]
(EngineCore_DP0 pid=801998) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:05<00:00,  5.41s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:05<00:00,  5.41s/it]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  50%|█████     | 64/128 [00:00<00:00, 635.65it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 646.56it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:42,  2.98it/s, est. speed input: 1526.82 toks/s, output: 2.98 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:29,  4.29it/s, est. speed input: 2061.27 toks/s, output: 4.03 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:25,  5.00it/s, est. speed input: 2335.80 toks/s, output: 4.56 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:21,  5.83it/s, est. speed input: 2608.17 toks/s, output: 5.09 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:13,  8.86it/s, est. speed input: 3387.50 toks/s, output: 6.62 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:01<00:10, 11.07it/s, est. speed input: 3984.29 toks/s, output: 7.78 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:01<00:09, 12.35it/s, est. speed input: 4414.76 toks/s, output: 8.62 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:01<00:08, 13.25it/s, est. speed input: 4761.81 toks/s, output: 9.30 toks/s]
Processed prompts:  11%|█         | 14/128 [00:01<00:08, 14.22it/s, est. speed input: 5081.96 toks/s, output: 9.93 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:01<00:07, 14.93it/s, est. speed input: 5352.50 toks/s, output: 10.45 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:07, 15.41it/s, est. speed input: 5580.98 toks/s, output: 10.90 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 15.75it/s, est. speed input: 5778.46 toks/s, output: 11.29 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 15.99it/s, est. speed input: 5951.05 toks/s, output: 11.62 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:02<00:06, 16.14it/s, est. speed input: 6101.21 toks/s, output: 11.92 toks/s]
Processed prompts:  20%|██        | 26/128 [00:02<00:06, 16.30it/s, est. speed input: 6238.34 toks/s, output: 12.18 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:02<00:06, 16.45it/s, est. speed input: 6363.24 toks/s, output: 12.43 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:02<00:05, 16.54it/s, est. speed input: 6474.47 toks/s, output: 12.65 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:02<00:05, 16.51it/s, est. speed input: 6569.25 toks/s, output: 12.83 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:02<00:05, 16.51it/s, est. speed input: 6656.39 toks/s, output: 13.00 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 16.55it/s, est. speed input: 6738.27 toks/s, output: 13.16 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.52it/s, est. speed input: 6809.82 toks/s, output: 13.30 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.53it/s, est. speed input: 6877.73 toks/s, output: 13.43 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:03<00:05, 16.42it/s, est. speed input: 6933.30 toks/s, output: 13.54 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:03<00:05, 16.23it/s, est. speed input: 6978.72 toks/s, output: 13.63 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:03<00:05, 15.85it/s, est. speed input: 7006.90 toks/s, output: 13.69 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:03<00:05, 15.97it/s, est. speed input: 7053.54 toks/s, output: 13.78 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:03<00:04, 16.13it/s, est. speed input: 7100.86 toks/s, output: 13.87 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 16.25it/s, est. speed input: 7144.88 toks/s, output: 13.95 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 16.34it/s, est. speed input: 7186.93 toks/s, output: 14.04 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.41it/s, est. speed input: 7226.32 toks/s, output: 14.11 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:04<00:04, 16.46it/s, est. speed input: 7263.64 toks/s, output: 14.19 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:04<00:04, 16.51it/s, est. speed input: 7299.32 toks/s, output: 14.26 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:04<00:03, 16.55it/s, est. speed input: 7333.30 toks/s, output: 14.32 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:04<00:03, 16.56it/s, est. speed input: 7364.51 toks/s, output: 14.38 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:04<00:03, 16.59it/s, est. speed input: 7395.03 toks/s, output: 14.44 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 16.56it/s, est. speed input: 7422.37 toks/s, output: 14.50 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 16.59it/s, est. speed input: 7450.07 toks/s, output: 14.55 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 16.58it/s, est. speed input: 7475.21 toks/s, output: 14.60 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:05<00:03, 16.56it/s, est. speed input: 7498.65 toks/s, output: 14.65 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:05<00:03, 16.51it/s, est. speed input: 7519.81 toks/s, output: 14.69 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:05<00:03, 16.47it/s, est. speed input: 7539.89 toks/s, output: 14.73 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:05<00:02, 16.51it/s, est. speed input: 7561.32 toks/s, output: 14.77 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:05<00:02, 16.56it/s, est. speed input: 7582.48 toks/s, output: 14.81 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 16.57it/s, est. speed input: 7601.75 toks/s, output: 14.85 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 16.37it/s, est. speed input: 7613.75 toks/s, output: 14.87 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 16.46it/s, est. speed input: 7632.59 toks/s, output: 14.91 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:06<00:02, 16.53it/s, est. speed input: 7650.82 toks/s, output: 14.94 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:06<00:02, 16.55it/s, est. speed input: 7667.27 toks/s, output: 14.98 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:06<00:02, 16.54it/s, est. speed input: 7682.71 toks/s, output: 15.01 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:06<00:01, 16.46it/s, est. speed input: 7695.22 toks/s, output: 15.03 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:06<00:01, 16.46it/s, est. speed input: 7708.97 toks/s, output: 15.06 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 16.44it/s, est. speed input: 7721.61 toks/s, output: 15.08 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 16.48it/s, est. speed input: 7735.07 toks/s, output: 15.11 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 16.47it/s, est. speed input: 7747.17 toks/s, output: 15.13 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 16.44it/s, est. speed input: 7758.33 toks/s, output: 15.15 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:07<00:01, 16.43it/s, est. speed input: 7769.38 toks/s, output: 15.17 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:07<00:01, 16.42it/s, est. speed input: 7779.88 toks/s, output: 15.20 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:07<00:00, 16.41it/s, est. speed input: 7789.99 toks/s, output: 15.21 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:07<00:00, 16.44it/s, est. speed input: 7800.83 toks/s, output: 15.24 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 16.45it/s, est. speed input: 7810.93 toks/s, output: 15.26 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 16.44it/s, est. speed input: 7820.35 toks/s, output: 15.27 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 16.44it/s, est. speed input: 7829.61 toks/s, output: 15.29 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 16.44it/s, est. speed input: 7838.52 toks/s, output: 15.31 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:08<00:00, 16.47it/s, est. speed input: 7847.99 toks/s, output: 15.33 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:08<00:00, 16.48it/s, est. speed input: 7856.86 toks/s, output: 15.35 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 16.52it/s, est. speed input: 7866.19 toks/s, output: 15.36 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 16.52it/s, est. speed input: 7866.19 toks/s, output: 15.36 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 15.36it/s, est. speed input: 7866.19 toks/s, output: 15.36 toks/s]
[rank0]:[W128 06:38:34.271142931 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 337.1s

测试结果:
  Requests/s:   15.00
  Tokens/s:     7697.12
  Total Reqs:   128
  Elapsed:      8.53s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7682.12

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:39:17 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:39:18 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=804637) WARNING 01-28 06:40:40 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=804637) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=804637) WARNING 01-28 06:42:09 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.07 requests/s, 15444.65 total tokens/s, 15.07 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 06:39:01] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:39:17] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:39:17] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:39:17] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:17] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:17] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:17] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:17] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:17] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:39:17] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:39:17] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:39:17] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:39:17] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:39:17] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:39:41] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:39:44] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:39:44] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:39:44] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:44] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:44] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:44] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:44] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:39:44] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:39:44] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:39:44] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:39:44] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:39:44] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:39:44] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=804637) [2026-01-28 06:40:43] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=804637) [2026-01-28 06:40:43] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=804637) [2026-01-28 06:40:43] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=804637) [2026-01-28 06:40:43] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=804637) [2026-01-28 06:40:43] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=804637) [2026-01-28 06:40:43] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=804637) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=804637) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.27it/s]
(EngineCore_DP0 pid=804637) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.27it/s]
(EngineCore_DP0 pid=804637) 
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:11] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:11] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:11] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:12] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:12] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:12] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:12] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=804637) [2026-01-28 06:41:12] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=804637) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:06<00:06,  6.77s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:09<00:00,  4.30s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:09<00:00,  4.67s/it]
(EngineCore_DP0 pid=804637) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:02<00:00,  2.81s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:02<00:00,  2.81s/it]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  26%|██▌       | 33/128 [00:00<00:00, 323.98it/s]
Adding requests:  54%|█████▍    | 69/128 [00:00<00:00, 340.63it/s]
Adding requests:  83%|████████▎ | 106/128 [00:00<00:00, 353.19it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 352.15it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:33,  3.75it/s, est. speed input: 3845.43 toks/s, output: 3.76 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:14,  8.55it/s, est. speed input: 7761.33 toks/s, output: 7.58 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:10, 11.28it/s, est. speed input: 9856.91 toks/s, output: 9.63 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:09, 12.92it/s, est. speed input: 11138.96 toks/s, output: 10.88 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:08, 13.99it/s, est. speed input: 12016.93 toks/s, output: 11.73 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:07, 14.71it/s, est. speed input: 12656.30 toks/s, output: 12.36 toks/s]
Processed prompts:  10%|█         | 13/128 [00:01<00:07, 15.20it/s, est. speed input: 13145.06 toks/s, output: 12.84 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:01<00:07, 15.57it/s, est. speed input: 13538.72 toks/s, output: 13.22 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:07, 15.80it/s, est. speed input: 13848.80 toks/s, output: 13.52 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 15.98it/s, est. speed input: 14107.76 toks/s, output: 13.78 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.10it/s, est. speed input: 14323.45 toks/s, output: 13.99 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.04it/s, est. speed input: 14476.89 toks/s, output: 14.14 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 15.97it/s, est. speed input: 14599.85 toks/s, output: 14.26 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 15.93it/s, est. speed input: 14709.52 toks/s, output: 14.36 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:03<00:22,  4.35it/s, est. speed input: 9534.43 toks/s, output: 9.31 toks/s]  
Processed prompts:  24%|██▍       | 31/128 [00:03<00:17,  5.57it/s, est. speed input: 9803.21 toks/s, output: 9.57 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:03<00:13,  6.93it/s, est. speed input: 10048.43 toks/s, output: 9.81 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:03<00:11,  8.37it/s, est. speed input: 10280.22 toks/s, output: 10.04 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:03<00:09,  9.79it/s, est. speed input: 10495.29 toks/s, output: 10.25 toks/s]
Processed prompts:  30%|███       | 39/128 [00:03<00:08, 11.06it/s, est. speed input: 10688.57 toks/s, output: 10.44 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:03<00:07, 12.15it/s, est. speed input: 10868.35 toks/s, output: 10.61 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:03<00:06, 13.07it/s, est. speed input: 11037.93 toks/s, output: 10.78 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:04<00:06, 13.83it/s, est. speed input: 11200.06 toks/s, output: 10.94 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:04<00:05, 14.39it/s, est. speed input: 11351.08 toks/s, output: 11.08 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:04<00:05, 14.83it/s, est. speed input: 11494.83 toks/s, output: 11.23 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:04<00:05, 15.12it/s, est. speed input: 11627.81 toks/s, output: 11.36 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:04<00:04, 15.36it/s, est. speed input: 11755.67 toks/s, output: 11.48 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:04<00:04, 15.55it/s, est. speed input: 11877.87 toks/s, output: 11.60 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:04<00:04, 15.65it/s, est. speed input: 11991.61 toks/s, output: 11.71 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:04<00:04, 15.70it/s, est. speed input: 12098.17 toks/s, output: 11.81 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:05<00:04, 15.80it/s, est. speed input: 12203.61 toks/s, output: 11.92 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:05<00:04, 15.95it/s, est. speed input: 12308.88 toks/s, output: 12.02 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:05<00:03, 16.07it/s, est. speed input: 12409.98 toks/s, output: 12.12 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:05<00:03, 16.14it/s, est. speed input: 12505.79 toks/s, output: 12.21 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:05<00:03, 16.24it/s, est. speed input: 12600.32 toks/s, output: 12.30 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:05<00:03, 16.23it/s, est. speed input: 12686.56 toks/s, output: 12.39 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:05<00:03, 16.24it/s, est. speed input: 12769.64 toks/s, output: 12.47 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:05<00:03, 16.27it/s, est. speed input: 12850.99 toks/s, output: 12.55 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:06<00:03, 16.28it/s, est. speed input: 12928.07 toks/s, output: 12.63 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:06<00:03, 16.26it/s, est. speed input: 13001.00 toks/s, output: 12.70 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:06<00:02, 16.27it/s, est. speed input: 13072.12 toks/s, output: 12.77 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:06<00:02, 16.29it/s, est. speed input: 13141.34 toks/s, output: 12.83 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:06<00:02, 16.30it/s, est. speed input: 13208.04 toks/s, output: 12.90 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:06<00:02, 16.32it/s, est. speed input: 13272.40 toks/s, output: 12.96 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:06<00:02, 16.29it/s, est. speed input: 13332.72 toks/s, output: 13.02 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:06<00:02, 16.31it/s, est. speed input: 13392.72 toks/s, output: 13.08 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:07<00:02, 16.29it/s, est. speed input: 13448.97 toks/s, output: 13.13 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:07<00:02, 16.24it/s, est. speed input: 13501.80 toks/s, output: 13.19 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:07<00:01, 16.24it/s, est. speed input: 13554.53 toks/s, output: 13.24 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:07<00:01, 16.23it/s, est. speed input: 13604.59 toks/s, output: 13.29 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:07<00:01, 16.21it/s, est. speed input: 13652.81 toks/s, output: 13.33 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:07<00:01, 16.26it/s, est. speed input: 13702.21 toks/s, output: 13.38 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:07<00:01, 16.25it/s, est. speed input: 13748.30 toks/s, output: 13.43 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:07<00:01, 16.24it/s, est. speed input: 13792.41 toks/s, output: 13.47 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:08<00:01, 16.27it/s, est. speed input: 13837.34 toks/s, output: 13.51 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:08<00:01, 16.26it/s, est. speed input: 13878.98 toks/s, output: 13.55 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:08<00:00, 16.02it/s, est. speed input: 13909.73 toks/s, output: 13.58 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:08<00:00, 16.11it/s, est. speed input: 13950.58 toks/s, output: 13.62 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:08<00:00, 16.16it/s, est. speed input: 13989.73 toks/s, output: 13.66 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:08<00:00, 16.24it/s, est. speed input: 14029.12 toks/s, output: 13.70 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:08<00:00, 16.28it/s, est. speed input: 14067.36 toks/s, output: 13.74 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:08<00:00, 16.25it/s, est. speed input: 14102.05 toks/s, output: 13.77 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:09<00:00, 16.27it/s, est. speed input: 14137.21 toks/s, output: 13.81 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:09<00:00, 16.20it/s, est. speed input: 14168.41 toks/s, output: 13.84 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 16.20it/s, est. speed input: 14184.96 toks/s, output: 13.85 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 13.85it/s, est. speed input: 14184.96 toks/s, output: 13.85 toks/s]
[rank0]:[W128 06:43:21.165860339 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 391.8s

测试结果:
  Requests/s:   15.07
  Tokens/s:     15444.65
  Total Reqs:   128
  Elapsed:      8.49s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     15429.58

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:45:36 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:45:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=807563) WARNING 01-28 06:47:21 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=807563) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=807563) WARNING 01-28 06:49:13 [backends.py:609] Failed to read file <frozen os>
Throughput: 31.42 requests/s, 32200.60 total tokens/s, 31.42 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 06:45:31] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:45:36] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:45:36] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:45:36] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:45:36] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:45:36] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:45:36] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:45:36] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:45:36] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:45:36] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:45:36] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:45:36] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:45:36] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:45:36] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:46:00] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:46:29] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:46:29] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:46:29] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:46:29] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:46:29] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:46:29] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:46:29] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:46:29] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:46:29] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:46:29] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:46:29] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:46:29] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:46:29] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 06:47:21.211081603 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=807563) [2026-01-28 06:47:37] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=807563) [2026-01-28 06:47:37] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=807563) [2026-01-28 06:47:37] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=807563) [2026-01-28 06:47:37] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=807563) [2026-01-28 06:47:37] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=807563) [2026-01-28 06:47:37] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=807563) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=807563) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.27it/s]
(EngineCore_DP0 pid=807563) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.27it/s]
(EngineCore_DP0 pid=807563) 
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=807563) [2026-01-28 06:48:27] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=807563) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:02<00:05,  2.55s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:07<00:04,  4.23s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:11<00:00,  3.80s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:11<00:00,  3.75s/it]
(EngineCore_DP0 pid=807563) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  3.43it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.73it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.87it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▎        | 35/256 [00:00<00:00, 346.73it/s]
Adding requests:  29%|██▊       | 73/256 [00:00<00:00, 364.02it/s]
Adding requests:  43%|████▎     | 110/256 [00:00<00:00, 366.69it/s]
Adding requests:  57%|█████▋    | 147/256 [00:00<00:00, 363.42it/s]
Adding requests:  72%|███████▏  | 184/256 [00:00<00:00, 361.61it/s]
Adding requests:  86%|████████▋ | 221/256 [00:00<00:00, 359.06it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 363.81it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   4%|▍         | 10/256 [00:00<00:03, 75.08it/s, est. speed input: 76893.57 toks/s, output: 75.08 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:00<00:05, 45.30it/s, est. speed input: 49672.23 toks/s, output: 48.51 toks/s]
Processed prompts:   9%|▉         | 24/256 [00:00<00:06, 38.52it/s, est. speed input: 43292.46 toks/s, output: 42.28 toks/s]
Processed prompts:  11%|█▏        | 29/256 [00:00<00:05, 39.45it/s, est. speed input: 43207.58 toks/s, output: 42.19 toks/s]
Processed prompts:  13%|█▎        | 34/256 [00:00<00:06, 35.11it/s, est. speed input: 40201.60 toks/s, output: 39.26 toks/s]
Processed prompts:  15%|█▍        | 38/256 [00:00<00:06, 34.83it/s, est. speed input: 39562.95 toks/s, output: 38.63 toks/s]
Processed prompts:  16%|█▋        | 42/256 [00:01<00:06, 34.63it/s, est. speed input: 39070.12 toks/s, output: 38.15 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:01<00:06, 34.38it/s, est. speed input: 38630.00 toks/s, output: 37.72 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:01<00:06, 34.12it/s, est. speed input: 38242.49 toks/s, output: 37.35 toks/s]
Processed prompts:  21%|██        | 54/256 [00:01<00:05, 34.03it/s, est. speed input: 37948.09 toks/s, output: 37.06 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:05, 33.91it/s, est. speed input: 37682.83 toks/s, output: 36.80 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 33.83it/s, est. speed input: 37456.25 toks/s, output: 36.58 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 33.70it/s, est. speed input: 37241.30 toks/s, output: 36.37 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 33.68it/s, est. speed input: 37069.04 toks/s, output: 36.20 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:02<00:05, 33.67it/s, est. speed input: 36916.50 toks/s, output: 36.05 toks/s]
Processed prompts:  30%|███       | 78/256 [00:02<00:05, 33.70it/s, est. speed input: 36789.85 toks/s, output: 35.93 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:02<00:05, 33.66it/s, est. speed input: 36663.82 toks/s, output: 35.80 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:05, 33.63it/s, est. speed input: 36549.46 toks/s, output: 35.69 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:04, 33.54it/s, est. speed input: 36434.44 toks/s, output: 35.58 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:04, 33.53it/s, est. speed input: 36339.32 toks/s, output: 35.49 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 33.56it/s, est. speed input: 36257.58 toks/s, output: 35.41 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 33.66it/s, est. speed input: 36194.24 toks/s, output: 35.35 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:03<00:04, 33.71it/s, est. speed input: 36133.58 toks/s, output: 35.29 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:03<00:04, 33.75it/s, est. speed input: 36077.70 toks/s, output: 35.23 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:03<00:04, 33.71it/s, est. speed input: 36016.98 toks/s, output: 35.17 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:03<00:04, 33.74it/s, est. speed input: 35967.66 toks/s, output: 35.12 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:03<00:03, 33.81it/s, est. speed input: 35927.35 toks/s, output: 35.09 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:03<00:03, 33.81it/s, est. speed input: 35884.27 toks/s, output: 35.04 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:03<00:03, 33.84it/s, est. speed input: 35847.79 toks/s, output: 35.01 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:03<00:03, 33.74it/s, est. speed input: 35799.78 toks/s, output: 34.96 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:03<00:03, 33.66it/s, est. speed input: 35754.34 toks/s, output: 34.92 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:04<00:03, 33.71it/s, est. speed input: 35721.81 toks/s, output: 34.88 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:04<00:03, 33.72it/s, est. speed input: 35688.59 toks/s, output: 34.85 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:04<00:03, 33.75it/s, est. speed input: 35659.67 toks/s, output: 34.82 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:04<00:03, 33.79it/s, est. speed input: 35633.58 toks/s, output: 34.80 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:04<00:02, 33.80it/s, est. speed input: 35607.44 toks/s, output: 34.77 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:04<00:02, 33.90it/s, est. speed input: 35591.59 toks/s, output: 34.76 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:04<00:02, 33.88it/s, est. speed input: 35568.03 toks/s, output: 34.73 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:04<00:02, 33.82it/s, est. speed input: 35541.98 toks/s, output: 34.71 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:05<00:02, 33.81it/s, est. speed input: 35519.33 toks/s, output: 34.69 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:05<00:02, 33.76it/s, est. speed input: 35495.07 toks/s, output: 34.66 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:05<00:02, 33.75it/s, est. speed input: 35472.94 toks/s, output: 34.64 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:05<00:02, 33.76it/s, est. speed input: 35453.79 toks/s, output: 34.62 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:05<00:01, 33.79it/s, est. speed input: 35436.83 toks/s, output: 34.61 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:05<00:01, 33.82it/s, est. speed input: 35421.57 toks/s, output: 34.59 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:05<00:01, 33.81it/s, est. speed input: 35404.42 toks/s, output: 34.57 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:05<00:01, 33.73it/s, est. speed input: 35382.70 toks/s, output: 34.55 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:05<00:01, 33.68it/s, est. speed input: 35362.37 toks/s, output: 34.53 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:06<00:01, 33.75it/s, est. speed input: 35350.47 toks/s, output: 34.52 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:06<00:01, 33.78it/s, est. speed input: 35337.41 toks/s, output: 34.51 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:06<00:01, 33.74it/s, est. speed input: 35320.34 toks/s, output: 34.49 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:06<00:01, 33.72it/s, est. speed input: 35304.77 toks/s, output: 34.48 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:06<00:00, 33.71it/s, est. speed input: 35290.04 toks/s, output: 34.46 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:06<00:00, 33.77it/s, est. speed input: 35280.54 toks/s, output: 34.45 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:06<00:00, 33.77it/s, est. speed input: 35268.07 toks/s, output: 34.44 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:06<00:00, 33.78it/s, est. speed input: 35257.07 toks/s, output: 34.43 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:07<00:00, 33.75it/s, est. speed input: 35244.10 toks/s, output: 34.42 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:07<00:00, 33.82it/s, est. speed input: 35236.99 toks/s, output: 34.41 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:07<00:00, 33.83it/s, est. speed input: 35227.79 toks/s, output: 34.40 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:07<00:00, 33.90it/s, est. speed input: 35221.94 toks/s, output: 34.40 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 33.90it/s, est. speed input: 35217.78 toks/s, output: 34.39 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:07<00:00, 34.39it/s, est. speed input: 35217.78 toks/s, output: 34.39 toks/s]
[rank0]:[W128 06:50:26.197009444 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 449.7s

测试结果:
  Requests/s:   31.42
  Tokens/s:     32200.60
  Total Reqs:   256
  Elapsed:      8.15s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     32169.18

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 06:53:07 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 06:53:08 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=810987) WARNING 01-28 06:54:34 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=810987) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=810987) WARNING 01-28 06:56:43 [backends.py:609] Failed to read file <frozen os>
Throughput: 52.25 requests/s, 53555.93 total tokens/s, 52.25 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 06:53:01] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:53:07] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:53:07] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:53:07] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:07] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:07] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:07] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:07] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:07] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:53:07] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:53:07] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:53:07] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:53:07] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:53:07] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 06:53:26] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 06:53:30] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 06:53:30] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 06:53:30] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:30] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:30] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:30] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:30] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 06:53:30] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 06:53:30] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 06:53:30] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 06:53:30] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 06:53:30] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 06:53:30] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=810987) [2026-01-28 06:54:46] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=810987) [2026-01-28 06:54:46] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=810987) [2026-01-28 06:54:46] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=810987) [2026-01-28 06:54:46] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=810987) [2026-01-28 06:54:46] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=810987) [2026-01-28 06:54:46] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=810987) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=810987) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.25it/s]
(EngineCore_DP0 pid=810987) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.25it/s]
(EngineCore_DP0 pid=810987) 
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:50] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:50] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:50] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:51] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:51] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:52] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:52] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=810987) [2026-01-28 06:55:52] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=810987) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:02<00:07,  2.47s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:12<00:13,  6.80s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:12<00:03,  3.97s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:13<00:00,  2.76s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:13<00:00,  3.45s/it]
(EngineCore_DP0 pid=810987) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:01,  1.20it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:01<00:00,  2.18it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:01<00:00,  2.87it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:01<00:00,  2.41it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 357.50it/s]
Adding requests:  15%|█▍        | 76/512 [00:00<00:01, 376.70it/s]
Adding requests:  22%|██▏       | 114/512 [00:00<00:01, 374.85it/s]
Adding requests:  30%|██▉       | 152/512 [00:00<00:00, 363.75it/s]
Adding requests:  37%|███▋      | 189/512 [00:00<00:00, 361.75it/s]
Adding requests:  44%|████▍     | 227/512 [00:00<00:00, 367.64it/s]
Adding requests:  52%|█████▏    | 264/512 [00:00<00:00, 368.35it/s]
Adding requests:  59%|█████▉    | 301/512 [00:00<00:00, 364.00it/s]
Adding requests:  66%|██████▌   | 339/512 [00:00<00:00, 367.37it/s]
Adding requests:  74%|███████▍  | 378/512 [00:01<00:00, 372.23it/s]
Adding requests:  81%|████████▏ | 416/512 [00:01<00:00, 373.05it/s]
Adding requests:  89%|████████▊ | 454/512 [00:01<00:00, 372.57it/s]
Adding requests:  96%|█████████▌| 492/512 [00:01<00:00, 373.44it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 369.28it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:00<00:01, 421.28it/s, est. speed input: 431455.93 toks/s, output: 421.30 toks/s]
Processed prompts:  21%|██▏       | 109/512 [00:00<00:03, 104.68it/s, est. speed input: 124145.63 toks/s, output: 121.24 toks/s]
Processed prompts:  25%|██▌       | 130/512 [00:01<00:04, 80.07it/s, est. speed input: 99001.41 toks/s, output: 96.68 toks/s]   
Processed prompts:  28%|██▊       | 144/512 [00:01<00:04, 76.05it/s, est. speed input: 94081.00 toks/s, output: 91.88 toks/s]
Processed prompts:  30%|███       | 155/512 [00:01<00:05, 69.35it/s, est. speed input: 88652.02 toks/s, output: 86.57 toks/s]
Processed prompts:  32%|███▏      | 164/512 [00:01<00:05, 67.60it/s, est. speed input: 86582.01 toks/s, output: 84.55 toks/s]
Processed prompts:  34%|███▎      | 172/512 [00:02<00:05, 64.57it/s, est. speed input: 84318.10 toks/s, output: 82.34 toks/s]
Processed prompts:  35%|███▍      | 179/512 [00:02<00:05, 60.49it/s, est. speed input: 81934.63 toks/s, output: 80.01 toks/s]
Processed prompts:  36%|███▋      | 186/512 [00:02<00:05, 57.10it/s, est. speed input: 79829.45 toks/s, output: 77.96 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:02<00:05, 56.24it/s, est. speed input: 78380.00 toks/s, output: 76.54 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:02<00:05, 55.56it/s, est. speed input: 77086.20 toks/s, output: 75.28 toks/s]
Processed prompts:  41%|████      | 210/512 [00:02<00:05, 55.09it/s, est. speed input: 75938.94 toks/s, output: 74.16 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:02<00:05, 54.68it/s, est. speed input: 74888.62 toks/s, output: 73.13 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:03<00:05, 54.38it/s, est. speed input: 73937.47 toks/s, output: 72.20 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:03<00:05, 54.16it/s, est. speed input: 73072.34 toks/s, output: 71.36 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:03<00:05, 53.97it/s, est. speed input: 72276.24 toks/s, output: 70.58 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:03<00:04, 53.88it/s, est. speed input: 71554.80 toks/s, output: 69.88 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:03<00:04, 53.81it/s, est. speed input: 70889.44 toks/s, output: 69.23 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:03<00:04, 53.69it/s, est. speed input: 70263.13 toks/s, output: 68.62 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:04<00:04, 53.70it/s, est. speed input: 69699.99 toks/s, output: 68.07 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:04<00:04, 53.67it/s, est. speed input: 69169.69 toks/s, output: 67.55 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:04<00:04, 53.68it/s, est. speed input: 68681.70 toks/s, output: 67.07 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:04<00:03, 53.64it/s, est. speed input: 68218.50 toks/s, output: 66.62 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:04<00:03, 53.68it/s, est. speed input: 67795.33 toks/s, output: 66.21 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:04<00:03, 53.62it/s, est. speed input: 67387.21 toks/s, output: 65.81 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:04<00:03, 53.61it/s, est. speed input: 67007.09 toks/s, output: 65.44 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:05<00:03, 53.56it/s, est. speed input: 66644.84 toks/s, output: 65.08 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:05<00:03, 53.52it/s, est. speed input: 66302.81 toks/s, output: 64.75 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:05<00:03, 53.58it/s, est. speed input: 65989.31 toks/s, output: 64.44 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:05<00:02, 53.61it/s, est. speed input: 65691.71 toks/s, output: 64.15 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:05<00:02, 53.67it/s, est. speed input: 65413.48 toks/s, output: 63.88 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:05<00:02, 53.64it/s, est. speed input: 65142.44 toks/s, output: 63.62 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:05<00:02, 53.57it/s, est. speed input: 64880.18 toks/s, output: 63.36 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:06<00:02, 53.58it/s, est. speed input: 64636.19 toks/s, output: 63.12 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:06<00:02, 53.60it/s, est. speed input: 64406.66 toks/s, output: 62.90 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:06<00:02, 53.57it/s, est. speed input: 64182.26 toks/s, output: 62.68 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:06<00:01, 53.65it/s, est. speed input: 63977.33 toks/s, output: 62.48 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:06<00:01, 53.68it/s, est. speed input: 63778.07 toks/s, output: 62.28 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:06<00:01, 53.71it/s, est. speed input: 63588.58 toks/s, output: 62.10 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:07<00:01, 53.69it/s, est. speed input: 63405.30 toks/s, output: 61.92 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:07<00:01, 53.70it/s, est. speed input: 63230.83 toks/s, output: 61.75 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:07<00:01, 53.69it/s, est. speed input: 63061.16 toks/s, output: 61.58 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:07<00:01, 53.72it/s, est. speed input: 62902.00 toks/s, output: 61.43 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:07<00:00, 53.76it/s, est. speed input: 62750.23 toks/s, output: 61.28 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:07<00:00, 53.79it/s, est. speed input: 62604.86 toks/s, output: 61.14 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:07<00:00, 53.82it/s, est. speed input: 62465.53 toks/s, output: 61.00 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:08<00:00, 53.86it/s, est. speed input: 62333.08 toks/s, output: 60.87 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:08<00:00, 53.86it/s, est. speed input: 62202.25 toks/s, output: 60.74 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:08<00:00, 53.86it/s, est. speed input: 62077.08 toks/s, output: 60.62 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 53.86it/s, est. speed input: 62333.95 toks/s, output: 60.87 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 60.87it/s, est. speed input: 62333.95 toks/s, output: 60.87 toks/s]
[rank0]:[W128 06:57:44.895753425 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 380.4s

测试结果:
  Requests/s:   52.25
  Tokens/s:     53555.93
  Total Reqs:   512
  Elapsed:      9.80s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     53503.68

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:00:11 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:00:12 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=814330) WARNING 01-28 07:01:19 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=814330) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=814330) WARNING 01-28 07:03:39 [backends.py:609] Failed to read file <frozen os>
Throughput: 32.78 requests/s, 33601.91 total tokens/s, 32.78 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 07:00:07] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:00:11] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:00:11] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:00:11] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:00:11] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:00:11] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:00:11] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:00:11] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:00:11] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:00:11] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:00:11] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:00:11] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:00:11] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:00:11] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:00:31] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:01:05] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:01:05] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:01:05] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:01:05] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:01:05] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:01:05] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:01:05] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:01:05] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:01:05] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:01:05] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:01:05] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:01:05] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:01:05] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=814330) [2026-01-28 07:01:26] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=814330) [2026-01-28 07:01:26] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=814330) [2026-01-28 07:01:26] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=814330) [2026-01-28 07:01:26] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=814330) [2026-01-28 07:01:26] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=814330) [2026-01-28 07:01:26] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=814330) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=814330) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.23it/s]
(EngineCore_DP0 pid=814330) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.23it/s]
(EngineCore_DP0 pid=814330) 
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=814330) [2026-01-28 07:02:33] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=814330) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:01<00:07,  1.97s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:03<00:05,  2.00s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:06<00:04,  2.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:08<00:02,  2.04s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:09<00:00,  1.84s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:09<00:00,  1.95s/it]
(EngineCore_DP0 pid=814330) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:01,  2.76it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  3.46it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:01<00:00,  2.49it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:01<00:00,  2.18it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:01<00:00,  2.38it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 35/1024 [00:00<00:02, 348.76it/s]
Adding requests:   7%|▋         | 74/1024 [00:00<00:02, 371.42it/s]
Adding requests:  11%|█         | 113/1024 [00:00<00:02, 378.11it/s]
Adding requests:  15%|█▍        | 151/1024 [00:00<00:02, 377.98it/s]
Adding requests:  19%|█▊        | 190/1024 [00:00<00:02, 381.61it/s]
Adding requests:  22%|██▏       | 230/1024 [00:00<00:02, 386.32it/s]
Adding requests:  26%|██▋       | 270/1024 [00:00<00:01, 388.87it/s]
Adding requests:  30%|███       | 309/1024 [00:00<00:01, 386.36it/s]
Adding requests:  34%|███▍      | 348/1024 [00:00<00:01, 385.10it/s]
Adding requests:  38%|███▊      | 387/1024 [00:01<00:01, 386.19it/s]
Adding requests:  42%|████▏     | 427/1024 [00:01<00:01, 387.73it/s]
Adding requests:  46%|████▌     | 467/1024 [00:01<00:01, 388.57it/s]
Adding requests:  49%|████▉     | 506/1024 [00:01<00:01, 386.63it/s]
Adding requests:  53%|█████▎    | 545/1024 [00:01<00:01, 379.59it/s]
Adding requests:  57%|█████▋    | 586/1024 [00:01<00:01, 388.39it/s]
Adding requests:  61%|██████    | 627/1024 [00:01<00:01, 393.42it/s]
Adding requests:  65%|██████▌   | 667/1024 [00:01<00:00, 388.43it/s]
Adding requests:  69%|██████▉   | 708/1024 [00:01<00:00, 393.39it/s]
Adding requests:  73%|███████▎  | 748/1024 [00:01<00:00, 391.36it/s]
Adding requests:  77%|███████▋  | 789/1024 [00:02<00:00, 392.75it/s]
Adding requests:  81%|████████  | 829/1024 [00:02<00:00, 386.87it/s]
Adding requests:  85%|████████▍ | 869/1024 [00:02<00:00, 389.28it/s]
Adding requests:  89%|████████▉ | 911/1024 [00:02<00:00, 396.44it/s]
Adding requests:  93%|█████████▎| 951/1024 [00:02<00:00, 396.98it/s]
Adding requests:  97%|█████████▋| 993/1024 [00:02<00:00, 401.25it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 389.82it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/1024 [00:09<1:25:02,  4.99s/it, est. speed input: 205.08 toks/s, output: 0.20 toks/s]
Processed prompts:   1%|          | 10/1024 [00:10<12:49,  1.32it/s, est. speed input: 1010.94 toks/s, output: 0.99 toks/s]
Processed prompts:   2%|▏         | 18/1024 [00:10<05:54,  2.84it/s, est. speed input: 1794.34 toks/s, output: 1.75 toks/s]
Processed prompts:   3%|▎         | 26/1024 [00:10<03:25,  4.87it/s, est. speed input: 2555.59 toks/s, output: 2.50 toks/s]
Processed prompts:   3%|▎         | 34/1024 [00:10<02:11,  7.50it/s, est. speed input: 3295.83 toks/s, output: 3.22 toks/s]
Processed prompts:   4%|▍         | 42/1024 [00:10<01:30, 10.82it/s, est. speed input: 4016.02 toks/s, output: 3.92 toks/s]
Processed prompts:   5%|▍         | 50/1024 [00:10<01:05, 14.84it/s, est. speed input: 4716.90 toks/s, output: 4.61 toks/s]
Processed prompts:   6%|▌         | 58/1024 [00:11<00:49, 19.44it/s, est. speed input: 5399.16 toks/s, output: 5.27 toks/s]
Processed prompts:   6%|▋         | 66/1024 [00:11<00:39, 24.45it/s, est. speed input: 6063.61 toks/s, output: 5.92 toks/s]
Processed prompts:   7%|▋         | 74/1024 [00:11<00:32, 29.57it/s, est. speed input: 6710.98 toks/s, output: 6.55 toks/s]
Processed prompts:   8%|▊         | 82/1024 [00:11<00:27, 34.47it/s, est. speed input: 7341.87 toks/s, output: 7.17 toks/s]
Processed prompts:   9%|▉         | 90/1024 [00:11<00:24, 38.90it/s, est. speed input: 7956.81 toks/s, output: 7.77 toks/s]
Processed prompts:  10%|▉         | 98/1024 [00:11<00:21, 42.70it/s, est. speed input: 8556.60 toks/s, output: 8.36 toks/s]
Processed prompts:  10%|█         | 106/1024 [00:11<00:20, 45.82it/s, est. speed input: 9141.90 toks/s, output: 8.93 toks/s]
Processed prompts:  11%|█         | 114/1024 [00:12<00:18, 48.20it/s, est. speed input: 9712.48 toks/s, output: 9.48 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:12<00:18, 50.08it/s, est. speed input: 10269.85 toks/s, output: 10.03 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:12<00:17, 51.46it/s, est. speed input: 10813.90 toks/s, output: 10.56 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:12<00:16, 52.46it/s, est. speed input: 11345.19 toks/s, output: 11.08 toks/s]
Processed prompts:  14%|█▍        | 146/1024 [00:12<00:16, 53.16it/s, est. speed input: 11864.04 toks/s, output: 11.59 toks/s]
Processed prompts:  15%|█▌        | 154/1024 [00:12<00:16, 53.69it/s, est. speed input: 12371.19 toks/s, output: 12.08 toks/s]
Processed prompts:  16%|█▌        | 162/1024 [00:12<00:15, 54.01it/s, est. speed input: 12866.46 toks/s, output: 12.56 toks/s]
Processed prompts:  17%|█▋        | 170/1024 [00:13<00:15, 54.29it/s, est. speed input: 13351.04 toks/s, output: 13.04 toks/s]
Processed prompts:  17%|█▋        | 178/1024 [00:13<00:15, 54.50it/s, est. speed input: 13825.09 toks/s, output: 13.50 toks/s]
Processed prompts:  18%|█▊        | 186/1024 [00:13<00:15, 54.64it/s, est. speed input: 14288.69 toks/s, output: 13.95 toks/s]
Processed prompts:  19%|█▉        | 194/1024 [00:13<00:15, 54.73it/s, est. speed input: 14742.27 toks/s, output: 14.40 toks/s]
Processed prompts:  20%|█▉        | 202/1024 [00:13<00:14, 54.81it/s, est. speed input: 15186.24 toks/s, output: 14.83 toks/s]
Processed prompts:  21%|██        | 210/1024 [00:13<00:14, 54.82it/s, est. speed input: 15620.38 toks/s, output: 15.25 toks/s]
Processed prompts:  21%|██▏       | 218/1024 [00:13<00:14, 54.86it/s, est. speed input: 16045.80 toks/s, output: 15.67 toks/s]
Processed prompts:  22%|██▏       | 226/1024 [00:14<00:14, 54.85it/s, est. speed input: 16461.94 toks/s, output: 16.08 toks/s]
Processed prompts:  23%|██▎       | 234/1024 [00:14<00:14, 54.87it/s, est. speed input: 16869.86 toks/s, output: 16.47 toks/s]
Processed prompts:  24%|██▎       | 242/1024 [00:14<00:14, 54.91it/s, est. speed input: 17269.74 toks/s, output: 16.86 toks/s]
Processed prompts:  24%|██▍       | 250/1024 [00:14<00:14, 54.92it/s, est. speed input: 17661.48 toks/s, output: 17.25 toks/s]
Processed prompts:  25%|██▌       | 258/1024 [00:14<00:13, 54.92it/s, est. speed input: 18045.31 toks/s, output: 17.62 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:14<00:13, 54.94it/s, est. speed input: 18421.72 toks/s, output: 17.99 toks/s]
Processed prompts:  27%|██▋       | 274/1024 [00:14<00:13, 54.91it/s, est. speed input: 18790.44 toks/s, output: 18.35 toks/s]
Processed prompts:  28%|██▊       | 282/1024 [00:15<00:13, 54.90it/s, est. speed input: 19152.07 toks/s, output: 18.70 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:15<00:13, 54.88it/s, est. speed input: 19506.69 toks/s, output: 19.05 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:15<00:13, 54.86it/s, est. speed input: 19854.42 toks/s, output: 19.39 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:15<00:13, 54.86it/s, est. speed input: 20195.74 toks/s, output: 19.72 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:15<00:12, 54.86it/s, est. speed input: 20530.84 toks/s, output: 20.05 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:15<00:12, 54.84it/s, est. speed input: 20859.38 toks/s, output: 20.37 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:15<00:12, 54.74it/s, est. speed input: 21181.00 toks/s, output: 20.68 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:16<00:12, 54.80it/s, est. speed input: 21498.30 toks/s, output: 20.99 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:16<00:12, 54.83it/s, est. speed input: 21809.74 toks/s, output: 21.30 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:16<00:12, 54.81it/s, est. speed input: 22115.13 toks/s, output: 21.60 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:16<00:12, 54.83it/s, est. speed input: 22415.57 toks/s, output: 21.89 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:16<00:11, 54.87it/s, est. speed input: 22711.00 toks/s, output: 22.18 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:16<00:11, 54.89it/s, est. speed input: 23001.24 toks/s, output: 22.46 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:16<00:11, 54.90it/s, est. speed input: 23286.59 toks/s, output: 22.74 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:17<00:11, 54.93it/s, est. speed input: 23567.22 toks/s, output: 23.01 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:17<00:11, 54.93it/s, est. speed input: 23842.90 toks/s, output: 23.28 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:17<00:11, 54.90it/s, est. speed input: 24113.57 toks/s, output: 23.55 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:17<00:11, 54.89it/s, est. speed input: 24379.95 toks/s, output: 23.81 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:17<00:10, 54.88it/s, est. speed input: 24641.81 toks/s, output: 24.06 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:17<00:10, 54.84it/s, est. speed input: 24899.07 toks/s, output: 24.32 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:17<00:10, 54.81it/s, est. speed input: 25152.06 toks/s, output: 24.56 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:18<00:10, 54.25it/s, est. speed input: 25394.23 toks/s, output: 24.80 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:18<00:10, 54.42it/s, est. speed input: 25639.46 toks/s, output: 25.04 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:18<00:10, 54.55it/s, est. speed input: 25881.21 toks/s, output: 25.27 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:18<00:10, 54.66it/s, est. speed input: 26118.91 toks/s, output: 25.51 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:18<00:09, 54.72it/s, est. speed input: 26353.02 toks/s, output: 25.74 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:18<00:09, 54.77it/s, est. speed input: 26583.47 toks/s, output: 25.96 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:19<00:09, 54.80it/s, est. speed input: 26810.41 toks/s, output: 26.18 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:19<00:09, 54.81it/s, est. speed input: 27033.77 toks/s, output: 26.40 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:19<00:09, 54.79it/s, est. speed input: 27253.40 toks/s, output: 26.61 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:19<00:09, 54.80it/s, est. speed input: 27469.96 toks/s, output: 26.83 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:19<00:09, 54.80it/s, est. speed input: 27683.33 toks/s, output: 27.03 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:19<00:08, 54.79it/s, est. speed input: 27893.38 toks/s, output: 27.24 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:19<00:08, 54.81it/s, est. speed input: 28100.58 toks/s, output: 27.44 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:20<00:08, 54.80it/s, est. speed input: 28304.55 toks/s, output: 27.64 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:20<00:08, 54.82it/s, est. speed input: 28505.92 toks/s, output: 27.84 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:20<00:08, 54.80it/s, est. speed input: 28703.92 toks/s, output: 28.03 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:20<00:08, 54.80it/s, est. speed input: 28899.35 toks/s, output: 28.22 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:20<00:07, 54.82it/s, est. speed input: 29092.25 toks/s, output: 28.41 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:20<00:07, 54.84it/s, est. speed input: 29282.52 toks/s, output: 28.60 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:20<00:07, 54.87it/s, est. speed input: 29470.25 toks/s, output: 28.78 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:21<00:07, 54.88it/s, est. speed input: 29655.26 toks/s, output: 28.96 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:21<00:07, 54.88it/s, est. speed input: 29837.68 toks/s, output: 29.14 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:21<00:07, 54.89it/s, est. speed input: 30017.81 toks/s, output: 29.31 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:21<00:07, 54.72it/s, est. speed input: 30193.16 toks/s, output: 29.49 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:21<00:06, 54.73it/s, est. speed input: 30367.82 toks/s, output: 29.66 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:21<00:06, 54.76it/s, est. speed input: 30540.38 toks/s, output: 29.82 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:21<00:06, 54.69it/s, est. speed input: 30709.59 toks/s, output: 29.99 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:23<00:21, 16.31it/s, est. speed input: 29352.65 toks/s, output: 28.66 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:23<00:16, 20.60it/s, est. speed input: 29514.68 toks/s, output: 28.82 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:23<00:13, 25.25it/s, est. speed input: 29674.36 toks/s, output: 28.98 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:23<00:11, 29.98it/s, est. speed input: 29832.22 toks/s, output: 29.13 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:23<00:09, 34.51it/s, est. speed input: 29988.10 toks/s, output: 29.29 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:23<00:08, 38.61it/s, est. speed input: 30142.46 toks/s, output: 29.44 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:24<00:07, 42.11it/s, est. speed input: 30294.73 toks/s, output: 29.58 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:24<00:06, 44.93it/s, est. speed input: 30444.70 toks/s, output: 29.73 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:24<00:06, 47.15it/s, est. speed input: 30592.95 toks/s, output: 29.88 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:24<00:05, 48.83it/s, est. speed input: 30739.30 toks/s, output: 30.02 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:24<00:05, 50.14it/s, est. speed input: 30884.50 toks/s, output: 30.16 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:24<00:05, 51.08it/s, est. speed input: 31027.87 toks/s, output: 30.30 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:25<00:05, 51.76it/s, est. speed input: 31169.48 toks/s, output: 30.44 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:25<00:04, 52.22it/s, est. speed input: 31309.15 toks/s, output: 30.58 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:25<00:04, 52.56it/s, est. speed input: 31447.26 toks/s, output: 30.71 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:25<00:04, 52.80it/s, est. speed input: 31583.76 toks/s, output: 30.84 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:25<00:04, 52.94it/s, est. speed input: 31718.22 toks/s, output: 30.97 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:25<00:04, 53.07it/s, est. speed input: 31851.63 toks/s, output: 31.11 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:25<00:04, 53.16it/s, est. speed input: 31983.37 toks/s, output: 31.23 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:26<00:03, 53.25it/s, est. speed input: 32113.98 toks/s, output: 31.36 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:26<00:03, 53.30it/s, est. speed input: 32242.96 toks/s, output: 31.49 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:26<00:03, 53.33it/s, est. speed input: 32370.34 toks/s, output: 31.61 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:26<00:03, 53.37it/s, est. speed input: 32496.49 toks/s, output: 31.73 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:26<00:03, 53.38it/s, est. speed input: 32621.10 toks/s, output: 31.86 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:26<00:03, 53.38it/s, est. speed input: 32744.17 toks/s, output: 31.98 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:26<00:02, 53.37it/s, est. speed input: 32865.84 toks/s, output: 32.10 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:27<00:02, 53.39it/s, est. speed input: 32986.38 toks/s, output: 32.21 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:27<00:02, 53.36it/s, est. speed input: 33105.14 toks/s, output: 32.33 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:27<00:02, 53.34it/s, est. speed input: 33222.64 toks/s, output: 32.44 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:27<00:02, 53.32it/s, est. speed input: 33338.75 toks/s, output: 32.56 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:27<00:02, 53.33it/s, est. speed input: 33453.88 toks/s, output: 32.67 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:27<00:02, 53.34it/s, est. speed input: 33567.85 toks/s, output: 32.78 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:28<00:01, 53.35it/s, est. speed input: 33680.61 toks/s, output: 32.89 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:28<00:01, 53.78it/s, est. speed input: 33796.87 toks/s, output: 33.00 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:28<00:01, 54.08it/s, est. speed input: 33911.90 toks/s, output: 33.12 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:28<00:01, 54.27it/s, est. speed input: 34025.52 toks/s, output: 33.23 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:28<00:01, 54.42it/s, est. speed input: 34138.07 toks/s, output: 33.34 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:28<00:01, 54.51it/s, est. speed input: 34249.38 toks/s, output: 33.45 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:28<00:00, 54.57it/s, est. speed input: 34359.49 toks/s, output: 33.55 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:29<00:00, 54.62it/s, est. speed input: 34468.67 toks/s, output: 33.66 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:29<00:00, 56.55it/s, est. speed input: 34596.05 toks/s, output: 33.79 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:29<00:00, 55.98it/s, est. speed input: 34702.80 toks/s, output: 33.89 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:29<00:00, 55.63it/s, est. speed input: 34808.90 toks/s, output: 33.99 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:29<00:00, 55.37it/s, est. speed input: 34913.89 toks/s, output: 34.10 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:29<00:00, 57.31it/s, est. speed input: 35038.74 toks/s, output: 34.22 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:29<00:00, 57.31it/s, est. speed input: 35244.95 toks/s, output: 34.42 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:29<00:00, 34.42it/s, est. speed input: 35244.95 toks/s, output: 34.42 toks/s]
[rank0]:[W128 07:05:16.509222711 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 458.7s

测试结果:
  Requests/s:   32.78
  Tokens/s:     33601.91
  Total Reqs:   1024
  Elapsed:      31.24s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     33569.13

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:07:27 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:07:28 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=817764) WARNING 01-28 07:09:55 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=817764) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=817764) WARNING 01-28 07:11:03 [backends.py:609] Failed to read file <frozen os>
Throughput: 52.75 requests/s, 54065.00 total tokens/s, 52.75 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 07:07:13] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:07:27] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:07:27] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:07:27] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:07:27] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:07:27] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:07:27] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:07:27] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:07:27] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:07:27] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:07:27] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:07:27] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:07:27] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:07:27] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:08:00] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:08:08] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:08:08] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:08:08] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:08:08] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:08:08] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:08:08] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:08:08] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:08:08] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:08:08] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:08:08] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:08:08] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:08:08] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:08:08] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 07:09:55.387440171 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=817764) [2026-01-28 07:09:58] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=817764) [2026-01-28 07:09:58] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=817764) [2026-01-28 07:09:58] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=817764) [2026-01-28 07:09:58] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=817764) [2026-01-28 07:09:58] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=817764) [2026-01-28 07:09:58] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=817764) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=817764) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.30it/s]
(EngineCore_DP0 pid=817764) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.30it/s]
(EngineCore_DP0 pid=817764) 
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:09] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=817764) [2026-01-28 07:10:10] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=817764) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:07<00:45,  7.64s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:10<00:24,  4.83s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:13<00:16,  4.10s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:25<00:21,  7.01s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:26<00:09,  5.00s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:29<00:04,  4.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:29<00:00,  3.04s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:29<00:00,  4.28s/it]
(EngineCore_DP0 pid=817764) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:01<00:04,  1.23s/it]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:02<00:03,  1.16s/it]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:05<00:01,  1.45s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:07<00:00,  1.43s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:07<00:00,  1.40s/it]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 36/2048 [00:00<00:05, 353.47it/s]
Adding requests:   4%|▎         | 75/2048 [00:00<00:05, 369.34it/s]
Adding requests:   6%|▌         | 114/2048 [00:00<00:05, 374.13it/s]
Adding requests:   7%|▋         | 152/2048 [00:00<00:05, 372.14it/s]
Adding requests:   9%|▉         | 190/2048 [00:00<00:05, 367.44it/s]
Adding requests:  11%|█         | 227/2048 [00:00<00:04, 367.50it/s]
Adding requests:  13%|█▎        | 264/2048 [00:00<00:04, 368.28it/s]
Adding requests:  15%|█▍        | 301/2048 [00:00<00:04, 365.55it/s]
Adding requests:  17%|█▋        | 338/2048 [00:00<00:04, 366.40it/s]
Adding requests:  18%|█▊        | 375/2048 [00:01<00:04, 367.21it/s]
Adding requests:  20%|██        | 413/2048 [00:01<00:04, 370.33it/s]
Adding requests:  22%|██▏       | 451/2048 [00:01<00:04, 370.90it/s]
Adding requests:  24%|██▍       | 489/2048 [00:01<00:04, 370.19it/s]
Adding requests:  26%|██▌       | 527/2048 [00:01<00:04, 365.23it/s]
Adding requests:  28%|██▊       | 567/2048 [00:01<00:03, 373.45it/s]
Adding requests:  30%|██▉       | 605/2048 [00:01<00:03, 375.28it/s]
Adding requests:  32%|███▏      | 646/2048 [00:01<00:03, 382.91it/s]
Adding requests:  33%|███▎      | 686/2048 [00:01<00:03, 385.46it/s]
Adding requests:  35%|███▌      | 726/2048 [00:01<00:03, 388.09it/s]
Adding requests:  37%|███▋      | 765/2048 [00:02<00:03, 380.96it/s]
Adding requests:  39%|███▉      | 804/2048 [00:02<00:03, 375.83it/s]
Adding requests:  41%|████      | 842/2048 [00:02<00:03, 370.40it/s]
Adding requests:  43%|████▎     | 880/2048 [00:02<00:03, 367.37it/s]
Adding requests:  45%|████▍     | 919/2048 [00:02<00:03, 372.21it/s]
Adding requests:  47%|████▋     | 957/2048 [00:02<00:02, 372.92it/s]
Adding requests:  49%|████▊     | 996/2048 [00:02<00:02, 377.81it/s]
Adding requests:  50%|█████     | 1034/2048 [00:02<00:02, 376.67it/s]
Adding requests:  52%|█████▏    | 1072/2048 [00:02<00:02, 374.63it/s]
Adding requests:  54%|█████▍    | 1112/2048 [00:02<00:02, 379.89it/s]
Adding requests:  56%|█████▌    | 1150/2048 [00:03<00:02, 376.11it/s]
Adding requests:  58%|█████▊    | 1192/2048 [00:03<00:02, 386.44it/s]
Adding requests:  60%|██████    | 1231/2048 [00:03<00:02, 384.30it/s]
Adding requests:  62%|██████▏   | 1270/2048 [00:03<00:02, 380.15it/s]
Adding requests:  64%|██████▍   | 1310/2048 [00:03<00:01, 383.97it/s]
Adding requests:  66%|██████▌   | 1350/2048 [00:03<00:01, 387.76it/s]
Adding requests:  68%|██████▊   | 1390/2048 [00:03<00:01, 388.50it/s]
Adding requests:  70%|██████▉   | 1429/2048 [00:03<00:01, 388.61it/s]
Adding requests:  72%|███████▏  | 1469/2048 [00:03<00:01, 389.71it/s]
Adding requests:  74%|███████▎  | 1509/2048 [00:03<00:01, 391.46it/s]
Adding requests:  76%|███████▌  | 1549/2048 [00:04<00:01, 389.23it/s]
Adding requests:  78%|███████▊  | 1589/2048 [00:04<00:01, 389.81it/s]
Adding requests:  80%|███████▉  | 1629/2048 [00:04<00:01, 390.43it/s]
Adding requests:  81%|████████▏ | 1669/2048 [00:04<00:00, 386.96it/s]
Adding requests:  83%|████████▎ | 1708/2048 [00:04<00:00, 387.20it/s]
Adding requests:  85%|████████▌ | 1747/2048 [00:04<00:00, 386.26it/s]
Adding requests:  87%|████████▋ | 1786/2048 [00:04<00:00, 386.36it/s]
Adding requests:  89%|████████▉ | 1825/2048 [00:04<00:00, 383.19it/s]
Adding requests:  91%|█████████ | 1864/2048 [00:04<00:00, 382.14it/s]
Adding requests:  93%|█████████▎| 1904/2048 [00:05<00:00, 384.79it/s]
Adding requests:  95%|█████████▍| 1943/2048 [00:05<00:00, 380.65it/s]
Adding requests:  97%|█████████▋| 1982/2048 [00:05<00:00, 383.19it/s]
Adding requests:  99%|█████████▊| 2021/2048 [00:05<00:00, 374.72it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 379.00it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:00<00:01, 1158.39it/s, est. speed input: 1186349.43 toks/s, output: 1158.44 toks/s]
Processed prompts:  17%|█▋        | 358/2048 [00:02<00:12, 136.93it/s, est. speed input: 170744.84 toks/s, output: 166.74 toks/s]   
Processed prompts:  20%|██        | 410/2048 [00:02<00:14, 110.07it/s, est. speed input: 141105.27 toks/s, output: 137.80 toks/s]
Processed prompts:  22%|██▏       | 441/2048 [00:03<00:16, 96.24it/s, est. speed input: 128014.94 toks/s, output: 125.01 toks/s] 
Processed prompts:  23%|██▎       | 462/2048 [00:03<00:17, 93.11it/s, est. speed input: 124369.32 toks/s, output: 121.45 toks/s]
Processed prompts:  23%|██▎       | 479/2048 [00:04<00:17, 87.43it/s, est. speed input: 120236.10 toks/s, output: 117.42 toks/s]
Processed prompts:  24%|██▍       | 492/2048 [00:04<00:19, 79.09it/s, est. speed input: 115649.17 toks/s, output: 112.94 toks/s]
Processed prompts:  25%|██▍       | 503/2048 [00:04<00:22, 70.18it/s, est. speed input: 111187.61 toks/s, output: 108.58 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:04<00:24, 62.74it/s, est. speed input: 107224.01 toks/s, output: 104.71 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:05<00:24, 61.51it/s, est. speed input: 104676.56 toks/s, output: 102.22 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:05<00:24, 60.53it/s, est. speed input: 102379.57 toks/s, output: 99.98 toks/s] 
Processed prompts:  27%|██▋       | 562/2048 [00:05<00:24, 59.81it/s, est. speed input: 100306.89 toks/s, output: 97.96 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:06<00:24, 59.27it/s, est. speed input: 98424.52 toks/s, output: 96.12 toks/s] 
Processed prompts:  29%|██▉       | 594/2048 [00:06<00:24, 58.88it/s, est. speed input: 96705.78 toks/s, output: 94.44 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:06<00:24, 58.59it/s, est. speed input: 95130.12 toks/s, output: 92.90 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:06<00:24, 57.11it/s, est. speed input: 93397.68 toks/s, output: 91.21 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:07<00:25, 55.77it/s, est. speed input: 91734.17 toks/s, output: 89.58 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:07<00:25, 54.91it/s, est. speed input: 90216.92 toks/s, output: 88.10 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:07<00:25, 54.35it/s, est. speed input: 88825.33 toks/s, output: 86.74 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:08<00:25, 53.79it/s, est. speed input: 87502.42 toks/s, output: 85.45 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:08<00:25, 53.24it/s, est. speed input: 86245.74 toks/s, output: 84.22 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:08<00:25, 52.90it/s, est. speed input: 85084.25 toks/s, output: 83.09 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:08<00:24, 52.67it/s, est. speed input: 84002.13 toks/s, output: 82.03 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:09<00:24, 52.49it/s, est. speed input: 82990.21 toks/s, output: 81.04 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:09<00:24, 52.38it/s, est. speed input: 82043.51 toks/s, output: 80.12 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:09<00:24, 52.28it/s, est. speed input: 81152.17 toks/s, output: 79.25 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:10<00:23, 52.22it/s, est. speed input: 80316.08 toks/s, output: 78.43 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:10<00:23, 52.17it/s, est. speed input: 79528.22 toks/s, output: 77.66 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:10<00:23, 52.15it/s, est. speed input: 78786.33 toks/s, output: 76.94 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:11<00:22, 52.14it/s, est. speed input: 78086.14 toks/s, output: 76.26 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:11<00:22, 52.13it/s, est. speed input: 77423.42 toks/s, output: 75.61 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:11<00:22, 52.10it/s, est. speed input: 76792.33 toks/s, output: 74.99 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:12<00:22, 52.08it/s, est. speed input: 76193.51 toks/s, output: 74.41 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:12<00:21, 52.09it/s, est. speed input: 75627.07 toks/s, output: 73.85 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:12<00:21, 52.08it/s, est. speed input: 75086.44 toks/s, output: 73.33 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:12<00:21, 52.09it/s, est. speed input: 74572.85 toks/s, output: 72.82 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:13<00:20, 52.09it/s, est. speed input: 74082.04 toks/s, output: 72.35 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:13<00:20, 52.94it/s, est. speed input: 73703.05 toks/s, output: 71.98 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:13<00:20, 52.67it/s, est. speed input: 73251.79 toks/s, output: 71.53 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:14<00:19, 52.48it/s, est. speed input: 72819.77 toks/s, output: 71.11 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:14<00:19, 52.37it/s, est. speed input: 72407.81 toks/s, output: 70.71 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:14<00:19, 52.27it/s, est. speed input: 72011.18 toks/s, output: 70.32 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:15<00:18, 52.25it/s, est. speed input: 71635.26 toks/s, output: 69.96 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:15<00:18, 52.14it/s, est. speed input: 71265.20 toks/s, output: 69.59 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:15<00:18, 52.10it/s, est. speed input: 70913.53 toks/s, output: 69.25 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:16<00:18, 52.27it/s, est. speed input: 70591.74 toks/s, output: 68.94 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:16<00:17, 52.67it/s, est. speed input: 70305.27 toks/s, output: 68.66 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:16<00:17, 52.92it/s, est. speed input: 70027.02 toks/s, output: 68.39 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:16<00:16, 54.04it/s, est. speed input: 69830.47 toks/s, output: 68.19 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:17<00:16, 53.91it/s, est. speed input: 69571.89 toks/s, output: 67.94 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:17<00:16, 53.81it/s, est. speed input: 69321.12 toks/s, output: 67.70 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:17<00:15, 53.75it/s, est. speed input: 69079.48 toks/s, output: 67.46 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:18<00:15, 53.70it/s, est. speed input: 68845.06 toks/s, output: 67.23 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:18<00:15, 53.65it/s, est. speed input: 68617.38 toks/s, output: 67.01 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:18<00:14, 53.61it/s, est. speed input: 68397.08 toks/s, output: 66.79 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:19<00:14, 53.58it/s, est. speed input: 68182.68 toks/s, output: 66.58 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:19<00:14, 53.55it/s, est. speed input: 67975.09 toks/s, output: 66.38 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:19<00:14, 53.55it/s, est. speed input: 67775.14 toks/s, output: 66.19 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:19<00:13, 53.54it/s, est. speed input: 67580.41 toks/s, output: 66.00 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:20<00:13, 53.54it/s, est. speed input: 67391.49 toks/s, output: 65.81 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:20<00:13, 53.53it/s, est. speed input: 67207.87 toks/s, output: 65.63 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:20<00:12, 53.51it/s, est. speed input: 67028.47 toks/s, output: 65.46 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:21<00:12, 53.51it/s, est. speed input: 66855.32 toks/s, output: 65.29 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:21<00:12, 53.50it/s, est. speed input: 66686.43 toks/s, output: 65.12 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:21<00:11, 53.50it/s, est. speed input: 66522.37 toks/s, output: 64.96 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:22<00:11, 53.50it/s, est. speed input: 66362.71 toks/s, output: 64.81 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:22<00:11, 53.49it/s, est. speed input: 66206.94 toks/s, output: 64.66 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:22<00:11, 53.48it/s, est. speed input: 66055.16 toks/s, output: 64.51 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:22<00:10, 53.47it/s, est. speed input: 65906.85 toks/s, output: 64.36 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:23<00:10, 53.46it/s, est. speed input: 65762.39 toks/s, output: 64.22 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:23<00:10, 53.45it/s, est. speed input: 65621.75 toks/s, output: 64.08 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:23<00:09, 53.46it/s, est. speed input: 65485.07 toks/s, output: 63.95 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:24<00:09, 53.37it/s, est. speed input: 65347.02 toks/s, output: 63.82 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:24<00:09, 53.23it/s, est. speed input: 65208.49 toks/s, output: 63.68 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:24<00:08, 53.13it/s, est. speed input: 65073.52 toks/s, output: 63.55 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:25<00:08, 53.07it/s, est. speed input: 64941.96 toks/s, output: 63.42 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:25<00:08, 53.01it/s, est. speed input: 64812.96 toks/s, output: 63.29 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:25<00:08, 52.97it/s, est. speed input: 64686.86 toks/s, output: 63.17 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:25<00:07, 52.94it/s, est. speed input: 64563.71 toks/s, output: 63.05 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:26<00:07, 52.95it/s, est. speed input: 64444.71 toks/s, output: 62.93 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:26<00:07, 52.92it/s, est. speed input: 64326.84 toks/s, output: 62.82 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:27<00:11, 31.38it/s, est. speed input: 62598.46 toks/s, output: 61.13 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:27<00:09, 35.74it/s, est. speed input: 62506.22 toks/s, output: 61.04 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:28<00:08, 39.58it/s, est. speed input: 62415.59 toks/s, output: 60.95 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:28<00:07, 42.80it/s, est. speed input: 62327.12 toks/s, output: 60.87 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:28<00:06, 45.38it/s, est. speed input: 62240.08 toks/s, output: 60.78 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:29<00:06, 47.39it/s, est. speed input: 62155.23 toks/s, output: 60.70 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:29<00:05, 48.93it/s, est. speed input: 62073.72 toks/s, output: 60.62 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:29<00:05, 50.00it/s, est. speed input: 61990.47 toks/s, output: 60.54 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:29<00:04, 50.81it/s, est. speed input: 61910.08 toks/s, output: 60.46 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:30<00:04, 51.39it/s, est. speed input: 61831.76 toks/s, output: 60.38 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:30<00:03, 51.80it/s, est. speed input: 61754.32 toks/s, output: 60.31 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:30<00:03, 52.10it/s, est. speed input: 61679.06 toks/s, output: 60.23 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:31<00:03, 53.20it/s, est. speed input: 61638.87 toks/s, output: 60.19 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:31<00:02, 53.08it/s, est. speed input: 61565.68 toks/s, output: 60.12 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:31<00:02, 52.99it/s, est. speed input: 61493.87 toks/s, output: 60.05 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:32<00:02, 52.94it/s, est. speed input: 61423.80 toks/s, output: 59.98 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:32<00:02, 52.89it/s, est. speed input: 61354.83 toks/s, output: 59.92 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:32<00:01, 52.89it/s, est. speed input: 61287.97 toks/s, output: 59.85 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:32<00:01, 53.19it/s, est. speed input: 61233.18 toks/s, output: 59.80 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:33<00:01, 53.40it/s, est. speed input: 61179.19 toks/s, output: 59.75 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:33<00:00, 53.55it/s, est. speed input: 61126.13 toks/s, output: 59.69 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:33<00:00, 53.65it/s, est. speed input: 61074.00 toks/s, output: 59.64 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:34<00:00, 54.79it/s, est. speed input: 61057.34 toks/s, output: 59.63 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:34<00:00, 54.79it/s, est. speed input: 61476.93 toks/s, output: 60.04 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:34<00:00, 60.04it/s, est. speed input: 61476.93 toks/s, output: 60.04 toks/s]
[rank0]:[W128 07:13:50.926074175 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 446.8s

测试结果:
  Requests/s:   52.75
  Tokens/s:     54065.00
  Total Reqs:   2048
  Elapsed:      38.83s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     54012.25

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:6)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:15:13 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:15:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=821307) WARNING 01-28 07:16:53 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=821307) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=821307) WARNING 01-28 07:19:43 [backends.py:609] Failed to read file <frozen os>
Throughput: 51.82 requests/s, 53111.57 total tokens/s, 51.82 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 07:15:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:15:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:15:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:15:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:15:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:15:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:15:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:15:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:15:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:15:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:15:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:15:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:15:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:15:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:16:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:16:24] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:16:24] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:16:24] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:16:24] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:16:24] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:16:24] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:16:24] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:16:24] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:16:24] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:16:24] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:16:24] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:16:24] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:16:24] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=821307) [2026-01-28 07:17:20] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=821307) [2026-01-28 07:17:20] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=821307) [2026-01-28 07:17:20] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=821307) [2026-01-28 07:17:20] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:6, expand_ratio=1.500
(EngineCore_DP0 pid=821307) [2026-01-28 07:17:20] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=821307) [2026-01-28 07:17:20] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=821307) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=821307) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.26it/s]
(EngineCore_DP0 pid=821307) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.26it/s]
(EngineCore_DP0 pid=821307) 
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3424] -> 1D uint8
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:02] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 9891840 bytes
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:02] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3424] -> 1D uint8
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:02] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 6594560 bytes
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3424] -> 1D uint8
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 35610624 bytes
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 9216] -> 1D uint8
(EngineCore_DP0 pid=821307) [2026-01-28 07:18:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 17694720 bytes
(EngineCore_DP0 pid=821307) [rank0]:W0128 07:19:52.358000 821307 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=821307) [rank0]:W0128 07:19:52.458000 821307 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=821307) [rank0]:W0128 07:19:54.458000 821307 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=821307) [rank0]:W0128 07:19:54.622000 821307 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=821307) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:04<00:40,  4.09s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:05<00:20,  2.25s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:05<00:12,  1.53s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:09<00:16,  2.30s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:16<00:24,  4.15s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:17<00:15,  3.07s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:19<00:11,  2.84s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:22<00:08,  2.89s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:27<00:07,  3.50s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:30<00:03,  3.32s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:33<00:00,  3.09s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:33<00:00,  3.03s/it]
(EngineCore_DP0 pid=821307) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:04<00:24,  4.10s/it]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:07<00:17,  3.59s/it]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:14<00:21,  5.37s/it]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:19<00:15,  5.04s/it]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:22<00:08,  4.40s/it]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:23<00:03,  3.31s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:25<00:00,  2.89s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:25<00:00,  3.69s/it]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 32/4096 [00:00<00:12, 314.51it/s]
Adding requests:   2%|▏         | 68/4096 [00:00<00:11, 339.95it/s]
Adding requests:   3%|▎         | 106/4096 [00:00<00:11, 355.15it/s]
Adding requests:   4%|▎         | 145/4096 [00:00<00:10, 366.51it/s]
Adding requests:   4%|▍         | 184/4096 [00:00<00:10, 372.80it/s]
Adding requests:   5%|▌         | 224/4096 [00:00<00:10, 380.21it/s]
Adding requests:   6%|▋         | 263/4096 [00:00<00:10, 377.35it/s]
Adding requests:   7%|▋         | 301/4096 [00:00<00:10, 368.96it/s]
Adding requests:   8%|▊         | 339/4096 [00:00<00:10, 369.87it/s]
Adding requests:   9%|▉         | 377/4096 [00:01<00:10, 371.36it/s]
Adding requests:  10%|█         | 415/4096 [00:01<00:09, 368.89it/s]
Adding requests:  11%|█         | 452/4096 [00:01<00:09, 369.08it/s]
Adding requests:  12%|█▏        | 490/4096 [00:01<00:09, 371.66it/s]
Adding requests:  13%|█▎        | 528/4096 [00:01<00:09, 362.65it/s]
Adding requests:  14%|█▍        | 568/4096 [00:01<00:09, 372.85it/s]
Adding requests:  15%|█▍        | 606/4096 [00:01<00:09, 374.49it/s]
Adding requests:  16%|█▌        | 646/4096 [00:01<00:09, 379.01it/s]
Adding requests:  17%|█▋        | 686/4096 [00:01<00:08, 384.01it/s]
Adding requests:  18%|█▊        | 725/4096 [00:01<00:08, 381.17it/s]
Adding requests:  19%|█▊        | 764/4096 [00:02<00:08, 379.75it/s]
Adding requests:  20%|█▉        | 802/4096 [00:02<00:08, 378.82it/s]
Adding requests:  21%|██        | 840/4096 [00:02<00:08, 369.56it/s]
Adding requests:  21%|██▏       | 879/4096 [00:02<00:08, 374.60it/s]
Adding requests:  22%|██▏       | 919/4096 [00:02<00:08, 381.16it/s]
Adding requests:  23%|██▎       | 958/4096 [00:02<00:08, 382.58it/s]
Adding requests:  24%|██▍       | 997/4096 [00:02<00:08, 383.48it/s]
Adding requests:  25%|██▌       | 1037/4096 [00:02<00:07, 386.85it/s]
Adding requests:  26%|██▋       | 1076/4096 [00:02<00:07, 385.41it/s]
Adding requests:  27%|██▋       | 1115/4096 [00:02<00:07, 383.67it/s]
Adding requests:  28%|██▊       | 1154/4096 [00:03<00:07, 381.49it/s]
Adding requests:  29%|██▉       | 1196/4096 [00:03<00:07, 390.89it/s]
Adding requests:  30%|███       | 1236/4096 [00:03<00:07, 378.19it/s]
Adding requests:  31%|███       | 1274/4096 [00:03<00:07, 377.11it/s]
Adding requests:  32%|███▏      | 1313/4096 [00:03<00:07, 380.16it/s]
Adding requests:  33%|███▎      | 1353/4096 [00:03<00:07, 383.02it/s]
Adding requests:  34%|███▍      | 1392/4096 [00:03<00:07, 383.94it/s]
Adding requests:  35%|███▍      | 1431/4096 [00:03<00:06, 384.69it/s]
Adding requests:  36%|███▌      | 1471/4096 [00:03<00:06, 387.31it/s]
Adding requests:  37%|███▋      | 1510/4096 [00:04<00:06, 386.17it/s]
Adding requests:  38%|███▊      | 1549/4096 [00:04<00:06, 386.19it/s]
Adding requests:  39%|███▉      | 1590/4096 [00:04<00:06, 392.80it/s]
Adding requests:  40%|███▉      | 1630/4096 [00:04<00:06, 392.52it/s]
Adding requests:  41%|████      | 1670/4096 [00:04<00:06, 383.91it/s]
Adding requests:  42%|████▏     | 1709/4096 [00:04<00:06, 383.06it/s]
Adding requests:  43%|████▎     | 1748/4096 [00:04<00:06, 380.84it/s]
Adding requests:  44%|████▎     | 1787/4096 [00:04<00:06, 382.07it/s]
Adding requests:  45%|████▍     | 1826/4096 [00:04<00:05, 384.39it/s]
Adding requests:  46%|████▌     | 1865/4096 [00:04<00:05, 381.66it/s]
Adding requests:  47%|████▋     | 1905/4096 [00:05<00:05, 384.48it/s]
Adding requests:  47%|████▋     | 1944/4096 [00:05<00:05, 383.45it/s]
Adding requests:  48%|████▊     | 1983/4096 [00:05<00:05, 383.99it/s]
Adding requests:  49%|████▉     | 2023/4096 [00:05<00:05, 386.57it/s]
Adding requests:  50%|█████     | 2063/4096 [00:05<00:05, 390.34it/s]
Adding requests:  51%|█████▏    | 2103/4096 [00:05<00:05, 391.79it/s]
Adding requests:  52%|█████▏    | 2143/4096 [00:05<00:05, 386.31it/s]
Adding requests:  53%|█████▎    | 2182/4096 [00:05<00:05, 381.04it/s]
Adding requests:  54%|█████▍    | 2222/4096 [00:05<00:04, 386.38it/s]
Adding requests:  55%|█████▌    | 2261/4096 [00:05<00:04, 385.15it/s]
Adding requests:  56%|█████▌    | 2300/4096 [00:06<00:04, 384.78it/s]
Adding requests:  57%|█████▋    | 2339/4096 [00:06<00:04, 377.50it/s]
Adding requests:  58%|█████▊    | 2378/4096 [00:06<00:04, 379.25it/s]
Adding requests:  59%|█████▉    | 2417/4096 [00:06<00:04, 381.82it/s]
Adding requests:  60%|█████▉    | 2456/4096 [00:06<00:04, 369.51it/s]
Adding requests:  61%|██████    | 2495/4096 [00:06<00:04, 373.29it/s]
Adding requests:  62%|██████▏   | 2534/4096 [00:06<00:04, 377.73it/s]
Adding requests:  63%|██████▎   | 2573/4096 [00:06<00:04, 380.17it/s]
Adding requests:  64%|██████▍   | 2612/4096 [00:06<00:03, 381.68it/s]
Adding requests:  65%|██████▍   | 2652/4096 [00:06<00:03, 385.09it/s]
Adding requests:  66%|██████▌   | 2691/4096 [00:07<00:03, 381.98it/s]
Adding requests:  67%|██████▋   | 2730/4096 [00:07<00:03, 379.22it/s]
Adding requests:  68%|██████▊   | 2769/4096 [00:07<00:03, 380.75it/s]
Adding requests:  69%|██████▊   | 2808/4096 [00:07<00:03, 376.50it/s]
Adding requests:  70%|██████▉   | 2848/4096 [00:07<00:03, 381.57it/s]
Adding requests:  71%|███████   | 2889/4096 [00:07<00:03, 387.79it/s]
Adding requests:  71%|███████▏  | 2928/4096 [00:07<00:03, 380.48it/s]
Adding requests:  72%|███████▏  | 2967/4096 [00:07<00:02, 381.62it/s]
Adding requests:  73%|███████▎  | 3006/4096 [00:07<00:02, 381.52it/s]
Adding requests:  74%|███████▍  | 3045/4096 [00:08<00:02, 381.76it/s]
Adding requests:  75%|███████▌  | 3084/4096 [00:08<00:02, 377.67it/s]
Adding requests:  76%|███████▌  | 3123/4096 [00:08<00:02, 380.20it/s]
Adding requests:  77%|███████▋  | 3162/4096 [00:08<00:02, 374.33it/s]
Adding requests:  78%|███████▊  | 3201/4096 [00:08<00:02, 376.71it/s]
Adding requests:  79%|███████▉  | 3241/4096 [00:08<00:02, 383.39it/s]
Adding requests:  80%|████████  | 3280/4096 [00:08<00:02, 383.71it/s]
Adding requests:  81%|████████  | 3319/4096 [00:08<00:02, 383.03it/s]
Adding requests:  82%|████████▏ | 3358/4096 [00:08<00:01, 383.90it/s]
Adding requests:  83%|████████▎ | 3397/4096 [00:08<00:01, 378.98it/s]
Adding requests:  84%|████████▍ | 3438/4096 [00:09<00:01, 383.91it/s]
Adding requests:  85%|████████▍ | 3477/4096 [00:09<00:01, 378.68it/s]
Adding requests:  86%|████████▌ | 3516/4096 [00:09<00:01, 379.07it/s]
Adding requests:  87%|████████▋ | 3554/4096 [00:09<00:01, 379.07it/s]
Adding requests:  88%|████████▊ | 3592/4096 [00:09<00:01, 374.70it/s]
Adding requests:  89%|████████▊ | 3630/4096 [00:09<00:01, 374.44it/s]
Adding requests:  90%|████████▉ | 3669/4096 [00:09<00:01, 377.23it/s]
Adding requests:  91%|█████████ | 3708/4096 [00:09<00:01, 380.44it/s]
Adding requests:  91%|█████████▏| 3747/4096 [00:09<00:00, 379.92it/s]
Adding requests:  92%|█████████▏| 3787/4096 [00:09<00:00, 384.78it/s]
Adding requests:  93%|█████████▎| 3826/4096 [00:10<00:00, 371.10it/s]
Adding requests:  94%|█████████▍| 3866/4096 [00:10<00:00, 378.88it/s]
Adding requests:  95%|█████████▌| 3904/4096 [00:10<00:00, 378.99it/s]
Adding requests:  96%|█████████▋| 3943/4096 [00:10<00:00, 380.81it/s]
Adding requests:  97%|█████████▋| 3982/4096 [00:10<00:00, 379.96it/s]
Adding requests:  98%|█████████▊| 4021/4096 [00:10<00:00, 382.76it/s]
Adding requests:  99%|█████████▉| 4060/4096 [00:10<00:00, 374.75it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 379.71it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 130/4096 [00:00<00:06, 630.18it/s, est. speed input: 645393.90 toks/s, output: 630.21 toks/s]
Processed prompts:   5%|▍         | 194/4096 [00:01<00:31, 124.73it/s, est. speed input: 152283.29 toks/s, output: 148.71 toks/s]
Processed prompts:   6%|▌         | 226/4096 [00:01<00:39, 99.01it/s, est. speed input: 124841.03 toks/s, output: 121.91 toks/s] 
Processed prompts:   6%|▋         | 258/4096 [00:02<00:45, 84.52it/s, est. speed input: 109956.48 toks/s, output: 107.38 toks/s]
Processed prompts:   7%|▋         | 290/4096 [00:02<00:50, 75.64it/s, est. speed input: 100578.83 toks/s, output: 98.22 toks/s] 
Processed prompts:   8%|▊         | 322/4096 [00:03<00:53, 70.00it/s, est. speed input: 94165.71 toks/s, output: 91.96 toks/s] 
Processed prompts:   9%|▊         | 354/4096 [00:04<00:56, 66.23it/s, est. speed input: 89460.57 toks/s, output: 87.36 toks/s]
Processed prompts:   9%|▉         | 386/4096 [00:04<00:58, 63.72it/s, est. speed input: 85891.27 toks/s, output: 83.88 toks/s]
Processed prompts:  10%|█         | 418/4096 [00:05<00:59, 61.99it/s, est. speed input: 83068.77 toks/s, output: 81.12 toks/s]
Processed prompts:  11%|█         | 450/4096 [00:05<00:59, 60.82it/s, est. speed input: 80799.82 toks/s, output: 78.91 toks/s]
Processed prompts:  12%|█▏        | 482/4096 [00:06<01:00, 60.01it/s, est. speed input: 78932.67 toks/s, output: 77.08 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:06<01:00, 59.45it/s, est. speed input: 77365.76 toks/s, output: 75.55 toks/s]
Processed prompts:  13%|█▎        | 546/4096 [00:07<01:00, 59.05it/s, est. speed input: 76029.80 toks/s, output: 74.25 toks/s]
Processed prompts:  14%|█▍        | 578/4096 [00:07<00:59, 58.76it/s, est. speed input: 74875.93 toks/s, output: 73.12 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:08<00:59, 58.56it/s, est. speed input: 73873.48 toks/s, output: 72.14 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:09<00:59, 58.41it/s, est. speed input: 72992.10 toks/s, output: 71.28 toks/s]
Processed prompts:  16%|█▋        | 674/4096 [00:09<00:58, 58.31it/s, est. speed input: 72213.38 toks/s, output: 70.52 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:10<00:58, 58.25it/s, est. speed input: 71519.70 toks/s, output: 69.84 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:10<00:57, 58.20it/s, est. speed input: 70896.63 toks/s, output: 69.23 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:11<00:57, 58.16it/s, est. speed input: 70334.87 toks/s, output: 68.69 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:11<00:56, 58.13it/s, est. speed input: 69825.37 toks/s, output: 68.19 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:12<00:56, 58.10it/s, est. speed input: 69360.11 toks/s, output: 67.73 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:12<00:55, 58.09it/s, est. speed input: 68936.26 toks/s, output: 67.32 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:13<00:55, 58.09it/s, est. speed input: 68547.86 toks/s, output: 66.94 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:13<00:54, 58.08it/s, est. speed input: 68188.28 toks/s, output: 66.59 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:15<01:20, 38.94it/s, est. speed input: 63885.20 toks/s, output: 62.39 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:15<01:11, 43.20it/s, est. speed input: 63730.46 toks/s, output: 62.24 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:16<01:05, 46.79it/s, est. speed input: 63587.22 toks/s, output: 62.10 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:17<01:01, 49.67it/s, est. speed input: 63451.92 toks/s, output: 61.96 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:17<00:57, 51.91it/s, est. speed input: 63325.10 toks/s, output: 61.84 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:18<00:55, 53.59it/s, est. speed input: 63204.80 toks/s, output: 61.72 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:18<00:53, 55.29it/s, est. speed input: 63145.95 toks/s, output: 61.67 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:19<00:51, 56.07it/s, est. speed input: 63036.98 toks/s, output: 61.56 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:19<00:50, 56.63it/s, est. speed input: 62934.92 toks/s, output: 61.46 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:20<00:49, 57.02it/s, est. speed input: 62838.26 toks/s, output: 61.37 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:20<00:49, 57.31it/s, est. speed input: 62746.69 toks/s, output: 61.28 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:21<00:48, 57.49it/s, est. speed input: 62658.32 toks/s, output: 61.19 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:22<00:47, 57.62it/s, est. speed input: 62574.60 toks/s, output: 61.11 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:22<00:47, 57.77it/s, est. speed input: 62499.92 toks/s, output: 61.04 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:23<00:46, 57.76it/s, est. speed input: 62418.63 toks/s, output: 60.96 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:23<00:45, 57.80it/s, est. speed input: 62345.92 toks/s, output: 60.88 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:24<00:45, 57.82it/s, est. speed input: 62275.43 toks/s, output: 60.82 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:24<00:44, 57.84it/s, est. speed input: 62208.76 toks/s, output: 60.75 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:25<00:44, 57.84it/s, est. speed input: 62143.45 toks/s, output: 60.69 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:25<00:43, 57.85it/s, est. speed input: 62081.76 toks/s, output: 60.63 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:26<00:43, 57.85it/s, est. speed input: 62022.11 toks/s, output: 60.57 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:27<00:42, 57.84it/s, est. speed input: 61964.79 toks/s, output: 60.51 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:27<00:42, 57.84it/s, est. speed input: 61909.95 toks/s, output: 60.46 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:28<00:41, 57.82it/s, est. speed input: 61855.63 toks/s, output: 60.41 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:28<00:40, 57.80it/s, est. speed input: 61802.99 toks/s, output: 60.35 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:29<00:40, 57.78it/s, est. speed input: 61751.88 toks/s, output: 60.30 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:29<00:39, 57.76it/s, est. speed input: 61702.86 toks/s, output: 60.26 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:30<00:39, 57.75it/s, est. speed input: 61655.45 toks/s, output: 60.21 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:30<00:38, 58.25it/s, est. speed input: 61641.49 toks/s, output: 60.20 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:31<00:37, 58.08it/s, est. speed input: 61596.35 toks/s, output: 60.15 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:31<00:37, 57.95it/s, est. speed input: 61552.10 toks/s, output: 60.11 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:32<00:37, 57.87it/s, est. speed input: 61509.32 toks/s, output: 60.07 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:33<00:36, 57.79it/s, est. speed input: 61467.24 toks/s, output: 60.03 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:33<00:35, 57.74it/s, est. speed input: 61426.29 toks/s, output: 59.99 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:34<00:35, 57.70it/s, est. speed input: 61387.07 toks/s, output: 59.95 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:34<00:34, 57.67it/s, est. speed input: 61348.55 toks/s, output: 59.91 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:35<00:34, 57.64it/s, est. speed input: 61310.92 toks/s, output: 59.87 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:35<00:33, 57.64it/s, est. speed input: 61275.21 toks/s, output: 59.84 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:36<00:33, 57.62it/s, est. speed input: 61239.66 toks/s, output: 59.80 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:36<00:32, 57.60it/s, est. speed input: 61204.96 toks/s, output: 59.77 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:37<00:32, 57.57it/s, est. speed input: 61170.86 toks/s, output: 59.74 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:38<00:31, 58.07it/s, est. speed input: 61163.94 toks/s, output: 59.73 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:38<00:30, 57.91it/s, est. speed input: 61131.74 toks/s, output: 59.70 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:39<00:30, 57.80it/s, est. speed input: 61100.13 toks/s, output: 59.67 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:39<00:29, 57.73it/s, est. speed input: 61070.11 toks/s, output: 59.64 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:40<00:29, 57.74it/s, est. speed input: 61043.70 toks/s, output: 59.61 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:40<00:28, 57.61it/s, est. speed input: 61011.28 toks/s, output: 59.58 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:41<00:28, 57.58it/s, est. speed input: 60983.05 toks/s, output: 59.55 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:41<00:27, 58.07it/s, est. speed input: 60978.74 toks/s, output: 59.55 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:42<00:27, 57.93it/s, est. speed input: 60952.71 toks/s, output: 59.52 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:43<00:26, 57.76it/s, est. speed input: 60924.34 toks/s, output: 59.50 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:43<00:26, 57.68it/s, est. speed input: 60897.98 toks/s, output: 59.47 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:44<00:25, 57.62it/s, est. speed input: 60872.32 toks/s, output: 59.45 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:44<00:24, 57.56it/s, est. speed input: 60846.57 toks/s, output: 59.42 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:45<00:24, 57.46it/s, est. speed input: 60818.95 toks/s, output: 59.39 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:45<00:23, 57.47it/s, est. speed input: 60795.34 toks/s, output: 59.37 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:46<00:23, 57.49it/s, est. speed input: 60772.72 toks/s, output: 59.35 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:46<00:22, 57.50it/s, est. speed input: 60750.80 toks/s, output: 59.33 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:47<00:22, 57.51it/s, est. speed input: 60729.12 toks/s, output: 59.31 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:48<00:31, 39.84it/s, est. speed input: 59686.29 toks/s, output: 58.29 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:49<00:27, 43.89it/s, est. speed input: 59677.48 toks/s, output: 58.28 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:50<00:25, 47.24it/s, est. speed input: 59668.55 toks/s, output: 58.27 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:50<00:23, 49.91it/s, est. speed input: 59659.97 toks/s, output: 58.26 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:51<00:21, 51.96it/s, est. speed input: 59651.13 toks/s, output: 58.25 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:51<00:20, 53.50it/s, est. speed input: 59642.64 toks/s, output: 58.24 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [00:52<00:19, 54.66it/s, est. speed input: 59635.01 toks/s, output: 58.24 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [00:52<00:18, 55.44it/s, est. speed input: 59625.60 toks/s, output: 58.23 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [00:53<00:17, 56.04it/s, est. speed input: 59617.54 toks/s, output: 58.22 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [00:53<00:16, 56.45it/s, est. speed input: 59609.20 toks/s, output: 58.21 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [00:54<00:16, 56.76it/s, est. speed input: 59601.73 toks/s, output: 58.20 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [00:55<00:15, 56.97it/s, est. speed input: 59594.18 toks/s, output: 58.20 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [00:55<00:15, 57.12it/s, est. speed input: 59586.83 toks/s, output: 58.19 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [00:56<00:14, 57.23it/s, est. speed input: 59579.52 toks/s, output: 58.18 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [00:56<00:13, 57.30it/s, est. speed input: 59572.18 toks/s, output: 58.18 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [00:57<00:13, 57.35it/s, est. speed input: 59565.21 toks/s, output: 58.17 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [00:57<00:12, 57.39it/s, est. speed input: 59558.42 toks/s, output: 58.16 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [00:58<00:12, 57.41it/s, est. speed input: 59551.55 toks/s, output: 58.16 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [00:58<00:11, 57.43it/s, est. speed input: 59545.12 toks/s, output: 58.15 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [00:59<00:11, 57.45it/s, est. speed input: 59538.93 toks/s, output: 58.14 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:00<00:10, 57.46it/s, est. speed input: 59532.37 toks/s, output: 58.14 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:00<00:09, 57.46it/s, est. speed input: 59526.07 toks/s, output: 58.13 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:01<00:09, 57.46it/s, est. speed input: 59519.81 toks/s, output: 58.12 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:01<00:08, 57.47it/s, est. speed input: 59513.95 toks/s, output: 58.12 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:02<00:08, 57.46it/s, est. speed input: 59507.79 toks/s, output: 58.11 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:02<00:07, 57.47it/s, est. speed input: 59502.24 toks/s, output: 58.11 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:03<00:07, 57.49it/s, est. speed input: 59497.01 toks/s, output: 58.10 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:03<00:06, 57.99it/s, est. speed input: 59506.40 toks/s, output: 58.11 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:04<00:06, 57.84it/s, est. speed input: 59500.83 toks/s, output: 58.11 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:05<00:05, 57.73it/s, est. speed input: 59495.41 toks/s, output: 58.10 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:05<00:04, 57.66it/s, est. speed input: 59490.05 toks/s, output: 58.10 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:06<00:04, 57.59it/s, est. speed input: 59484.32 toks/s, output: 58.09 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:06<00:03, 57.55it/s, est. speed input: 59479.01 toks/s, output: 58.08 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:07<00:03, 57.53it/s, est. speed input: 59474.02 toks/s, output: 58.08 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:07<00:02, 57.51it/s, est. speed input: 59468.72 toks/s, output: 58.07 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:08<00:02, 57.50it/s, est. speed input: 59463.77 toks/s, output: 58.07 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:08<00:01, 57.50it/s, est. speed input: 59458.92 toks/s, output: 58.07 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:09<00:01, 57.99it/s, est. speed input: 59467.82 toks/s, output: 58.07 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:09<00:00, 58.51it/s, est. speed input: 59480.87 toks/s, output: 58.09 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:09<00:00, 58.51it/s, est. speed input: 59919.27 toks/s, output: 58.51 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:09<00:00, 58.51it/s, est. speed input: 59919.27 toks/s, output: 58.51 toks/s]
[rank0]:[W128 07:22:53.713624214 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 598.2s

测试结果:
  Requests/s:   51.82
  Tokens/s:     53111.57
  Total Reqs:   4096
  Elapsed:      79.05s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     53059.75


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_6/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,15.0041,7697.1223,8.5310
1024,1024,1,128,128,15.0679,15444.6472,8.4949
2048,1024,2,256,128,31.4152,32200.5967,8.1489
4096,1024,4,512,128,52.2497,53555.9261,9.7991
8192,1024,8,1024,128,32.7823,33601.9081,31.2363
16384,1024,16,2048,128,52.7463,54064.9953,38.8273
32768,1024,32,4096,128,51.8162,53111.5684,79.0487

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_8) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_8

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:24:52 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:24:53 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=825679) WARNING 01-28 07:26:00 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=825679) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=825679) WARNING 01-28 07:28:24 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.38 requests/s, 7892.05 total tokens/s, 15.38 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 07:24:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:24:52] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:24:52] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:24:52] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:24:52] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:24:52] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:24:52] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:24:52] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:24:52] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:24:52] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:24:52] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:24:52] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:24:52] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:24:52] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:25:32] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:25:51] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:25:51] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:25:51] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:25:51] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:25:51] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:25:51] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:25:51] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:25:51] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:25:51] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:25:51] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:25:51] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:25:51] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:25:51] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:06] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:06] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:06] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:06] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:06] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:06] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=825679) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=825679) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.43s/it]
(EngineCore_DP0 pid=825679) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.43s/it]
(EngineCore_DP0 pid=825679) 
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:54] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:54] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:54] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=825679) [2026-01-28 07:26:59] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=825679) [2026-01-28 07:27:00] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=825679) [2026-01-28 07:27:00] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=825679) [2026-01-28 07:27:00] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=825679) [2026-01-28 07:27:02] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=825679) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:01<00:01,  1.63s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:04<00:00,  2.35s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:04<00:00,  2.24s/it]
(EngineCore_DP0 pid=825679) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.90it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.90it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  51%|█████     | 65/128 [00:00<00:00, 640.67it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 655.51it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:46,  2.75it/s, est. speed input: 1408.75 toks/s, output: 2.75 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:18,  6.71it/s, est. speed input: 3002.26 toks/s, output: 5.86 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:12,  9.58it/s, est. speed input: 4025.26 toks/s, output: 7.86 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:10, 11.62it/s, est. speed input: 4728.07 toks/s, output: 9.23 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:09, 13.11it/s, est. speed input: 5246.97 toks/s, output: 10.25 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:08, 14.14it/s, est. speed input: 5637.92 toks/s, output: 11.01 toks/s]
Processed prompts:  10%|█         | 13/128 [00:01<00:07, 14.89it/s, est. speed input: 5947.37 toks/s, output: 11.62 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:01<00:07, 15.20it/s, est. speed input: 6168.53 toks/s, output: 12.05 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:07, 15.57it/s, est. speed input: 6369.27 toks/s, output: 12.44 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 15.81it/s, est. speed input: 6534.32 toks/s, output: 12.76 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 15.87it/s, est. speed input: 6662.68 toks/s, output: 13.01 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.09it/s, est. speed input: 6790.96 toks/s, output: 13.26 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.32it/s, est. speed input: 6909.12 toks/s, output: 13.49 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.42it/s, est. speed input: 7007.91 toks/s, output: 13.69 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:02<00:06, 16.47it/s, est. speed input: 7092.84 toks/s, output: 13.85 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:02<00:05, 16.54it/s, est. speed input: 7172.20 toks/s, output: 14.01 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:02<00:05, 16.56it/s, est. speed input: 7240.55 toks/s, output: 14.14 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.34it/s, est. speed input: 7285.29 toks/s, output: 14.23 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.36it/s, est. speed input: 7338.24 toks/s, output: 14.33 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.36it/s, est. speed input: 7385.39 toks/s, output: 14.42 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.36it/s, est. speed input: 7428.22 toks/s, output: 14.51 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.30it/s, est. speed input: 7463.75 toks/s, output: 14.58 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:03<00:05, 16.29it/s, est. speed input: 7498.49 toks/s, output: 14.65 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:03<00:04, 16.29it/s, est. speed input: 7530.64 toks/s, output: 14.71 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:03<00:04, 16.30it/s, est. speed input: 7561.23 toks/s, output: 14.77 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 16.36it/s, est. speed input: 7592.42 toks/s, output: 14.83 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 16.35it/s, est. speed input: 7619.04 toks/s, output: 14.88 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.34it/s, est. speed input: 7643.23 toks/s, output: 14.93 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.35it/s, est. speed input: 7667.00 toks/s, output: 14.97 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.33it/s, est. speed input: 7688.20 toks/s, output: 15.02 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:04<00:04, 16.35it/s, est. speed input: 7709.29 toks/s, output: 15.06 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:04<00:03, 16.38it/s, est. speed input: 7730.10 toks/s, output: 15.10 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:04<00:03, 16.40it/s, est. speed input: 7749.87 toks/s, output: 15.14 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 16.42it/s, est. speed input: 7768.58 toks/s, output: 15.17 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.39it/s, est. speed input: 7784.43 toks/s, output: 15.20 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.41it/s, est. speed input: 7801.27 toks/s, output: 15.24 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.44it/s, est. speed input: 7817.88 toks/s, output: 15.27 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.42it/s, est. speed input: 7831.72 toks/s, output: 15.30 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:05<00:03, 16.44it/s, est. speed input: 7846.58 toks/s, output: 15.33 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:05<00:02, 16.47it/s, est. speed input: 7861.10 toks/s, output: 15.35 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:05<00:02, 16.46it/s, est. speed input: 7874.12 toks/s, output: 15.38 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:05<00:02, 16.49it/s, est. speed input: 7887.42 toks/s, output: 15.41 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 16.47it/s, est. speed input: 7899.16 toks/s, output: 15.43 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.43it/s, est. speed input: 7909.04 toks/s, output: 15.45 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.39it/s, est. speed input: 7918.29 toks/s, output: 15.47 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.39it/s, est. speed input: 7928.14 toks/s, output: 15.48 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.43it/s, est. speed input: 7938.93 toks/s, output: 15.51 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:06<00:02, 16.42it/s, est. speed input: 7948.16 toks/s, output: 15.52 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:06<00:01, 16.38it/s, est. speed input: 7955.71 toks/s, output: 15.54 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:06<00:01, 16.43it/s, est. speed input: 7965.46 toks/s, output: 15.56 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 16.46it/s, est. speed input: 7974.97 toks/s, output: 15.58 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 16.44it/s, est. speed input: 7982.57 toks/s, output: 15.59 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.45it/s, est. speed input: 7990.73 toks/s, output: 15.61 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.47it/s, est. speed input: 7998.95 toks/s, output: 15.62 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.50it/s, est. speed input: 8007.25 toks/s, output: 15.64 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:07<00:01, 16.52it/s, est. speed input: 8015.37 toks/s, output: 15.65 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:07<00:00, 16.50it/s, est. speed input: 8022.34 toks/s, output: 15.67 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:07<00:00, 16.49it/s, est. speed input: 8029.18 toks/s, output: 15.68 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 16.45it/s, est. speed input: 8034.89 toks/s, output: 15.69 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 16.48it/s, est. speed input: 8041.81 toks/s, output: 15.71 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 16.49it/s, est. speed input: 8048.23 toks/s, output: 15.72 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.48it/s, est. speed input: 8054.06 toks/s, output: 15.73 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.46it/s, est. speed input: 8059.42 toks/s, output: 15.74 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:08<00:00, 16.45it/s, est. speed input: 8064.81 toks/s, output: 15.75 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 16.45it/s, est. speed input: 8067.61 toks/s, output: 15.76 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 15.76it/s, est. speed input: 8067.61 toks/s, output: 15.76 toks/s]
[rank0]:[W128 07:30:07.980710647 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 430.5s

测试结果:
  Requests/s:   15.38
  Tokens/s:     7892.05
  Total Reqs:   128
  Elapsed:      8.32s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7876.67

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:31:56 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:31:58 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=829580) WARNING 01-28 07:33:21 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=829580) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=829580) WARNING 01-28 07:35:13 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.92 requests/s, 16313.40 total tokens/s, 15.92 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 07:31:50] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:31:56] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:31:56] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:31:56] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:31:56] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:31:56] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:31:56] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:31:56] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:31:56] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:31:56] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:31:56] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:31:56] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:31:56] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:31:56] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:32:17] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:32:19] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:32:19] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:32:19] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:32:19] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:32:19] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:32:19] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:32:19] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:32:19] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:32:19] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:32:19] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:32:19] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:32:19] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:32:19] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 07:33:20.390379851 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=829580) [2026-01-28 07:33:22] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=829580) [2026-01-28 07:33:22] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=829580) [2026-01-28 07:33:22] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=829580) [2026-01-28 07:33:22] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=829580) [2026-01-28 07:33:22] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=829580) [2026-01-28 07:33:22] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=829580) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=829580) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.11s/it]
(EngineCore_DP0 pid=829580) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.11s/it]
(EngineCore_DP0 pid=829580) 
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:02] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:05] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:05] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:07] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:12] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:13] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:13] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=829580) [2026-01-28 07:34:14] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=829580) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:02<00:02,  2.61s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:04<00:00,  2.43s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:04<00:00,  2.46s/it]
(EngineCore_DP0 pid=829580) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:03<00:00,  3.41s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:03<00:00,  3.41s/it]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  28%|██▊       | 36/128 [00:00<00:00, 356.54it/s]
Adding requests:  59%|█████▉    | 76/128 [00:00<00:00, 376.84it/s]
Adding requests:  89%|████████▉ | 114/128 [00:00<00:00, 374.84it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 373.05it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:04, 27.84it/s, est. speed input: 28510.90 toks/s, output: 27.84 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:06, 18.58it/s, est. speed input: 20182.33 toks/s, output: 19.71 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:06, 17.79it/s, est. speed input: 19307.44 toks/s, output: 18.85 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:06, 17.32it/s, est. speed input: 18794.49 toks/s, output: 18.35 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:06, 17.01it/s, est. speed input: 18450.88 toks/s, output: 18.02 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:06, 16.83it/s, est. speed input: 18219.62 toks/s, output: 17.79 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:06, 16.75it/s, est. speed input: 18062.88 toks/s, output: 17.64 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.70it/s, est. speed input: 17943.12 toks/s, output: 17.52 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.65it/s, est. speed input: 17841.71 toks/s, output: 17.42 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.70it/s, est. speed input: 17786.80 toks/s, output: 17.37 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.71it/s, est. speed input: 17732.36 toks/s, output: 17.32 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.72it/s, est. speed input: 17686.79 toks/s, output: 17.27 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:05, 16.77it/s, est. speed input: 17659.45 toks/s, output: 17.25 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:05, 16.70it/s, est. speed input: 17610.59 toks/s, output: 17.20 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 16.04it/s, est. speed input: 17430.60 toks/s, output: 17.02 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.14it/s, est. speed input: 17391.22 toks/s, output: 16.98 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.30it/s, est. speed input: 17373.92 toks/s, output: 16.97 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.41it/s, est. speed input: 17358.06 toks/s, output: 16.95 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.49it/s, est. speed input: 17345.12 toks/s, output: 16.94 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.54it/s, est. speed input: 17331.82 toks/s, output: 16.93 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:05, 16.53it/s, est. speed input: 17312.32 toks/s, output: 16.91 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:04, 16.53it/s, est. speed input: 17294.85 toks/s, output: 16.89 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:04, 16.51it/s, est. speed input: 17276.21 toks/s, output: 16.87 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 16.49it/s, est. speed input: 17259.86 toks/s, output: 16.86 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 16.46it/s, est. speed input: 17241.46 toks/s, output: 16.84 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.45it/s, est. speed input: 17225.38 toks/s, output: 16.82 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.49it/s, est. speed input: 17216.41 toks/s, output: 16.81 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.51it/s, est. speed input: 17207.76 toks/s, output: 16.80 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:04, 16.51it/s, est. speed input: 17197.48 toks/s, output: 16.79 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:03, 16.50it/s, est. speed input: 17186.87 toks/s, output: 16.78 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 16.51it/s, est. speed input: 17178.41 toks/s, output: 16.78 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:03<00:03, 16.53it/s, est. speed input: 17173.06 toks/s, output: 16.77 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.48it/s, est. speed input: 17160.07 toks/s, output: 16.76 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.49it/s, est. speed input: 17152.82 toks/s, output: 16.75 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.47it/s, est. speed input: 17144.02 toks/s, output: 16.74 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.47it/s, est. speed input: 17136.18 toks/s, output: 16.73 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.47it/s, est. speed input: 17129.10 toks/s, output: 16.73 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:02, 16.48it/s, est. speed input: 17122.86 toks/s, output: 16.72 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 16.45it/s, est. speed input: 17114.52 toks/s, output: 16.71 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:04<00:02, 16.39it/s, est. speed input: 17102.40 toks/s, output: 16.70 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 16.45it/s, est. speed input: 17099.79 toks/s, output: 16.70 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.46it/s, est. speed input: 17094.98 toks/s, output: 16.69 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.46it/s, est. speed input: 17089.22 toks/s, output: 16.69 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.52it/s, est. speed input: 17088.47 toks/s, output: 16.69 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.55it/s, est. speed input: 17086.81 toks/s, output: 16.69 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 16.58it/s, est. speed input: 17086.28 toks/s, output: 16.69 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 16.53it/s, est. speed input: 17080.08 toks/s, output: 16.68 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:05<00:01, 16.54it/s, est. speed input: 17077.86 toks/s, output: 16.68 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 16.53it/s, est. speed input: 17074.19 toks/s, output: 16.67 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 16.44it/s, est. speed input: 17065.50 toks/s, output: 16.67 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.46it/s, est. speed input: 17062.10 toks/s, output: 16.66 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.52it/s, est. speed input: 17062.28 toks/s, output: 16.66 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.55it/s, est. speed input: 17061.40 toks/s, output: 16.66 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.57it/s, est. speed input: 17060.33 toks/s, output: 16.66 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:06<00:00, 16.55it/s, est. speed input: 17057.67 toks/s, output: 16.66 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:06<00:00, 16.54it/s, est. speed input: 17054.96 toks/s, output: 16.66 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 16.52it/s, est. speed input: 17051.63 toks/s, output: 16.65 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 16.50it/s, est. speed input: 17048.40 toks/s, output: 16.65 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 16.47it/s, est. speed input: 17044.31 toks/s, output: 16.64 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.44it/s, est. speed input: 17039.28 toks/s, output: 16.64 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.41it/s, est. speed input: 17034.35 toks/s, output: 16.64 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.41it/s, est. speed input: 17030.52 toks/s, output: 16.63 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.41it/s, est. speed input: 17027.59 toks/s, output: 16.63 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.63it/s, est. speed input: 17027.59 toks/s, output: 16.63 toks/s]
[rank0]:[W128 07:37:21.920734610 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 449.1s

测试结果:
  Requests/s:   15.92
  Tokens/s:     16313.40
  Total Reqs:   128
  Elapsed:      8.04s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16297.48

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:39:11 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:39:12 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=832859) WARNING 01-28 07:40:33 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=832859) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=832859) WARNING 01-28 07:42:41 [backends.py:609] Failed to read file <frozen os>
Throughput: 31.75 requests/s, 32545.49 total tokens/s, 31.75 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 07:39:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:39:11] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:39:11] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:39:11] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:11] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:11] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:11] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:11] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:11] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:39:11] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:39:11] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:39:11] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:39:11] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:39:11] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:39:34] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:39:58] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:39:58] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:39:58] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:58] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:58] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:58] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:58] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:39:58] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:39:58] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:39:58] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:39:58] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:39:58] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:39:58] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=832859) [2026-01-28 07:40:36] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=832859) [2026-01-28 07:40:36] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=832859) [2026-01-28 07:40:36] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=832859) [2026-01-28 07:40:36] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=832859) [2026-01-28 07:40:36] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=832859) [2026-01-28 07:40:36] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=832859) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=832859) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.29it/s]
(EngineCore_DP0 pid=832859) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.29it/s]
(EngineCore_DP0 pid=832859) 
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:21] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:24] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:24] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:25] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:26] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:26] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:26] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=832859) [2026-01-28 07:41:26] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=832859) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:02<00:05,  2.75s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:03<00:01,  1.71s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:04<00:00,  1.12s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:04<00:00,  1.38s/it]
(EngineCore_DP0 pid=832859) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  1.85it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.73it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.74it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 36/256 [00:00<00:00, 355.47it/s]
Adding requests:  30%|██▉       | 76/256 [00:00<00:00, 375.33it/s]
Adding requests:  45%|████▍     | 114/256 [00:00<00:00, 373.56it/s]
Adding requests:  59%|█████▉    | 152/256 [00:00<00:00, 371.00it/s]
Adding requests:  74%|███████▍  | 190/256 [00:00<00:00, 369.74it/s]
Adding requests:  89%|████████▊ | 227/256 [00:00<00:00, 368.44it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 370.61it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▌         | 14/256 [00:00<00:01, 121.16it/s, est. speed input: 124101.26 toks/s, output: 121.17 toks/s]
Processed prompts:  11%|█         | 27/256 [00:00<00:04, 50.85it/s, est. speed input: 57235.90 toks/s, output: 55.89 toks/s]   
Processed prompts:  14%|█▎        | 35/256 [00:00<00:05, 42.74it/s, est. speed input: 49115.28 toks/s, output: 47.96 toks/s]
Processed prompts:  16%|█▌        | 41/256 [00:00<00:05, 39.53it/s, est. speed input: 45961.39 toks/s, output: 44.88 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:01<00:05, 35.71it/s, est. speed input: 42956.77 toks/s, output: 41.95 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:01<00:05, 35.20it/s, est. speed input: 42101.10 toks/s, output: 41.11 toks/s]
Processed prompts:  21%|██        | 54/256 [00:01<00:05, 34.78it/s, est. speed input: 41400.90 toks/s, output: 40.43 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:05, 34.51it/s, est. speed input: 40842.91 toks/s, output: 39.88 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 34.32it/s, est. speed input: 40371.22 toks/s, output: 39.42 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 34.17it/s, est. speed input: 39968.21 toks/s, output: 39.03 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 34.02it/s, est. speed input: 39605.57 toks/s, output: 38.68 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:01<00:05, 33.91it/s, est. speed input: 39287.60 toks/s, output: 38.37 toks/s]
Processed prompts:  30%|███       | 78/256 [00:02<00:05, 33.84it/s, est. speed input: 39008.80 toks/s, output: 38.09 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:02<00:05, 33.79it/s, est. speed input: 38759.99 toks/s, output: 37.85 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:02<00:05, 33.76it/s, est. speed input: 38538.93 toks/s, output: 37.64 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:02<00:04, 33.59it/s, est. speed input: 38312.03 toks/s, output: 37.41 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:02<00:04, 33.66it/s, est. speed input: 38138.68 toks/s, output: 37.24 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:02<00:04, 33.43it/s, est. speed input: 37933.87 toks/s, output: 37.04 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:02<00:04, 33.01it/s, est. speed input: 37704.22 toks/s, output: 36.82 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:02<00:04, 32.88it/s, est. speed input: 37520.62 toks/s, output: 36.64 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:04<00:15,  9.21it/s, est. speed input: 27749.71 toks/s, output: 27.10 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:04<00:12, 11.73it/s, est. speed input: 27918.41 toks/s, output: 27.26 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:04<00:09, 14.53it/s, est. speed input: 28079.88 toks/s, output: 27.42 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:04<00:07, 17.43it/s, est. speed input: 28226.09 toks/s, output: 27.56 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:04<00:06, 20.31it/s, est. speed input: 28376.66 toks/s, output: 27.71 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:04<00:05, 23.06it/s, est. speed input: 28533.30 toks/s, output: 27.86 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:04<00:04, 25.50it/s, est. speed input: 28684.50 toks/s, output: 28.01 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:04<00:04, 27.53it/s, est. speed input: 28827.90 toks/s, output: 28.15 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:05<00:03, 29.12it/s, est. speed input: 28961.12 toks/s, output: 28.28 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:05<00:03, 30.41it/s, est. speed input: 29093.50 toks/s, output: 28.41 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:05<00:03, 31.39it/s, est. speed input: 29220.40 toks/s, output: 28.54 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:05<00:03, 32.10it/s, est. speed input: 29340.75 toks/s, output: 28.65 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:05<00:03, 32.59it/s, est. speed input: 29454.22 toks/s, output: 28.76 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:05<00:02, 32.99it/s, est. speed input: 29566.09 toks/s, output: 28.87 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:05<00:02, 33.30it/s, est. speed input: 29674.52 toks/s, output: 28.98 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:05<00:02, 33.40it/s, est. speed input: 29771.56 toks/s, output: 29.07 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:05<00:02, 32.57it/s, est. speed input: 29809.83 toks/s, output: 29.11 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:06<00:02, 32.92it/s, est. speed input: 29902.22 toks/s, output: 29.20 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:06<00:02, 33.19it/s, est. speed input: 29992.44 toks/s, output: 29.29 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:06<00:02, 33.30it/s, est. speed input: 30074.78 toks/s, output: 29.37 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:06<00:01, 33.35it/s, est. speed input: 30152.53 toks/s, output: 29.45 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:06<00:01, 33.44it/s, est. speed input: 30230.44 toks/s, output: 29.52 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:06<00:01, 33.55it/s, est. speed input: 30308.06 toks/s, output: 29.60 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:06<00:01, 33.57it/s, est. speed input: 30380.23 toks/s, output: 29.67 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:06<00:01, 33.59it/s, est. speed input: 30450.00 toks/s, output: 29.74 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:07<00:01, 33.64it/s, est. speed input: 30519.37 toks/s, output: 29.80 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:07<00:01, 33.69it/s, est. speed input: 30586.74 toks/s, output: 29.87 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:07<00:01, 33.67it/s, est. speed input: 30649.62 toks/s, output: 29.93 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:07<00:01, 33.68it/s, est. speed input: 30711.77 toks/s, output: 29.99 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:07<00:00, 33.76it/s, est. speed input: 30774.86 toks/s, output: 30.05 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:07<00:00, 33.49it/s, est. speed input: 30820.88 toks/s, output: 30.10 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:07<00:00, 33.60it/s, est. speed input: 30879.61 toks/s, output: 30.16 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:07<00:00, 33.63it/s, est. speed input: 30934.17 toks/s, output: 30.21 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:07<00:00, 33.57it/s, est. speed input: 30983.39 toks/s, output: 30.26 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:08<00:00, 33.63it/s, est. speed input: 31036.15 toks/s, output: 30.31 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:08<00:00, 33.61it/s, est. speed input: 31084.12 toks/s, output: 30.36 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:08<00:00, 33.64it/s, est. speed input: 31132.81 toks/s, output: 30.40 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 33.64it/s, est. speed input: 31154.24 toks/s, output: 30.42 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 30.42it/s, est. speed input: 31154.24 toks/s, output: 30.42 toks/s]
[rank0]:[W128 07:44:30.591581306 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 408.7s

测试结果:
  Requests/s:   31.75
  Tokens/s:     32545.49
  Total Reqs:   256
  Elapsed:      8.06s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     32513.74

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:46:13 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:46:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=836074) WARNING 01-28 07:47:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=836074) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=836074) WARNING 01-28 07:49:33 [backends.py:609] Failed to read file <frozen os>
Throughput: 56.44 requests/s, 57848.76 total tokens/s, 56.44 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 07:46:09] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:46:13] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:46:13] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:46:13] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:46:13] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:46:13] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:46:13] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:46:13] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:46:13] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:46:13] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:46:13] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:46:13] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:46:13] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:46:13] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:46:58] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:47:31] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:47:31] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:47:31] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:47:31] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:47:31] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:47:31] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:47:31] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:47:31] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:47:31] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:47:31] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:47:31] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:47:31] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:47:31] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=836074) [2026-01-28 07:47:44] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=836074) [2026-01-28 07:47:44] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=836074) [2026-01-28 07:47:44] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=836074) [2026-01-28 07:47:44] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=836074) [2026-01-28 07:47:44] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=836074) [2026-01-28 07:47:44] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=836074) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=836074) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.18it/s]
(EngineCore_DP0 pid=836074) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.18it/s]
(EngineCore_DP0 pid=836074) 
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:28] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:29] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:29] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:34] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:34] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=836074) [2026-01-28 07:48:35] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=836074) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:15<00:46, 15.54s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:17<00:15,  7.67s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:20<00:05,  5.52s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:23<00:00,  4.47s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:23<00:00,  5.88s/it]
(EngineCore_DP0 pid=836074) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:00<00:01,  1.42it/s]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:01<00:00,  2.01it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:01<00:00,  2.02it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:01<00:00,  1.94it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 352.79it/s]
Adding requests:  15%|█▍        | 75/512 [00:00<00:01, 372.37it/s]
Adding requests:  22%|██▏       | 113/512 [00:00<00:01, 374.71it/s]
Adding requests:  29%|██▉       | 151/512 [00:00<00:00, 368.61it/s]
Adding requests:  37%|███▋      | 188/512 [00:00<00:00, 364.11it/s]
Adding requests:  44%|████▍     | 226/512 [00:00<00:00, 368.01it/s]
Adding requests:  52%|█████▏    | 264/512 [00:00<00:00, 371.58it/s]
Adding requests:  59%|█████▉    | 302/512 [00:00<00:00, 366.45it/s]
Adding requests:  66%|██████▌   | 339/512 [00:00<00:00, 365.69it/s]
Adding requests:  73%|███████▎  | 376/512 [00:01<00:00, 364.46it/s]
Adding requests:  81%|████████  | 413/512 [00:01<00:00, 361.65it/s]
Adding requests:  88%|████████▊ | 451/512 [00:01<00:00, 365.90it/s]
Adding requests:  95%|█████████▌| 488/512 [00:01<00:00, 366.59it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 366.43it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:00<00:00, 479.63it/s, est. speed input: 491228.53 toks/s, output: 479.66 toks/s]
Processed prompts:  22%|██▏       | 114/512 [00:00<00:03, 103.43it/s, est. speed input: 122622.69 toks/s, output: 119.75 toks/s]
Processed prompts:  27%|██▋       | 138/512 [00:01<00:04, 86.13it/s, est. speed input: 104003.56 toks/s, output: 101.56 toks/s] 
Processed prompts:  30%|███       | 154/512 [00:01<00:04, 78.68it/s, est. speed input: 96668.32 toks/s, output: 94.40 toks/s]  
Processed prompts:  32%|███▏      | 166/512 [00:01<00:04, 74.20it/s, est. speed input: 92613.85 toks/s, output: 90.44 toks/s]
Processed prompts:  34%|███▍      | 176/512 [00:01<00:04, 74.09it/s, est. speed input: 91419.01 toks/s, output: 89.28 toks/s]
Processed prompts:  36%|███▌      | 185/512 [00:02<00:04, 72.53it/s, est. speed input: 89906.29 toks/s, output: 87.80 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:02<00:04, 63.99it/s, est. speed input: 85971.75 toks/s, output: 83.96 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:02<00:04, 62.85it/s, est. speed input: 84544.11 toks/s, output: 82.56 toks/s]
Processed prompts:  41%|████      | 210/512 [00:02<00:04, 61.90it/s, est. speed input: 83271.45 toks/s, output: 81.32 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:02<00:04, 61.16it/s, est. speed input: 82133.00 toks/s, output: 80.21 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:02<00:04, 60.57it/s, est. speed input: 81096.62 toks/s, output: 79.20 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:02<00:04, 60.09it/s, est. speed input: 80150.01 toks/s, output: 78.27 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:03<00:04, 59.74it/s, est. speed input: 79284.47 toks/s, output: 77.43 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:03<00:04, 59.41it/s, est. speed input: 78478.24 toks/s, output: 76.64 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:03<00:04, 59.29it/s, est. speed input: 77757.40 toks/s, output: 75.93 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:03<00:04, 59.21it/s, est. speed input: 77092.90 toks/s, output: 75.29 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:03<00:04, 59.11it/s, est. speed input: 76470.62 toks/s, output: 74.68 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:03<00:03, 59.03it/s, est. speed input: 75890.75 toks/s, output: 74.11 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:03<00:03, 58.98it/s, est. speed input: 75352.06 toks/s, output: 73.59 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:04<00:03, 58.99it/s, est. speed input: 74855.12 toks/s, output: 73.10 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:04<00:03, 58.94it/s, est. speed input: 74384.31 toks/s, output: 72.64 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:04<00:03, 58.93it/s, est. speed input: 73945.06 toks/s, output: 72.21 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:04<00:03, 58.91it/s, est. speed input: 73531.06 toks/s, output: 71.81 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:04<00:03, 58.90it/s, est. speed input: 73140.68 toks/s, output: 71.43 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:04<00:02, 58.78it/s, est. speed input: 72760.38 toks/s, output: 71.05 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:04<00:02, 58.80it/s, est. speed input: 72413.58 toks/s, output: 70.72 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:05<00:02, 58.86it/s, est. speed input: 72089.20 toks/s, output: 70.40 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:05<00:02, 58.90it/s, est. speed input: 71783.45 toks/s, output: 70.10 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:05<00:02, 58.89it/s, est. speed input: 71488.26 toks/s, output: 69.81 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:05<00:02, 58.92it/s, est. speed input: 71211.27 toks/s, output: 69.54 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:05<00:02, 58.90it/s, est. speed input: 70944.66 toks/s, output: 69.28 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:05<00:02, 58.90it/s, est. speed input: 70692.42 toks/s, output: 69.04 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:05<00:01, 58.89it/s, est. speed input: 70449.75 toks/s, output: 68.80 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:05<00:01, 58.89it/s, est. speed input: 70218.68 toks/s, output: 68.57 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:06<00:01, 58.90it/s, est. speed input: 69999.13 toks/s, output: 68.36 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:06<00:01, 58.87it/s, est. speed input: 69786.14 toks/s, output: 68.15 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:06<00:01, 58.89it/s, est. speed input: 69586.14 toks/s, output: 67.95 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:06<00:01, 58.81it/s, est. speed input: 69386.08 toks/s, output: 67.76 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:06<00:01, 58.80it/s, est. speed input: 69197.98 toks/s, output: 67.58 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:06<00:00, 58.83it/s, est. speed input: 69019.93 toks/s, output: 67.40 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:06<00:00, 58.84it/s, est. speed input: 68848.67 toks/s, output: 67.23 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:07<00:00, 58.82it/s, est. speed input: 68682.13 toks/s, output: 67.07 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:07<00:00, 58.79it/s, est. speed input: 68520.55 toks/s, output: 66.91 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:07<00:00, 58.85it/s, est. speed input: 68370.37 toks/s, output: 66.77 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:07<00:00, 58.84it/s, est. speed input: 68222.43 toks/s, output: 66.62 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:07<00:00, 58.84it/s, est. speed input: 68079.59 toks/s, output: 66.48 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 58.84it/s, est. speed input: 68329.20 toks/s, output: 66.73 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 66.73it/s, est. speed input: 68329.20 toks/s, output: 66.73 toks/s]
[rank0]:[W128 07:51:36.977853185 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 451.7s

测试结果:
  Requests/s:   56.44
  Tokens/s:     57848.76
  Total Reqs:   512
  Elapsed:      9.07s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     57792.32

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 07:53:46 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 07:53:47 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=839738) WARNING 01-28 07:55:15 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=839738) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=839738) WARNING 01-28 07:56:56 [backends.py:609] Failed to read file <frozen os>
Throughput: 52.57 requests/s, 53884.88 total tokens/s, 52.57 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 07:53:39] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:53:46] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:53:46] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:53:46] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:53:46] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:53:46] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:53:46] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:53:46] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:53:46] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:53:46] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:53:46] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:53:46] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:53:46] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:53:46] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 07:54:29] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 07:54:48] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 07:54:48] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 07:54:48] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:54:48] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:54:48] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:54:48] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:54:48] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 07:54:48] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 07:54:48] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 07:54:48] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 07:54:48] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 07:54:48] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 07:54:48] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:18] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:18] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:18] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:18] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:18] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:18] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=839738) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=839738) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.09it/s]
(EngineCore_DP0 pid=839738) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.09it/s]
(EngineCore_DP0 pid=839738) 
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:52] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:53] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:53] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:55] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=839738) [2026-01-28 07:55:58] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=839738) [2026-01-28 07:56:00] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=839738) [2026-01-28 07:56:00] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=839738) [2026-01-28 07:56:00] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=839738) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:03<00:14,  3.62s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:04<00:05,  1.77s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:04<00:02,  1.30s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:06<00:01,  1.39s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:07<00:00,  1.45s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
(EngineCore_DP0 pid=839738) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:01,  2.28it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:00<00:00,  2.09it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:01<00:00,  1.90it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:01<00:00,  2.23it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:01<00:00,  2.15it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 34/1024 [00:00<00:02, 334.49it/s]
Adding requests:   7%|▋         | 72/1024 [00:00<00:02, 356.92it/s]
Adding requests:  11%|█         | 110/1024 [00:00<00:02, 367.09it/s]
Adding requests:  14%|█▍        | 147/1024 [00:00<00:02, 365.27it/s]
Adding requests:  18%|█▊        | 184/1024 [00:00<00:02, 365.75it/s]
Adding requests:  22%|██▏       | 223/1024 [00:00<00:02, 372.50it/s]
Adding requests:  25%|██▌       | 261/1024 [00:00<00:02, 372.92it/s]
Adding requests:  29%|██▉       | 299/1024 [00:00<00:01, 369.13it/s]
Adding requests:  33%|███▎      | 336/1024 [00:00<00:01, 368.18it/s]
Adding requests:  37%|███▋      | 374/1024 [00:01<00:01, 370.81it/s]
Adding requests:  40%|████      | 413/1024 [00:01<00:01, 373.70it/s]
Adding requests:  44%|████▍     | 451/1024 [00:01<00:01, 371.74it/s]
Adding requests:  48%|████▊     | 489/1024 [00:01<00:01, 370.47it/s]
Adding requests:  51%|█████▏    | 527/1024 [00:01<00:01, 359.67it/s]
Adding requests:  55%|█████▌    | 566/1024 [00:01<00:01, 366.61it/s]
Adding requests:  59%|█████▉    | 603/1024 [00:01<00:01, 367.57it/s]
Adding requests:  63%|██████▎   | 643/1024 [00:01<00:01, 374.43it/s]
Adding requests:  67%|██████▋   | 682/1024 [00:01<00:00, 379.01it/s]
Adding requests:  70%|███████   | 720/1024 [00:01<00:00, 377.62it/s]
Adding requests:  74%|███████▍  | 758/1024 [00:02<00:00, 375.33it/s]
Adding requests:  78%|███████▊  | 796/1024 [00:02<00:00, 371.17it/s]
Adding requests:  81%|████████▏ | 834/1024 [00:02<00:00, 364.13it/s]
Adding requests:  85%|████████▌ | 874/1024 [00:02<00:00, 373.00it/s]
Adding requests:  89%|████████▉ | 913/1024 [00:02<00:00, 377.53it/s]
Adding requests:  93%|█████████▎| 952/1024 [00:02<00:00, 379.31it/s]
Adding requests:  97%|█████████▋| 992/1024 [00:02<00:00, 383.58it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 372.67it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:00<00:01, 737.80it/s, est. speed input: 755626.26 toks/s, output: 737.83 toks/s]
Processed prompts:  19%|█▉        | 196/1024 [00:01<00:07, 111.12it/s, est. speed input: 135232.36 toks/s, output: 132.06 toks/s]
Processed prompts:  22%|██▏       | 230/1024 [00:02<00:08, 91.54it/s, est. speed input: 113758.85 toks/s, output: 111.09 toks/s] 
Processed prompts:  25%|██▍       | 251/1024 [00:02<00:09, 79.15it/s, est. speed input: 102401.54 toks/s, output: 100.00 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:02<00:10, 73.18it/s, est. speed input: 97156.93 toks/s, output: 94.88 toks/s]  
Processed prompts:  27%|██▋       | 278/1024 [00:02<00:10, 74.32it/s, est. speed input: 96494.07 toks/s, output: 94.23 toks/s]
Processed prompts:  28%|██▊       | 289/1024 [00:03<00:09, 74.41it/s, est. speed input: 95552.17 toks/s, output: 93.31 toks/s]
Processed prompts:  29%|██▉       | 299/1024 [00:03<00:11, 61.88it/s, est. speed input: 90317.83 toks/s, output: 88.20 toks/s]
Processed prompts:  30%|██▉       | 307/1024 [00:03<00:11, 60.56it/s, est. speed input: 88895.20 toks/s, output: 86.81 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:03<00:12, 57.92it/s, est. speed input: 87302.90 toks/s, output: 85.26 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:03<00:12, 57.16it/s, est. speed input: 86101.80 toks/s, output: 84.08 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:03<00:12, 56.52it/s, est. speed input: 84986.32 toks/s, output: 82.99 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:04<00:12, 56.03it/s, est. speed input: 83955.26 toks/s, output: 81.99 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:04<00:12, 55.61it/s, est. speed input: 82988.73 toks/s, output: 81.04 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:04<00:12, 55.30it/s, est. speed input: 82082.87 toks/s, output: 80.16 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:04<00:12, 55.09it/s, est. speed input: 81240.89 toks/s, output: 79.34 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:04<00:11, 54.88it/s, est. speed input: 80442.21 toks/s, output: 78.56 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:04<00:11, 54.75it/s, est. speed input: 79693.83 toks/s, output: 77.83 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:05<00:11, 54.66it/s, est. speed input: 78991.12 toks/s, output: 77.14 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:05<00:11, 54.54it/s, est. speed input: 78320.80 toks/s, output: 76.48 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:05<00:11, 54.54it/s, est. speed input: 77698.55 toks/s, output: 75.88 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:05<00:11, 54.48it/s, est. speed input: 77102.42 toks/s, output: 75.30 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:05<00:11, 54.47it/s, est. speed input: 76541.80 toks/s, output: 74.75 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:05<00:10, 54.48it/s, est. speed input: 76013.13 toks/s, output: 74.23 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:05<00:10, 54.47it/s, est. speed input: 75506.34 toks/s, output: 73.74 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:06<00:10, 54.45it/s, est. speed input: 75024.23 toks/s, output: 73.26 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:06<00:10, 54.43it/s, est. speed input: 74562.74 toks/s, output: 72.81 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:06<00:10, 54.42it/s, est. speed input: 74124.10 toks/s, output: 72.39 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:06<00:10, 54.42it/s, est. speed input: 73706.01 toks/s, output: 71.98 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:06<00:10, 54.45it/s, est. speed input: 73310.31 toks/s, output: 71.59 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:06<00:09, 54.43it/s, est. speed input: 72927.77 toks/s, output: 71.22 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:06<00:09, 54.41it/s, est. speed input: 72560.19 toks/s, output: 70.86 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:07<00:09, 54.42it/s, est. speed input: 72210.51 toks/s, output: 70.52 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:07<00:09, 54.36it/s, est. speed input: 71868.99 toks/s, output: 70.18 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:07<00:09, 54.39it/s, est. speed input: 71547.22 toks/s, output: 69.87 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:07<00:09, 54.39it/s, est. speed input: 71236.52 toks/s, output: 69.57 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:07<00:09, 54.40it/s, est. speed input: 70938.90 toks/s, output: 69.28 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:07<00:08, 54.40it/s, est. speed input: 70651.79 toks/s, output: 69.00 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:07<00:08, 54.41it/s, est. speed input: 70375.27 toks/s, output: 68.73 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:08<00:08, 54.23it/s, est. speed input: 70095.63 toks/s, output: 68.45 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:08<00:08, 53.97it/s, est. speed input: 69813.88 toks/s, output: 68.18 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:08<00:08, 53.74it/s, est. speed input: 69540.31 toks/s, output: 67.91 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:08<00:08, 53.62it/s, est. speed input: 69278.43 toks/s, output: 67.65 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:08<00:08, 53.56it/s, est. speed input: 69026.61 toks/s, output: 67.41 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:08<00:08, 53.50it/s, est. speed input: 68782.90 toks/s, output: 67.17 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:08<00:07, 53.44it/s, est. speed input: 68545.65 toks/s, output: 66.94 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:09<00:07, 53.41it/s, est. speed input: 68317.25 toks/s, output: 66.72 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:09<00:07, 53.36it/s, est. speed input: 68095.21 toks/s, output: 66.50 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:09<00:07, 53.37it/s, est. speed input: 67881.37 toks/s, output: 66.29 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:09<00:07, 53.33it/s, est. speed input: 67672.34 toks/s, output: 66.09 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:09<00:07, 53.33it/s, est. speed input: 67471.42 toks/s, output: 65.89 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:09<00:07, 53.33it/s, est. speed input: 67275.96 toks/s, output: 65.70 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:10<00:06, 53.31it/s, est. speed input: 67085.96 toks/s, output: 65.51 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:10<00:06, 53.26it/s, est. speed input: 66898.55 toks/s, output: 65.33 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:10<00:06, 53.14it/s, est. speed input: 66711.33 toks/s, output: 65.15 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:10<00:06, 53.12it/s, est. speed input: 66533.84 toks/s, output: 64.97 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:10<00:06, 53.16it/s, est. speed input: 66365.17 toks/s, output: 64.81 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:10<00:06, 53.19it/s, est. speed input: 66200.07 toks/s, output: 64.65 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:10<00:05, 53.25it/s, est. speed input: 66042.35 toks/s, output: 64.49 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:11<00:05, 53.26it/s, est. speed input: 65887.29 toks/s, output: 64.34 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:11<00:05, 53.30it/s, est. speed input: 65738.00 toks/s, output: 64.20 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:11<00:05, 53.32it/s, est. speed input: 65591.54 toks/s, output: 64.05 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:11<00:05, 53.31it/s, est. speed input: 65448.53 toks/s, output: 63.91 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:11<00:05, 53.34it/s, est. speed input: 65310.45 toks/s, output: 63.78 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:11<00:05, 53.35it/s, est. speed input: 65175.71 toks/s, output: 63.65 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:11<00:04, 53.39it/s, est. speed input: 65045.82 toks/s, output: 63.52 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:12<00:04, 53.36it/s, est. speed input: 64916.68 toks/s, output: 63.39 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:12<00:04, 53.35it/s, est. speed input: 64790.87 toks/s, output: 63.27 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:12<00:04, 53.36it/s, est. speed input: 64668.67 toks/s, output: 63.15 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:12<00:04, 53.34it/s, est. speed input: 64548.51 toks/s, output: 63.04 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:12<00:04, 53.30it/s, est. speed input: 64429.84 toks/s, output: 62.92 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:12<00:04, 53.33it/s, est. speed input: 64316.70 toks/s, output: 62.81 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:03, 53.28it/s, est. speed input: 64202.72 toks/s, output: 62.70 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:13<00:03, 53.32it/s, est. speed input: 64094.91 toks/s, output: 62.59 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:13<00:03, 53.31it/s, est. speed input: 63987.89 toks/s, output: 62.49 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:13<00:03, 53.30it/s, est. speed input: 63882.93 toks/s, output: 62.39 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:13<00:03, 53.33it/s, est. speed input: 63781.79 toks/s, output: 62.29 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:13<00:03, 53.29it/s, est. speed input: 63680.32 toks/s, output: 62.19 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:13<00:02, 53.29it/s, est. speed input: 63582.15 toks/s, output: 62.09 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 53.29it/s, est. speed input: 63486.25 toks/s, output: 62.00 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:14<00:02, 53.32it/s, est. speed input: 63393.50 toks/s, output: 61.91 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:14<00:02, 53.38it/s, est. speed input: 63304.50 toks/s, output: 61.82 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:14<00:02, 53.67it/s, est. speed input: 63227.17 toks/s, output: 61.75 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:14<00:02, 53.87it/s, est. speed input: 63151.02 toks/s, output: 61.67 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:14<00:02, 53.99it/s, est. speed input: 63075.91 toks/s, output: 61.60 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:14<00:01, 54.09it/s, est. speed input: 63002.61 toks/s, output: 61.53 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 54.14it/s, est. speed input: 62930.37 toks/s, output: 61.46 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 54.22it/s, est. speed input: 62860.87 toks/s, output: 61.39 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:15<00:01, 54.22it/s, est. speed input: 62791.11 toks/s, output: 61.32 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:15<00:01, 54.23it/s, est. speed input: 62722.21 toks/s, output: 61.25 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:15<00:01, 54.25it/s, est. speed input: 62655.31 toks/s, output: 61.19 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:15<00:00, 54.26it/s, est. speed input: 62589.64 toks/s, output: 61.12 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 54.29it/s, est. speed input: 62525.99 toks/s, output: 61.06 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 55.90it/s, est. speed input: 62517.90 toks/s, output: 61.05 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:16<00:00, 55.13it/s, est. speed input: 62445.91 toks/s, output: 60.98 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:16<00:00, 54.70it/s, est. speed input: 62378.45 toks/s, output: 60.92 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:16<00:00, 54.48it/s, est. speed input: 62314.99 toks/s, output: 60.85 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:16<00:00, 56.21it/s, est. speed input: 62313.62 toks/s, output: 60.85 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:16<00:00, 56.21it/s, est. speed input: 62679.95 toks/s, output: 61.21 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:16<00:00, 61.21it/s, est. speed input: 62679.95 toks/s, output: 61.21 toks/s]
[rank0]:[W128 07:59:05.640528019 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 479.5s

测试结果:
  Requests/s:   52.57
  Tokens/s:     53884.88
  Total Reqs:   1024
  Elapsed:      19.48s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     53832.31

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:02:03 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:02:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=843636) WARNING 01-28 08:03:37 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=843636) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=843636) WARNING 01-28 08:05:33 [backends.py:609] Failed to read file <frozen os>
Throughput: 42.57 requests/s, 43632.25 total tokens/s, 42.57 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 08:01:39] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:02:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:02:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:02:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:02:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:02:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:02:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:02:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:02:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:02:33] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:02:43] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:02:43] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:02:43] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:43] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:43] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:43] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:43] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:02:43] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:02:43] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:02:43] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:02:43] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:02:43] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:02:43] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 08:03:36.829094162 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=843636) [2026-01-28 08:03:52] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=843636) [2026-01-28 08:03:52] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=843636) [2026-01-28 08:03:52] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=843636) [2026-01-28 08:03:52] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=843636) [2026-01-28 08:03:52] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=843636) [2026-01-28 08:03:52] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=843636) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=843636) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.17it/s]
(EngineCore_DP0 pid=843636) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.17it/s]
(EngineCore_DP0 pid=843636) 
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:30] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:30] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:31] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:31] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=843636) [2026-01-28 08:04:31] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=843636) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:04<00:25,  4.21s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:16<00:44,  8.84s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:19<00:25,  6.33s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:27<00:20,  7.00s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:29<00:10,  5.29s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:31<00:03,  4.00s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:33<00:00,  3.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:33<00:00,  4.73s/it]
(EngineCore_DP0 pid=843636) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:03<00:12,  3.09s/it]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:03<00:04,  1.47s/it]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:04<00:02,  1.38s/it]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:05<00:01,  1.12s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:06<00:00,  1.01it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:06<00:00,  1.24s/it]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 35/2048 [00:00<00:05, 349.20it/s]
Adding requests:   4%|▎         | 74/2048 [00:00<00:05, 370.22it/s]
Adding requests:   6%|▌         | 113/2048 [00:00<00:05, 375.92it/s]
Adding requests:   7%|▋         | 151/2048 [00:00<00:05, 368.68it/s]
Adding requests:   9%|▉         | 189/2048 [00:00<00:05, 370.34it/s]
Adding requests:  11%|█         | 228/2048 [00:00<00:04, 374.69it/s]
Adding requests:  13%|█▎        | 267/2048 [00:00<00:04, 378.24it/s]
Adding requests:  15%|█▍        | 305/2048 [00:00<00:04, 373.47it/s]
Adding requests:  17%|█▋        | 343/2048 [00:00<00:04, 375.38it/s]
Adding requests:  19%|█▊        | 382/2048 [00:01<00:04, 378.82it/s]
Adding requests:  21%|██        | 421/2048 [00:01<00:04, 381.74it/s]
Adding requests:  22%|██▏       | 460/2048 [00:01<00:04, 381.15it/s]
Adding requests:  24%|██▍       | 499/2048 [00:01<00:04, 380.83it/s]
Adding requests:  26%|██▋       | 538/2048 [00:01<00:04, 374.13it/s]
Adding requests:  28%|██▊       | 579/2048 [00:01<00:03, 381.77it/s]
Adding requests:  30%|███       | 618/2048 [00:01<00:03, 380.54it/s]
Adding requests:  32%|███▏      | 657/2048 [00:01<00:03, 381.69it/s]
Adding requests:  34%|███▍      | 697/2048 [00:01<00:03, 386.89it/s]
Adding requests:  36%|███▌      | 738/2048 [00:01<00:03, 391.49it/s]
Adding requests:  38%|███▊      | 778/2048 [00:02<00:03, 378.40it/s]
Adding requests:  40%|███▉      | 816/2048 [00:02<00:03, 376.99it/s]
Adding requests:  42%|████▏     | 855/2048 [00:02<00:03, 380.22it/s]
Adding requests:  44%|████▎     | 895/2048 [00:02<00:02, 385.83it/s]
Adding requests:  46%|████▌     | 935/2048 [00:02<00:02, 388.83it/s]
Adding requests:  48%|████▊     | 975/2048 [00:02<00:02, 391.26it/s]
Adding requests:  50%|████▉     | 1015/2048 [00:02<00:02, 393.54it/s]
Adding requests:  52%|█████▏    | 1055/2048 [00:02<00:02, 392.60it/s]
Adding requests:  53%|█████▎    | 1095/2048 [00:02<00:02, 390.68it/s]
Adding requests:  55%|█████▌    | 1135/2048 [00:02<00:02, 388.57it/s]
Adding requests:  57%|█████▋    | 1176/2048 [00:03<00:02, 394.50it/s]
Adding requests:  60%|█████▉    | 1219/2048 [00:03<00:02, 402.41it/s]
Adding requests:  62%|██████▏   | 1260/2048 [00:03<00:01, 394.87it/s]
Adding requests:  63%|██████▎   | 1300/2048 [00:03<00:01, 395.08it/s]
Adding requests:  65%|██████▌   | 1341/2048 [00:03<00:01, 399.11it/s]
Adding requests:  67%|██████▋   | 1381/2048 [00:03<00:01, 397.43it/s]
Adding requests:  69%|██████▉   | 1421/2048 [00:03<00:01, 395.73it/s]
Adding requests:  71%|███████▏  | 1461/2048 [00:03<00:01, 393.69it/s]
Adding requests:  73%|███████▎  | 1502/2048 [00:03<00:01, 395.93it/s]
Adding requests:  75%|███████▌  | 1542/2048 [00:03<00:01, 396.08it/s]
Adding requests:  77%|███████▋  | 1582/2048 [00:04<00:01, 394.02it/s]
Adding requests:  79%|███████▉  | 1623/2048 [00:04<00:01, 398.13it/s]
Adding requests:  81%|████████  | 1663/2048 [00:04<00:00, 396.84it/s]
Adding requests:  83%|████████▎ | 1703/2048 [00:04<00:00, 397.15it/s]
Adding requests:  85%|████████▌ | 1744/2048 [00:04<00:00, 397.50it/s]
Adding requests:  87%|████████▋ | 1784/2048 [00:04<00:00, 392.55it/s]
Adding requests:  89%|████████▉ | 1826/2048 [00:04<00:00, 397.73it/s]
Adding requests:  91%|█████████ | 1866/2048 [00:04<00:00, 395.20it/s]
Adding requests:  93%|█████████▎| 1907/2048 [00:04<00:00, 397.18it/s]
Adding requests:  95%|█████████▌| 1947/2048 [00:05<00:00, 383.78it/s]
Adding requests:  97%|█████████▋| 1987/2048 [00:05<00:00, 385.54it/s]
Adding requests:  99%|█████████▉| 2028/2048 [00:05<00:00, 392.00it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 387.74it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/2048 [00:08<2:31:48,  4.45s/it, est. speed input: 230.01 toks/s, output: 0.22 toks/s]
Processed prompts:   1%|          | 18/2048 [00:09<12:39,  2.67it/s, est. speed input: 2008.04 toks/s, output: 1.96 toks/s]
Processed prompts:   2%|▏         | 34/2048 [00:09<05:45,  5.84it/s, est. speed input: 3683.17 toks/s, output: 3.60 toks/s]
Processed prompts:   2%|▏         | 50/2048 [00:09<03:24,  9.77it/s, est. speed input: 5263.18 toks/s, output: 5.14 toks/s]
Processed prompts:   3%|▎         | 66/2048 [00:10<02:16, 14.47it/s, est. speed input: 6756.59 toks/s, output: 6.60 toks/s]
Processed prompts:   4%|▍         | 82/2048 [00:10<01:39, 19.80it/s, est. speed input: 8170.18 toks/s, output: 7.98 toks/s]
Processed prompts:   5%|▍         | 98/2048 [00:10<01:16, 25.49it/s, est. speed input: 9510.21 toks/s, output: 9.29 toks/s]
Processed prompts:   6%|▌         | 114/2048 [00:10<01:01, 31.21it/s, est. speed input: 10782.08 toks/s, output: 10.53 toks/s]
Processed prompts:   6%|▋         | 130/2048 [00:11<00:52, 36.61it/s, est. speed input: 11991.49 toks/s, output: 11.71 toks/s]
Processed prompts:   7%|▋         | 146/2048 [00:11<00:45, 41.41it/s, est. speed input: 13142.13 toks/s, output: 12.83 toks/s]
Processed prompts:   8%|▊         | 162/2048 [00:11<00:41, 45.47it/s, est. speed input: 14238.71 toks/s, output: 13.90 toks/s]
Processed prompts:   9%|▊         | 178/2048 [00:11<00:38, 48.73it/s, est. speed input: 15284.39 toks/s, output: 14.93 toks/s]
Processed prompts:   9%|▉         | 194/2048 [00:12<00:36, 51.27it/s, est. speed input: 16283.00 toks/s, output: 15.90 toks/s]
Processed prompts:  10%|█         | 210/2048 [00:12<00:34, 53.19it/s, est. speed input: 17237.46 toks/s, output: 16.83 toks/s]
Processed prompts:  11%|█         | 226/2048 [00:12<00:33, 54.60it/s, est. speed input: 18150.52 toks/s, output: 17.73 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:13<00:32, 55.62it/s, est. speed input: 19024.83 toks/s, output: 18.58 toks/s]
Processed prompts:  13%|█▎        | 258/2048 [00:13<00:31, 56.37it/s, est. speed input: 19863.56 toks/s, output: 19.40 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:13<00:31, 56.90it/s, est. speed input: 20668.03 toks/s, output: 20.18 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:13<00:30, 57.28it/s, est. speed input: 21440.62 toks/s, output: 20.94 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:14<00:30, 57.54it/s, est. speed input: 22182.92 toks/s, output: 21.66 toks/s]
Processed prompts:  16%|█▌        | 322/2048 [00:14<00:29, 57.71it/s, est. speed input: 22896.51 toks/s, output: 22.36 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:14<00:29, 57.84it/s, est. speed input: 23583.60 toks/s, output: 23.03 toks/s]
Processed prompts:  17%|█▋        | 354/2048 [00:14<00:29, 57.94it/s, est. speed input: 24245.58 toks/s, output: 23.68 toks/s]
Processed prompts:  18%|█▊        | 370/2048 [00:15<00:28, 58.01it/s, est. speed input: 24883.72 toks/s, output: 24.30 toks/s]
Processed prompts:  19%|█▉        | 386/2048 [00:15<00:28, 58.06it/s, est. speed input: 25499.22 toks/s, output: 24.90 toks/s]
Processed prompts:  20%|█▉        | 402/2048 [00:15<00:28, 58.10it/s, est. speed input: 26093.30 toks/s, output: 25.48 toks/s]
Processed prompts:  20%|██        | 418/2048 [00:16<00:28, 58.09it/s, est. speed input: 26666.11 toks/s, output: 26.04 toks/s]
Processed prompts:  21%|██        | 434/2048 [00:16<00:27, 58.13it/s, est. speed input: 27220.81 toks/s, output: 26.58 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:16<00:27, 58.08it/s, est. speed input: 27754.94 toks/s, output: 27.10 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:16<00:27, 58.09it/s, est. speed input: 28273.08 toks/s, output: 27.61 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:17<00:26, 58.09it/s, est. speed input: 28774.29 toks/s, output: 28.10 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:17<00:26, 58.09it/s, est. speed input: 29259.61 toks/s, output: 28.57 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:17<00:26, 58.10it/s, est. speed input: 29730.17 toks/s, output: 29.03 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:17<00:26, 57.94it/s, est. speed input: 30181.71 toks/s, output: 29.47 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:18<00:25, 57.96it/s, est. speed input: 30623.03 toks/s, output: 29.91 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:18<00:25, 58.01it/s, est. speed input: 31052.36 toks/s, output: 30.32 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:18<00:25, 58.06it/s, est. speed input: 31469.42 toks/s, output: 30.73 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:19<00:25, 58.09it/s, est. speed input: 31874.40 toks/s, output: 31.13 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:19<00:24, 58.10it/s, est. speed input: 32267.42 toks/s, output: 31.51 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:19<00:24, 58.10it/s, est. speed input: 32649.38 toks/s, output: 31.88 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:19<00:24, 58.12it/s, est. speed input: 33021.07 toks/s, output: 32.25 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:20<00:23, 58.12it/s, est. speed input: 33382.43 toks/s, output: 32.60 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:20<00:23, 58.12it/s, est. speed input: 33734.13 toks/s, output: 32.94 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:20<00:23, 58.11it/s, est. speed input: 34076.08 toks/s, output: 33.28 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:21<00:23, 58.04it/s, est. speed input: 34407.62 toks/s, output: 33.60 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:21<00:22, 58.05it/s, est. speed input: 34732.00 toks/s, output: 33.92 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:21<00:22, 58.06it/s, est. speed input: 35048.06 toks/s, output: 34.23 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:21<00:22, 58.08it/s, est. speed input: 35356.45 toks/s, output: 34.53 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:22<00:22, 58.09it/s, est. speed input: 35657.18 toks/s, output: 34.82 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:22<00:21, 58.08it/s, est. speed input: 35950.21 toks/s, output: 35.11 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:22<00:21, 58.06it/s, est. speed input: 36235.64 toks/s, output: 35.39 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:22<00:21, 58.07it/s, est. speed input: 36514.77 toks/s, output: 35.66 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:23<00:20, 58.07it/s, est. speed input: 36787.06 toks/s, output: 35.92 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:23<00:20, 58.14it/s, est. speed input: 37054.84 toks/s, output: 36.19 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:23<00:20, 58.07it/s, est. speed input: 37313.53 toks/s, output: 36.44 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:24<00:20, 58.07it/s, est. speed input: 37567.26 toks/s, output: 36.69 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:24<00:19, 58.09it/s, est. speed input: 37816.00 toks/s, output: 36.93 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:24<00:19, 58.09it/s, est. speed input: 38058.54 toks/s, output: 37.17 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:24<00:19, 58.09it/s, est. speed input: 38295.86 toks/s, output: 37.40 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:25<00:18, 58.10it/s, est. speed input: 38528.33 toks/s, output: 37.63 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:25<00:18, 58.09it/s, est. speed input: 38755.18 toks/s, output: 37.85 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:25<00:18, 59.04it/s, est. speed input: 38999.74 toks/s, output: 38.09 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:25<00:17, 58.74it/s, est. speed input: 39216.84 toks/s, output: 38.30 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:26<00:17, 58.53it/s, est. speed input: 39429.46 toks/s, output: 38.51 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:26<00:17, 58.41it/s, est. speed input: 39638.02 toks/s, output: 38.71 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:26<00:17, 58.31it/s, est. speed input: 39842.00 toks/s, output: 38.91 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:27<00:16, 58.24it/s, est. speed input: 40042.04 toks/s, output: 39.10 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:27<00:16, 58.20it/s, est. speed input: 40238.00 toks/s, output: 39.29 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:27<00:16, 58.15it/s, est. speed input: 40429.67 toks/s, output: 39.48 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:27<00:16, 58.12it/s, est. speed input: 40617.64 toks/s, output: 39.67 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:28<00:15, 58.10it/s, est. speed input: 40801.99 toks/s, output: 39.85 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:28<00:15, 58.09it/s, est. speed input: 40982.68 toks/s, output: 40.02 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:28<00:15, 59.04it/s, est. speed input: 41181.45 toks/s, output: 40.22 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:28<00:14, 58.74it/s, est. speed input: 41355.28 toks/s, output: 40.39 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:29<00:14, 58.53it/s, est. speed input: 41525.74 toks/s, output: 40.55 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:29<00:14, 58.39it/s, est. speed input: 41693.03 toks/s, output: 40.72 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:29<00:14, 58.29it/s, est. speed input: 41857.23 toks/s, output: 40.88 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:30<00:13, 58.20it/s, est. speed input: 42018.04 toks/s, output: 41.03 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:30<00:13, 58.16it/s, est. speed input: 42176.49 toks/s, output: 41.19 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:30<00:13, 58.11it/s, est. speed input: 42331.58 toks/s, output: 41.34 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:30<00:13, 58.10it/s, est. speed input: 42484.34 toks/s, output: 41.49 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:31<00:12, 58.10it/s, est. speed input: 42634.58 toks/s, output: 41.64 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:31<00:12, 58.07it/s, est. speed input: 42781.61 toks/s, output: 41.78 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:31<00:12, 58.05it/s, est. speed input: 42926.11 toks/s, output: 41.92 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:32<00:12, 58.06it/s, est. speed input: 43068.45 toks/s, output: 42.06 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:32<00:11, 58.04it/s, est. speed input: 43207.86 toks/s, output: 42.20 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:32<00:11, 58.06it/s, est. speed input: 43345.65 toks/s, output: 42.33 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:32<00:11, 58.05it/s, est. speed input: 43480.68 toks/s, output: 42.46 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:33<00:10, 58.04it/s, est. speed input: 43613.37 toks/s, output: 42.59 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:33<00:10, 58.02it/s, est. speed input: 43743.67 toks/s, output: 42.72 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:33<00:10, 58.01it/s, est. speed input: 43871.82 toks/s, output: 42.84 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:33<00:10, 58.00it/s, est. speed input: 43997.77 toks/s, output: 42.97 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:34<00:09, 57.98it/s, est. speed input: 44121.61 toks/s, output: 43.09 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:34<00:09, 57.96it/s, est. speed input: 44243.11 toks/s, output: 43.21 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:34<00:09, 57.93it/s, est. speed input: 44362.56 toks/s, output: 43.32 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:35<00:09, 57.93it/s, est. speed input: 44480.36 toks/s, output: 43.44 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:35<00:08, 57.91it/s, est. speed input: 44596.08 toks/s, output: 43.55 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:35<00:08, 57.89it/s, est. speed input: 44709.74 toks/s, output: 43.66 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:35<00:08, 57.89it/s, est. speed input: 44822.04 toks/s, output: 43.77 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:36<00:07, 57.88it/s, est. speed input: 44932.45 toks/s, output: 43.88 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:36<00:07, 57.87it/s, est. speed input: 45041.05 toks/s, output: 43.99 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:36<00:07, 57.86it/s, est. speed input: 45147.93 toks/s, output: 44.09 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:36<00:07, 57.88it/s, est. speed input: 45253.81 toks/s, output: 44.19 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:37<00:06, 57.88it/s, est. speed input: 45357.76 toks/s, output: 44.29 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:37<00:06, 57.86it/s, est. speed input: 45459.87 toks/s, output: 44.39 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:37<00:06, 57.92it/s, est. speed input: 45561.91 toks/s, output: 44.49 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:38<00:06, 57.85it/s, est. speed input: 45660.37 toks/s, output: 44.59 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:38<00:05, 57.85it/s, est. speed input: 45758.28 toks/s, output: 44.69 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:38<00:05, 57.85it/s, est. speed input: 45854.73 toks/s, output: 44.78 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:38<00:05, 57.83it/s, est. speed input: 45949.45 toks/s, output: 44.87 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:39<00:04, 57.83it/s, est. speed input: 46043.08 toks/s, output: 44.96 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:39<00:04, 57.84it/s, est. speed input: 46135.64 toks/s, output: 45.05 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:39<00:04, 57.82it/s, est. speed input: 46226.51 toks/s, output: 45.14 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:40<00:04, 57.83it/s, est. speed input: 46316.34 toks/s, output: 45.23 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:40<00:03, 57.81it/s, est. speed input: 46404.66 toks/s, output: 45.32 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:40<00:03, 57.82it/s, est. speed input: 46492.08 toks/s, output: 45.40 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:41<00:06, 27.16it/s, est. speed input: 45420.54 toks/s, output: 44.36 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:42<00:05, 32.60it/s, est. speed input: 45527.27 toks/s, output: 44.46 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:42<00:04, 37.50it/s, est. speed input: 45616.24 toks/s, output: 44.55 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:42<00:03, 41.91it/s, est. speed input: 45704.15 toks/s, output: 44.63 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:42<00:02, 45.68it/s, est. speed input: 45790.91 toks/s, output: 44.72 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:43<00:02, 48.75it/s, est. speed input: 45876.69 toks/s, output: 44.80 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:43<00:01, 51.12it/s, est. speed input: 45960.77 toks/s, output: 44.88 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:43<00:01, 52.92it/s, est. speed input: 46043.65 toks/s, output: 44.96 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:44<00:01, 54.26it/s, est. speed input: 46125.35 toks/s, output: 45.04 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:44<00:00, 55.23it/s, est. speed input: 46206.12 toks/s, output: 45.12 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:44<00:00, 55.95it/s, est. speed input: 46286.08 toks/s, output: 45.20 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:44<00:00, 57.53it/s, est. speed input: 46383.23 toks/s, output: 45.30 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:44<00:00, 57.53it/s, est. speed input: 46702.15 toks/s, output: 45.61 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:44<00:00, 45.61it/s, est. speed input: 46702.15 toks/s, output: 45.61 toks/s]
[rank0]:[W128 08:08:04.096269354 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 466.7s

测试结果:
  Requests/s:   42.57
  Tokens/s:     43632.25
  Total Reqs:   2048
  Elapsed:      48.11s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     43589.68

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:8)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:10:37 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:10:39 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=847694) WARNING 01-28 08:12:03 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=847694) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=847694) WARNING 01-28 08:14:41 [backends.py:609] Failed to read file <frozen os>
Throughput: 45.07 requests/s, 46200.85 total tokens/s, 45.07 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 08:09:49] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:10:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:10:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:10:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:10:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:10:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:10:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:10:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:10:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:10:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:10:58] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:10:58] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:10:58] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:58] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:58] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:58] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:58] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:10:58] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:10:58] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:10:58] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:10:58] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:10:58] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:10:58] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=847694) [2026-01-28 08:12:11] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=847694) [2026-01-28 08:12:11] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=847694) [2026-01-28 08:12:11] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=847694) [2026-01-28 08:12:11] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:8, expand_ratio=1.333
(EngineCore_DP0 pid=847694) [2026-01-28 08:12:11] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=847694) [2026-01-28 08:12:11] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=847694) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=847694) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.21it/s]
(EngineCore_DP0 pid=847694) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.21it/s]
(EngineCore_DP0 pid=847694) 
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 3840] -> 1D uint8
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11059200 bytes
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 3840] -> 1D uint8
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7372800 bytes
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 3840] -> 1D uint8
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 39813120 bytes
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 10368] -> 1D uint8
(EngineCore_DP0 pid=847694) [2026-01-28 08:13:08] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 19906560 bytes
(EngineCore_DP0 pid=847694) [rank0]:W0128 08:14:49.918000 847694 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=847694) [rank0]:W0128 08:14:50.017000 847694 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=847694) [rank0]:W0128 08:14:51.741000 847694 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=847694) [rank0]:W0128 08:14:51.897000 847694 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=847694) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:03<00:30,  3.01s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:04<00:19,  2.20s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:06<00:15,  1.95s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:07<00:12,  1.85s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:10<00:11,  1.95s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:11<00:08,  1.79s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:12<00:06,  1.52s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:16<00:07,  2.34s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:26<00:09,  4.74s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:35<00:06,  6.01s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:38<00:00,  5.14s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:38<00:00,  3.52s/it]
(EngineCore_DP0 pid=847694) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:01<00:10,  1.74s/it]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:03<00:08,  1.75s/it]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:03<00:04,  1.08s/it]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:03<00:02,  1.40it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:04<00:01,  1.67it/s]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:05<00:00,  1.38it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:05<00:00,  1.44it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:05<00:00,  1.18it/s]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 34/4096 [00:00<00:12, 337.99it/s]
Adding requests:   2%|▏         | 71/4096 [00:00<00:11, 356.13it/s]
Adding requests:   3%|▎         | 109/4096 [00:00<00:10, 363.03it/s]
Adding requests:   4%|▎         | 146/4096 [00:00<00:10, 360.59it/s]
Adding requests:   4%|▍         | 183/4096 [00:00<00:10, 358.94it/s]
Adding requests:   5%|▌         | 221/4096 [00:00<00:10, 362.84it/s]
Adding requests:   6%|▋         | 259/4096 [00:00<00:10, 366.73it/s]
Adding requests:   7%|▋         | 296/4096 [00:00<00:10, 349.68it/s]
Adding requests:   8%|▊         | 332/4096 [00:00<00:10, 351.31it/s]
Adding requests:   9%|▉         | 371/4096 [00:01<00:10, 361.16it/s]
Adding requests:  10%|█         | 410/4096 [00:01<00:10, 368.13it/s]
Adding requests:  11%|█         | 448/4096 [00:01<00:09, 371.07it/s]
Adding requests:  12%|█▏        | 487/4096 [00:01<00:09, 373.83it/s]
Adding requests:  13%|█▎        | 525/4096 [00:01<00:09, 364.03it/s]
Adding requests:  14%|█▍        | 564/4096 [00:01<00:09, 370.10it/s]
Adding requests:  15%|█▍        | 602/4096 [00:01<00:09, 371.44it/s]
Adding requests:  16%|█▌        | 642/4096 [00:01<00:09, 377.94it/s]
Adding requests:  17%|█▋        | 682/4096 [00:01<00:08, 383.70it/s]
Adding requests:  18%|█▊        | 721/4096 [00:01<00:08, 383.80it/s]
Adding requests:  19%|█▊        | 760/4096 [00:02<00:08, 381.70it/s]
Adding requests:  20%|█▉        | 799/4096 [00:02<00:08, 380.46it/s]
Adding requests:  20%|██        | 838/4096 [00:02<00:08, 372.99it/s]
Adding requests:  21%|██▏       | 878/4096 [00:02<00:08, 378.53it/s]
Adding requests:  22%|██▏       | 918/4096 [00:02<00:08, 382.92it/s]
Adding requests:  23%|██▎       | 957/4096 [00:02<00:08, 380.92it/s]
Adding requests:  24%|██▍       | 997/4096 [00:02<00:08, 384.62it/s]
Adding requests:  25%|██▌       | 1036/4096 [00:02<00:07, 383.01it/s]
Adding requests:  26%|██▌       | 1075/4096 [00:02<00:07, 381.13it/s]
Adding requests:  27%|██▋       | 1114/4096 [00:02<00:07, 380.67it/s]
Adding requests:  28%|██▊       | 1153/4096 [00:03<00:07, 381.43it/s]
Adding requests:  29%|██▉       | 1195/4096 [00:03<00:07, 390.54it/s]
Adding requests:  30%|███       | 1235/4096 [00:03<00:07, 377.54it/s]
Adding requests:  31%|███       | 1273/4096 [00:03<00:07, 378.12it/s]
Adding requests:  32%|███▏      | 1312/4096 [00:03<00:07, 379.53it/s]
Adding requests:  33%|███▎      | 1352/4096 [00:03<00:07, 384.18it/s]
Adding requests:  34%|███▍      | 1392/4096 [00:03<00:06, 388.68it/s]
Adding requests:  35%|███▍      | 1431/4096 [00:03<00:06, 387.00it/s]
Adding requests:  36%|███▌      | 1471/4096 [00:03<00:06, 390.58it/s]
Adding requests:  37%|███▋      | 1511/4096 [00:04<00:06, 392.57it/s]
Adding requests:  38%|███▊      | 1551/4096 [00:04<00:06, 391.43it/s]
Adding requests:  39%|███▉      | 1591/4096 [00:04<00:06, 391.53it/s]
Adding requests:  40%|███▉      | 1631/4096 [00:04<00:06, 393.06it/s]
Adding requests:  41%|████      | 1671/4096 [00:04<00:06, 389.40it/s]
Adding requests:  42%|████▏     | 1710/4096 [00:04<00:06, 387.94it/s]
Adding requests:  43%|████▎     | 1749/4096 [00:04<00:06, 386.38it/s]
Adding requests:  44%|████▎     | 1788/4096 [00:04<00:05, 386.97it/s]
Adding requests:  45%|████▍     | 1827/4096 [00:04<00:05, 383.73it/s]
Adding requests:  46%|████▌     | 1866/4096 [00:04<00:05, 381.63it/s]
Adding requests:  47%|████▋     | 1905/4096 [00:05<00:05, 383.31it/s]
Adding requests:  47%|████▋     | 1944/4096 [00:05<00:05, 385.19it/s]
Adding requests:  48%|████▊     | 1983/4096 [00:05<00:05, 385.20it/s]
Adding requests:  49%|████▉     | 2023/4096 [00:05<00:05, 389.36it/s]
Adding requests:  50%|█████     | 2064/4096 [00:05<00:05, 393.54it/s]
Adding requests:  51%|█████▏    | 2105/4096 [00:05<00:05, 396.68it/s]
Adding requests:  52%|█████▏    | 2145/4096 [00:05<00:04, 390.27it/s]
Adding requests:  53%|█████▎    | 2185/4096 [00:05<00:04, 386.69it/s]
Adding requests:  54%|█████▍    | 2226/4096 [00:05<00:04, 390.17it/s]
Adding requests:  55%|█████▌    | 2266/4096 [00:05<00:04, 390.23it/s]
Adding requests:  56%|█████▋    | 2307/4096 [00:06<00:04, 393.01it/s]
Adding requests:  57%|█████▋    | 2347/4096 [00:06<00:04, 390.60it/s]
Adding requests:  58%|█████▊    | 2387/4096 [00:06<00:04, 391.68it/s]
Adding requests:  59%|█████▉    | 2427/4096 [00:06<00:04, 392.21it/s]
Adding requests:  60%|██████    | 2467/4096 [00:06<00:04, 378.54it/s]
Adding requests:  61%|██████    | 2506/4096 [00:06<00:04, 381.74it/s]
Adding requests:  62%|██████▏   | 2545/4096 [00:06<00:04, 382.66it/s]
Adding requests:  63%|██████▎   | 2585/4096 [00:06<00:03, 386.69it/s]
Adding requests:  64%|██████▍   | 2624/4096 [00:06<00:03, 384.66it/s]
Adding requests:  65%|██████▌   | 2665/4096 [00:06<00:03, 389.10it/s]
Adding requests:  66%|██████▌   | 2704/4096 [00:07<00:03, 385.02it/s]
Adding requests:  67%|██████▋   | 2744/4096 [00:07<00:03, 386.88it/s]
Adding requests:  68%|██████▊   | 2783/4096 [00:07<00:03, 387.48it/s]
Adding requests:  69%|██████▉   | 2822/4096 [00:07<00:03, 382.75it/s]
Adding requests:  70%|██████▉   | 2862/4096 [00:07<00:03, 386.72it/s]
Adding requests:  71%|███████   | 2902/4096 [00:07<00:03, 389.54it/s]
Adding requests:  72%|███████▏  | 2941/4096 [00:07<00:02, 385.16it/s]
Adding requests:  73%|███████▎  | 2982/4096 [00:07<00:02, 387.79it/s]
Adding requests:  74%|███████▍  | 3022/4096 [00:07<00:02, 388.39it/s]
Adding requests:  75%|███████▍  | 3061/4096 [00:08<00:02, 384.77it/s]
Adding requests:  76%|███████▌  | 3100/4096 [00:08<00:02, 386.09it/s]
Adding requests:  77%|███████▋  | 3140/4096 [00:08<00:02, 387.54it/s]
Adding requests:  78%|███████▊  | 3179/4096 [00:08<00:02, 387.25it/s]
Adding requests:  79%|███████▊  | 3218/4096 [00:08<00:02, 387.13it/s]
Adding requests:  80%|███████▉  | 3258/4096 [00:08<00:02, 387.51it/s]
Adding requests:  81%|████████  | 3298/4096 [00:08<00:02, 391.03it/s]
Adding requests:  81%|████████▏ | 3338/4096 [00:08<00:01, 386.86it/s]
Adding requests:  82%|████████▏ | 3377/4096 [00:08<00:01, 387.60it/s]
Adding requests:  83%|████████▎ | 3416/4096 [00:08<00:01, 386.75it/s]
Adding requests:  84%|████████▍ | 3455/4096 [00:09<00:01, 383.23it/s]
Adding requests:  85%|████████▌ | 3494/4096 [00:09<00:01, 379.33it/s]
Adding requests:  86%|████████▋ | 3533/4096 [00:09<00:01, 380.63it/s]
Adding requests:  87%|████████▋ | 3573/4096 [00:09<00:01, 383.22it/s]
Adding requests:  88%|████████▊ | 3612/4096 [00:09<00:01, 384.92it/s]
Adding requests:  89%|████████▉ | 3651/4096 [00:09<00:01, 385.82it/s]
Adding requests:  90%|█████████ | 3690/4096 [00:09<00:01, 386.63it/s]
Adding requests:  91%|█████████ | 3729/4096 [00:09<00:00, 385.63it/s]
Adding requests:  92%|█████████▏| 3769/4096 [00:09<00:00, 389.01it/s]
Adding requests:  93%|█████████▎| 3808/4096 [00:09<00:00, 389.02it/s]
Adding requests:  94%|█████████▍| 3847/4096 [00:10<00:00, 377.22it/s]
Adding requests:  95%|█████████▍| 3886/4096 [00:10<00:00, 380.92it/s]
Adding requests:  96%|█████████▌| 3926/4096 [00:10<00:00, 384.37it/s]
Adding requests:  97%|█████████▋| 3965/4096 [00:10<00:00, 383.91it/s]
Adding requests:  98%|█████████▊| 4004/4096 [00:10<00:00, 384.11it/s]
Adding requests:  99%|█████████▊| 4043/4096 [00:10<00:00, 382.58it/s]
Adding requests: 100%|█████████▉| 4082/4096 [00:10<00:00, 382.01it/s]
Adding requests: 100%|██████████| 4096/4096 [00:10<00:00, 382.57it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/4096 [00:10<5:41:15,  5.00s/it, est. speed input: 204.75 toks/s, output: 0.20 toks/s]
Processed prompts:   1%|          | 34/4096 [00:10<15:18,  4.42it/s, est. speed input: 3298.16 toks/s, output: 3.22 toks/s]
Processed prompts:   2%|▏         | 66/4096 [00:11<07:04,  9.49it/s, est. speed input: 6087.01 toks/s, output: 5.94 toks/s]
Processed prompts:   2%|▏         | 98/4096 [00:11<04:21, 15.27it/s, est. speed input: 8612.82 toks/s, output: 8.41 toks/s]
Processed prompts:   3%|▎         | 130/4096 [00:12<03:04, 21.50it/s, est. speed input: 10911.66 toks/s, output: 10.66 toks/s]
Processed prompts:   4%|▍         | 162/4096 [00:12<02:21, 27.81it/s, est. speed input: 13012.81 toks/s, output: 12.71 toks/s]
Processed prompts:   5%|▍         | 194/4096 [00:13<01:55, 33.81it/s, est. speed input: 14940.23 toks/s, output: 14.59 toks/s]
Processed prompts:   6%|▌         | 226/4096 [00:13<01:38, 39.19it/s, est. speed input: 16714.88 toks/s, output: 16.32 toks/s]
Processed prompts:   6%|▋         | 258/4096 [00:14<01:27, 43.76it/s, est. speed input: 18354.51 toks/s, output: 17.92 toks/s]
Processed prompts:   7%|▋         | 290/4096 [00:14<01:20, 47.45it/s, est. speed input: 19873.03 toks/s, output: 19.41 toks/s]
Processed prompts:   8%|▊         | 322/4096 [00:15<01:14, 50.33it/s, est. speed input: 21283.71 toks/s, output: 20.78 toks/s]
Processed prompts:   9%|▊         | 354/4096 [00:16<01:11, 52.52it/s, est. speed input: 22597.69 toks/s, output: 22.07 toks/s]
Processed prompts:   9%|▉         | 386/4096 [00:16<01:08, 54.14it/s, est. speed input: 23824.66 toks/s, output: 23.27 toks/s]
Processed prompts:  10%|█         | 418/4096 [00:17<01:06, 55.31it/s, est. speed input: 24972.29 toks/s, output: 24.39 toks/s]
Processed prompts:  11%|█         | 450/4096 [00:17<01:04, 56.15it/s, est. speed input: 26048.21 toks/s, output: 25.44 toks/s]
Processed prompts:  12%|█▏        | 482/4096 [00:18<01:03, 56.74it/s, est. speed input: 27058.83 toks/s, output: 26.42 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:18<01:02, 57.16it/s, est. speed input: 28010.24 toks/s, output: 27.35 toks/s]
Processed prompts:  13%|█▎        | 546/4096 [00:19<01:01, 57.44it/s, est. speed input: 28906.92 toks/s, output: 28.23 toks/s]
Processed prompts:  14%|█▍        | 578/4096 [00:19<01:01, 57.61it/s, est. speed input: 29752.64 toks/s, output: 29.06 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:20<01:00, 57.73it/s, est. speed input: 30552.53 toks/s, output: 29.84 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:20<00:59, 57.82it/s, est. speed input: 31310.84 toks/s, output: 30.58 toks/s]
Processed prompts:  16%|█▋        | 674/4096 [00:22<01:32, 36.90it/s, est. speed input: 30545.19 toks/s, output: 29.83 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:23<01:21, 41.42it/s, est. speed input: 31232.92 toks/s, output: 30.50 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:23<01:14, 45.30it/s, est. speed input: 31888.16 toks/s, output: 31.14 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:24<01:08, 48.48it/s, est. speed input: 32513.22 toks/s, output: 31.75 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:24<01:04, 50.99it/s, est. speed input: 33111.45 toks/s, output: 32.34 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:25<01:01, 52.91it/s, est. speed input: 33683.03 toks/s, output: 32.89 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:25<00:59, 54.34it/s, est. speed input: 34230.71 toks/s, output: 33.43 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:26<00:57, 55.38it/s, est. speed input: 34754.99 toks/s, output: 33.94 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:27<00:56, 56.13it/s, est. speed input: 35257.64 toks/s, output: 34.43 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:27<00:54, 57.00it/s, est. speed input: 35754.44 toks/s, output: 34.92 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:28<00:54, 57.28it/s, est. speed input: 36218.10 toks/s, output: 35.37 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:28<00:53, 57.51it/s, est. speed input: 36664.79 toks/s, output: 35.81 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:29<00:52, 57.72it/s, est. speed input: 37096.57 toks/s, output: 36.23 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:29<00:52, 57.76it/s, est. speed input: 37508.35 toks/s, output: 36.63 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:30<00:51, 57.84it/s, est. speed input: 37907.20 toks/s, output: 37.02 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:30<00:50, 58.40it/s, est. speed input: 38311.31 toks/s, output: 37.41 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:31<00:49, 58.29it/s, est. speed input: 38682.23 toks/s, output: 37.78 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:31<00:49, 58.21it/s, est. speed input: 39039.90 toks/s, output: 38.12 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:32<00:48, 58.15it/s, est. speed input: 39385.67 toks/s, output: 38.46 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:33<00:48, 58.12it/s, est. speed input: 39720.09 toks/s, output: 38.79 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:33<00:47, 58.08it/s, est. speed input: 40042.97 toks/s, output: 39.10 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:34<00:47, 58.07it/s, est. speed input: 40355.91 toks/s, output: 39.41 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:34<00:46, 58.09it/s, est. speed input: 40660.14 toks/s, output: 39.71 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:35<00:46, 58.03it/s, est. speed input: 40952.02 toks/s, output: 39.99 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:35<00:45, 58.07it/s, est. speed input: 41238.05 toks/s, output: 40.27 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:36<00:45, 58.00it/s, est. speed input: 41511.61 toks/s, output: 40.54 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:36<00:44, 57.97it/s, est. speed input: 41777.91 toks/s, output: 40.80 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:37<00:44, 57.96it/s, est. speed input: 42036.63 toks/s, output: 41.05 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:38<00:43, 57.96it/s, est. speed input: 42288.02 toks/s, output: 41.30 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:38<00:43, 57.95it/s, est. speed input: 42531.89 toks/s, output: 41.54 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:39<00:42, 57.99it/s, est. speed input: 42770.63 toks/s, output: 41.77 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:39<00:41, 57.90it/s, est. speed input: 42998.62 toks/s, output: 41.99 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:40<00:41, 57.90it/s, est. speed input: 43222.27 toks/s, output: 42.21 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:40<00:40, 57.89it/s, est. speed input: 43439.81 toks/s, output: 42.42 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:41<00:40, 57.88it/s, est. speed input: 43651.26 toks/s, output: 42.63 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:41<00:39, 57.89it/s, est. speed input: 43857.56 toks/s, output: 42.83 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:42<00:39, 57.87it/s, est. speed input: 44057.94 toks/s, output: 43.03 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:42<00:38, 58.42it/s, est. speed input: 44271.25 toks/s, output: 43.23 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:43<00:37, 58.18it/s, est. speed input: 44459.18 toks/s, output: 43.42 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:44<00:37, 58.06it/s, est. speed input: 44644.00 toks/s, output: 43.60 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:44<00:36, 57.98it/s, est. speed input: 44824.35 toks/s, output: 43.77 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:45<00:36, 57.89it/s, est. speed input: 44999.21 toks/s, output: 43.94 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:45<00:35, 57.85it/s, est. speed input: 45170.58 toks/s, output: 44.11 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:46<00:35, 57.82it/s, est. speed input: 45337.82 toks/s, output: 44.28 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:46<00:34, 57.80it/s, est. speed input: 45501.01 toks/s, output: 44.43 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:47<00:34, 57.78it/s, est. speed input: 45660.09 toks/s, output: 44.59 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:47<00:33, 57.77it/s, est. speed input: 45815.88 toks/s, output: 44.74 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:48<00:33, 57.75it/s, est. speed input: 45967.56 toks/s, output: 44.89 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:49<00:32, 57.73it/s, est. speed input: 46115.68 toks/s, output: 45.03 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:49<00:32, 57.72it/s, est. speed input: 46260.39 toks/s, output: 45.18 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:50<00:31, 58.22it/s, est. speed input: 46416.96 toks/s, output: 45.33 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:50<00:30, 58.06it/s, est. speed input: 46555.46 toks/s, output: 45.46 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:51<00:30, 58.01it/s, est. speed input: 46692.71 toks/s, output: 45.60 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:51<00:29, 57.87it/s, est. speed input: 46823.95 toks/s, output: 45.73 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:52<00:29, 57.86it/s, est. speed input: 46955.01 toks/s, output: 45.85 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:52<00:28, 57.76it/s, est. speed input: 47080.43 toks/s, output: 45.98 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:53<00:28, 57.74it/s, est. speed input: 47204.87 toks/s, output: 46.10 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:54<00:27, 58.22it/s, est. speed input: 47340.44 toks/s, output: 46.23 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:55<00:43, 36.10it/s, est. speed input: 46507.69 toks/s, output: 45.42 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:56<00:37, 40.66it/s, est. speed input: 46631.18 toks/s, output: 45.54 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:56<00:33, 44.60it/s, est. speed input: 46752.08 toks/s, output: 45.66 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:57<00:30, 47.83it/s, est. speed input: 46870.28 toks/s, output: 45.77 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:57<00:28, 50.40it/s, est. speed input: 46986.51 toks/s, output: 45.89 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:58<00:26, 52.36it/s, est. speed input: 47100.27 toks/s, output: 46.00 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:59<00:25, 53.83it/s, est. speed input: 47212.24 toks/s, output: 46.11 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:59<00:24, 54.90it/s, est. speed input: 47321.74 toks/s, output: 46.21 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [01:00<00:23, 55.64it/s, est. speed input: 47428.38 toks/s, output: 46.32 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [01:00<00:22, 56.14it/s, est. speed input: 47531.95 toks/s, output: 46.42 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [01:01<00:22, 56.56it/s, est. speed input: 47635.71 toks/s, output: 46.52 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [01:01<00:21, 56.86it/s, est. speed input: 47737.36 toks/s, output: 46.62 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [01:02<00:20, 57.07it/s, est. speed input: 47837.39 toks/s, output: 46.72 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [01:02<00:20, 57.22it/s, est. speed input: 47935.58 toks/s, output: 46.81 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [01:03<00:19, 57.32it/s, est. speed input: 48031.86 toks/s, output: 46.91 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [01:04<00:18, 57.38it/s, est. speed input: 48126.27 toks/s, output: 47.00 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [01:04<00:18, 57.44it/s, est. speed input: 48219.43 toks/s, output: 47.09 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [01:05<00:17, 57.49it/s, est. speed input: 48311.34 toks/s, output: 47.18 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [01:05<00:17, 57.48it/s, est. speed input: 48400.40 toks/s, output: 47.27 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [01:06<00:16, 57.50it/s, est. speed input: 48488.77 toks/s, output: 47.35 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [01:06<00:16, 57.52it/s, est. speed input: 48575.80 toks/s, output: 47.44 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [01:07<00:15, 57.54it/s, est. speed input: 48661.42 toks/s, output: 47.52 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [01:07<00:14, 57.53it/s, est. speed input: 48745.35 toks/s, output: 47.60 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [01:08<00:14, 57.54it/s, est. speed input: 48828.13 toks/s, output: 47.68 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [01:09<00:13, 57.55it/s, est. speed input: 48909.69 toks/s, output: 47.76 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [01:09<00:13, 57.57it/s, est. speed input: 48990.10 toks/s, output: 47.84 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [01:10<00:12, 57.59it/s, est. speed input: 49069.39 toks/s, output: 47.92 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [01:10<00:12, 57.59it/s, est. speed input: 49147.36 toks/s, output: 48.00 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [01:11<00:11, 57.61it/s, est. speed input: 49224.24 toks/s, output: 48.07 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:11<00:11, 57.61it/s, est. speed input: 49299.88 toks/s, output: 48.14 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:12<00:10, 57.62it/s, est. speed input: 49374.44 toks/s, output: 48.22 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:12<00:09, 57.63it/s, est. speed input: 49447.94 toks/s, output: 48.29 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:13<00:09, 57.63it/s, est. speed input: 49520.14 toks/s, output: 48.36 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:14<00:08, 57.62it/s, est. speed input: 49591.23 toks/s, output: 48.43 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:14<00:08, 57.61it/s, est. speed input: 49661.02 toks/s, output: 48.50 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:15<00:07, 57.66it/s, est. speed input: 49731.10 toks/s, output: 48.57 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:15<00:07, 57.59it/s, est. speed input: 49797.88 toks/s, output: 48.63 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:16<00:06, 58.11it/s, est. speed input: 49875.49 toks/s, output: 48.71 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:16<00:06, 57.95it/s, est. speed input: 49941.32 toks/s, output: 48.77 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:17<00:05, 57.85it/s, est. speed input: 50006.41 toks/s, output: 48.83 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:17<00:04, 57.78it/s, est. speed input: 50070.53 toks/s, output: 48.90 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:18<00:04, 57.72it/s, est. speed input: 50133.42 toks/s, output: 48.96 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:19<00:03, 57.68it/s, est. speed input: 50195.60 toks/s, output: 49.02 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:19<00:03, 57.65it/s, est. speed input: 50256.85 toks/s, output: 49.08 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:20<00:02, 57.63it/s, est. speed input: 50317.19 toks/s, output: 49.14 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:20<00:02, 57.63it/s, est. speed input: 50376.95 toks/s, output: 49.20 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:21<00:01, 57.61it/s, est. speed input: 50435.64 toks/s, output: 49.25 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:21<00:01, 58.13it/s, est. speed input: 50503.89 toks/s, output: 49.32 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:22<00:00, 58.63it/s, est. speed input: 50573.96 toks/s, output: 49.39 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:22<00:00, 58.63it/s, est. speed input: 50946.75 toks/s, output: 49.75 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:22<00:00, 49.75it/s, est. speed input: 50946.75 toks/s, output: 49.75 toks/s]
[rank0]:[W128 08:17:55.092389353 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 696.9s

测试结果:
  Requests/s:   45.07
  Tokens/s:     46200.85
  Total Reqs:   4096
  Elapsed:      90.87s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     46155.78


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_8/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,15.3841,7892.0513,8.3203
1024,1024,1,128,128,15.9155,16313.3952,8.0425
2048,1024,2,256,128,31.7517,32545.4878,8.0626
4096,1024,4,512,128,56.4378,57848.7559,9.0719
8192,1024,8,1024,128,52.5706,53884.8821,19.4786
16384,1024,16,2048,128,42.5680,43632.2508,48.1112
32768,1024,32,4096,128,45.0740,46200.8499,90.8728

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-INT8 | cuSPARSELt (2_10) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-INT8-SlideSparse-2_10
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_10

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:20:58 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:20:59 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=852374) WARNING 01-28 08:22:12 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=852374) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=852374) WARNING 01-28 08:24:34 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.69 requests/s, 8046.43 total tokens/s, 15.69 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 08:20:47] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:20:58] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:20:58] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:20:58] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:20:58] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:20:58] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:20:58] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:20:58] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:20:58] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:20:58] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:20:58] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:20:58] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:20:58] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:20:58] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:21:17] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:21:20] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:21:20] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:21:20] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:21:20] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:21:20] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:21:20] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:21:20] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:21:20] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:21:20] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:21:20] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:21:20] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:21:20] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:21:20] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=852374) [2026-01-28 08:22:20] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=852374) [2026-01-28 08:22:20] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=852374) [2026-01-28 08:22:20] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=852374) [2026-01-28 08:22:20] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=852374) [2026-01-28 08:22:20] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=852374) [2026-01-28 08:22:20] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=852374) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=852374) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.38s/it]
(EngineCore_DP0 pid=852374) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:03<00:00,  3.38s/it]
(EngineCore_DP0 pid=852374) 
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:41] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:43] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:43] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:43] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:43] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=852374) [2026-01-28 08:23:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=852374) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  1.12it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:03<00:00,  1.91s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:03<00:00,  1.76s/it]
(EngineCore_DP0 pid=852374) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  2.28it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  2.28it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  50%|█████     | 64/128 [00:00<00:00, 631.86it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 646.47it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:43,  2.92it/s, est. speed input: 1492.92 toks/s, output: 2.92 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:17,  7.12it/s, est. speed input: 3186.85 toks/s, output: 6.22 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:12,  9.87it/s, est. speed input: 4191.95 toks/s, output: 8.19 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:10, 11.40it/s, est. speed input: 4783.84 toks/s, output: 9.34 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:00<00:09, 13.01it/s, est. speed input: 5314.60 toks/s, output: 10.38 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:08, 14.15it/s, est. speed input: 5715.52 toks/s, output: 11.16 toks/s]
Processed prompts:  10%|█         | 13/128 [00:01<00:07, 14.99it/s, est. speed input: 6034.42 toks/s, output: 11.79 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:01<00:07, 15.53it/s, est. speed input: 6284.70 toks/s, output: 12.27 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:06, 15.93it/s, est. speed input: 6493.42 toks/s, output: 12.68 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.27it/s, est. speed input: 6673.66 toks/s, output: 13.03 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.52it/s, est. speed input: 6828.69 toks/s, output: 13.34 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.67it/s, est. speed input: 6959.84 toks/s, output: 13.59 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.77it/s, est. speed input: 7073.49 toks/s, output: 13.82 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.82it/s, est. speed input: 7171.24 toks/s, output: 14.01 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:02<00:05, 16.84it/s, est. speed input: 7256.68 toks/s, output: 14.17 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:02<00:05, 16.87it/s, est. speed input: 7334.15 toks/s, output: 14.32 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:02<00:05, 16.93it/s, est. speed input: 7405.92 toks/s, output: 14.46 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.96it/s, est. speed input: 7470.17 toks/s, output: 14.59 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 16.96it/s, est. speed input: 7527.07 toks/s, output: 14.70 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 16.90it/s, est. speed input: 7574.60 toks/s, output: 14.79 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 16.88it/s, est. speed input: 7619.50 toks/s, output: 14.88 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 16.84it/s, est. speed input: 7659.31 toks/s, output: 14.96 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:04, 16.81it/s, est. speed input: 7695.93 toks/s, output: 15.03 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:03<00:04, 16.77it/s, est. speed input: 7728.23 toks/s, output: 15.09 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:03<00:04, 16.75it/s, est. speed input: 7758.56 toks/s, output: 15.15 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 16.72it/s, est. speed input: 7786.42 toks/s, output: 15.21 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 16.76it/s, est. speed input: 7815.02 toks/s, output: 15.26 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 16.77it/s, est. speed input: 7841.24 toks/s, output: 15.31 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 16.78it/s, est. speed input: 7865.31 toks/s, output: 15.36 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 16.76it/s, est. speed input: 7887.25 toks/s, output: 15.40 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:03, 16.75it/s, est. speed input: 7907.82 toks/s, output: 15.44 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:04<00:03, 16.77it/s, est. speed input: 7928.36 toks/s, output: 15.48 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:04<00:03, 16.78it/s, est. speed input: 7947.66 toks/s, output: 15.52 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 16.78it/s, est. speed input: 7965.33 toks/s, output: 15.56 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 16.81it/s, est. speed input: 7983.36 toks/s, output: 15.59 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 16.79it/s, est. speed input: 7999.02 toks/s, output: 15.62 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 16.79it/s, est. speed input: 8014.09 toks/s, output: 15.65 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 16.75it/s, est. speed input: 8026.99 toks/s, output: 15.68 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 16.74it/s, est. speed input: 8039.93 toks/s, output: 15.70 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:05<00:02, 16.73it/s, est. speed input: 8052.15 toks/s, output: 15.73 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:05<00:02, 16.75it/s, est. speed input: 8064.78 toks/s, output: 15.75 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:05<00:02, 16.75it/s, est. speed input: 8076.40 toks/s, output: 15.77 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 16.71it/s, est. speed input: 8086.20 toks/s, output: 15.79 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 16.74it/s, est. speed input: 8097.51 toks/s, output: 15.82 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 16.74it/s, est. speed input: 8107.51 toks/s, output: 15.83 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 16.76it/s, est. speed input: 8117.90 toks/s, output: 15.86 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 16.80it/s, est. speed input: 8128.58 toks/s, output: 15.88 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:01, 16.75it/s, est. speed input: 8136.25 toks/s, output: 15.89 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:06<00:01, 16.74it/s, est. speed input: 8144.64 toks/s, output: 15.91 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:06<00:01, 16.77it/s, est. speed input: 8153.87 toks/s, output: 15.93 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 16.81it/s, est. speed input: 8163.14 toks/s, output: 15.94 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 16.86it/s, est. speed input: 8172.77 toks/s, output: 15.96 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 16.74it/s, est. speed input: 8177.53 toks/s, output: 15.97 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 16.76it/s, est. speed input: 8185.16 toks/s, output: 15.99 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 16.81it/s, est. speed input: 8193.63 toks/s, output: 16.00 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 16.28it/s, est. speed input: 8185.39 toks/s, output: 15.99 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:07<00:00, 16.37it/s, est. speed input: 8190.49 toks/s, output: 16.00 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:07<00:00, 16.50it/s, est. speed input: 8197.57 toks/s, output: 16.01 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 16.57it/s, est. speed input: 8203.58 toks/s, output: 16.02 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 16.56it/s, est. speed input: 8207.75 toks/s, output: 16.03 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 16.58it/s, est. speed input: 8212.80 toks/s, output: 16.04 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 16.64it/s, est. speed input: 8218.59 toks/s, output: 16.05 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 16.66it/s, est. speed input: 8223.71 toks/s, output: 16.06 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 16.69it/s, est. speed input: 8229.23 toks/s, output: 16.07 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.69it/s, est. speed input: 8232.05 toks/s, output: 16.08 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.08it/s, est. speed input: 8232.05 toks/s, output: 16.08 toks/s]
[rank0]:[W128 08:25:44.223420941 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 369.6s

测试结果:
  Requests/s:   15.69
  Tokens/s:     8046.43
  Total Reqs:   128
  Elapsed:      8.16s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     8030.75

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:27:46 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:27:47 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=855631) WARNING 01-28 08:29:23 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=855631) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=855631) WARNING 01-28 08:31:20 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.70 requests/s, 16095.59 total tokens/s, 15.70 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 08:27:30] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:27:46] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:27:46] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:27:46] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:27:46] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:27:46] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:27:46] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:27:46] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:27:46] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:27:46] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:27:46] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:27:46] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:27:46] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:27:46] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:28:12] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:28:14] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:28:14] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:28:14] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:28:14] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:28:14] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:28:14] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:28:14] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:28:14] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:28:14] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:28:14] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:28:14] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:28:14] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:28:14] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 08:29:23.049198075 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=855631) [2026-01-28 08:29:28] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=855631) [2026-01-28 08:29:28] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=855631) [2026-01-28 08:29:28] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=855631) [2026-01-28 08:29:28] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=855631) [2026-01-28 08:29:28] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=855631) [2026-01-28 08:29:28] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=855631) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=855631) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.24it/s]
(EngineCore_DP0 pid=855631) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.24it/s]
(EngineCore_DP0 pid=855631) 
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:14] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:15] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:15] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:15] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:15] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:17] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:17] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=855631) [2026-01-28 08:30:17] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=855631) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:04<00:04,  4.23s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:04<00:00,  1.99s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:04<00:00,  2.32s/it]
(EngineCore_DP0 pid=855631) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:01<00:00,  1.23s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:01<00:00,  1.23s/it]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  29%|██▉       | 37/128 [00:00<00:00, 364.08it/s]
Adding requests:  59%|█████▊    | 75/128 [00:00<00:00, 370.67it/s]
Adding requests:  88%|████████▊ | 113/128 [00:00<00:00, 373.35it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 373.75it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:08, 14.32it/s, est. speed input: 14665.72 toks/s, output: 14.32 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:07, 15.80it/s, est. speed input: 15932.44 toks/s, output: 15.56 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:07, 16.35it/s, est. speed input: 16416.85 toks/s, output: 16.03 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:07, 16.64it/s, est. speed input: 16674.02 toks/s, output: 16.28 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:07, 16.77it/s, est. speed input: 16820.92 toks/s, output: 16.43 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:00<00:06, 16.78it/s, est. speed input: 16882.27 toks/s, output: 16.49 toks/s]
Processed prompts:  11%|█         | 14/128 [00:00<00:06, 16.75it/s, est. speed input: 16913.19 toks/s, output: 16.52 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:00<00:06, 16.74it/s, est. speed input: 16935.72 toks/s, output: 16.54 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:06, 16.72it/s, est. speed input: 16953.62 toks/s, output: 16.56 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:06, 16.68it/s, est. speed input: 16956.88 toks/s, output: 16.56 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 16.70it/s, est. speed input: 16972.54 toks/s, output: 16.57 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 16.76it/s, est. speed input: 17000.40 toks/s, output: 16.60 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 16.78it/s, est. speed input: 17018.35 toks/s, output: 16.62 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:01<00:05, 16.84it/s, est. speed input: 17044.35 toks/s, output: 16.64 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:01<00:05, 16.86it/s, est. speed input: 17060.55 toks/s, output: 16.66 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:01<00:05, 16.84it/s, est. speed input: 17068.96 toks/s, output: 16.67 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:02<00:05, 16.84it/s, est. speed input: 17080.47 toks/s, output: 16.68 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 16.74it/s, est. speed input: 17070.06 toks/s, output: 16.67 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 16.71it/s, est. speed input: 17068.50 toks/s, output: 16.67 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 16.63it/s, est. speed input: 17057.61 toks/s, output: 16.66 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 16.60it/s, est. speed input: 17050.56 toks/s, output: 16.65 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:02<00:05, 16.60it/s, est. speed input: 17049.08 toks/s, output: 16.65 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:02<00:04, 16.63it/s, est. speed input: 17050.34 toks/s, output: 16.65 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:02<00:04, 16.64it/s, est. speed input: 17051.71 toks/s, output: 16.65 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:03<00:04, 16.66it/s, est. speed input: 17054.26 toks/s, output: 16.65 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 16.60it/s, est. speed input: 17045.52 toks/s, output: 16.65 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 16.43it/s, est. speed input: 17021.81 toks/s, output: 16.62 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 16.39it/s, est. speed input: 17010.19 toks/s, output: 16.61 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 16.34it/s, est. speed input: 16996.28 toks/s, output: 16.60 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:03<00:04, 16.31it/s, est. speed input: 16983.21 toks/s, output: 16.59 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:03<00:04, 16.29it/s, est. speed input: 16972.55 toks/s, output: 16.57 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:03<00:03, 16.24it/s, est. speed input: 16957.31 toks/s, output: 16.56 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:03<00:03, 16.27it/s, est. speed input: 16950.32 toks/s, output: 16.55 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 16.29it/s, est. speed input: 16943.73 toks/s, output: 16.55 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 16.29it/s, est. speed input: 16935.90 toks/s, output: 16.54 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 16.30it/s, est. speed input: 16930.26 toks/s, output: 16.53 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:04<00:03, 16.24it/s, est. speed input: 16917.96 toks/s, output: 16.52 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:04<00:03, 16.26it/s, est. speed input: 16912.07 toks/s, output: 16.52 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:04<00:03, 16.25it/s, est. speed input: 16904.49 toks/s, output: 16.51 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:04<00:02, 16.24it/s, est. speed input: 16897.10 toks/s, output: 16.50 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:04<00:02, 16.24it/s, est. speed input: 16890.13 toks/s, output: 16.49 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 16.20it/s, est. speed input: 16880.63 toks/s, output: 16.48 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 16.10it/s, est. speed input: 16865.44 toks/s, output: 16.47 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 16.12it/s, est. speed input: 16857.98 toks/s, output: 16.46 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:05<00:02, 16.15it/s, est. speed input: 16852.78 toks/s, output: 16.46 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:05<00:02, 16.21it/s, est. speed input: 16850.44 toks/s, output: 16.46 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:05<00:02, 16.25it/s, est. speed input: 16847.49 toks/s, output: 16.45 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:05<00:01, 16.25it/s, est. speed input: 16843.60 toks/s, output: 16.45 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:05<00:01, 16.26it/s, est. speed input: 16840.07 toks/s, output: 16.45 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 16.25it/s, est. speed input: 16835.79 toks/s, output: 16.44 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 16.27it/s, est. speed input: 16833.23 toks/s, output: 16.44 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 16.25it/s, est. speed input: 16828.46 toks/s, output: 16.43 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:06<00:01, 16.24it/s, est. speed input: 16824.00 toks/s, output: 16.43 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:06<00:01, 16.22it/s, est. speed input: 16819.43 toks/s, output: 16.43 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:06<00:01, 16.21it/s, est. speed input: 16814.46 toks/s, output: 16.42 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:06<00:00, 16.22it/s, est. speed input: 16811.45 toks/s, output: 16.42 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:06<00:00, 16.24it/s, est. speed input: 16809.13 toks/s, output: 16.42 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 16.26it/s, est. speed input: 16807.24 toks/s, output: 16.41 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 16.24it/s, est. speed input: 16803.25 toks/s, output: 16.41 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 16.21it/s, est. speed input: 16798.90 toks/s, output: 16.41 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:07<00:00, 16.24it/s, est. speed input: 16796.87 toks/s, output: 16.40 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:07<00:00, 16.21it/s, est. speed input: 16792.86 toks/s, output: 16.40 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:07<00:00, 16.21it/s, est. speed input: 16789.38 toks/s, output: 16.40 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.25it/s, est. speed input: 16788.94 toks/s, output: 16.40 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.25it/s, est. speed input: 16788.94 toks/s, output: 16.40 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.39it/s, est. speed input: 16788.94 toks/s, output: 16.40 toks/s]
[rank0]:[W128 08:33:00.728465342 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 398.4s

测试结果:
  Requests/s:   15.70
  Tokens/s:     16095.59
  Total Reqs:   128
  Elapsed:      8.15s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     16079.88

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:33:48 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:33:49 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=858926) WARNING 01-28 08:35:24 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=858926) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=858926) WARNING 01-28 08:37:33 [backends.py:609] Failed to read file <frozen os>
Throughput: 30.97 requests/s, 31746.12 total tokens/s, 30.97 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 08:33:46] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:33:48] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:33:48] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:33:48] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:33:48] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:33:48] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:33:48] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:33:48] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:33:48] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:33:48] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:33:48] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:33:48] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:33:48] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:33:48] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:34:19] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:34:29] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:34:29] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:34:29] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:34:29] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:34:29] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:34:29] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:34:29] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:34:29] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:34:29] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:34:29] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:34:29] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:34:29] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:34:29] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 08:35:24.537648186 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=858926) [2026-01-28 08:35:46] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=858926) [2026-01-28 08:35:46] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=858926) [2026-01-28 08:35:46] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=858926) [2026-01-28 08:35:46] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=858926) [2026-01-28 08:35:46] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=858926) [2026-01-28 08:35:46] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=858926) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=858926) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.08s/it]
(EngineCore_DP0 pid=858926) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.08s/it]
(EngineCore_DP0 pid=858926) 
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=858926) [2026-01-28 08:36:25] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=858926) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:03<00:06,  3.07s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:07<00:03,  3.85s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:18<00:00,  7.29s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:18<00:00,  6.28s/it]
(EngineCore_DP0 pid=858926) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:02<00:02,  2.23s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:02<00:00,  1.37s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:02<00:00,  1.50s/it]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 36/256 [00:00<00:00, 359.29it/s]
Adding requests:  29%|██▉       | 75/256 [00:00<00:00, 374.53it/s]
Adding requests:  44%|████▍     | 113/256 [00:00<00:00, 364.35it/s]
Adding requests:  59%|█████▊    | 150/256 [00:00<00:00, 359.05it/s]
Adding requests:  73%|███████▎  | 186/256 [00:00<00:00, 352.86it/s]
Adding requests:  87%|████████▋ | 222/256 [00:00<00:00, 352.39it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 357.33it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▌         | 14/256 [00:00<00:02, 108.95it/s, est. speed input: 111595.89 toks/s, output: 108.96 toks/s]
Processed prompts:  10%|▉         | 25/256 [00:00<00:04, 51.08it/s, est. speed input: 57427.36 toks/s, output: 56.08 toks/s]   
Processed prompts:  12%|█▎        | 32/256 [00:00<00:05, 40.03it/s, est. speed input: 46863.25 toks/s, output: 45.76 toks/s]
Processed prompts:  14%|█▍        | 37/256 [00:00<00:05, 39.81it/s, est. speed input: 45818.02 toks/s, output: 44.74 toks/s]
Processed prompts:  16%|█▋        | 42/256 [00:01<00:06, 35.05it/s, est. speed input: 42268.51 toks/s, output: 41.28 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:01<00:06, 34.17it/s, est. speed input: 41158.50 toks/s, output: 40.19 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:01<00:06, 33.52it/s, est. speed input: 40293.35 toks/s, output: 39.35 toks/s]
Processed prompts:  21%|██        | 54/256 [00:01<00:06, 33.00it/s, est. speed input: 39577.20 toks/s, output: 38.65 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:01<00:06, 32.79it/s, est. speed input: 39041.41 toks/s, output: 38.13 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:01<00:05, 32.62it/s, est. speed input: 38581.71 toks/s, output: 37.68 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:01<00:05, 32.51it/s, est. speed input: 38191.05 toks/s, output: 37.30 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:01<00:05, 32.35it/s, est. speed input: 37829.63 toks/s, output: 36.94 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:02<00:05, 32.33it/s, est. speed input: 37538.17 toks/s, output: 36.66 toks/s]
Processed prompts:  30%|███       | 78/256 [00:03<00:20,  8.79it/s, est. speed input: 24456.69 toks/s, output: 23.88 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:03<00:15, 11.19it/s, est. speed input: 24757.67 toks/s, output: 24.18 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:03<00:12, 13.89it/s, est. speed input: 25048.53 toks/s, output: 24.46 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:03<00:09, 16.72it/s, est. speed input: 25315.95 toks/s, output: 24.72 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:03<00:08, 19.50it/s, est. speed input: 25565.09 toks/s, output: 24.97 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:03<00:07, 22.11it/s, est. speed input: 25800.36 toks/s, output: 25.20 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:04<00:06, 24.34it/s, est. speed input: 26015.02 toks/s, output: 25.41 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:04<00:05, 26.27it/s, est. speed input: 26224.69 toks/s, output: 25.61 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:04<00:05, 27.73it/s, est. speed input: 26413.32 toks/s, output: 25.79 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:04<00:04, 28.88it/s, est. speed input: 26593.28 toks/s, output: 25.97 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:04<00:04, 29.75it/s, est. speed input: 26764.40 toks/s, output: 26.14 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:04<00:04, 30.35it/s, est. speed input: 26922.84 toks/s, output: 26.29 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:04<00:04, 30.83it/s, est. speed input: 27076.46 toks/s, output: 26.44 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:04<00:04, 31.22it/s, est. speed input: 27225.34 toks/s, output: 26.59 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:05<00:03, 31.50it/s, est. speed input: 27367.13 toks/s, output: 26.73 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:05<00:03, 31.70it/s, est. speed input: 27502.10 toks/s, output: 26.86 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:05<00:03, 31.84it/s, est. speed input: 27630.84 toks/s, output: 26.98 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:05<00:03, 32.15it/s, est. speed input: 27768.16 toks/s, output: 27.12 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:05<00:03, 32.44it/s, est. speed input: 27902.84 toks/s, output: 27.25 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:05<00:03, 32.78it/s, est. speed input: 28040.41 toks/s, output: 27.38 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:05<00:02, 33.02it/s, est. speed input: 28172.34 toks/s, output: 27.51 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:05<00:02, 33.20it/s, est. speed input: 28299.23 toks/s, output: 27.64 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:05<00:02, 33.31it/s, est. speed input: 28420.36 toks/s, output: 27.75 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:06<00:02, 33.37it/s, est. speed input: 28535.66 toks/s, output: 27.87 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:06<00:02, 33.50it/s, est. speed input: 28651.63 toks/s, output: 27.98 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:06<00:02, 33.46it/s, est. speed input: 28756.02 toks/s, output: 28.08 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:06<00:02, 33.54it/s, est. speed input: 28861.95 toks/s, output: 28.19 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:06<00:02, 33.53it/s, est. speed input: 28961.34 toks/s, output: 28.28 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:06<00:01, 33.42it/s, est. speed input: 29051.02 toks/s, output: 28.37 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:06<00:01, 33.39it/s, est. speed input: 29140.14 toks/s, output: 28.46 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:06<00:01, 33.44it/s, est. speed input: 29229.73 toks/s, output: 28.54 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:07<00:01, 33.36it/s, est. speed input: 29310.86 toks/s, output: 28.62 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:07<00:01, 33.47it/s, est. speed input: 29397.32 toks/s, output: 28.71 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:07<00:01, 33.43it/s, est. speed input: 29475.14 toks/s, output: 28.78 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:07<00:01, 33.42it/s, est. speed input: 29551.68 toks/s, output: 28.86 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:07<00:01, 33.31it/s, est. speed input: 29620.54 toks/s, output: 28.93 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:07<00:01, 33.34it/s, est. speed input: 29692.20 toks/s, output: 29.00 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:07<00:00, 33.44it/s, est. speed input: 29765.39 toks/s, output: 29.07 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:07<00:00, 33.47it/s, est. speed input: 29834.51 toks/s, output: 29.14 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:08<00:00, 33.39it/s, est. speed input: 29897.45 toks/s, output: 29.20 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:08<00:00, 33.45it/s, est. speed input: 29963.06 toks/s, output: 29.26 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:08<00:00, 33.48it/s, est. speed input: 30026.81 toks/s, output: 29.32 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:08<00:00, 33.45it/s, est. speed input: 30086.15 toks/s, output: 29.38 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:08<00:00, 33.49it/s, est. speed input: 30146.48 toks/s, output: 29.44 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:08<00:00, 33.50it/s, est. speed input: 30204.54 toks/s, output: 29.50 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 33.50it/s, est. speed input: 30234.95 toks/s, output: 29.53 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 29.53it/s, est. speed input: 30234.95 toks/s, output: 29.53 toks/s]
[rank0]:[W128 08:39:17.403332974 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 444.6s

测试结果:
  Requests/s:   30.97
  Tokens/s:     31746.12
  Total Reqs:   256
  Elapsed:      8.27s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     31715.15

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:41:23 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:41:24 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=862520) WARNING 01-28 08:43:43 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=862520) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=862520) WARNING 01-28 08:45:12 [backends.py:609] Failed to read file <frozen os>
Throughput: 50.46 requests/s, 51725.11 total tokens/s, 50.46 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 08:41:07] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:41:23] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:41:23] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:41:23] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:41:23] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:41:23] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:41:23] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:41:23] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:41:23] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:41:23] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:41:23] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:41:23] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:41:23] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:41:23] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:42:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:42:20] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:42:20] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:42:20] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:42:20] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:42:20] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:42:20] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:42:20] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:42:20] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:42:20] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:42:20] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:42:20] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:42:20] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:42:20] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 08:43:43.661742150 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:52] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:52] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:52] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:52] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:52] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:52] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=862520) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=862520) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.16it/s]
(EngineCore_DP0 pid=862520) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.16it/s]
(EngineCore_DP0 pid=862520) 
(EngineCore_DP0 pid=862520) [2026-01-28 08:43:59] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:00] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:00] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:01] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:01] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:01] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=862520) [2026-01-28 08:44:02] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=862520) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:05<00:16,  5.60s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:06<00:05,  2.87s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:11<00:03,  3.81s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:20<00:00,  6.05s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:20<00:00,  5.24s/it]
(EngineCore_DP0 pid=862520) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:05<00:11,  5.96s/it]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:06<00:02,  2.56s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:06<00:00,  1.52s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:06<00:00,  2.14s/it]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 354.95it/s]
Adding requests:  15%|█▍        | 75/512 [00:00<00:01, 370.71it/s]
Adding requests:  22%|██▏       | 114/512 [00:00<00:01, 375.24it/s]
Adding requests:  30%|██▉       | 152/512 [00:00<00:00, 373.25it/s]
Adding requests:  37%|███▋      | 190/512 [00:00<00:00, 370.89it/s]
Adding requests:  45%|████▍     | 228/512 [00:00<00:00, 369.53it/s]
Adding requests:  52%|█████▏    | 266/512 [00:00<00:00, 371.91it/s]
Adding requests:  59%|█████▉    | 304/512 [00:00<00:00, 365.13it/s]
Adding requests:  67%|██████▋   | 341/512 [00:00<00:00, 366.14it/s]
Adding requests:  74%|███████▍  | 378/512 [00:01<00:00, 363.75it/s]
Adding requests:  81%|████████  | 415/512 [00:01<00:00, 357.99it/s]
Adding requests:  88%|████████▊ | 453/512 [00:01<00:00, 361.86it/s]
Adding requests:  96%|█████████▌| 491/512 [00:01<00:00, 365.98it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 366.99it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  12%|█▏        | 62/512 [00:00<00:01, 357.88it/s, est. speed input: 366528.85 toks/s, output: 357.90 toks/s]
Processed prompts:  19%|█▉        | 98/512 [00:00<00:04, 99.13it/s, est. speed input: 117653.66 toks/s, output: 114.89 toks/s] 
Processed prompts:  23%|██▎       | 116/512 [00:01<00:04, 85.25it/s, est. speed input: 102812.92 toks/s, output: 100.40 toks/s]
Processed prompts:  25%|██▌       | 129/512 [00:01<00:04, 77.65it/s, est. speed input: 95588.29 toks/s, output: 93.35 toks/s]  
Processed prompts:  27%|██▋       | 139/512 [00:01<00:05, 68.28it/s, est. speed input: 88507.53 toks/s, output: 86.43 toks/s]
Processed prompts:  29%|██▊       | 147/512 [00:01<00:05, 64.99it/s, est. speed input: 85533.28 toks/s, output: 83.53 toks/s]
Processed prompts:  30%|███       | 154/512 [00:01<00:05, 60.68it/s, est. speed input: 82523.08 toks/s, output: 80.59 toks/s]
Processed prompts:  32%|███▏      | 162/512 [00:02<00:05, 58.78it/s, est. speed input: 80458.77 toks/s, output: 78.57 toks/s]
Processed prompts:  33%|███▎      | 170/512 [00:02<00:05, 57.20it/s, est. speed input: 78647.36 toks/s, output: 76.80 toks/s]
Processed prompts:  35%|███▍      | 178/512 [00:02<00:05, 55.99it/s, est. speed input: 77070.56 toks/s, output: 75.26 toks/s]
Processed prompts:  36%|███▋      | 186/512 [00:02<00:05, 55.15it/s, est. speed input: 75701.54 toks/s, output: 73.93 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:02<00:05, 54.48it/s, est. speed input: 74473.43 toks/s, output: 72.73 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:02<00:05, 53.98it/s, est. speed input: 73374.15 toks/s, output: 71.65 toks/s]
Processed prompts:  41%|████      | 210/512 [00:02<00:05, 53.30it/s, est. speed input: 72309.53 toks/s, output: 70.61 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:03<00:05, 52.60it/s, est. speed input: 71301.79 toks/s, output: 69.63 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:03<00:05, 52.15it/s, est. speed input: 70397.54 toks/s, output: 68.75 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:03<00:05, 51.86it/s, est. speed input: 69580.99 toks/s, output: 67.95 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:03<00:05, 51.67it/s, est. speed input: 68838.13 toks/s, output: 67.22 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:03<00:05, 51.56it/s, est. speed input: 68161.66 toks/s, output: 66.56 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:03<00:04, 51.56it/s, est. speed input: 67552.43 toks/s, output: 65.97 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:04<00:04, 51.71it/s, est. speed input: 67014.31 toks/s, output: 65.44 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:04<00:04, 51.80it/s, est. speed input: 66513.06 toks/s, output: 64.95 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:04<00:04, 51.89it/s, est. speed input: 66050.99 toks/s, output: 64.50 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:04<00:04, 51.98it/s, est. speed input: 65623.93 toks/s, output: 64.09 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:04<00:04, 51.99it/s, est. speed input: 65217.09 toks/s, output: 63.69 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:04<00:03, 52.02it/s, est. speed input: 64840.30 toks/s, output: 63.32 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:04<00:03, 51.97it/s, est. speed input: 64476.68 toks/s, output: 62.97 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:05<00:03, 51.94it/s, est. speed input: 64136.24 toks/s, output: 62.63 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:05<00:03, 51.98it/s, est. speed input: 63822.42 toks/s, output: 62.33 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:05<00:03, 51.90it/s, est. speed input: 63514.31 toks/s, output: 62.03 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:05<00:03, 51.94it/s, est. speed input: 63233.31 toks/s, output: 61.75 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:05<00:03, 51.91it/s, est. speed input: 62961.51 toks/s, output: 61.49 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:05<00:02, 51.85it/s, est. speed input: 62699.13 toks/s, output: 61.23 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:06<00:02, 51.93it/s, est. speed input: 62463.26 toks/s, output: 61.00 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:06<00:02, 51.91it/s, est. speed input: 62231.49 toks/s, output: 60.77 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:06<00:02, 51.96it/s, est. speed input: 62016.30 toks/s, output: 60.56 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:06<00:02, 51.93it/s, est. speed input: 61806.88 toks/s, output: 60.36 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:06<00:02, 51.96it/s, est. speed input: 61609.96 toks/s, output: 60.17 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:06<00:01, 51.96it/s, est. speed input: 61420.39 toks/s, output: 59.98 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:06<00:01, 51.94it/s, est. speed input: 61237.88 toks/s, output: 59.80 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:07<00:01, 51.92it/s, est. speed input: 61062.55 toks/s, output: 59.63 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:07<00:01, 51.94it/s, est. speed input: 60897.41 toks/s, output: 59.47 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:07<00:01, 51.96it/s, est. speed input: 60739.25 toks/s, output: 59.32 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:07<00:01, 51.92it/s, est. speed input: 60583.69 toks/s, output: 59.16 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:07<00:01, 51.95it/s, est. speed input: 60439.13 toks/s, output: 59.02 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:07<00:00, 51.96it/s, est. speed input: 60299.04 toks/s, output: 58.89 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:08<00:00, 51.90it/s, est. speed input: 60159.41 toks/s, output: 58.75 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:08<00:00, 51.91it/s, est. speed input: 60028.42 toks/s, output: 58.62 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:08<00:00, 51.91it/s, est. speed input: 59901.65 toks/s, output: 58.50 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:08<00:00, 51.94it/s, est. speed input: 59782.21 toks/s, output: 58.38 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:08<00:00, 51.92it/s, est. speed input: 59663.64 toks/s, output: 58.27 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 51.92it/s, est. speed input: 59924.69 toks/s, output: 58.52 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:08<00:00, 58.52it/s, est. speed input: 59924.69 toks/s, output: 58.52 toks/s]
[rank0]:[W128 08:47:09.336183663 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 407.0s

测试结果:
  Requests/s:   50.46
  Tokens/s:     51725.11
  Total Reqs:   512
  Elapsed:      10.15s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     51674.65

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:48:05 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:48:07 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=865663) WARNING 01-28 08:50:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=865663) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=865663) WARNING 01-28 08:51:37 [backends.py:609] Failed to read file <frozen os>
Throughput: 50.63 requests/s, 51895.20 total tokens/s, 50.63 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 08:47:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:48:05] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:48:05] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:48:05] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:05] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:05] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:05] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:05] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:05] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:48:05] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:48:05] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:48:05] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:48:05] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:48:05] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:48:50] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:48:55] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:48:55] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:48:55] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:55] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:55] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:55] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:55] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:48:55] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:48:55] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:48:55] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:48:55] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:48:55] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:48:55] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:21] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:21] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:21] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:21] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:21] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:21] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=865663) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=865663) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.75s/it]
(EngineCore_DP0 pid=865663) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.75s/it]
(EngineCore_DP0 pid=865663) 
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=865663) [2026-01-28 08:50:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=865663) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:02<00:09,  2.35s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:06<00:09,  3.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:08<00:05,  2.68s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:12<00:03,  3.32s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:16<00:00,  3.44s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:16<00:00,  3.24s/it]
(EngineCore_DP0 pid=865663) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:01,  2.77it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:01<00:01,  1.10it/s]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:01<00:00,  1.59it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:02<00:00,  1.90it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:02<00:00,  1.73it/s]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   3%|▎         | 35/1024 [00:00<00:02, 343.78it/s]
Adding requests:   7%|▋         | 72/1024 [00:00<00:02, 358.02it/s]
Adding requests:  11%|█         | 110/1024 [00:00<00:02, 363.41it/s]
Adding requests:  14%|█▍        | 147/1024 [00:00<00:02, 361.83it/s]
Adding requests:  18%|█▊        | 184/1024 [00:00<00:02, 361.39it/s]
Adding requests:  22%|██▏       | 221/1024 [00:00<00:02, 362.83it/s]
Adding requests:  25%|██▌       | 258/1024 [00:00<00:02, 361.66it/s]
Adding requests:  29%|██▉       | 295/1024 [00:00<00:02, 350.88it/s]
Adding requests:  32%|███▏      | 331/1024 [00:00<00:01, 350.82it/s]
Adding requests:  36%|███▌      | 368/1024 [00:01<00:01, 356.29it/s]
Adding requests:  39%|███▉      | 404/1024 [00:01<00:01, 356.76it/s]
Adding requests:  43%|████▎     | 440/1024 [00:01<00:01, 355.40it/s]
Adding requests:  47%|████▋     | 477/1024 [00:01<00:01, 359.21it/s]
Adding requests:  50%|█████     | 513/1024 [00:01<00:01, 356.58it/s]
Adding requests:  54%|█████▎    | 549/1024 [00:01<00:01, 348.53it/s]
Adding requests:  57%|█████▋    | 586/1024 [00:01<00:01, 354.15it/s]
Adding requests:  61%|██████    | 623/1024 [00:01<00:01, 357.44it/s]
Adding requests:  64%|██████▍   | 659/1024 [00:01<00:01, 353.32it/s]
Adding requests:  68%|██████▊   | 698/1024 [00:01<00:00, 362.74it/s]
Adding requests:  72%|███████▏  | 736/1024 [00:02<00:00, 366.59it/s]
Adding requests:  75%|███████▌  | 773/1024 [00:02<00:00, 364.30it/s]
Adding requests:  79%|███████▉  | 810/1024 [00:02<00:00, 362.90it/s]
Adding requests:  83%|████████▎ | 847/1024 [00:02<00:00, 359.16it/s]
Adding requests:  87%|████████▋ | 886/1024 [00:02<00:00, 365.83it/s]
Adding requests:  90%|█████████ | 925/1024 [00:02<00:00, 369.86it/s]
Adding requests:  94%|█████████▍| 963/1024 [00:02<00:00, 372.74it/s]
Adding requests:  98%|█████████▊| 1001/1024 [00:02<00:00, 373.08it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 361.35it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   9%|▉         | 90/1024 [00:00<00:02, 433.71it/s, est. speed input: 444180.34 toks/s, output: 433.73 toks/s]
Processed prompts:  13%|█▎        | 134/1024 [00:00<00:07, 116.45it/s, est. speed input: 139860.35 toks/s, output: 136.58 toks/s]
Processed prompts:  15%|█▌        | 156/1024 [00:01<00:09, 87.57it/s, est. speed input: 110587.49 toks/s, output: 108.00 toks/s] 
Processed prompts:  17%|█▋        | 170/1024 [00:01<00:11, 75.50it/s, est. speed input: 99262.79 toks/s, output: 96.94 toks/s]  
Processed prompts:  18%|█▊        | 181/1024 [00:01<00:11, 74.79it/s, est. speed input: 97136.93 toks/s, output: 94.86 toks/s]
Processed prompts:  19%|█▊        | 191/1024 [00:02<00:11, 72.83it/s, est. speed input: 94826.04 toks/s, output: 92.60 toks/s]
Processed prompts:  20%|█▉        | 200/1024 [00:02<00:11, 69.60it/s, est. speed input: 92351.87 toks/s, output: 90.19 toks/s]
Processed prompts:  20%|██        | 208/1024 [00:02<00:12, 65.32it/s, est. speed input: 89766.35 toks/s, output: 87.66 toks/s]
Processed prompts:  21%|██        | 215/1024 [00:02<00:13, 60.24it/s, est. speed input: 87110.04 toks/s, output: 85.07 toks/s]
Processed prompts:  22%|██▏       | 222/1024 [00:02<00:14, 56.26it/s, est. speed input: 84757.84 toks/s, output: 82.77 toks/s]
Processed prompts:  22%|██▏       | 228/1024 [00:02<00:15, 51.47it/s, est. speed input: 82304.39 toks/s, output: 80.38 toks/s]
Processed prompts:  23%|██▎       | 234/1024 [00:02<00:16, 47.90it/s, est. speed input: 80105.59 toks/s, output: 78.23 toks/s]
Processed prompts:  24%|██▎       | 242/1024 [00:03<00:15, 49.02it/s, est. speed input: 78777.36 toks/s, output: 76.93 toks/s]
Processed prompts:  24%|██▍       | 250/1024 [00:03<00:15, 49.79it/s, est. speed input: 77562.93 toks/s, output: 75.74 toks/s]
Processed prompts:  25%|██▌       | 258/1024 [00:03<00:15, 50.36it/s, est. speed input: 76462.13 toks/s, output: 74.67 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:03<00:14, 52.26it/s, est. speed input: 75770.23 toks/s, output: 73.99 toks/s]
Processed prompts:  27%|██▋       | 274/1024 [00:03<00:13, 53.68it/s, est. speed input: 75131.28 toks/s, output: 73.37 toks/s]
Processed prompts:  28%|██▊       | 282/1024 [00:03<00:13, 54.72it/s, est. speed input: 74537.77 toks/s, output: 72.79 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:04<00:13, 55.49it/s, est. speed input: 73989.79 toks/s, output: 72.26 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:04<00:12, 56.02it/s, est. speed input: 73473.95 toks/s, output: 71.75 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:04<00:12, 56.39it/s, est. speed input: 72991.42 toks/s, output: 71.28 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:04<00:12, 56.65it/s, est. speed input: 72539.24 toks/s, output: 70.84 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:04<00:12, 56.87it/s, est. speed input: 72119.05 toks/s, output: 70.43 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:04<00:12, 56.97it/s, est. speed input: 71717.72 toks/s, output: 70.04 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:04<00:12, 57.09it/s, est. speed input: 71344.32 toks/s, output: 69.67 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:04<00:11, 57.13it/s, est. speed input: 70987.45 toks/s, output: 69.32 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:05<00:11, 57.16it/s, est. speed input: 70649.96 toks/s, output: 68.99 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:05<00:11, 57.20it/s, est. speed input: 70332.69 toks/s, output: 68.68 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:05<00:11, 57.24it/s, est. speed input: 70033.20 toks/s, output: 68.39 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:05<00:11, 57.27it/s, est. speed input: 69748.90 toks/s, output: 68.11 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:05<00:11, 57.28it/s, est. speed input: 69477.00 toks/s, output: 67.85 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:05<00:10, 57.27it/s, est. speed input: 69216.99 toks/s, output: 67.59 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:05<00:10, 57.27it/s, est. speed input: 68968.96 toks/s, output: 67.35 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:06<00:10, 57.22it/s, est. speed input: 68728.57 toks/s, output: 67.12 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:06<00:10, 57.22it/s, est. speed input: 68501.83 toks/s, output: 66.90 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:06<00:10, 57.23it/s, est. speed input: 68286.06 toks/s, output: 66.69 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:06<00:10, 57.21it/s, est. speed input: 68077.37 toks/s, output: 66.48 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:06<00:10, 57.21it/s, est. speed input: 67877.50 toks/s, output: 66.29 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:06<00:10, 57.21it/s, est. speed input: 67686.93 toks/s, output: 66.10 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:06<00:09, 57.21it/s, est. speed input: 67503.75 toks/s, output: 65.92 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:07<00:09, 57.21it/s, est. speed input: 67327.66 toks/s, output: 65.75 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:07<00:09, 57.21it/s, est. speed input: 67158.46 toks/s, output: 65.58 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:07<00:09, 57.23it/s, est. speed input: 66997.12 toks/s, output: 65.43 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:07<00:09, 57.21it/s, est. speed input: 66839.59 toks/s, output: 65.27 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:07<00:09, 57.22it/s, est. speed input: 66689.10 toks/s, output: 65.13 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:07<00:09, 57.22it/s, est. speed input: 66543.46 toks/s, output: 64.98 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:07<00:08, 57.23it/s, est. speed input: 66403.95 toks/s, output: 64.85 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:08<00:08, 57.23it/s, est. speed input: 66268.64 toks/s, output: 64.72 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:08<00:08, 57.20it/s, est. speed input: 66136.13 toks/s, output: 64.59 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:08<00:08, 57.19it/s, est. speed input: 66009.09 toks/s, output: 64.46 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:08<00:08, 57.17it/s, est. speed input: 65884.98 toks/s, output: 64.34 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:08<00:08, 56.19it/s, est. speed input: 65704.03 toks/s, output: 64.16 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:08<00:08, 55.15it/s, est. speed input: 65504.53 toks/s, output: 63.97 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:08<00:08, 54.42it/s, est. speed input: 65310.48 toks/s, output: 63.78 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:09<00:08, 53.91it/s, est. speed input: 65122.21 toks/s, output: 63.60 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:09<00:08, 53.56it/s, est. speed input: 64940.24 toks/s, output: 63.42 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:09<00:08, 53.34it/s, est. speed input: 64765.62 toks/s, output: 63.25 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:09<00:07, 53.15it/s, est. speed input: 64593.59 toks/s, output: 63.08 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:09<00:07, 53.04it/s, est. speed input: 64428.74 toks/s, output: 62.92 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:09<00:07, 52.97it/s, est. speed input: 64269.85 toks/s, output: 62.76 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:09<00:07, 52.94it/s, est. speed input: 64116.78 toks/s, output: 62.61 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:10<00:07, 52.88it/s, est. speed input: 63965.56 toks/s, output: 62.47 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:10<00:07, 52.85it/s, est. speed input: 63819.24 toks/s, output: 62.32 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:10<00:07, 52.80it/s, est. speed input: 63676.05 toks/s, output: 62.18 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:10<00:06, 52.81it/s, est. speed input: 63539.13 toks/s, output: 62.05 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:10<00:06, 52.79it/s, est. speed input: 63404.85 toks/s, output: 61.92 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:10<00:06, 52.79it/s, est. speed input: 63274.92 toks/s, output: 61.79 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:11<00:06, 52.80it/s, est. speed input: 63149.32 toks/s, output: 61.67 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:11<00:06, 52.78it/s, est. speed input: 63025.39 toks/s, output: 61.55 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:11<00:06, 52.77it/s, est. speed input: 62905.16 toks/s, output: 61.43 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:11<00:06, 52.77it/s, est. speed input: 62788.08 toks/s, output: 61.32 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:11<00:05, 52.82it/s, est. speed input: 62676.88 toks/s, output: 61.21 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:11<00:05, 52.83it/s, est. speed input: 62567.60 toks/s, output: 61.10 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:11<00:05, 52.83it/s, est. speed input: 62460.09 toks/s, output: 61.00 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:12<00:05, 52.84it/s, est. speed input: 62356.17 toks/s, output: 60.89 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:12<00:05, 52.85it/s, est. speed input: 62254.77 toks/s, output: 60.80 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:12<00:05, 52.84it/s, est. speed input: 62155.47 toks/s, output: 60.70 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:12<00:04, 52.81it/s, est. speed input: 62057.16 toks/s, output: 60.60 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:12<00:04, 52.80it/s, est. speed input: 61961.46 toks/s, output: 60.51 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:12<00:04, 52.80it/s, est. speed input: 61868.52 toks/s, output: 60.42 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:13<00:04, 52.81it/s, est. speed input: 61778.36 toks/s, output: 60.33 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:13<00:04, 52.81it/s, est. speed input: 61690.02 toks/s, output: 60.24 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:13<00:04, 52.80it/s, est. speed input: 61602.87 toks/s, output: 60.16 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:13<00:04, 52.83it/s, est. speed input: 61519.34 toks/s, output: 60.08 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:13<00:03, 52.83it/s, est. speed input: 61437.27 toks/s, output: 60.00 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:13<00:03, 52.84it/s, est. speed input: 61357.07 toks/s, output: 59.92 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:13<00:03, 52.85it/s, est. speed input: 61278.69 toks/s, output: 59.84 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:14<00:03, 52.84it/s, est. speed input: 61201.49 toks/s, output: 59.77 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:14<00:03, 52.84it/s, est. speed input: 61126.03 toks/s, output: 59.69 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:14<00:03, 52.84it/s, est. speed input: 61052.30 toks/s, output: 59.62 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:14<00:02, 52.83it/s, est. speed input: 60979.70 toks/s, output: 59.55 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:14<00:02, 52.81it/s, est. speed input: 60907.73 toks/s, output: 59.48 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:14<00:02, 52.82it/s, est. speed input: 60838.66 toks/s, output: 59.41 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:14<00:02, 52.82it/s, est. speed input: 60770.47 toks/s, output: 59.35 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:15<00:02, 52.80it/s, est. speed input: 60702.80 toks/s, output: 59.28 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:15<00:02, 52.80it/s, est. speed input: 60637.11 toks/s, output: 59.22 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:15<00:02, 52.81it/s, est. speed input: 60573.18 toks/s, output: 59.15 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:15<00:01, 52.80it/s, est. speed input: 60509.79 toks/s, output: 59.09 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:15<00:01, 52.80it/s, est. speed input: 60447.73 toks/s, output: 59.03 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:15<00:01, 52.80it/s, est. speed input: 60387.07 toks/s, output: 58.97 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:16<00:01, 52.78it/s, est. speed input: 60326.48 toks/s, output: 58.91 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:16<00:01, 52.78it/s, est. speed input: 60267.75 toks/s, output: 58.86 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:16<00:01, 52.78it/s, est. speed input: 60210.27 toks/s, output: 58.80 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:16<00:01, 52.77it/s, est. speed input: 60153.31 toks/s, output: 58.74 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:16<00:00, 52.76it/s, est. speed input: 60097.35 toks/s, output: 58.69 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:16<00:00, 54.42it/s, est. speed input: 60097.50 toks/s, output: 58.69 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:16<00:00, 53.89it/s, est. speed input: 60042.43 toks/s, output: 58.64 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:17<00:00, 53.53it/s, est. speed input: 59988.71 toks/s, output: 58.58 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:17<00:00, 53.32it/s, est. speed input: 59937.18 toks/s, output: 58.53 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:17<00:00, 55.09it/s, est. speed input: 59946.40 toks/s, output: 58.54 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 55.09it/s, est. speed input: 60298.88 toks/s, output: 58.89 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:17<00:00, 58.89it/s, est. speed input: 60298.88 toks/s, output: 58.89 toks/s]
[rank0]:[W128 08:53:53.809744570 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 479.0s

测试结果:
  Requests/s:   50.63
  Tokens/s:     51895.20
  Total Reqs:   1024
  Elapsed:      20.23s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     51844.57

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 08:56:24 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 08:56:25 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=870062) WARNING 01-28 08:58:25 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=870062) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=870062) WARNING 01-28 08:59:43 [backends.py:609] Failed to read file <frozen os>
Throughput: 39.60 requests/s, 40594.81 total tokens/s, 39.60 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 08:56:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:56:24] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:56:24] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:56:24] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:56:24] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:56:24] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:56:24] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:56:24] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:56:24] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:56:24] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:56:24] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:56:24] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:56:24] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:56:24] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 08:56:54] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 08:57:06] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 08:57:06] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 08:57:06] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:57:06] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:57:06] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:57:06] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:57:06] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 08:57:06] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 08:57:06] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 08:57:06] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 08:57:06] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 08:57:06] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 08:57:06] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:28] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:28] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:28] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:28] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:28] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:28] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=870062) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=870062) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.21it/s]
(EngineCore_DP0 pid=870062) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.21it/s]
(EngineCore_DP0 pid=870062) 
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:44] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:45] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:45] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:46] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:47] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:48] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:48] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=870062) [2026-01-28 08:58:48] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=870062) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:04<00:29,  4.94s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:08<00:20,  4.09s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:12<00:16,  4.20s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:16<00:12,  4.13s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:21<00:08,  4.29s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:28<00:05,  5.11s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:32<00:00,  4.91s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:32<00:00,  4.65s/it]
(EngineCore_DP0 pid=870062) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:01<00:04,  1.24s/it]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:01<00:02,  1.07it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:02<00:01,  1.45it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:03<00:00,  1.27it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:04<00:00,  1.13it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:04<00:00,  1.15it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 36/2048 [00:00<00:05, 357.05it/s]
Adding requests:   4%|▎         | 75/2048 [00:00<00:05, 372.73it/s]
Adding requests:   6%|▌         | 113/2048 [00:00<00:05, 375.21it/s]
Adding requests:   7%|▋         | 151/2048 [00:00<00:05, 372.39it/s]
Adding requests:   9%|▉         | 189/2048 [00:00<00:04, 373.05it/s]
Adding requests:  11%|█         | 228/2048 [00:00<00:04, 378.52it/s]
Adding requests:  13%|█▎        | 267/2048 [00:00<00:04, 381.85it/s]
Adding requests:  15%|█▍        | 306/2048 [00:00<00:04, 379.51it/s]
Adding requests:  17%|█▋        | 345/2048 [00:00<00:04, 381.71it/s]
Adding requests:  19%|█▉        | 384/2048 [00:01<00:04, 383.22it/s]
Adding requests:  21%|██        | 423/2048 [00:01<00:04, 383.45it/s]
Adding requests:  23%|██▎       | 462/2048 [00:01<00:04, 382.30it/s]
Adding requests:  24%|██▍       | 501/2048 [00:01<00:04, 383.32it/s]
Adding requests:  26%|██▋       | 540/2048 [00:01<00:03, 379.94it/s]
Adding requests:  28%|██▊       | 580/2048 [00:01<00:03, 385.19it/s]
Adding requests:  30%|███       | 620/2048 [00:01<00:03, 389.20it/s]
Adding requests:  32%|███▏      | 660/2048 [00:01<00:03, 391.80it/s]
Adding requests:  34%|███▍      | 702/2048 [00:01<00:03, 397.46it/s]
Adding requests:  36%|███▌      | 742/2048 [00:01<00:03, 395.66it/s]
Adding requests:  38%|███▊      | 782/2048 [00:02<00:03, 393.23it/s]
Adding requests:  40%|████      | 822/2048 [00:02<00:03, 385.74it/s]
Adding requests:  42%|████▏     | 861/2048 [00:02<00:03, 380.20it/s]
Adding requests:  44%|████▍     | 901/2048 [00:02<00:02, 383.98it/s]
Adding requests:  46%|████▌     | 941/2048 [00:02<00:02, 387.46it/s]
Adding requests:  48%|████▊     | 981/2048 [00:02<00:02, 390.72it/s]
Adding requests:  50%|████▉     | 1022/2048 [00:02<00:02, 394.41it/s]
Adding requests:  52%|█████▏    | 1063/2048 [00:02<00:02, 395.44it/s]
Adding requests:  54%|█████▍    | 1103/2048 [00:02<00:02, 394.10it/s]
Adding requests:  56%|█████▌    | 1143/2048 [00:02<00:02, 388.75it/s]
Adding requests:  58%|█████▊    | 1184/2048 [00:03<00:02, 394.69it/s]
Adding requests:  60%|█████▉    | 1225/2048 [00:03<00:02, 396.89it/s]
Adding requests:  62%|██████▏   | 1265/2048 [00:03<00:01, 393.14it/s]
Adding requests:  64%|██████▎   | 1305/2048 [00:03<00:01, 393.20it/s]
Adding requests:  66%|██████▌   | 1346/2048 [00:03<00:01, 397.07it/s]
Adding requests:  68%|██████▊   | 1386/2048 [00:03<00:01, 397.57it/s]
Adding requests:  70%|██████▉   | 1427/2048 [00:03<00:01, 399.86it/s]
Adding requests:  72%|███████▏  | 1467/2048 [00:03<00:01, 399.62it/s]
Adding requests:  74%|███████▎  | 1509/2048 [00:03<00:01, 403.27it/s]
Adding requests:  76%|███████▌  | 1550/2048 [00:03<00:01, 398.26it/s]
Adding requests:  78%|███████▊  | 1592/2048 [00:04<00:01, 403.13it/s]
Adding requests:  80%|███████▉  | 1633/2048 [00:04<00:01, 404.93it/s]
Adding requests:  82%|████████▏ | 1674/2048 [00:04<00:00, 400.77it/s]
Adding requests:  84%|████████▎ | 1715/2048 [00:04<00:00, 398.52it/s]
Adding requests:  86%|████████▌ | 1755/2048 [00:04<00:00, 396.60it/s]
Adding requests:  88%|████████▊ | 1795/2048 [00:04<00:00, 393.23it/s]
Adding requests:  90%|████████▉ | 1835/2048 [00:04<00:00, 394.42it/s]
Adding requests:  92%|█████████▏| 1875/2048 [00:04<00:00, 393.86it/s]
Adding requests:  94%|█████████▎| 1915/2048 [00:04<00:00, 394.18it/s]
Adding requests:  95%|█████████▌| 1955/2048 [00:05<00:00, 392.02it/s]
Adding requests:  97%|█████████▋| 1995/2048 [00:06<00:00, 102.43it/s]
Adding requests:  99%|█████████▉| 2035/2048 [00:06<00:00, 131.80it/s]
Adding requests: 100%|██████████| 2048/2048 [00:06<00:00, 329.45it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/2048 [00:09<2:41:22,  4.73s/it, est. speed input: 216.38 toks/s, output: 0.21 toks/s]
Processed prompts:   1%|          | 18/2048 [00:09<13:26,  2.52it/s, est. speed input: 1889.21 toks/s, output: 1.84 toks/s]
Processed prompts:   2%|▏         | 34/2048 [00:10<06:06,  5.49it/s, est. speed input: 3465.35 toks/s, output: 3.38 toks/s]
Processed prompts:   2%|▏         | 50/2048 [00:10<03:37,  9.20it/s, est. speed input: 4952.95 toks/s, output: 4.84 toks/s]
Processed prompts:   3%|▎         | 66/2048 [00:10<02:25, 13.63it/s, est. speed input: 6359.24 toks/s, output: 6.21 toks/s]
Processed prompts:   4%|▍         | 82/2048 [00:10<01:45, 18.66it/s, est. speed input: 7690.69 toks/s, output: 7.51 toks/s]
Processed prompts:   5%|▍         | 98/2048 [00:11<01:21, 24.03it/s, est. speed input: 8953.16 toks/s, output: 8.74 toks/s]
Processed prompts:   6%|▌         | 114/2048 [00:11<01:05, 29.44it/s, est. speed input: 10151.72 toks/s, output: 9.91 toks/s]
Processed prompts:   6%|▋         | 130/2048 [00:11<00:55, 34.54it/s, est. speed input: 11291.19 toks/s, output: 11.03 toks/s]
Processed prompts:   7%|▋         | 146/2048 [00:12<00:48, 39.11it/s, est. speed input: 12376.60 toks/s, output: 12.09 toks/s]
Processed prompts:   8%|▊         | 162/2048 [00:12<00:43, 42.92it/s, est. speed input: 13409.47 toks/s, output: 13.10 toks/s]
Processed prompts:   9%|▊         | 178/2048 [00:12<00:40, 46.01it/s, est. speed input: 14395.35 toks/s, output: 14.06 toks/s]
Processed prompts:   9%|▉         | 194/2048 [00:12<00:38, 48.42it/s, est. speed input: 15336.92 toks/s, output: 14.98 toks/s]
Processed prompts:  10%|█         | 210/2048 [00:13<00:36, 50.26it/s, est. speed input: 16237.83 toks/s, output: 15.86 toks/s]
Processed prompts:  11%|█         | 226/2048 [00:13<00:35, 51.62it/s, est. speed input: 17099.76 toks/s, output: 16.70 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:13<00:34, 52.60it/s, est. speed input: 17925.09 toks/s, output: 17.50 toks/s]
Processed prompts:  13%|█▎        | 258/2048 [00:14<00:33, 53.32it/s, est. speed input: 18716.86 toks/s, output: 18.28 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:14<00:32, 53.84it/s, est. speed input: 19476.89 toks/s, output: 19.02 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:14<00:32, 54.19it/s, est. speed input: 20206.47 toks/s, output: 19.73 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:14<00:31, 54.45it/s, est. speed input: 20907.79 toks/s, output: 20.42 toks/s]
Processed prompts:  16%|█▌        | 322/2048 [00:15<00:31, 54.62it/s, est. speed input: 21582.22 toks/s, output: 21.08 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:15<00:31, 54.72it/s, est. speed input: 22231.12 toks/s, output: 21.71 toks/s]
Processed prompts:  17%|█▋        | 354/2048 [00:15<00:30, 54.80it/s, est. speed input: 22856.28 toks/s, output: 22.32 toks/s]
Processed prompts:  18%|█▊        | 370/2048 [00:16<00:30, 54.85it/s, est. speed input: 23458.68 toks/s, output: 22.91 toks/s]
Processed prompts:  19%|█▉        | 386/2048 [00:16<00:30, 54.90it/s, est. speed input: 24040.17 toks/s, output: 23.48 toks/s]
Processed prompts:  20%|█▉        | 402/2048 [00:16<00:29, 54.97it/s, est. speed input: 24602.37 toks/s, output: 24.03 toks/s]
Processed prompts:  20%|██        | 418/2048 [00:17<00:29, 54.92it/s, est. speed input: 25142.91 toks/s, output: 24.55 toks/s]
Processed prompts:  21%|██        | 434/2048 [00:17<00:29, 54.94it/s, est. speed input: 25666.62 toks/s, output: 25.07 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:17<00:29, 54.95it/s, est. speed input: 26173.03 toks/s, output: 25.56 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:17<00:28, 54.97it/s, est. speed input: 26663.02 toks/s, output: 26.04 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:18<00:28, 54.97it/s, est. speed input: 27137.28 toks/s, output: 26.50 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:18<00:28, 54.97it/s, est. speed input: 27596.46 toks/s, output: 26.95 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:18<00:27, 54.97it/s, est. speed input: 28041.31 toks/s, output: 27.38 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:19<00:27, 54.96it/s, est. speed input: 28472.54 toks/s, output: 27.81 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:19<00:27, 54.98it/s, est. speed input: 28891.23 toks/s, output: 28.21 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:19<00:27, 54.98it/s, est. speed input: 29297.23 toks/s, output: 28.61 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:19<00:26, 54.97it/s, est. speed input: 29691.23 toks/s, output: 29.00 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:20<00:26, 54.98it/s, est. speed input: 30074.28 toks/s, output: 29.37 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:20<00:26, 54.98it/s, est. speed input: 30446.32 toks/s, output: 29.73 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:20<00:25, 54.98it/s, est. speed input: 30807.81 toks/s, output: 30.09 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:21<00:25, 54.96it/s, est. speed input: 31159.07 toks/s, output: 30.43 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:21<00:25, 54.96it/s, est. speed input: 31500.89 toks/s, output: 30.76 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:21<00:25, 54.94it/s, est. speed input: 31833.19 toks/s, output: 31.09 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:21<00:24, 54.94it/s, est. speed input: 32156.91 toks/s, output: 31.40 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:22<00:24, 54.93it/s, est. speed input: 32472.00 toks/s, output: 31.71 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:22<00:24, 54.93it/s, est. speed input: 32779.03 toks/s, output: 32.01 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:22<00:23, 54.94it/s, est. speed input: 33078.37 toks/s, output: 32.30 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:23<00:23, 54.93it/s, est. speed input: 33370.07 toks/s, output: 32.59 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:23<00:23, 54.97it/s, est. speed input: 33655.38 toks/s, output: 32.87 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:23<00:22, 54.90it/s, est. speed input: 33931.39 toks/s, output: 33.14 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:24<00:22, 54.87it/s, est. speed input: 34201.22 toks/s, output: 33.40 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:24<00:22, 54.89it/s, est. speed input: 34465.33 toks/s, output: 33.66 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:24<00:22, 54.90it/s, est. speed input: 34723.28 toks/s, output: 33.91 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:24<00:21, 54.90it/s, est. speed input: 34975.16 toks/s, output: 34.16 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:25<00:21, 54.92it/s, est. speed input: 35221.35 toks/s, output: 34.40 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:25<00:21, 54.91it/s, est. speed input: 35461.65 toks/s, output: 34.63 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:25<00:20, 54.90it/s, est. speed input: 35696.30 toks/s, output: 34.86 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:26<00:20, 54.91it/s, est. speed input: 35925.99 toks/s, output: 35.08 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:26<00:20, 54.91it/s, est. speed input: 36150.70 toks/s, output: 35.30 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:26<00:20, 54.90it/s, est. speed input: 36370.09 toks/s, output: 35.52 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:26<00:19, 54.89it/s, est. speed input: 36584.70 toks/s, output: 35.73 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:27<00:19, 55.79it/s, est. speed input: 36815.95 toks/s, output: 35.95 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:27<00:18, 55.57it/s, est. speed input: 37022.83 toks/s, output: 36.16 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:27<00:18, 55.30it/s, est. speed input: 37222.61 toks/s, output: 36.35 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:28<00:18, 55.20it/s, est. speed input: 37420.23 toks/s, output: 36.54 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:28<00:18, 55.07it/s, est. speed input: 37612.38 toks/s, output: 36.73 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:28<00:18, 55.00it/s, est. speed input: 37801.18 toks/s, output: 36.92 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:28<00:17, 54.96it/s, est. speed input: 37986.37 toks/s, output: 37.10 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:29<00:17, 54.92it/s, est. speed input: 38167.52 toks/s, output: 37.27 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:29<00:17, 54.89it/s, est. speed input: 38345.13 toks/s, output: 37.45 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:29<00:16, 54.88it/s, est. speed input: 38519.33 toks/s, output: 37.62 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:30<00:16, 54.87it/s, est. speed input: 38690.31 toks/s, output: 37.78 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:30<00:16, 55.83it/s, est. speed input: 38879.37 toks/s, output: 37.97 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:30<00:15, 55.53it/s, est. speed input: 39043.80 toks/s, output: 38.13 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:30<00:15, 55.33it/s, est. speed input: 39205.02 toks/s, output: 38.29 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:31<00:15, 55.18it/s, est. speed input: 39363.22 toks/s, output: 38.44 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:31<00:15, 55.13it/s, est. speed input: 39519.58 toks/s, output: 38.59 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:31<00:14, 54.99it/s, est. speed input: 39670.79 toks/s, output: 38.74 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:33<00:29, 27.40it/s, est. speed input: 38646.87 toks/s, output: 37.74 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:33<00:24, 32.23it/s, est. speed input: 38799.55 toks/s, output: 37.89 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:33<00:20, 36.77it/s, est. speed input: 38949.45 toks/s, output: 38.04 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:33<00:18, 40.80it/s, est. speed input: 39096.87 toks/s, output: 38.18 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:34<00:16, 44.18it/s, est. speed input: 39241.69 toks/s, output: 38.32 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:34<00:15, 46.93it/s, est. speed input: 39384.72 toks/s, output: 38.46 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:34<00:14, 48.99it/s, est. speed input: 39523.59 toks/s, output: 38.60 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:35<00:13, 50.59it/s, est. speed input: 39661.14 toks/s, output: 38.73 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:35<00:12, 51.78it/s, est. speed input: 39796.48 toks/s, output: 38.86 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:35<00:12, 52.64it/s, est. speed input: 39929.55 toks/s, output: 38.99 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:36<00:11, 53.25it/s, est. speed input: 40060.20 toks/s, output: 39.12 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:36<00:11, 53.69it/s, est. speed input: 40188.97 toks/s, output: 39.25 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:36<00:11, 54.00it/s, est. speed input: 40315.60 toks/s, output: 39.37 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:36<00:10, 54.22it/s, est. speed input: 40440.20 toks/s, output: 39.49 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:37<00:10, 54.38it/s, est. speed input: 40562.86 toks/s, output: 39.61 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:37<00:10, 54.47it/s, est. speed input: 40683.26 toks/s, output: 39.73 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:37<00:09, 54.55it/s, est. speed input: 40802.17 toks/s, output: 39.85 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:38<00:09, 54.58it/s, est. speed input: 40918.67 toks/s, output: 39.96 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:38<00:09, 54.61it/s, est. speed input: 41033.54 toks/s, output: 40.07 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:38<00:09, 54.62it/s, est. speed input: 41146.60 toks/s, output: 40.18 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:38<00:08, 54.64it/s, est. speed input: 41258.11 toks/s, output: 40.29 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:39<00:08, 54.63it/s, est. speed input: 41367.58 toks/s, output: 40.40 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:39<00:08, 54.63it/s, est. speed input: 41475.46 toks/s, output: 40.50 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:39<00:07, 54.62it/s, est. speed input: 41581.62 toks/s, output: 40.61 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:40<00:07, 54.64it/s, est. speed input: 41686.72 toks/s, output: 40.71 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:40<00:07, 54.65it/s, est. speed input: 41790.22 toks/s, output: 40.81 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:40<00:06, 54.64it/s, est. speed input: 41891.96 toks/s, output: 40.91 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:41<00:06, 54.65it/s, est. speed input: 41992.49 toks/s, output: 41.01 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:41<00:06, 54.63it/s, est. speed input: 42091.20 toks/s, output: 41.10 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:41<00:06, 54.62it/s, est. speed input: 42188.52 toks/s, output: 41.20 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:41<00:05, 54.61it/s, est. speed input: 42284.32 toks/s, output: 41.29 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:42<00:05, 54.61it/s, est. speed input: 42379.05 toks/s, output: 41.39 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:42<00:05, 54.61it/s, est. speed input: 42472.43 toks/s, output: 41.48 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:42<00:04, 54.62it/s, est. speed input: 42564.67 toks/s, output: 41.57 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:43<00:04, 54.61it/s, est. speed input: 42655.45 toks/s, output: 41.66 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:43<00:04, 54.57it/s, est. speed input: 42744.37 toks/s, output: 41.74 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:43<00:04, 54.57it/s, est. speed input: 42832.62 toks/s, output: 41.83 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:43<00:03, 54.43it/s, est. speed input: 42917.23 toks/s, output: 41.91 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:44<00:03, 54.47it/s, est. speed input: 43003.02 toks/s, output: 42.00 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:44<00:03, 55.44it/s, est. speed input: 43103.81 toks/s, output: 42.09 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:44<00:02, 55.17it/s, est. speed input: 43187.27 toks/s, output: 42.18 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:45<00:02, 54.99it/s, est. speed input: 43269.92 toks/s, output: 42.26 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:45<00:02, 54.85it/s, est. speed input: 43351.12 toks/s, output: 42.34 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:45<00:02, 54.75it/s, est. speed input: 43431.22 toks/s, output: 42.41 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:45<00:01, 54.69it/s, est. speed input: 43510.56 toks/s, output: 42.49 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:46<00:01, 54.65it/s, est. speed input: 43588.89 toks/s, output: 42.57 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:46<00:01, 54.62it/s, est. speed input: 43666.08 toks/s, output: 42.64 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:46<00:00, 54.61it/s, est. speed input: 43742.54 toks/s, output: 42.72 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:47<00:00, 54.59it/s, est. speed input: 43817.98 toks/s, output: 42.79 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:47<00:00, 55.68it/s, est. speed input: 43910.21 toks/s, output: 42.88 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:47<00:00, 55.68it/s, est. speed input: 44212.12 toks/s, output: 43.18 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:47<00:00, 43.18it/s, est. speed input: 44212.12 toks/s, output: 43.18 toks/s]
[rank0]:[W128 09:02:38.959149476 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 438.5s

测试结果:
  Requests/s:   39.60
  Tokens/s:     40594.81
  Total Reqs:   2048
  Elapsed:      51.71s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     40555.20

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-INT8                                  │
│ Backend:  cuSPARSELt (2:10)                               │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:03:46 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:03:47 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=873778) WARNING 01-28 09:05:12 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=873778) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=873778) WARNING 01-28 09:06:58 [backends.py:609] Failed to read file <frozen os>
Throughput: 46.86 requests/s, 48028.94 total tokens/s, 46.86 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 09:03:41] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:03:46] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 09:03:46] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 09:03:46] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:03:46] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:03:46] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:03:46] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:03:46] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:03:46] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 09:03:46] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:03:46] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:03:46] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:03:46] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:03:46] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:04:19] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:04:25] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-INT8'
[2026-01-28 09:04:25] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-INT8
[2026-01-28 09:04:25] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:04:25] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:04:25] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:04:25] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:04:25] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-INT8
[2026-01-28 09:04:25] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-INT8'
[2026-01-28 09:04:25] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:04:25] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:04:25] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:04:25] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:04:25] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:17] INFO SlideSparseLinearMethod_INT8.py:805: Wrapping CompressedTensorsW8A8Int8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:18] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:18] INFO SlideSparseLinearMethod_INT8.py:452: SlideSparseInt8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:18] INFO SlideSparseLinearMethod_INT8.py:604: SlideSparseInt8LinearMethod: cuSPARSELt sparsity=2:10, expand_ratio=1.250
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:18] INFO SlideSparseLinearMethod_INT8.py:621: Preloaded INT8 Triton kernels for model: BitNet-2B-INT8
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:18] INFO SlideSparseLinearMethod_INT8.py:625: SlideSparseInt8LinearMethod initialized, kernel=cuSPARSELt, symmetric=True
(EngineCore_DP0 pid=873778) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=873778) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.18it/s]
(EngineCore_DP0 pid=873778) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.18it/s]
(EngineCore_DP0 pid=873778) 
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:36] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [3840, 4096] -> 1D uint8
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:37] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 11796480 bytes
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:37] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 4096] -> 1D uint8
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:38] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 7864320 bytes
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:38] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [13824, 4096] -> 1D uint8
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:38] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 42467328 bytes
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:38] INFO SlideSparseLinearMethod_INT8.py:719: cuSPARSELt INT8 compression: [2560, 11072] -> 1D uint8
(EngineCore_DP0 pid=873778) [2026-01-28 09:05:40] INFO SlideSparseLinearMethod_INT8.py:729: cuSPARSELt INT8 compression done: 21299200 bytes
(EngineCore_DP0 pid=873778) [rank0]:W0128 09:07:06.986000 873778 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=873778) [rank0]:W0128 09:07:07.094000 873778 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=873778) [rank0]:W0128 09:07:17.942000 873778 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=873778) [rank0]:W0128 09:07:18.110000 873778 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=873778) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:01<00:13,  1.32s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:04<00:23,  2.57s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:09<00:28,  3.56s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:13<00:26,  3.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:14<00:17,  2.83s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:15<00:10,  2.14s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:17<00:08,  2.14s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:21<00:07,  2.66s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:28<00:07,  3.94s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:29<00:03,  3.03s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:30<00:00,  2.41s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:30<00:00,  2.74s/it]
(EngineCore_DP0 pid=873778) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:01<00:07,  1.21s/it]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:02<00:06,  1.35s/it]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:02<00:03,  1.21it/s]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:03<00:02,  1.06it/s]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:05<00:02,  1.22s/it]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:06<00:00,  1.00it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:08<00:00,  1.38s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:08<00:00,  1.20s/it]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 34/4096 [00:00<00:12, 337.44it/s]
Adding requests:   2%|▏         | 72/4096 [00:00<00:11, 357.87it/s]
Adding requests:   3%|▎         | 110/4096 [00:00<00:10, 364.77it/s]
Adding requests:   4%|▎         | 147/4096 [00:00<00:10, 365.97it/s]
Adding requests:   4%|▍         | 184/4096 [00:00<00:10, 366.52it/s]
Adding requests:   5%|▌         | 221/4096 [00:00<00:10, 365.20it/s]
Adding requests:   6%|▋         | 259/4096 [00:00<00:10, 368.96it/s]
Adding requests:   7%|▋         | 296/4096 [00:00<00:10, 365.39it/s]
Adding requests:   8%|▊         | 333/4096 [00:00<00:10, 362.70it/s]
Adding requests:   9%|▉         | 371/4096 [00:01<00:10, 366.39it/s]
Adding requests:  10%|█         | 410/4096 [00:01<00:09, 370.87it/s]
Adding requests:  11%|█         | 448/4096 [00:01<00:09, 370.93it/s]
Adding requests:  12%|█▏        | 486/4096 [00:01<00:09, 373.01it/s]
Adding requests:  13%|█▎        | 524/4096 [00:01<00:09, 365.55it/s]
Adding requests:  14%|█▍        | 564/4096 [00:01<00:09, 373.17it/s]
Adding requests:  15%|█▍        | 602/4096 [00:01<00:09, 371.08it/s]
Adding requests:  16%|█▌        | 641/4096 [00:01<00:09, 375.37it/s]
Adding requests:  17%|█▋        | 680/4096 [00:01<00:09, 377.70it/s]
Adding requests:  18%|█▊        | 718/4096 [00:01<00:08, 378.18it/s]
Adding requests:  18%|█▊        | 756/4096 [00:02<00:08, 375.72it/s]
Adding requests:  19%|█▉        | 794/4096 [00:02<00:08, 376.96it/s]
Adding requests:  20%|██        | 832/4096 [00:02<00:08, 369.00it/s]
Adding requests:  21%|██        | 870/4096 [00:02<00:08, 371.68it/s]
Adding requests:  22%|██▏       | 909/4096 [00:02<00:08, 376.81it/s]
Adding requests:  23%|██▎       | 948/4096 [00:02<00:08, 379.98it/s]
Adding requests:  24%|██▍       | 987/4096 [00:02<00:08, 381.91it/s]
Adding requests:  25%|██▌       | 1026/4096 [00:02<00:08, 379.30it/s]
Adding requests:  26%|██▌       | 1065/4096 [00:02<00:07, 381.16it/s]
Adding requests:  27%|██▋       | 1104/4096 [00:02<00:08, 366.66it/s]
Adding requests:  28%|██▊       | 1141/4096 [00:03<00:08, 367.47it/s]
Adding requests:  29%|██▉       | 1182/4096 [00:03<00:07, 377.82it/s]
Adding requests:  30%|██▉       | 1223/4096 [00:03<00:07, 386.88it/s]
Adding requests:  31%|███       | 1262/4096 [00:03<00:07, 384.60it/s]
Adding requests:  32%|███▏      | 1301/4096 [00:03<00:07, 381.45it/s]
Adding requests:  33%|███▎      | 1341/4096 [00:03<00:07, 386.87it/s]
Adding requests:  34%|███▎      | 1381/4096 [00:03<00:06, 390.12it/s]
Adding requests:  35%|███▍      | 1421/4096 [00:03<00:06, 391.21it/s]
Adding requests:  36%|███▌      | 1461/4096 [00:03<00:06, 391.08it/s]
Adding requests:  37%|███▋      | 1501/4096 [00:03<00:06, 391.98it/s]
Adding requests:  38%|███▊      | 1541/4096 [00:04<00:06, 392.90it/s]
Adding requests:  39%|███▊      | 1582/4096 [00:04<00:06, 395.54it/s]
Adding requests:  40%|███▉      | 1623/4096 [00:04<00:06, 397.36it/s]
Adding requests:  41%|████      | 1663/4096 [00:04<00:06, 395.85it/s]
Adding requests:  42%|████▏     | 1703/4096 [00:04<00:06, 395.54it/s]
Adding requests:  43%|████▎     | 1743/4096 [00:05<00:22, 102.89it/s]
Adding requests:  44%|████▎     | 1782/4096 [00:05<00:17, 130.95it/s]
Adding requests:  44%|████▍     | 1822/4096 [00:05<00:13, 163.95it/s]
Adding requests:  45%|████▌     | 1860/4096 [00:05<00:11, 195.99it/s]
Adding requests:  46%|████▋     | 1900/4096 [00:05<00:09, 231.55it/s]
Adding requests:  47%|████▋     | 1939/4096 [00:06<00:08, 263.32it/s]
Adding requests:  48%|████▊     | 1979/4096 [00:06<00:07, 292.23it/s]
Adding requests:  49%|████▉     | 2019/4096 [00:06<00:06, 316.70it/s]
Adding requests:  50%|█████     | 2059/4096 [00:06<00:06, 336.89it/s]
Adding requests:  51%|█████     | 2099/4096 [00:06<00:05, 351.80it/s]
Adding requests:  52%|█████▏    | 2138/4096 [00:06<00:05, 358.42it/s]
Adding requests:  53%|█████▎    | 2177/4096 [00:06<00:05, 364.14it/s]
Adding requests:  54%|█████▍    | 2216/4096 [00:06<00:05, 370.49it/s]
Adding requests:  55%|█████▌    | 2255/4096 [00:06<00:04, 372.82it/s]
Adding requests:  56%|█████▌    | 2294/4096 [00:06<00:04, 376.71it/s]
Adding requests:  57%|█████▋    | 2333/4096 [00:07<00:04, 367.55it/s]
Adding requests:  58%|█████▊    | 2371/4096 [00:07<00:04, 369.58it/s]
Adding requests:  59%|█████▉    | 2411/4096 [00:07<00:04, 376.30it/s]
Adding requests:  60%|█████▉    | 2451/4096 [00:07<00:04, 380.16it/s]
Adding requests:  61%|██████    | 2490/4096 [00:07<00:04, 382.50it/s]
Adding requests:  62%|██████▏   | 2529/4096 [00:07<00:04, 379.57it/s]
Adding requests:  63%|██████▎   | 2568/4096 [00:07<00:04, 381.23it/s]
Adding requests:  64%|██████▎   | 2607/4096 [00:07<00:03, 378.25it/s]
Adding requests:  65%|██████▍   | 2645/4096 [00:07<00:03, 377.99it/s]
Adding requests:  66%|██████▌   | 2684/4096 [00:08<00:03, 378.86it/s]
Adding requests:  66%|██████▋   | 2723/4096 [00:08<00:03, 381.06it/s]
Adding requests:  67%|██████▋   | 2762/4096 [00:08<00:03, 380.08it/s]
Adding requests:  68%|██████▊   | 2801/4096 [00:08<00:03, 375.98it/s]
Adding requests:  69%|██████▉   | 2840/4096 [00:08<00:03, 379.26it/s]
Adding requests:  70%|███████   | 2880/4096 [00:08<00:03, 382.81it/s]
Adding requests:  71%|███████▏  | 2919/4096 [00:08<00:03, 381.50it/s]
Adding requests:  72%|███████▏  | 2958/4096 [00:08<00:03, 379.14it/s]
Adding requests:  73%|███████▎  | 2997/4096 [00:08<00:02, 380.95it/s]
Adding requests:  74%|███████▍  | 3036/4096 [00:08<00:02, 377.17it/s]
Adding requests:  75%|███████▌  | 3074/4096 [00:09<00:02, 374.75it/s]
Adding requests:  76%|███████▌  | 3114/4096 [00:09<00:02, 380.31it/s]
Adding requests:  77%|███████▋  | 3153/4096 [00:09<00:02, 378.68it/s]
Adding requests:  78%|███████▊  | 3192/4096 [00:09<00:02, 380.86it/s]
Adding requests:  79%|███████▉  | 3231/4096 [00:09<00:02, 383.50it/s]
Adding requests:  80%|███████▉  | 3271/4096 [00:09<00:02, 386.87it/s]
Adding requests:  81%|████████  | 3311/4096 [00:09<00:02, 389.02it/s]
Adding requests:  82%|████████▏ | 3350/4096 [00:09<00:01, 388.95it/s]
Adding requests:  83%|████████▎ | 3389/4096 [00:09<00:01, 385.06it/s]
Adding requests:  84%|████████▎ | 3428/4096 [00:09<00:01, 381.82it/s]
Adding requests:  85%|████████▍ | 3467/4096 [00:10<00:01, 378.08it/s]
Adding requests:  86%|████████▌ | 3505/4096 [00:10<00:01, 377.80it/s]
Adding requests:  87%|████████▋ | 3544/4096 [00:10<00:01, 381.16it/s]
Adding requests:  87%|████████▋ | 3583/4096 [00:10<00:01, 380.75it/s]
Adding requests:  88%|████████▊ | 3622/4096 [00:10<00:01, 380.92it/s]
Adding requests:  89%|████████▉ | 3661/4096 [00:10<00:01, 380.06it/s]
Adding requests:  90%|█████████ | 3701/4096 [00:10<00:01, 385.43it/s]
Adding requests:  91%|█████████▏| 3740/4096 [00:10<00:00, 370.15it/s]
Adding requests:  92%|█████████▏| 3782/4096 [00:10<00:00, 381.50it/s]
Adding requests:  93%|█████████▎| 3821/4096 [00:11<00:00, 381.12it/s]
Adding requests:  94%|█████████▍| 3862/4096 [00:11<00:00, 387.94it/s]
Adding requests:  95%|█████████▌| 3901/4096 [00:11<00:00, 384.55it/s]
Adding requests:  96%|█████████▌| 3941/4096 [00:11<00:00, 385.98it/s]
Adding requests:  97%|█████████▋| 3980/4096 [00:11<00:00, 386.57it/s]
Adding requests:  98%|█████████▊| 4021/4096 [00:11<00:00, 392.17it/s]
Adding requests:  99%|█████████▉| 4061/4096 [00:11<00:00, 386.17it/s]
Adding requests: 100%|██████████| 4096/4096 [00:11<00:00, 349.83it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/4096 [00:04<2:41:48,  2.37s/it, est. speed input: 431.83 toks/s, output: 0.42 toks/s]
Processed prompts:   1%|          | 34/4096 [00:05<07:53,  8.59it/s, est. speed input: 6553.60 toks/s, output: 6.40 toks/s]
Processed prompts:   2%|▏         | 66/4096 [00:05<03:58, 16.86it/s, est. speed input: 11506.62 toks/s, output: 11.24 toks/s]
Processed prompts:   2%|▏         | 98/4096 [00:06<02:41, 24.72it/s, est. speed input: 15589.54 toks/s, output: 15.22 toks/s]
Processed prompts:   3%|▎         | 130/4096 [00:06<02:04, 31.77it/s, est. speed input: 19017.87 toks/s, output: 18.57 toks/s]
Processed prompts:   4%|▍         | 162/4096 [00:07<01:44, 37.75it/s, est. speed input: 21934.79 toks/s, output: 21.42 toks/s]
Processed prompts:   5%|▍         | 194/4096 [00:08<01:31, 42.60it/s, est. speed input: 24447.02 toks/s, output: 23.87 toks/s]
Processed prompts:   6%|▌         | 226/4096 [00:08<01:23, 46.39it/s, est. speed input: 26632.94 toks/s, output: 26.01 toks/s]
Processed prompts:   6%|▋         | 258/4096 [00:09<01:17, 49.27it/s, est. speed input: 28554.19 toks/s, output: 27.88 toks/s]
Processed prompts:   7%|▋         | 290/4096 [00:09<01:14, 51.39it/s, est. speed input: 30252.35 toks/s, output: 29.54 toks/s]
Processed prompts:   8%|▊         | 322/4096 [00:10<01:11, 52.94it/s, est. speed input: 31767.05 toks/s, output: 31.02 toks/s]
Processed prompts:   9%|▊         | 354/4096 [00:10<01:09, 54.05it/s, est. speed input: 33124.13 toks/s, output: 32.35 toks/s]
Processed prompts:   9%|▉         | 386/4096 [00:11<01:07, 54.85it/s, est. speed input: 34349.49 toks/s, output: 33.54 toks/s]
Processed prompts:  10%|█         | 418/4096 [00:12<01:06, 55.47it/s, est. speed input: 35465.14 toks/s, output: 34.63 toks/s]
Processed prompts:  11%|█         | 450/4096 [00:12<01:05, 55.79it/s, est. speed input: 36470.54 toks/s, output: 35.62 toks/s]
Processed prompts:  12%|█▏        | 482/4096 [00:13<01:04, 56.13it/s, est. speed input: 37399.85 toks/s, output: 36.52 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:13<01:03, 56.27it/s, est. speed input: 38244.46 toks/s, output: 37.35 toks/s]
Processed prompts:  13%|█▎        | 546/4096 [00:14<01:02, 56.42it/s, est. speed input: 39027.03 toks/s, output: 38.11 toks/s]
Processed prompts:  14%|█▍        | 578/4096 [00:14<01:02, 56.51it/s, est. speed input: 39748.78 toks/s, output: 38.82 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:15<01:01, 56.57it/s, est. speed input: 40418.33 toks/s, output: 39.47 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:16<01:01, 56.61it/s, est. speed input: 41039.92 toks/s, output: 40.08 toks/s]
Processed prompts:  16%|█▋        | 674/4096 [00:16<01:00, 56.64it/s, est. speed input: 41619.48 toks/s, output: 40.64 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:17<00:59, 56.66it/s, est. speed input: 42160.26 toks/s, output: 41.17 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:17<00:59, 56.67it/s, est. speed input: 42667.00 toks/s, output: 41.67 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:18<00:58, 56.68it/s, est. speed input: 43142.36 toks/s, output: 42.13 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:18<00:58, 56.69it/s, est. speed input: 43589.71 toks/s, output: 42.57 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:19<00:57, 56.75it/s, est. speed input: 44014.70 toks/s, output: 42.98 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:19<00:56, 56.68it/s, est. speed input: 44407.95 toks/s, output: 43.37 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:20<00:56, 56.68it/s, est. speed input: 44782.97 toks/s, output: 43.73 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:21<00:55, 56.69it/s, est. speed input: 45138.31 toks/s, output: 44.08 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:21<00:55, 56.68it/s, est. speed input: 45474.17 toks/s, output: 44.41 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:22<00:54, 56.67it/s, est. speed input: 45792.70 toks/s, output: 44.72 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:22<00:54, 56.66it/s, est. speed input: 46094.92 toks/s, output: 45.01 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:23<00:53, 56.69it/s, est. speed input: 46385.42 toks/s, output: 45.30 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:23<00:53, 56.59it/s, est. speed input: 46653.86 toks/s, output: 45.56 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:24<00:52, 56.58it/s, est. speed input: 46913.96 toks/s, output: 45.81 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:25<00:51, 57.06it/s, est. speed input: 47192.80 toks/s, output: 46.09 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:25<00:51, 56.91it/s, est. speed input: 47429.77 toks/s, output: 46.32 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:27<01:17, 36.93it/s, est. speed input: 45884.16 toks/s, output: 44.81 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:27<01:09, 41.22it/s, est. speed input: 46129.24 toks/s, output: 45.05 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:28<01:02, 44.87it/s, est. speed input: 46365.15 toks/s, output: 45.28 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:28<00:58, 47.83it/s, est. speed input: 46590.56 toks/s, output: 45.50 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:29<00:54, 50.13it/s, est. speed input: 46807.22 toks/s, output: 45.71 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:30<00:52, 51.89it/s, est. speed input: 47015.74 toks/s, output: 45.91 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:30<00:50, 53.18it/s, est. speed input: 47215.88 toks/s, output: 46.11 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:31<00:49, 54.13it/s, est. speed input: 47409.29 toks/s, output: 46.30 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:31<00:47, 54.81it/s, est. speed input: 47595.22 toks/s, output: 46.48 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:32<00:46, 55.31it/s, est. speed input: 47775.21 toks/s, output: 46.66 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:32<00:45, 55.64it/s, est. speed input: 47948.35 toks/s, output: 46.82 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:33<00:45, 55.88it/s, est. speed input: 48115.43 toks/s, output: 46.99 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:33<00:44, 56.05it/s, est. speed input: 48276.87 toks/s, output: 47.15 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:34<00:43, 56.15it/s, est. speed input: 48432.65 toks/s, output: 47.30 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:35<00:43, 56.24it/s, est. speed input: 48583.62 toks/s, output: 47.44 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:35<00:42, 56.31it/s, est. speed input: 48730.59 toks/s, output: 47.59 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:36<00:42, 56.30it/s, est. speed input: 48870.31 toks/s, output: 47.72 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:36<00:41, 56.32it/s, est. speed input: 49006.72 toks/s, output: 47.86 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:37<00:40, 56.33it/s, est. speed input: 49138.79 toks/s, output: 47.99 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:37<00:40, 56.33it/s, est. speed input: 49266.82 toks/s, output: 48.11 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:38<00:39, 56.85it/s, est. speed input: 49412.93 toks/s, output: 48.25 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:39<00:38, 56.70it/s, est. speed input: 49533.56 toks/s, output: 48.37 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:39<00:38, 56.60it/s, est. speed input: 49650.65 toks/s, output: 48.49 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:40<00:37, 56.52it/s, est. speed input: 49764.15 toks/s, output: 48.60 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:40<00:37, 56.46it/s, est. speed input: 49874.35 toks/s, output: 48.71 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:41<00:36, 56.41it/s, est. speed input: 49981.29 toks/s, output: 48.81 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:41<00:36, 56.38it/s, est. speed input: 50085.37 toks/s, output: 48.91 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:42<00:35, 56.29it/s, est. speed input: 50183.88 toks/s, output: 49.01 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:43<00:35, 56.28it/s, est. speed input: 50281.84 toks/s, output: 49.10 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:43<00:34, 56.29it/s, est. speed input: 50378.30 toks/s, output: 49.20 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:44<00:34, 56.30it/s, est. speed input: 50471.94 toks/s, output: 49.29 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:44<00:33, 56.29it/s, est. speed input: 50562.67 toks/s, output: 49.38 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:45<00:32, 56.33it/s, est. speed input: 50652.86 toks/s, output: 49.47 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:45<00:32, 56.75it/s, est. speed input: 50755.42 toks/s, output: 49.57 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:46<00:31, 56.67it/s, est. speed input: 50841.72 toks/s, output: 49.65 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:47<00:31, 56.49it/s, est. speed input: 50921.76 toks/s, output: 49.73 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:47<00:30, 56.44it/s, est. speed input: 51002.24 toks/s, output: 49.81 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:48<00:30, 56.39it/s, est. speed input: 51080.68 toks/s, output: 49.88 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:48<00:29, 56.37it/s, est. speed input: 51157.46 toks/s, output: 49.96 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:49<00:28, 56.34it/s, est. speed input: 51232.04 toks/s, output: 50.03 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:49<00:28, 56.83it/s, est. speed input: 51322.32 toks/s, output: 50.12 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:50<00:27, 56.66it/s, est. speed input: 51393.43 toks/s, output: 50.19 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [00:50<00:27, 56.55it/s, est. speed input: 51463.14 toks/s, output: 50.26 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [00:51<00:26, 56.47it/s, est. speed input: 51531.34 toks/s, output: 50.32 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [00:52<00:26, 56.40it/s, est. speed input: 51597.36 toks/s, output: 50.39 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [00:52<00:25, 56.35it/s, est. speed input: 51662.03 toks/s, output: 50.45 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [00:53<00:24, 56.37it/s, est. speed input: 51727.07 toks/s, output: 50.51 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [00:53<00:24, 56.29it/s, est. speed input: 51787.58 toks/s, output: 50.57 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [00:54<00:23, 56.26it/s, est. speed input: 51847.79 toks/s, output: 50.63 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [00:54<00:23, 56.19it/s, est. speed input: 51905.39 toks/s, output: 50.69 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [00:55<00:22, 56.14it/s, est. speed input: 51961.45 toks/s, output: 50.74 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [00:56<00:22, 56.17it/s, est. speed input: 52018.47 toks/s, output: 50.80 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [00:56<00:21, 56.22it/s, est. speed input: 52075.40 toks/s, output: 50.85 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [00:57<00:21, 56.16it/s, est. speed input: 52128.15 toks/s, output: 50.91 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [00:57<00:20, 56.18it/s, est. speed input: 52181.68 toks/s, output: 50.96 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [00:58<00:19, 56.18it/s, est. speed input: 52233.93 toks/s, output: 51.01 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [00:58<00:19, 56.18it/s, est. speed input: 52285.14 toks/s, output: 51.06 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [01:00<00:28, 36.57it/s, est. speed input: 51455.04 toks/s, output: 50.25 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [01:01<00:25, 40.85it/s, est. speed input: 51512.04 toks/s, output: 50.30 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [01:01<00:22, 44.50it/s, est. speed input: 51567.87 toks/s, output: 50.36 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [01:02<00:20, 47.47it/s, est. speed input: 51622.57 toks/s, output: 50.41 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [01:02<00:18, 49.79it/s, est. speed input: 51676.37 toks/s, output: 50.47 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [01:03<00:17, 51.56it/s, est. speed input: 51729.39 toks/s, output: 50.52 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [01:03<00:16, 52.87it/s, est. speed input: 51781.15 toks/s, output: 50.57 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [01:04<00:15, 53.83it/s, est. speed input: 51832.12 toks/s, output: 50.62 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [01:05<00:14, 54.52it/s, est. speed input: 51882.28 toks/s, output: 50.67 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [01:05<00:13, 55.02it/s, est. speed input: 51931.38 toks/s, output: 50.71 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [01:06<00:13, 55.38it/s, est. speed input: 51979.97 toks/s, output: 50.76 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [01:06<00:12, 55.63it/s, est. speed input: 52027.59 toks/s, output: 50.81 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [01:07<00:12, 55.81it/s, est. speed input: 52074.59 toks/s, output: 50.85 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:07<00:11, 55.93it/s, est. speed input: 52120.56 toks/s, output: 50.90 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:08<00:10, 56.02it/s, est. speed input: 52165.89 toks/s, output: 50.94 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:09<00:10, 56.07it/s, est. speed input: 52210.28 toks/s, output: 50.99 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:09<00:09, 56.11it/s, est. speed input: 52253.79 toks/s, output: 51.03 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:10<00:09, 56.14it/s, est. speed input: 52296.89 toks/s, output: 51.07 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:10<00:08, 56.16it/s, est. speed input: 52339.31 toks/s, output: 51.11 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:11<00:07, 56.18it/s, est. speed input: 52380.93 toks/s, output: 51.15 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:11<00:07, 56.20it/s, est. speed input: 52422.20 toks/s, output: 51.19 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:12<00:06, 56.72it/s, est. speed input: 52475.03 toks/s, output: 51.25 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:13<00:06, 56.56it/s, est. speed input: 52514.63 toks/s, output: 51.28 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:13<00:05, 56.47it/s, est. speed input: 52553.96 toks/s, output: 51.32 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:14<00:05, 56.39it/s, est. speed input: 52592.34 toks/s, output: 51.36 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:14<00:04, 56.34it/s, est. speed input: 52630.21 toks/s, output: 51.40 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:15<00:03, 56.30it/s, est. speed input: 52667.56 toks/s, output: 51.43 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:15<00:03, 56.29it/s, est. speed input: 52704.60 toks/s, output: 51.47 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:16<00:02, 56.27it/s, est. speed input: 52740.95 toks/s, output: 51.50 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:17<00:02, 56.27it/s, est. speed input: 52776.81 toks/s, output: 51.54 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:17<00:01, 56.25it/s, est. speed input: 52811.83 toks/s, output: 51.57 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:18<00:01, 56.75it/s, est. speed input: 52858.06 toks/s, output: 51.62 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:18<00:00, 57.27it/s, est. speed input: 52907.21 toks/s, output: 51.67 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:18<00:00, 57.27it/s, est. speed input: 53297.23 toks/s, output: 52.05 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:18<00:00, 52.05it/s, est. speed input: 53297.23 toks/s, output: 52.05 toks/s]
[rank0]:[W128 09:10:10.425682399 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 532.5s

测试结果:
  Requests/s:   46.86
  Tokens/s:     48028.94
  Total Reqs:   4096
  Elapsed:      87.41s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     47982.08


------------------------------------------------------------
  生成 CSV: BitNet-2B-INT8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_INT8_py312_cu129_x86_64/cusparselt/2_10/BitNet-2B-INT8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,15.6851,8046.4310,8.1606
1024,1024,1,128,128,15.7030,16095.5877,8.1513
2048,1024,2,256,128,30.9718,31746.1215,8.2656
4096,1024,4,512,128,50.4635,51725.1096,10.1459
8192,1024,8,1024,128,50.6295,51895.1951,20.2254
16384,1024,16,2048,128,39.6047,40594.8055,51.7110
32768,1024,32,4096,128,46.8575,48028.9423,87.4140

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败


============================================================
  Benchmark 完成!
============================================================


总计: 35 成功, 0 失败
============================================================
