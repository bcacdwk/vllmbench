======================================================================
SlideSparse vLLM Throughput Benchmark Log
Created: 2026-01-28 09:12:49
======================================================================

原始命令:
  /root/vllmbench/slidesparse/tools/throughput_benchmark.py --model bitnet1.58-2b-fp8 --backend cublaslt,cusparselt --stage prefill --sparsity 2_4,2_6,2_8,2_10 --M 512,1024,2048,4096,8192,16384,32768

命令行参数:
  --model: bitnet1.58-2b-fp8
  --backend: cublaslt,cusparselt
  --sparsity: 2_4,2_6,2_8,2_10
  --stage: prefill
  --M: 512,1024,2048,4096,8192,16384,32768
  --N: None
  --inner-32: False
  --eager: False
  --gpu-id: 0
  --gpu-mem: 0.8
  --dry-run: False
  --list-models: False

硬件信息:
  GPU: RTX4090
  Compute Capability: cc89
  VRAM: 24.0 GB
  CUDA: 12.9
  Python: py312

Backend 环境变量 (初始状态):
  DISABLE_SLIDESPARSE: 未设置
  USE_CUBLASLT: 未设置
  USE_CUSPARSELT: 未设置
  SPARSITY: 未设置
  INNER_DTYPE_32: 未设置

======================================================================


============================================================
  BitNet-2B-FP8 | cuBLASLt | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints/BitNet-2B-FP8
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cublaslt

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:13:48 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:13:49 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=878403) WARNING 01-28 09:15:20 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=878403) WARNING 01-28 09:15:49 [backends.py:609] Failed to read file <frozen os>
Throughput: 13.94 requests/s, 7149.55 total tokens/s, 13.94 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 09:13:47] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:13:48] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:13:48] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:13:48] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:13:48] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:13:48] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:13:48] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:13:48] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:13:48] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:13:48] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:13:48] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:13:48] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:13:48] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:13:48] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:14:20] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:14:57] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:14:57] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:14:57] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:14:57] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:14:57] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:14:57] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:14:57] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:14:57] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:14:57] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:14:57] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:14:57] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:14:57] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:14:57] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=878403) [2026-01-28 09:15:22] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=878403) [2026-01-28 09:15:22] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=878403) [2026-01-28 09:15:22] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=878403) [2026-01-28 09:15:22] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=878403) [2026-01-28 09:15:22] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=878403) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=878403) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.39s/it]
(EngineCore_DP0 pid=878403) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.39s/it]
(EngineCore_DP0 pid=878403) 
(EngineCore_DP0 pid=878403) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:07<00:07,  7.88s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:16<00:00,  8.30s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:16<00:00,  8.24s/it]
(EngineCore_DP0 pid=878403) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  3.85it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  3.85it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  49%|████▉     | 63/128 [00:00<00:00, 625.11it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 638.10it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 635.62it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:24,  5.14it/s, est. speed input: 2632.79 toks/s, output: 5.14 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:24,  5.19it/s, est. speed input: 2653.29 toks/s, output: 5.18 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:14,  8.78it/s, est. speed input: 3939.20 toks/s, output: 7.69 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:11, 10.91it/s, est. speed input: 4699.13 toks/s, output: 9.18 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:09, 12.18it/s, est. speed input: 5188.28 toks/s, output: 10.13 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:09, 12.99it/s, est. speed input: 5530.88 toks/s, output: 10.80 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:01<00:08, 13.50it/s, est. speed input: 5782.25 toks/s, output: 11.29 toks/s]
Processed prompts:  11%|█         | 14/128 [00:01<00:08, 13.89it/s, est. speed input: 5982.76 toks/s, output: 11.68 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:01<00:07, 14.02it/s, est. speed input: 6122.17 toks/s, output: 11.96 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:07, 14.26it/s, est. speed input: 6257.18 toks/s, output: 12.22 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:07, 14.51it/s, est. speed input: 6377.90 toks/s, output: 12.46 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:07, 14.64it/s, est. speed input: 6475.91 toks/s, output: 12.65 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:07, 14.73it/s, est. speed input: 6559.55 toks/s, output: 12.81 toks/s]
Processed prompts:  20%|██        | 26/128 [00:02<00:06, 14.77it/s, est. speed input: 6630.68 toks/s, output: 12.95 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:02<00:06, 14.80it/s, est. speed input: 6692.02 toks/s, output: 13.07 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:02<00:06, 14.81it/s, est. speed input: 6745.40 toks/s, output: 13.17 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:02<00:06, 14.76it/s, est. speed input: 6788.23 toks/s, output: 13.26 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:02<00:06, 14.77it/s, est. speed input: 6830.05 toks/s, output: 13.34 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:06, 14.73it/s, est. speed input: 6864.05 toks/s, output: 13.41 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:06, 14.80it/s, est. speed input: 6901.75 toks/s, output: 13.48 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:06, 13.83it/s, est. speed input: 6859.13 toks/s, output: 13.40 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:03<00:06, 14.05it/s, est. speed input: 6885.72 toks/s, output: 13.45 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:03<00:05, 14.31it/s, est. speed input: 6917.66 toks/s, output: 13.51 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:03<00:05, 14.41it/s, est. speed input: 6941.01 toks/s, output: 13.56 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:03<00:05, 14.49it/s, est. speed input: 6963.35 toks/s, output: 13.60 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:03<00:05, 14.51it/s, est. speed input: 6981.42 toks/s, output: 13.64 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:05, 14.56it/s, est. speed input: 7000.95 toks/s, output: 13.67 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:05, 14.58it/s, est. speed input: 7017.55 toks/s, output: 13.71 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:04<00:04, 14.58it/s, est. speed input: 7032.65 toks/s, output: 13.74 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:04<00:04, 14.61it/s, est. speed input: 7048.13 toks/s, output: 13.77 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:04<00:04, 14.59it/s, est. speed input: 7060.95 toks/s, output: 13.79 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:04<00:04, 14.61it/s, est. speed input: 7074.40 toks/s, output: 13.82 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:04<00:04, 14.63it/s, est. speed input: 7087.54 toks/s, output: 13.84 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:04<00:04, 14.67it/s, est. speed input: 7100.61 toks/s, output: 13.87 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:04, 14.69it/s, est. speed input: 7113.20 toks/s, output: 13.89 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:05<00:03, 14.65it/s, est. speed input: 7122.61 toks/s, output: 13.91 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:06<00:11,  4.92it/s, est. speed input: 6074.97 toks/s, output: 11.87 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:06<00:08,  6.15it/s, est. speed input: 6106.71 toks/s, output: 11.93 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:06<00:06,  7.45it/s, est. speed input: 6137.53 toks/s, output: 11.99 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:06<00:05,  8.75it/s, est. speed input: 6167.39 toks/s, output: 12.05 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:06<00:04,  9.96it/s, est. speed input: 6195.43 toks/s, output: 12.10 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:06<00:04, 11.02it/s, est. speed input: 6221.71 toks/s, output: 12.15 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:06<00:03, 11.87it/s, est. speed input: 6245.63 toks/s, output: 12.20 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:07<00:03, 12.57it/s, est. speed input: 6269.50 toks/s, output: 12.25 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:07<00:03, 13.11it/s, est. speed input: 6292.22 toks/s, output: 12.29 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:07<00:02, 13.46it/s, est. speed input: 6312.39 toks/s, output: 12.33 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:07<00:02, 13.72it/s, est. speed input: 6331.87 toks/s, output: 12.37 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:07<00:02, 13.97it/s, est. speed input: 6352.57 toks/s, output: 12.41 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:07<00:02, 14.14it/s, est. speed input: 6372.08 toks/s, output: 12.45 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:07<00:02, 14.26it/s, est. speed input: 6391.01 toks/s, output: 12.48 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:07<00:01, 14.39it/s, est. speed input: 6410.28 toks/s, output: 12.52 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:08<00:01, 14.55it/s, est. speed input: 6430.69 toks/s, output: 12.56 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:08<00:01, 14.68it/s, est. speed input: 6450.93 toks/s, output: 12.60 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:08<00:01, 14.75it/s, est. speed input: 6469.79 toks/s, output: 12.64 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:08<00:01, 14.85it/s, est. speed input: 6489.38 toks/s, output: 12.67 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:08<00:01, 14.89it/s, est. speed input: 6507.53 toks/s, output: 12.71 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:08<00:01, 14.80it/s, est. speed input: 6522.63 toks/s, output: 12.74 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:08<00:00, 14.70it/s, est. speed input: 6536.43 toks/s, output: 12.77 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:09<00:00, 14.46it/s, est. speed input: 6545.70 toks/s, output: 12.78 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:09<00:00, 14.52it/s, est. speed input: 6559.94 toks/s, output: 12.81 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:09<00:00, 14.57it/s, est. speed input: 6573.96 toks/s, output: 12.84 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:09<00:00, 14.60it/s, est. speed input: 6587.39 toks/s, output: 12.87 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:09<00:00, 14.70it/s, est. speed input: 6602.24 toks/s, output: 12.89 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:09<00:00, 14.80it/s, est. speed input: 6617.10 toks/s, output: 12.92 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 14.87it/s, est. speed input: 6631.67 toks/s, output: 12.95 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 14.87it/s, est. speed input: 6631.67 toks/s, output: 12.95 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 12.95it/s, est. speed input: 6631.67 toks/s, output: 12.95 toks/s]
[rank0]:[W128 09:17:56.548068280 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 429.2s

测试结果:
  Requests/s:   13.94
  Tokens/s:     7149.55
  Total Reqs:   128
  Elapsed:      9.18s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7135.61

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:20:41 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:20:42 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=881705) WARNING 01-28 09:22:08 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=881705) WARNING 01-28 09:23:40 [backends.py:609] Failed to read file <frozen os>
Throughput: 13.46 requests/s, 13797.44 total tokens/s, 13.46 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 09:20:15] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:20:41] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:20:41] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:20:41] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:20:41] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:20:41] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:20:41] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:20:41] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:20:41] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:20:41] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:20:41] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:20:41] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:20:41] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:20:41] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:21:05] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:21:10] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:21:10] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:21:10] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:21:10] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:21:10] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:21:10] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:21:10] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:21:10] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:21:10] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:21:10] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:21:10] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:21:10] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:21:10] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=881705) [2026-01-28 09:22:19] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=881705) [2026-01-28 09:22:19] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=881705) [2026-01-28 09:22:19] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=881705) [2026-01-28 09:22:19] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=881705) [2026-01-28 09:22:19] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=881705) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=881705) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.61it/s]
(EngineCore_DP0 pid=881705) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.61it/s]
(EngineCore_DP0 pid=881705) 
(EngineCore_DP0 pid=881705) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:00<00:00,  2.42it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.19it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:00<00:00,  2.22it/s]
(EngineCore_DP0 pid=881705) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:01<00:00,  1.41s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:01<00:00,  1.41s/it]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  27%|██▋       | 35/128 [00:00<00:00, 343.43it/s]
Adding requests:  57%|█████▋    | 73/128 [00:00<00:00, 361.36it/s]
Adding requests:  86%|████████▌ | 110/128 [00:00<00:00, 353.32it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 354.59it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<01:04,  1.96it/s, est. speed input: 2009.49 toks/s, output: 1.96 toks/s]
Processed prompts:   2%|▏         | 3/128 [00:00<00:22,  5.44it/s, est. speed input: 4731.34 toks/s, output: 4.62 toks/s]
Processed prompts:   4%|▍         | 5/128 [00:00<00:15,  8.02it/s, est. speed input: 6506.59 toks/s, output: 6.35 toks/s]
Processed prompts:   5%|▌         | 7/128 [00:00<00:12,  9.96it/s, est. speed input: 7778.44 toks/s, output: 7.60 toks/s]
Processed prompts:   7%|▋         | 9/128 [00:01<00:10, 11.37it/s, est. speed input: 8726.18 toks/s, output: 8.52 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:01<00:09, 12.34it/s, est. speed input: 9446.53 toks/s, output: 9.22 toks/s]
Processed prompts:  10%|█         | 13/128 [00:01<00:09, 12.51it/s, est. speed input: 9874.40 toks/s, output: 9.64 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:01<00:08, 13.10it/s, est. speed input: 10340.24 toks/s, output: 10.10 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:01<00:08, 13.55it/s, est. speed input: 10732.15 toks/s, output: 10.48 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:07, 13.76it/s, est. speed input: 11038.92 toks/s, output: 10.78 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:07, 14.02it/s, est. speed input: 11323.69 toks/s, output: 11.06 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:02<00:07, 14.13it/s, est. speed input: 11556.11 toks/s, output: 11.29 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:02<00:07, 14.26it/s, est. speed input: 11768.15 toks/s, output: 11.49 toks/s]
Processed prompts:  21%|██        | 27/128 [00:02<00:07, 14.34it/s, est. speed input: 11953.95 toks/s, output: 11.67 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:02<00:06, 14.38it/s, est. speed input: 12115.40 toks/s, output: 11.83 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:02<00:06, 14.42it/s, est. speed input: 12261.86 toks/s, output: 11.97 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:02<00:06, 14.48it/s, est. speed input: 12397.43 toks/s, output: 12.11 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:06, 14.50it/s, est. speed input: 12516.98 toks/s, output: 12.22 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:03<00:06, 14.47it/s, est. speed input: 12620.15 toks/s, output: 12.32 toks/s]
Processed prompts:  30%|███       | 39/128 [00:03<00:06, 14.43it/s, est. speed input: 12712.20 toks/s, output: 12.41 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:03<00:06, 14.40it/s, est. speed input: 12796.08 toks/s, output: 12.50 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:03<00:05, 14.44it/s, est. speed input: 12879.97 toks/s, output: 12.58 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:03<00:05, 14.50it/s, est. speed input: 12960.76 toks/s, output: 12.66 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:03<00:05, 14.51it/s, est. speed input: 13032.29 toks/s, output: 12.73 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:03<00:05, 14.54it/s, est. speed input: 13100.89 toks/s, output: 12.79 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:05, 14.57it/s, est. speed input: 13166.38 toks/s, output: 12.86 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:04<00:05, 14.57it/s, est. speed input: 13225.20 toks/s, output: 12.92 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:04<00:05, 14.60it/s, est. speed input: 13282.62 toks/s, output: 12.97 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:04<00:04, 14.71it/s, est. speed input: 13345.66 toks/s, output: 13.03 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:04<00:04, 14.77it/s, est. speed input: 13402.44 toks/s, output: 13.09 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:04<00:04, 14.82it/s, est. speed input: 13457.47 toks/s, output: 13.14 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:04<00:04, 14.84it/s, est. speed input: 13507.67 toks/s, output: 13.19 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:04<00:04, 14.87it/s, est. speed input: 13556.46 toks/s, output: 13.24 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:05<00:04, 14.81it/s, est. speed input: 13596.48 toks/s, output: 13.28 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:05<00:03, 14.86it/s, est. speed input: 13641.27 toks/s, output: 13.32 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:05<00:03, 14.85it/s, est. speed input: 13680.12 toks/s, output: 13.36 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:05<00:03, 14.87it/s, est. speed input: 13719.55 toks/s, output: 13.40 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:05<00:03, 14.92it/s, est. speed input: 13759.62 toks/s, output: 13.44 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:06<00:08,  5.69it/s, est. speed input: 12242.90 toks/s, output: 11.96 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:06<00:07,  6.98it/s, est. speed input: 12302.49 toks/s, output: 12.01 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:06<00:05,  8.31it/s, est. speed input: 12362.68 toks/s, output: 12.07 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:06<00:04,  9.58it/s, est. speed input: 12419.81 toks/s, output: 12.13 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:06<00:04, 10.74it/s, est. speed input: 12474.84 toks/s, output: 12.18 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:07<00:03, 11.72it/s, est. speed input: 12527.51 toks/s, output: 12.23 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:07<00:03, 12.55it/s, est. speed input: 12580.11 toks/s, output: 12.29 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:07<00:02, 13.19it/s, est. speed input: 12629.82 toks/s, output: 12.33 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:07<00:02, 13.67it/s, est. speed input: 12677.45 toks/s, output: 12.38 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:07<00:02, 14.04it/s, est. speed input: 12724.09 toks/s, output: 12.43 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:07<00:02, 14.27it/s, est. speed input: 12767.03 toks/s, output: 12.47 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:07<00:02, 14.43it/s, est. speed input: 12807.90 toks/s, output: 12.51 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:08<00:01, 14.56it/s, est. speed input: 12848.25 toks/s, output: 12.55 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:08<00:01, 14.62it/s, est. speed input: 12885.68 toks/s, output: 12.58 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:08<00:01, 14.65it/s, est. speed input: 12921.31 toks/s, output: 12.62 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:08<00:01, 14.60it/s, est. speed input: 12952.72 toks/s, output: 12.65 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:08<00:01, 14.69it/s, est. speed input: 12988.89 toks/s, output: 12.68 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:08<00:01, 14.72it/s, est. speed input: 13022.28 toks/s, output: 12.72 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:08<00:01, 14.74it/s, est. speed input: 13054.56 toks/s, output: 12.75 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:08<00:00, 14.79it/s, est. speed input: 13087.64 toks/s, output: 12.78 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:09<00:00, 14.84it/s, est. speed input: 13120.28 toks/s, output: 12.81 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:09<00:00, 14.89it/s, est. speed input: 13152.53 toks/s, output: 12.84 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:09<00:00, 14.88it/s, est. speed input: 13181.89 toks/s, output: 12.87 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:09<00:00, 14.89it/s, est. speed input: 13211.52 toks/s, output: 12.90 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:09<00:00, 14.87it/s, est. speed input: 13238.89 toks/s, output: 12.93 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:09<00:00, 14.85it/s, est. speed input: 13265.54 toks/s, output: 12.95 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 14.85it/s, est. speed input: 13278.47 toks/s, output: 12.97 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:09<00:00, 12.97it/s, est. speed input: 13278.47 toks/s, output: 12.97 toks/s]
[rank0]:[W128 09:24:49.487242212 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 431.2s

测试结果:
  Requests/s:   13.46
  Tokens/s:     13797.44
  Total Reqs:   128
  Elapsed:      9.51s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     13783.98

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:27:37 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:27:38 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=884950) WARNING 01-28 09:28:50 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=884950) WARNING 01-28 09:29:59 [backends.py:609] Failed to read file <frozen os>
Throughput: 21.75 requests/s, 22298.02 total tokens/s, 21.75 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 09:27:28] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:27:37] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:27:37] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:27:37] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:27:37] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:27:37] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:27:37] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:27:37] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:27:37] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:27:37] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:27:37] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:27:37] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:27:37] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:27:37] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:27:55] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:28:04] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:28:04] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:28:04] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:28:04] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:28:04] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:28:04] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:28:04] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:28:04] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:28:04] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:28:04] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:28:04] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:28:04] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:28:04] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=884950) [2026-01-28 09:29:00] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=884950) [2026-01-28 09:29:00] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=884950) [2026-01-28 09:29:00] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=884950) [2026-01-28 09:29:00] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=884950) [2026-01-28 09:29:00] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=884950) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=884950) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.55it/s]
(EngineCore_DP0 pid=884950) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.55it/s]
(EngineCore_DP0 pid=884950) 
(EngineCore_DP0 pid=884950) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:01<00:03,  1.96s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:03<00:01,  1.55s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:05<00:00,  1.96s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:05<00:00,  1.89s/it]
(EngineCore_DP0 pid=884950) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:01<00:01,  1.02s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.55it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.43it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  14%|█▍        | 37/256 [00:00<00:00, 363.49it/s]
Adding requests:  29%|██▉       | 75/256 [00:00<00:00, 371.32it/s]
Adding requests:  44%|████▍     | 113/256 [00:00<00:00, 370.20it/s]
Adding requests:  59%|█████▉    | 151/256 [00:00<00:00, 370.69it/s]
Adding requests:  74%|███████▍  | 189/256 [00:00<00:00, 369.34it/s]
Adding requests:  88%|████████▊ | 226/256 [00:00<00:00, 366.08it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 369.58it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 1/256 [00:02<10:57,  2.58s/it, est. speed input: 397.02 toks/s, output: 0.39 toks/s]
Processed prompts:   1%|          | 2/256 [00:02<04:50,  1.14s/it, est. speed input: 754.03 toks/s, output: 0.74 toks/s]
Processed prompts:   2%|▏         | 6/256 [00:02<01:11,  3.48it/s, est. speed input: 2158.71 toks/s, output: 2.11 toks/s]
Processed prompts:   4%|▍         | 10/256 [00:02<00:37,  6.51it/s, est. speed input: 3441.83 toks/s, output: 3.36 toks/s]
Processed prompts:   5%|▌         | 14/256 [00:03<00:24,  9.83it/s, est. speed input: 4616.30 toks/s, output: 4.51 toks/s]
Processed prompts:   7%|▋         | 18/256 [00:03<00:18, 13.15it/s, est. speed input: 5685.83 toks/s, output: 5.55 toks/s]
Processed prompts:   9%|▊         | 22/256 [00:03<00:14, 16.46it/s, est. speed input: 6680.89 toks/s, output: 6.52 toks/s]
Processed prompts:  10%|█         | 26/256 [00:03<00:11, 19.50it/s, est. speed input: 7603.14 toks/s, output: 7.42 toks/s]
Processed prompts:  12%|█▏        | 30/256 [00:03<00:10, 22.04it/s, est. speed input: 8454.23 toks/s, output: 8.26 toks/s]
Processed prompts:  13%|█▎        | 34/256 [00:03<00:09, 24.18it/s, est. speed input: 9248.97 toks/s, output: 9.03 toks/s]
Processed prompts:  15%|█▍        | 38/256 [00:03<00:08, 25.85it/s, est. speed input: 9989.22 toks/s, output: 9.76 toks/s]
Processed prompts:  16%|█▋        | 42/256 [00:04<00:07, 27.10it/s, est. speed input: 10680.27 toks/s, output: 10.43 toks/s]
Processed prompts:  18%|█▊        | 46/256 [00:04<00:07, 28.13it/s, est. speed input: 11331.82 toks/s, output: 11.07 toks/s]
Processed prompts:  20%|█▉        | 50/256 [00:04<00:07, 28.87it/s, est. speed input: 11943.21 toks/s, output: 11.66 toks/s]
Processed prompts:  21%|██        | 54/256 [00:04<00:06, 29.45it/s, est. speed input: 12520.50 toks/s, output: 12.23 toks/s]
Processed prompts:  23%|██▎       | 58/256 [00:04<00:06, 29.83it/s, est. speed input: 13063.05 toks/s, output: 12.76 toks/s]
Processed prompts:  24%|██▍       | 62/256 [00:04<00:06, 30.06it/s, est. speed input: 13573.92 toks/s, output: 13.26 toks/s]
Processed prompts:  26%|██▌       | 66/256 [00:04<00:06, 30.29it/s, est. speed input: 14059.66 toks/s, output: 13.73 toks/s]
Processed prompts:  27%|██▋       | 70/256 [00:04<00:06, 30.36it/s, est. speed input: 14516.11 toks/s, output: 14.18 toks/s]
Processed prompts:  29%|██▉       | 74/256 [00:05<00:05, 30.45it/s, est. speed input: 14950.49 toks/s, output: 14.60 toks/s]
Processed prompts:  30%|███       | 78/256 [00:05<00:05, 30.45it/s, est. speed input: 15360.69 toks/s, output: 15.00 toks/s]
Processed prompts:  32%|███▏      | 82/256 [00:05<00:05, 30.46it/s, est. speed input: 15750.69 toks/s, output: 15.38 toks/s]
Processed prompts:  34%|███▎      | 86/256 [00:05<00:05, 30.60it/s, est. speed input: 16127.99 toks/s, output: 15.75 toks/s]
Processed prompts:  35%|███▌      | 90/256 [00:05<00:05, 30.58it/s, est. speed input: 16482.57 toks/s, output: 16.10 toks/s]
Processed prompts:  37%|███▋      | 94/256 [00:05<00:05, 30.58it/s, est. speed input: 16821.44 toks/s, output: 16.43 toks/s]
Processed prompts:  38%|███▊      | 98/256 [00:05<00:05, 30.58it/s, est. speed input: 17145.55 toks/s, output: 16.74 toks/s]
Processed prompts:  40%|███▉      | 102/256 [00:05<00:05, 30.54it/s, est. speed input: 17453.59 toks/s, output: 17.04 toks/s]
Processed prompts:  41%|████▏     | 106/256 [00:06<00:04, 30.54it/s, est. speed input: 17749.37 toks/s, output: 17.33 toks/s]
Processed prompts:  43%|████▎     | 110/256 [00:06<00:04, 30.53it/s, est. speed input: 18032.67 toks/s, output: 17.61 toks/s]
Processed prompts:  45%|████▍     | 114/256 [00:06<00:04, 30.55it/s, est. speed input: 18305.26 toks/s, output: 17.88 toks/s]
Processed prompts:  46%|████▌     | 118/256 [00:06<00:04, 30.49it/s, est. speed input: 18563.94 toks/s, output: 18.13 toks/s]
Processed prompts:  48%|████▊     | 122/256 [00:06<00:04, 30.32it/s, est. speed input: 18806.98 toks/s, output: 18.37 toks/s]
Processed prompts:  49%|████▉     | 126/256 [00:06<00:04, 30.47it/s, est. speed input: 19051.49 toks/s, output: 18.60 toks/s]
Processed prompts:  51%|█████     | 130/256 [00:06<00:04, 30.60it/s, est. speed input: 19287.73 toks/s, output: 18.84 toks/s]
Processed prompts:  52%|█████▏    | 134/256 [00:07<00:03, 30.64it/s, est. speed input: 19513.21 toks/s, output: 19.06 toks/s]
Processed prompts:  54%|█████▍    | 138/256 [00:07<00:03, 30.64it/s, est. speed input: 19729.43 toks/s, output: 19.27 toks/s]
Processed prompts:  55%|█████▌    | 142/256 [00:07<00:03, 30.65it/s, est. speed input: 19938.21 toks/s, output: 19.47 toks/s]
Processed prompts:  57%|█████▋    | 146/256 [00:07<00:03, 30.69it/s, est. speed input: 20141.19 toks/s, output: 19.67 toks/s]
Processed prompts:  59%|█████▊    | 150/256 [00:07<00:03, 30.36it/s, est. speed input: 20323.28 toks/s, output: 19.85 toks/s]
Processed prompts:  60%|██████    | 154/256 [00:07<00:03, 30.22it/s, est. speed input: 20502.03 toks/s, output: 20.02 toks/s]
Processed prompts:  62%|██████▏   | 158/256 [00:07<00:03, 30.00it/s, est. speed input: 20670.18 toks/s, output: 20.19 toks/s]
Processed prompts:  63%|██████▎   | 162/256 [00:07<00:03, 29.95it/s, est. speed input: 20836.62 toks/s, output: 20.35 toks/s]
Processed prompts:  65%|██████▍   | 166/256 [00:08<00:03, 29.98it/s, est. speed input: 21000.00 toks/s, output: 20.51 toks/s]
Processed prompts:  66%|██████▋   | 170/256 [00:08<00:02, 30.16it/s, est. speed input: 21164.24 toks/s, output: 20.67 toks/s]
Processed prompts:  68%|██████▊   | 174/256 [00:08<00:02, 30.40it/s, est. speed input: 21327.25 toks/s, output: 20.83 toks/s]
Processed prompts:  70%|██████▉   | 178/256 [00:08<00:02, 30.46it/s, est. speed input: 21481.45 toks/s, output: 20.98 toks/s]
Processed prompts:  71%|███████   | 182/256 [00:08<00:02, 30.23it/s, est. speed input: 21621.23 toks/s, output: 21.11 toks/s]
Processed prompts:  73%|███████▎  | 186/256 [00:08<00:02, 30.17it/s, est. speed input: 21760.12 toks/s, output: 21.25 toks/s]
Processed prompts:  74%|███████▍  | 190/256 [00:08<00:02, 30.09it/s, est. speed input: 21893.36 toks/s, output: 21.38 toks/s]
Processed prompts:  76%|███████▌  | 194/256 [00:09<00:02, 30.01it/s, est. speed input: 22022.17 toks/s, output: 21.51 toks/s]
Processed prompts:  77%|███████▋  | 198/256 [00:09<00:01, 29.98it/s, est. speed input: 22147.74 toks/s, output: 21.63 toks/s]
Processed prompts:  79%|███████▉  | 202/256 [00:09<00:01, 30.19it/s, est. speed input: 22278.01 toks/s, output: 21.76 toks/s]
Processed prompts:  80%|████████  | 206/256 [00:09<00:01, 30.39it/s, est. speed input: 22406.53 toks/s, output: 21.88 toks/s]
Processed prompts:  82%|████████▏ | 210/256 [00:09<00:01, 30.39it/s, est. speed input: 22526.71 toks/s, output: 22.00 toks/s]
Processed prompts:  84%|████████▎ | 214/256 [00:09<00:01, 30.52it/s, est. speed input: 22647.78 toks/s, output: 22.12 toks/s]
Processed prompts:  85%|████████▌ | 218/256 [00:09<00:01, 30.49it/s, est. speed input: 22761.89 toks/s, output: 22.23 toks/s]
Processed prompts:  87%|████████▋ | 222/256 [00:09<00:01, 30.48it/s, est. speed input: 22873.36 toks/s, output: 22.34 toks/s]
Processed prompts:  88%|████████▊ | 226/256 [00:10<00:00, 30.30it/s, est. speed input: 22976.00 toks/s, output: 22.44 toks/s]
Processed prompts:  90%|████████▉ | 230/256 [00:10<00:00, 30.15it/s, est. speed input: 23075.27 toks/s, output: 22.53 toks/s]
Processed prompts:  91%|█████████▏| 234/256 [00:10<00:00, 30.11it/s, est. speed input: 23174.01 toks/s, output: 22.63 toks/s]
Processed prompts:  93%|█████████▎| 238/256 [00:10<00:00, 30.06it/s, est. speed input: 23269.46 toks/s, output: 22.72 toks/s]
Processed prompts:  95%|█████████▍| 242/256 [00:10<00:00, 30.04it/s, est. speed input: 23362.93 toks/s, output: 22.82 toks/s]
Processed prompts:  96%|█████████▌| 246/256 [00:10<00:00, 30.05it/s, est. speed input: 23455.20 toks/s, output: 22.91 toks/s]
Processed prompts:  98%|█████████▊| 250/256 [00:10<00:00, 29.99it/s, est. speed input: 23542.79 toks/s, output: 22.99 toks/s]
Processed prompts:  99%|█████████▉| 254/256 [00:11<00:00, 30.06it/s, est. speed input: 23631.84 toks/s, output: 23.08 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:11<00:00, 30.06it/s, est. speed input: 23673.30 toks/s, output: 23.12 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:11<00:00, 23.12it/s, est. speed input: 23673.30 toks/s, output: 23.12 toks/s]
[rank0]:[W128 09:31:13.349729063 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 263.3s

测试结果:
  Requests/s:   21.75
  Tokens/s:     22298.02
  Total Reqs:   256
  Elapsed:      11.77s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     22276.27

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:32:03 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:32:04 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=887092) WARNING 01-28 09:32:42 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=887092) WARNING 01-28 09:33:38 [backends.py:609] Failed to read file <frozen os>
Throughput: 28.21 requests/s, 28918.77 total tokens/s, 28.21 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 09:31:59] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:32:03] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:32:03] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:32:03] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:03] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:03] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:03] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:03] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:03] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:32:03] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:32:03] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:32:03] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:32:03] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:32:03] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:32:32] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:32:34] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:32:34] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:32:34] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:34] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:34] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:34] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:34] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:32:34] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:32:34] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:32:34] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:32:34] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:32:34] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:32:34] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=887092) [2026-01-28 09:32:46] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=887092) [2026-01-28 09:32:47] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=887092) [2026-01-28 09:32:47] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=887092) [2026-01-28 09:32:47] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=887092) [2026-01-28 09:32:47] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=887092) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=887092) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.62it/s]
(EngineCore_DP0 pid=887092) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.62it/s]
(EngineCore_DP0 pid=887092) 
(EngineCore_DP0 pid=887092) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:05<00:17,  5.95s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:15<00:16,  8.22s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:23<00:08,  8.20s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:27<00:00,  6.42s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:27<00:00,  6.91s/it]
(EngineCore_DP0 pid=887092) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:02<00:04,  2.08s/it]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:03<00:01,  1.56s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:03<00:00,  1.16s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:03<00:00,  1.32s/it]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 359.01it/s]
Adding requests:  14%|█▍        | 74/512 [00:00<00:01, 369.93it/s]
Adding requests:  22%|██▏       | 111/512 [00:00<00:01, 368.50it/s]
Adding requests:  29%|██▉       | 149/512 [00:00<00:00, 372.48it/s]
Adding requests:  37%|███▋      | 187/512 [00:00<00:00, 371.98it/s]
Adding requests:  44%|████▍     | 225/512 [00:00<00:00, 371.78it/s]
Adding requests:  52%|█████▏    | 264/512 [00:00<00:00, 377.12it/s]
Adding requests:  59%|█████▉    | 302/512 [00:00<00:00, 373.55it/s]
Adding requests:  66%|██████▋   | 340/512 [00:00<00:00, 371.97it/s]
Adding requests:  74%|███████▍  | 379/512 [00:01<00:00, 376.55it/s]
Adding requests:  82%|████████▏ | 418/512 [00:01<00:00, 379.65it/s]
Adding requests:  89%|████████▉ | 456/512 [00:01<00:00, 378.77it/s]
Adding requests:  96%|█████████▋| 494/512 [00:01<00:00, 377.98it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 375.01it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 1/512 [00:01<14:18,  1.68s/it, est. speed input: 609.86 toks/s, output: 0.60 toks/s]
Processed prompts:   0%|          | 2/512 [00:05<25:41,  3.02s/it, est. speed input: 362.90 toks/s, output: 0.35 toks/s]
Processed prompts:   2%|▏         | 10/512 [00:05<03:26,  2.43it/s, est. speed input: 1756.90 toks/s, output: 1.72 toks/s]
Processed prompts:   4%|▎         | 18/512 [00:06<01:36,  5.11it/s, est. speed input: 3068.25 toks/s, output: 3.00 toks/s]
Processed prompts:   5%|▌         | 26/512 [00:06<00:57,  8.39it/s, est. speed input: 4303.18 toks/s, output: 4.20 toks/s]
Processed prompts:   7%|▋         | 34/512 [00:06<00:39, 12.23it/s, est. speed input: 5468.76 toks/s, output: 5.34 toks/s]
Processed prompts:   8%|▊         | 42/512 [00:06<00:28, 16.48it/s, est. speed input: 6569.82 toks/s, output: 6.42 toks/s]
Processed prompts:  10%|▉         | 50/512 [00:06<00:22, 20.93it/s, est. speed input: 7612.34 toks/s, output: 7.43 toks/s]
Processed prompts:  11%|█▏        | 58/512 [00:06<00:17, 25.27it/s, est. speed input: 8599.89 toks/s, output: 8.40 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:07<00:15, 29.26it/s, est. speed input: 9537.02 toks/s, output: 9.31 toks/s]
Processed prompts:  14%|█▍        | 74/512 [00:07<00:13, 32.75it/s, est. speed input: 10428.23 toks/s, output: 10.18 toks/s]
Processed prompts:  16%|█▌        | 82/512 [00:07<00:12, 35.63it/s, est. speed input: 11276.02 toks/s, output: 11.01 toks/s]
Processed prompts:  18%|█▊        | 90/512 [00:07<00:11, 37.95it/s, est. speed input: 12084.50 toks/s, output: 11.80 toks/s]
Processed prompts:  19%|█▉        | 98/512 [00:07<00:10, 39.70it/s, est. speed input: 12854.88 toks/s, output: 12.55 toks/s]
Processed prompts:  21%|██        | 106/512 [00:07<00:09, 41.03it/s, est. speed input: 13591.11 toks/s, output: 13.27 toks/s]
Processed prompts:  22%|██▏       | 114/512 [00:08<00:09, 42.01it/s, est. speed input: 14294.84 toks/s, output: 13.96 toks/s]
Processed prompts:  24%|██▍       | 122/512 [00:08<00:09, 42.73it/s, est. speed input: 14968.44 toks/s, output: 14.62 toks/s]
Processed prompts:  25%|██▌       | 130/512 [00:08<00:08, 43.25it/s, est. speed input: 15613.73 toks/s, output: 15.25 toks/s]
Processed prompts:  27%|██▋       | 138/512 [00:08<00:08, 43.58it/s, est. speed input: 16231.27 toks/s, output: 15.85 toks/s]
Processed prompts:  29%|██▊       | 146/512 [00:08<00:08, 43.83it/s, est. speed input: 16824.09 toks/s, output: 16.43 toks/s]
Processed prompts:  30%|███       | 154/512 [00:09<00:08, 44.00it/s, est. speed input: 17393.37 toks/s, output: 16.99 toks/s]
Processed prompts:  32%|███▏      | 162/512 [00:09<00:07, 44.13it/s, est. speed input: 17940.66 toks/s, output: 17.52 toks/s]
Processed prompts:  33%|███▎      | 170/512 [00:09<00:07, 44.22it/s, est. speed input: 18467.10 toks/s, output: 18.03 toks/s]
Processed prompts:  35%|███▍      | 178/512 [00:09<00:07, 44.32it/s, est. speed input: 18974.63 toks/s, output: 18.53 toks/s]
Processed prompts:  36%|███▋      | 186/512 [00:09<00:07, 44.37it/s, est. speed input: 19463.10 toks/s, output: 19.01 toks/s]
Processed prompts:  38%|███▊      | 194/512 [00:09<00:07, 44.45it/s, est. speed input: 19935.21 toks/s, output: 19.47 toks/s]
Processed prompts:  39%|███▉      | 202/512 [00:10<00:06, 44.49it/s, est. speed input: 20390.17 toks/s, output: 19.91 toks/s]
Processed prompts:  41%|████      | 210/512 [00:10<00:06, 44.53it/s, est. speed input: 20829.62 toks/s, output: 20.34 toks/s]
Processed prompts:  43%|████▎     | 218/512 [00:10<00:06, 44.52it/s, est. speed input: 21252.98 toks/s, output: 20.75 toks/s]
Processed prompts:  44%|████▍     | 226/512 [00:10<00:06, 44.53it/s, est. speed input: 21662.57 toks/s, output: 21.15 toks/s]
Processed prompts:  46%|████▌     | 234/512 [00:10<00:06, 44.53it/s, est. speed input: 22058.46 toks/s, output: 21.54 toks/s]
Processed prompts:  47%|████▋     | 242/512 [00:11<00:06, 44.52it/s, est. speed input: 22441.17 toks/s, output: 21.92 toks/s]
Processed prompts:  49%|████▉     | 250/512 [00:11<00:05, 44.50it/s, est. speed input: 22811.29 toks/s, output: 22.28 toks/s]
Processed prompts:  50%|█████     | 258/512 [00:11<00:05, 44.51it/s, est. speed input: 23170.30 toks/s, output: 22.63 toks/s]
Processed prompts:  52%|█████▏    | 266/512 [00:11<00:05, 44.54it/s, est. speed input: 23518.97 toks/s, output: 22.97 toks/s]
Processed prompts:  54%|█████▎    | 274/512 [00:11<00:05, 44.53it/s, est. speed input: 23856.06 toks/s, output: 23.30 toks/s]
Processed prompts:  55%|█████▌    | 282/512 [00:11<00:05, 44.51it/s, est. speed input: 24182.46 toks/s, output: 23.62 toks/s]
Processed prompts:  57%|█████▋    | 290/512 [00:12<00:04, 44.50it/s, est. speed input: 24499.45 toks/s, output: 23.93 toks/s]
Processed prompts:  58%|█████▊    | 298/512 [00:12<00:04, 44.53it/s, est. speed input: 24808.31 toks/s, output: 24.23 toks/s]
Processed prompts:  60%|█████▉    | 306/512 [00:12<00:04, 44.78it/s, est. speed input: 25114.30 toks/s, output: 24.53 toks/s]
Processed prompts:  61%|██████▏   | 314/512 [00:12<00:04, 45.67it/s, est. speed input: 25430.44 toks/s, output: 24.83 toks/s]
Processed prompts:  63%|██████▎   | 322/512 [00:12<00:04, 46.32it/s, est. speed input: 25738.36 toks/s, output: 25.14 toks/s]
Processed prompts:  64%|██████▍   | 330/512 [00:12<00:03, 46.80it/s, est. speed input: 26038.78 toks/s, output: 25.43 toks/s]
Processed prompts:  66%|██████▌   | 338/512 [00:13<00:03, 47.14it/s, est. speed input: 26331.44 toks/s, output: 25.71 toks/s]
Processed prompts:  68%|██████▊   | 346/512 [00:13<00:03, 47.35it/s, est. speed input: 26616.27 toks/s, output: 25.99 toks/s]
Processed prompts:  69%|██████▉   | 354/512 [00:13<00:03, 47.55it/s, est. speed input: 26895.09 toks/s, output: 26.26 toks/s]
Processed prompts:  71%|███████   | 362/512 [00:13<00:03, 47.68it/s, est. speed input: 27166.87 toks/s, output: 26.53 toks/s]
Processed prompts:  72%|███████▏  | 370/512 [00:13<00:02, 47.75it/s, est. speed input: 27431.57 toks/s, output: 26.79 toks/s]
Processed prompts:  74%|███████▍  | 378/512 [00:13<00:02, 47.84it/s, est. speed input: 27690.85 toks/s, output: 27.04 toks/s]
Processed prompts:  75%|███████▌  | 386/512 [00:14<00:02, 47.87it/s, est. speed input: 27943.27 toks/s, output: 27.29 toks/s]
Processed prompts:  77%|███████▋  | 394/512 [00:14<00:02, 47.88it/s, est. speed input: 28189.74 toks/s, output: 27.53 toks/s]
Processed prompts:  79%|███████▊  | 402/512 [00:14<00:02, 47.93it/s, est. speed input: 28431.31 toks/s, output: 27.76 toks/s]
Processed prompts:  80%|████████  | 410/512 [00:14<00:02, 47.92it/s, est. speed input: 28666.36 toks/s, output: 27.99 toks/s]
Processed prompts:  82%|████████▏ | 418/512 [00:14<00:01, 47.89it/s, est. speed input: 28895.74 toks/s, output: 28.22 toks/s]
Processed prompts:  83%|████████▎ | 426/512 [00:14<00:01, 47.90it/s, est. speed input: 29120.63 toks/s, output: 28.44 toks/s]
Processed prompts:  85%|████████▍ | 434/512 [00:15<00:01, 47.88it/s, est. speed input: 29339.94 toks/s, output: 28.65 toks/s]
Processed prompts:  86%|████████▋ | 442/512 [00:15<00:01, 47.88it/s, est. speed input: 29554.71 toks/s, output: 28.86 toks/s]
Processed prompts:  88%|████████▊ | 450/512 [00:15<00:01, 47.84it/s, est. speed input: 29763.90 toks/s, output: 29.07 toks/s]
Processed prompts:  89%|████████▉ | 458/512 [00:15<00:01, 47.83it/s, est. speed input: 29969.13 toks/s, output: 29.27 toks/s]
Processed prompts:  91%|█████████ | 466/512 [00:15<00:00, 47.83it/s, est. speed input: 30170.17 toks/s, output: 29.46 toks/s]
Processed prompts:  93%|█████████▎| 474/512 [00:15<00:00, 47.56it/s, est. speed input: 30361.08 toks/s, output: 29.65 toks/s]
Processed prompts:  94%|█████████▍| 482/512 [00:16<00:00, 46.48it/s, est. speed input: 30527.47 toks/s, output: 29.81 toks/s]
Processed prompts:  96%|█████████▌| 490/512 [00:16<00:00, 45.75it/s, est. speed input: 30689.88 toks/s, output: 29.97 toks/s]
Processed prompts:  97%|█████████▋| 498/512 [00:16<00:00, 45.25it/s, est. speed input: 30848.86 toks/s, output: 30.13 toks/s]
Processed prompts:  99%|█████████▉| 506/512 [00:16<00:00, 44.93it/s, est. speed input: 31004.98 toks/s, output: 30.28 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:16<00:00, 44.93it/s, est. speed input: 31244.36 toks/s, output: 30.51 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:16<00:00, 30.51it/s, est. speed input: 31244.36 toks/s, output: 30.51 toks/s]
[rank0]:[W128 09:36:07.785525797 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 289.6s

测试结果:
  Requests/s:   28.21
  Tokens/s:     28918.77
  Total Reqs:   512
  Elapsed:      18.15s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     28890.56

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:37:10 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:37:11 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=889521) WARNING 01-28 09:38:48 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=889521) WARNING 01-28 09:39:28 [backends.py:609] Failed to read file <frozen os>
Throughput: 28.36 requests/s, 29071.23 total tokens/s, 28.36 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 09:36:46] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:37:10] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:37:10] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:37:10] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:10] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:10] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:10] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:10] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:10] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:37:10] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:37:10] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:37:10] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:37:10] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:37:10] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:37:45] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:37:54] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:37:54] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:37:54] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:54] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:54] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:54] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:54] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:37:54] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:37:54] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:37:54] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:37:54] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:37:54] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:37:54] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=889521) [2026-01-28 09:38:51] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=889521) [2026-01-28 09:38:51] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=889521) [2026-01-28 09:38:51] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=889521) [2026-01-28 09:38:51] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=889521) [2026-01-28 09:38:51] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=889521) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=889521) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=889521) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.38it/s]
(EngineCore_DP0 pid=889521) 
(EngineCore_DP0 pid=889521) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:02<00:10,  2.56s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:03<00:04,  1.62s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:05<00:03,  1.86s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:08<00:02,  2.13s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:11<00:00,  2.63s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:11<00:00,  2.35s/it]
(EngineCore_DP0 pid=889521) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:03<00:11,  3.99s/it]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:06<00:06,  3.32s/it]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:07<00:02,  2.26s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:09<00:00,  1.85s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:09<00:00,  2.26s/it]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▎         | 36/1024 [00:00<00:02, 357.64it/s]
Adding requests:   7%|▋         | 75/1024 [00:00<00:02, 371.67it/s]
Adding requests:  11%|█         | 114/1024 [00:00<00:02, 377.06it/s]
Adding requests:  15%|█▍        | 152/1024 [00:00<00:02, 370.85it/s]
Adding requests:  19%|█▊        | 190/1024 [00:00<00:02, 371.93it/s]
Adding requests:  22%|██▏       | 228/1024 [00:00<00:02, 372.29it/s]
Adding requests:  26%|██▌       | 267/1024 [00:00<00:02, 375.01it/s]
Adding requests:  30%|██▉       | 305/1024 [00:00<00:01, 372.48it/s]
Adding requests:  33%|███▎      | 343/1024 [00:00<00:01, 372.11it/s]
Adding requests:  37%|███▋      | 383/1024 [00:01<00:01, 377.12it/s]
Adding requests:  41%|████▏     | 423/1024 [00:01<00:01, 382.42it/s]
Adding requests:  45%|████▌     | 462/1024 [00:01<00:01, 378.92it/s]
Adding requests:  49%|████▉     | 500/1024 [00:01<00:01, 379.07it/s]
Adding requests:  53%|█████▎    | 538/1024 [00:01<00:01, 371.30it/s]
Adding requests:  57%|█████▋    | 579/1024 [00:01<00:01, 379.76it/s]
Adding requests:  60%|██████    | 619/1024 [00:01<00:01, 383.05it/s]
Adding requests:  64%|██████▍   | 658/1024 [00:01<00:00, 378.44it/s]
Adding requests:  68%|██████▊   | 699/1024 [00:01<00:00, 386.86it/s]
Adding requests:  72%|███████▏  | 739/1024 [00:01<00:00, 388.81it/s]
Adding requests:  76%|███████▌  | 778/1024 [00:02<00:00, 383.37it/s]
Adding requests:  80%|███████▉  | 817/1024 [00:02<00:00, 377.28it/s]
Adding requests:  83%|████████▎ | 855/1024 [00:02<00:00, 377.35it/s]
Adding requests:  88%|████████▊ | 896/1024 [00:02<00:00, 384.73it/s]
Adding requests:  91%|█████████▏| 935/1024 [00:02<00:00, 386.13it/s]
Adding requests:  95%|█████████▌| 975/1024 [00:02<00:00, 389.36it/s]
Adding requests:  99%|█████████▉| 1014/1024 [00:02<00:00, 389.53it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 380.31it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 1/1024 [00:04<1:14:13,  4.35s/it, est. speed input: 235.21 toks/s, output: 0.23 toks/s]
Processed prompts:   0%|          | 2/1024 [00:11<1:46:33,  6.26s/it, est. speed input: 171.51 toks/s, output: 0.17 toks/s]
Processed prompts:   1%|          | 10/1024 [00:12<13:59,  1.21it/s, est. speed input: 845.92 toks/s, output: 0.83 toks/s] 
Processed prompts:   2%|▏         | 18/1024 [00:12<06:22,  2.63it/s, est. speed input: 1502.22 toks/s, output: 1.47 toks/s]
Processed prompts:   3%|▎         | 26/1024 [00:12<03:40,  4.52it/s, est. speed input: 2141.13 toks/s, output: 2.09 toks/s]
Processed prompts:   3%|▎         | 34/1024 [00:12<02:22,  6.96it/s, est. speed input: 2763.41 toks/s, output: 2.70 toks/s]
Processed prompts:   4%|▍         | 42/1024 [00:12<01:38, 10.02it/s, est. speed input: 3369.61 toks/s, output: 3.29 toks/s]
Processed prompts:   5%|▍         | 50/1024 [00:12<01:11, 13.67it/s, est. speed input: 3960.33 toks/s, output: 3.87 toks/s]
Processed prompts:   6%|▌         | 58/1024 [00:13<00:54, 17.84it/s, est. speed input: 4536.29 toks/s, output: 4.43 toks/s]
Processed prompts:   6%|▋         | 66/1024 [00:13<00:43, 22.24it/s, est. speed input: 5096.26 toks/s, output: 4.98 toks/s]
Processed prompts:   7%|▋         | 74/1024 [00:13<00:35, 26.76it/s, est. speed input: 5643.82 toks/s, output: 5.51 toks/s]
Processed prompts:   8%|▊         | 82/1024 [00:13<00:30, 31.06it/s, est. speed input: 6178.16 toks/s, output: 6.03 toks/s]
Processed prompts:   9%|▉         | 90/1024 [00:13<00:26, 34.92it/s, est. speed input: 6699.87 toks/s, output: 6.54 toks/s]
Processed prompts:  10%|▉         | 98/1024 [00:13<00:24, 38.20it/s, est. speed input: 7209.24 toks/s, output: 7.04 toks/s]
Processed prompts:  10%|█         | 106/1024 [00:14<00:22, 40.84it/s, est. speed input: 7706.59 toks/s, output: 7.53 toks/s]
Processed prompts:  11%|█         | 114/1024 [00:14<00:21, 42.89it/s, est. speed input: 8192.28 toks/s, output: 8.00 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:14<00:20, 44.44it/s, est. speed input: 8666.92 toks/s, output: 8.46 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:14<00:19, 45.59it/s, est. speed input: 9130.81 toks/s, output: 8.92 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:14<00:19, 46.45it/s, est. speed input: 9584.40 toks/s, output: 9.36 toks/s]
Processed prompts:  14%|█▍        | 146/1024 [00:14<00:18, 46.42it/s, est. speed input: 10022.66 toks/s, output: 9.79 toks/s]
Processed prompts:  15%|█▌        | 154/1024 [00:15<00:18, 45.84it/s, est. speed input: 10446.04 toks/s, output: 10.20 toks/s]
Processed prompts:  16%|█▌        | 162/1024 [00:15<00:18, 45.42it/s, est. speed input: 10859.31 toks/s, output: 10.60 toks/s]
Processed prompts:  17%|█▋        | 170/1024 [00:15<00:18, 45.17it/s, est. speed input: 11263.27 toks/s, output: 11.00 toks/s]
Processed prompts:  17%|█▋        | 178/1024 [00:15<00:18, 45.00it/s, est. speed input: 11658.04 toks/s, output: 11.38 toks/s]
Processed prompts:  18%|█▊        | 186/1024 [00:15<00:18, 44.88it/s, est. speed input: 12043.84 toks/s, output: 11.76 toks/s]
Processed prompts:  19%|█▉        | 194/1024 [00:15<00:18, 44.79it/s, est. speed input: 12420.88 toks/s, output: 12.13 toks/s]
Processed prompts:  20%|█▉        | 202/1024 [00:16<00:18, 44.71it/s, est. speed input: 12789.41 toks/s, output: 12.49 toks/s]
Processed prompts:  21%|██        | 210/1024 [00:16<00:18, 44.64it/s, est. speed input: 13149.66 toks/s, output: 12.84 toks/s]
Processed prompts:  21%|██▏       | 218/1024 [00:16<00:18, 44.60it/s, est. speed input: 13502.25 toks/s, output: 13.19 toks/s]
Processed prompts:  22%|██▏       | 226/1024 [00:16<00:17, 44.58it/s, est. speed input: 13847.28 toks/s, output: 13.52 toks/s]
Processed prompts:  23%|██▎       | 234/1024 [00:16<00:17, 44.57it/s, est. speed input: 14185.00 toks/s, output: 13.85 toks/s]
Processed prompts:  24%|██▎       | 242/1024 [00:17<00:17, 44.56it/s, est. speed input: 14515.60 toks/s, output: 14.18 toks/s]
Processed prompts:  24%|██▍       | 250/1024 [00:17<00:17, 44.54it/s, est. speed input: 14839.15 toks/s, output: 14.49 toks/s]
Processed prompts:  25%|██▌       | 258/1024 [00:17<00:17, 44.55it/s, est. speed input: 15156.28 toks/s, output: 14.80 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:17<00:17, 44.52it/s, est. speed input: 15466.64 toks/s, output: 15.10 toks/s]
Processed prompts:  27%|██▋       | 274/1024 [00:17<00:16, 44.53it/s, est. speed input: 15770.93 toks/s, output: 15.40 toks/s]
Processed prompts:  28%|██▊       | 282/1024 [00:17<00:16, 44.53it/s, est. speed input: 16069.14 toks/s, output: 15.69 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:18<00:16, 44.53it/s, est. speed input: 16361.46 toks/s, output: 15.98 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:18<00:16, 44.52it/s, est. speed input: 16647.89 toks/s, output: 16.26 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:18<00:16, 44.52it/s, est. speed input: 16928.81 toks/s, output: 16.53 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:18<00:15, 44.52it/s, est. speed input: 17204.43 toks/s, output: 16.80 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:18<00:15, 44.54it/s, est. speed input: 17474.98 toks/s, output: 17.07 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:19<00:15, 44.50it/s, est. speed input: 17739.81 toks/s, output: 17.32 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:19<00:15, 44.57it/s, est. speed input: 18000.89 toks/s, output: 17.58 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:19<00:15, 44.63it/s, est. speed input: 18257.20 toks/s, output: 17.83 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:19<00:14, 44.68it/s, est. speed input: 18508.98 toks/s, output: 18.08 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:19<00:14, 44.70it/s, est. speed input: 18756.12 toks/s, output: 18.32 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:19<00:14, 44.73it/s, est. speed input: 18998.96 toks/s, output: 18.55 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:20<00:14, 44.75it/s, est. speed input: 19237.45 toks/s, output: 18.79 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:20<00:14, 44.76it/s, est. speed input: 19471.67 toks/s, output: 19.02 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:20<00:14, 44.76it/s, est. speed input: 19701.83 toks/s, output: 19.24 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:20<00:13, 44.79it/s, est. speed input: 19928.27 toks/s, output: 19.46 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:20<00:13, 44.79it/s, est. speed input: 20150.60 toks/s, output: 19.68 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:21<00:13, 44.80it/s, est. speed input: 20369.31 toks/s, output: 19.89 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:21<00:13, 44.76it/s, est. speed input: 20583.73 toks/s, output: 20.10 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:21<00:13, 44.75it/s, est. speed input: 20794.73 toks/s, output: 20.31 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:21<00:12, 44.77it/s, est. speed input: 21002.68 toks/s, output: 20.51 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:21<00:12, 44.74it/s, est. speed input: 21206.59 toks/s, output: 20.71 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:21<00:12, 44.76it/s, est. speed input: 21407.61 toks/s, output: 20.91 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:22<00:12, 44.74it/s, est. speed input: 21605.02 toks/s, output: 21.10 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:22<00:12, 44.73it/s, est. speed input: 21799.31 toks/s, output: 21.29 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:22<00:12, 44.74it/s, est. speed input: 21990.79 toks/s, output: 21.48 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:22<00:11, 44.75it/s, est. speed input: 22179.23 toks/s, output: 21.66 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:22<00:11, 44.74it/s, est. speed input: 22364.42 toks/s, output: 21.84 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:22<00:11, 44.73it/s, est. speed input: 22546.78 toks/s, output: 22.02 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:23<00:11, 44.74it/s, est. speed input: 22726.43 toks/s, output: 22.19 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:23<00:11, 44.74it/s, est. speed input: 22903.30 toks/s, output: 22.37 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:23<00:11, 44.71it/s, est. speed input: 23077.16 toks/s, output: 22.54 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:23<00:10, 44.72it/s, est. speed input: 23248.71 toks/s, output: 22.70 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:23<00:10, 44.70it/s, est. speed input: 23417.41 toks/s, output: 22.87 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:24<00:10, 44.72it/s, est. speed input: 23584.01 toks/s, output: 23.03 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:24<00:10, 44.71it/s, est. speed input: 23747.83 toks/s, output: 23.19 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:24<00:10, 44.70it/s, est. speed input: 23909.17 toks/s, output: 23.35 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:24<00:09, 44.71it/s, est. speed input: 24068.51 toks/s, output: 23.50 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:24<00:09, 44.72it/s, est. speed input: 24225.47 toks/s, output: 23.66 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:24<00:09, 44.70it/s, est. speed input: 24379.89 toks/s, output: 23.81 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:25<00:09, 44.71it/s, est. speed input: 24532.40 toks/s, output: 23.96 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:25<00:09, 44.71it/s, est. speed input: 24682.58 toks/s, output: 24.10 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:25<00:09, 44.71it/s, est. speed input: 24830.75 toks/s, output: 24.25 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:25<00:08, 44.73it/s, est. speed input: 24977.06 toks/s, output: 24.39 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:25<00:08, 44.72it/s, est. speed input: 25121.02 toks/s, output: 24.53 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:26<00:08, 44.71it/s, est. speed input: 25263.06 toks/s, output: 24.67 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:26<00:08, 44.71it/s, est. speed input: 25403.14 toks/s, output: 24.81 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:26<00:08, 44.71it/s, est. speed input: 25541.41 toks/s, output: 24.94 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:26<00:08, 44.72it/s, est. speed input: 25677.85 toks/s, output: 25.08 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:26<00:07, 44.72it/s, est. speed input: 25812.47 toks/s, output: 25.21 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:26<00:07, 44.72it/s, est. speed input: 25945.30 toks/s, output: 25.34 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:27<00:07, 44.73it/s, est. speed input: 26076.49 toks/s, output: 25.47 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:27<00:07, 44.66it/s, est. speed input: 26204.87 toks/s, output: 25.59 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:27<00:07, 44.59it/s, est. speed input: 26331.40 toks/s, output: 25.71 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:27<00:06, 44.54it/s, est. speed input: 26456.29 toks/s, output: 25.84 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:27<00:06, 44.53it/s, est. speed input: 26579.75 toks/s, output: 25.96 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:27<00:06, 44.48it/s, est. speed input: 26701.19 toks/s, output: 26.08 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:28<00:06, 44.48it/s, est. speed input: 26821.45 toks/s, output: 26.19 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:28<00:06, 44.46it/s, est. speed input: 26940.01 toks/s, output: 26.31 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:28<00:06, 44.44it/s, est. speed input: 27057.02 toks/s, output: 26.42 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:28<00:05, 44.45it/s, est. speed input: 27172.77 toks/s, output: 26.54 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:28<00:05, 44.42it/s, est. speed input: 27286.61 toks/s, output: 26.65 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:29<00:05, 44.43it/s, est. speed input: 27399.49 toks/s, output: 26.76 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:29<00:05, 44.44it/s, est. speed input: 27511.01 toks/s, output: 26.87 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:29<00:05, 44.39it/s, est. speed input: 27620.39 toks/s, output: 26.97 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:29<00:05, 44.39it/s, est. speed input: 27728.96 toks/s, output: 27.08 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:29<00:04, 44.40it/s, est. speed input: 27836.23 toks/s, output: 27.18 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:29<00:04, 44.36it/s, est. speed input: 27941.74 toks/s, output: 27.29 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:30<00:04, 44.39it/s, est. speed input: 28046.64 toks/s, output: 27.39 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:30<00:04, 44.40it/s, est. speed input: 28150.14 toks/s, output: 27.49 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:30<00:04, 44.39it/s, est. speed input: 28252.26 toks/s, output: 27.59 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:30<00:03, 44.40it/s, est. speed input: 28353.40 toks/s, output: 27.69 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:30<00:03, 44.39it/s, est. speed input: 28453.13 toks/s, output: 27.79 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:31<00:03, 44.39it/s, est. speed input: 28551.79 toks/s, output: 27.88 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:31<00:03, 44.39it/s, est. speed input: 28649.26 toks/s, output: 27.98 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:31<00:03, 44.37it/s, est. speed input: 28745.41 toks/s, output: 28.07 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:31<00:03, 44.39it/s, est. speed input: 28840.85 toks/s, output: 28.16 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:31<00:02, 44.39it/s, est. speed input: 28935.07 toks/s, output: 28.26 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:31<00:02, 44.37it/s, est. speed input: 29028.05 toks/s, output: 28.35 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:32<00:02, 44.36it/s, est. speed input: 29119.89 toks/s, output: 28.44 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:32<00:02, 44.34it/s, est. speed input: 29210.68 toks/s, output: 28.53 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:32<00:02, 44.36it/s, est. speed input: 29300.83 toks/s, output: 28.61 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:32<00:01, 44.36it/s, est. speed input: 29389.76 toks/s, output: 28.70 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:32<00:01, 44.33it/s, est. speed input: 29477.48 toks/s, output: 28.79 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:33<00:01, 44.35it/s, est. speed input: 29564.55 toks/s, output: 28.87 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:33<00:01, 44.35it/s, est. speed input: 29650.61 toks/s, output: 28.96 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:33<00:01, 44.34it/s, est. speed input: 29735.68 toks/s, output: 29.04 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:33<00:01, 44.32it/s, est. speed input: 29819.62 toks/s, output: 29.12 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:33<00:00, 45.96it/s, est. speed input: 29921.83 toks/s, output: 29.22 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:33<00:00, 45.43it/s, est. speed input: 30003.80 toks/s, output: 29.30 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:34<00:00, 45.07it/s, est. speed input: 30084.97 toks/s, output: 29.38 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:34<00:00, 44.86it/s, est. speed input: 30165.66 toks/s, output: 29.46 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:34<00:00, 46.53it/s, est. speed input: 30266.09 toks/s, output: 29.56 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:34<00:00, 46.53it/s, est. speed input: 30444.23 toks/s, output: 29.73 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:34<00:00, 29.73it/s, est. speed input: 30444.23 toks/s, output: 29.73 toks/s]
[rank0]:[W128 09:41:48.129245977 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 458.6s

测试结果:
  Requests/s:   28.36
  Tokens/s:     29071.23
  Total Reqs:   1024
  Elapsed:      36.10s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     29042.87

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:44:34 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:44:35 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=893471) WARNING 01-28 09:46:00 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=893471) WARNING 01-28 09:46:50 [backends.py:609] Failed to read file <frozen os>
Throughput: 39.29 requests/s, 40276.26 total tokens/s, 39.29 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 09:44:23] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:44:34] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:44:34] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:44:34] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:44:34] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:44:34] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:44:34] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:44:34] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:44:34] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:44:34] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:44:34] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:44:34] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:44:34] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:44:34] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:45:00] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:45:23] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:45:23] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:45:23] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:45:23] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:45:23] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:45:23] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:45:23] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:45:23] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:45:23] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:45:23] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:45:23] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:45:23] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:45:23] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=893471) [2026-01-28 09:46:04] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=893471) [2026-01-28 09:46:04] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=893471) [2026-01-28 09:46:04] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=893471) [2026-01-28 09:46:04] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=893471) [2026-01-28 09:46:04] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=893471) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=893471) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.43it/s]
(EngineCore_DP0 pid=893471) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.43it/s]
(EngineCore_DP0 pid=893471) 
(EngineCore_DP0 pid=893471) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:00<00:05,  1.14it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:02<00:05,  1.08s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:04<00:07,  1.89s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:06<00:05,  1.74s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:11<00:05,  2.75s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:13<00:02,  2.55s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:14<00:00,  2.05s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:14<00:00,  2.03s/it]
(EngineCore_DP0 pid=893471) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:00<00:01,  3.80it/s]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:01<00:01,  1.59it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:01<00:00,  2.28it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:01<00:00,  2.66it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:01<00:00,  3.15it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:01<00:00,  2.70it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 36/2048 [00:00<00:05, 352.40it/s]
Adding requests:   4%|▎         | 75/2048 [00:00<00:05, 369.16it/s]
Adding requests:   5%|▌         | 112/2048 [00:00<00:05, 368.91it/s]
Adding requests:   7%|▋         | 149/2048 [00:00<00:05, 364.76it/s]
Adding requests:   9%|▉         | 186/2048 [00:00<00:05, 366.54it/s]
Adding requests:  11%|█         | 224/2048 [00:00<00:04, 370.21it/s]
Adding requests:  13%|█▎        | 262/2048 [00:00<00:04, 367.86it/s]
Adding requests:  15%|█▍        | 299/2048 [00:00<00:04, 367.58it/s]
Adding requests:  16%|█▋        | 336/2048 [00:00<00:04, 366.30it/s]
Adding requests:  18%|█▊        | 373/2048 [00:01<00:04, 365.76it/s]
Adding requests:  20%|██        | 410/2048 [00:01<00:04, 366.80it/s]
Adding requests:  22%|██▏       | 448/2048 [00:01<00:04, 368.64it/s]
Adding requests:  24%|██▎       | 485/2048 [00:01<00:04, 368.18it/s]
Adding requests:  25%|██▌       | 522/2048 [00:01<00:04, 362.23it/s]
Adding requests:  27%|██▋       | 561/2048 [00:01<00:04, 368.11it/s]
Adding requests:  29%|██▉       | 599/2048 [00:01<00:03, 370.11it/s]
Adding requests:  31%|███       | 638/2048 [00:01<00:03, 375.14it/s]
Adding requests:  33%|███▎      | 677/2048 [00:01<00:03, 377.25it/s]
Adding requests:  35%|███▍      | 716/2048 [00:01<00:03, 380.57it/s]
Adding requests:  37%|███▋      | 755/2048 [00:02<00:03, 374.95it/s]
Adding requests:  39%|███▊      | 793/2048 [00:02<00:03, 375.79it/s]
Adding requests:  41%|████      | 831/2048 [00:02<00:03, 373.82it/s]
Adding requests:  42%|████▏     | 870/2048 [00:02<00:03, 378.52it/s]
Adding requests:  44%|████▍     | 911/2048 [00:02<00:02, 384.68it/s]
Adding requests:  46%|████▋     | 951/2048 [00:02<00:02, 386.51it/s]
Adding requests:  48%|████▊     | 991/2048 [00:02<00:02, 387.64it/s]
Adding requests:  50%|█████     | 1031/2048 [00:02<00:02, 389.44it/s]
Adding requests:  52%|█████▏    | 1070/2048 [00:02<00:02, 387.45it/s]
Adding requests:  54%|█████▍    | 1109/2048 [00:02<00:02, 385.96it/s]
Adding requests:  56%|█████▌    | 1148/2048 [00:03<00:02, 380.55it/s]
Adding requests:  58%|█████▊    | 1188/2048 [00:03<00:02, 384.44it/s]
Adding requests:  60%|█████▉    | 1228/2048 [00:03<00:02, 386.81it/s]
Adding requests:  62%|██████▏   | 1267/2048 [00:03<00:02, 382.74it/s]
Adding requests:  64%|██████▍   | 1306/2048 [00:03<00:01, 381.12it/s]
Adding requests:  66%|██████▌   | 1346/2048 [00:03<00:01, 383.69it/s]
Adding requests:  68%|██████▊   | 1385/2048 [00:03<00:01, 383.37it/s]
Adding requests:  70%|██████▉   | 1424/2048 [00:03<00:01, 385.03it/s]
Adding requests:  71%|███████▏  | 1463/2048 [00:03<00:01, 380.51it/s]
Adding requests:  73%|███████▎  | 1502/2048 [00:03<00:01, 382.52it/s]
Adding requests:  75%|███████▌  | 1541/2048 [00:04<00:01, 383.81it/s]
Adding requests:  77%|███████▋  | 1580/2048 [00:04<00:01, 383.14it/s]
Adding requests:  79%|███████▉  | 1619/2048 [00:04<00:01, 379.34it/s]
Adding requests:  81%|████████  | 1657/2048 [00:04<00:01, 373.84it/s]
Adding requests:  83%|████████▎ | 1695/2048 [00:04<00:00, 370.47it/s]
Adding requests:  85%|████████▍ | 1735/2048 [00:04<00:00, 377.56it/s]
Adding requests:  87%|████████▋ | 1773/2048 [00:04<00:00, 377.04it/s]
Adding requests:  89%|████████▊ | 1814/2048 [00:04<00:00, 384.29it/s]
Adding requests:  90%|█████████ | 1853/2048 [00:04<00:00, 380.35it/s]
Adding requests:  92%|█████████▏| 1892/2048 [00:05<00:00, 378.14it/s]
Adding requests:  94%|█████████▍| 1930/2048 [00:05<00:00, 371.95it/s]
Adding requests:  96%|█████████▌| 1968/2048 [00:05<00:00, 358.22it/s]
Adding requests:  98%|█████████▊| 2007/2048 [00:05<00:00, 364.61it/s]
Adding requests: 100%|█████████▉| 2044/2048 [00:05<00:00, 364.67it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 375.41it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/2048 [00:00<05:35,  6.10it/s, est. speed input: 6251.12 toks/s, output: 6.10 toks/s]
Processed prompts:   1%|          | 18/2048 [00:00<01:09, 29.36it/s, est. speed input: 26679.52 toks/s, output: 26.05 toks/s]
Processed prompts:   2%|▏         | 34/2048 [00:01<00:55, 36.27it/s, est. speed input: 33061.65 toks/s, output: 32.29 toks/s]
Processed prompts:   2%|▏         | 50/2048 [00:01<00:50, 39.43it/s, est. speed input: 36176.01 toks/s, output: 35.33 toks/s]
Processed prompts:   3%|▎         | 66/2048 [00:01<00:48, 41.15it/s, est. speed input: 38019.48 toks/s, output: 37.13 toks/s]
Processed prompts:   4%|▍         | 82/2048 [00:02<00:46, 42.18it/s, est. speed input: 39238.62 toks/s, output: 38.32 toks/s]
Processed prompts:   5%|▍         | 98/2048 [00:02<00:45, 42.82it/s, est. speed input: 40102.36 toks/s, output: 39.16 toks/s]
Processed prompts:   6%|▌         | 114/2048 [00:02<00:44, 43.25it/s, est. speed input: 40750.41 toks/s, output: 39.80 toks/s]
Processed prompts:   6%|▋         | 130/2048 [00:03<00:44, 43.53it/s, est. speed input: 41248.69 toks/s, output: 40.28 toks/s]
Processed prompts:   7%|▋         | 146/2048 [00:03<00:43, 43.70it/s, est. speed input: 41642.88 toks/s, output: 40.67 toks/s]
Processed prompts:   8%|▊         | 162/2048 [00:03<00:43, 43.83it/s, est. speed input: 41967.56 toks/s, output: 40.98 toks/s]
Processed prompts:   9%|▊         | 178/2048 [00:04<00:42, 43.92it/s, est. speed input: 42238.93 toks/s, output: 41.25 toks/s]
Processed prompts:   9%|▉         | 194/2048 [00:04<00:42, 43.94it/s, est. speed input: 42457.26 toks/s, output: 41.46 toks/s]
Processed prompts:  10%|█         | 210/2048 [00:05<00:41, 43.99it/s, est. speed input: 42650.17 toks/s, output: 41.65 toks/s]
Processed prompts:  11%|█         | 226/2048 [00:05<00:41, 44.02it/s, est. speed input: 42817.61 toks/s, output: 41.81 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:05<00:41, 44.04it/s, est. speed input: 42964.09 toks/s, output: 41.96 toks/s]
Processed prompts:  13%|█▎        | 258/2048 [00:06<00:40, 44.04it/s, est. speed input: 43091.72 toks/s, output: 42.08 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:06<00:40, 44.05it/s, est. speed input: 43205.95 toks/s, output: 42.19 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:06<00:39, 44.05it/s, est. speed input: 43306.55 toks/s, output: 42.29 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:07<00:39, 44.05it/s, est. speed input: 43396.34 toks/s, output: 42.38 toks/s]
Processed prompts:  16%|█▌        | 322/2048 [00:07<00:39, 44.05it/s, est. speed input: 43477.95 toks/s, output: 42.46 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:07<00:38, 44.05it/s, est. speed input: 43552.53 toks/s, output: 42.53 toks/s]
Processed prompts:  17%|█▋        | 354/2048 [00:08<00:38, 44.04it/s, est. speed input: 43619.26 toks/s, output: 42.60 toks/s]
Processed prompts:  18%|█▊        | 370/2048 [00:08<00:38, 44.01it/s, est. speed input: 43677.46 toks/s, output: 42.65 toks/s]
Processed prompts:  19%|█▉        | 386/2048 [00:09<00:37, 43.97it/s, est. speed input: 43728.28 toks/s, output: 42.70 toks/s]
Processed prompts:  20%|█▉        | 402/2048 [00:09<00:37, 43.94it/s, est. speed input: 43774.73 toks/s, output: 42.75 toks/s]
Processed prompts:  20%|██        | 418/2048 [00:09<00:37, 43.93it/s, est. speed input: 43818.07 toks/s, output: 42.79 toks/s]
Processed prompts:  21%|██        | 434/2048 [00:10<00:36, 43.91it/s, est. speed input: 43857.96 toks/s, output: 42.83 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:10<00:36, 43.90it/s, est. speed input: 43894.73 toks/s, output: 42.87 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:10<00:36, 43.88it/s, est. speed input: 43928.83 toks/s, output: 42.90 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:11<00:58, 26.90it/s, est. speed input: 41148.11 toks/s, output: 40.18 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:12<00:50, 30.43it/s, est. speed input: 41259.59 toks/s, output: 40.29 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:12<00:45, 33.50it/s, est. speed input: 41364.06 toks/s, output: 40.39 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:13<00:42, 36.05it/s, est. speed input: 41462.17 toks/s, output: 40.49 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:13<00:39, 38.08it/s, est. speed input: 41555.10 toks/s, output: 40.58 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:13<00:37, 39.64it/s, est. speed input: 41642.89 toks/s, output: 40.67 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:14<00:36, 40.81it/s, est. speed input: 41726.06 toks/s, output: 40.75 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:14<00:34, 41.67it/s, est. speed input: 41805.32 toks/s, output: 40.83 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:14<00:34, 42.29it/s, est. speed input: 41880.44 toks/s, output: 40.90 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:15<00:33, 42.78it/s, est. speed input: 41954.78 toks/s, output: 40.97 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:15<00:32, 43.05it/s, est. speed input: 42020.57 toks/s, output: 41.04 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:16<00:32, 43.32it/s, est. speed input: 42088.25 toks/s, output: 41.10 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:16<00:31, 43.43it/s, est. speed input: 42148.07 toks/s, output: 41.16 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:16<00:31, 43.56it/s, est. speed input: 42207.80 toks/s, output: 41.22 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:17<00:30, 43.64it/s, est. speed input: 42265.36 toks/s, output: 41.27 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:17<00:30, 43.77it/s, est. speed input: 42324.95 toks/s, output: 41.33 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:17<00:29, 43.67it/s, est. speed input: 42369.13 toks/s, output: 41.38 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:18<00:29, 43.85it/s, est. speed input: 42427.95 toks/s, output: 41.43 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:18<00:29, 43.97it/s, est. speed input: 42484.54 toks/s, output: 41.49 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:18<00:28, 44.04it/s, est. speed input: 42537.93 toks/s, output: 41.54 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:19<00:28, 44.10it/s, est. speed input: 42589.63 toks/s, output: 41.59 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:19<00:27, 44.19it/s, est. speed input: 42642.03 toks/s, output: 41.64 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:20<00:27, 44.17it/s, est. speed input: 42688.37 toks/s, output: 41.69 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:20<00:27, 44.19it/s, est. speed input: 42734.54 toks/s, output: 41.73 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:20<00:26, 44.20it/s, est. speed input: 42779.27 toks/s, output: 41.78 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:21<00:26, 44.24it/s, est. speed input: 42824.09 toks/s, output: 41.82 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:21<00:26, 44.21it/s, est. speed input: 42863.98 toks/s, output: 41.86 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:21<00:25, 44.24it/s, est. speed input: 42905.55 toks/s, output: 41.90 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:22<00:25, 44.19it/s, est. speed input: 42942.25 toks/s, output: 41.94 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:22<00:24, 44.18it/s, est. speed input: 42978.47 toks/s, output: 41.97 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:22<00:24, 44.17it/s, est. speed input: 43013.81 toks/s, output: 42.01 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:23<00:23, 44.94it/s, est. speed input: 43086.52 toks/s, output: 42.08 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:23<00:23, 44.71it/s, est. speed input: 43119.53 toks/s, output: 42.11 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:23<00:23, 44.54it/s, est. speed input: 43151.09 toks/s, output: 42.14 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:24<00:23, 44.41it/s, est. speed input: 43181.16 toks/s, output: 42.17 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:24<00:22, 44.33it/s, est. speed input: 43210.73 toks/s, output: 42.20 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:25<00:22, 44.06it/s, est. speed input: 43229.72 toks/s, output: 42.22 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:25<00:22, 43.98it/s, est. speed input: 43252.80 toks/s, output: 42.24 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:25<00:21, 44.06it/s, est. speed input: 43281.88 toks/s, output: 42.27 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:26<00:21, 44.12it/s, est. speed input: 43309.87 toks/s, output: 42.29 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:26<00:20, 44.15it/s, est. speed input: 43336.66 toks/s, output: 42.32 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:26<00:20, 44.17it/s, est. speed input: 43363.03 toks/s, output: 42.35 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:27<00:19, 44.95it/s, est. speed input: 43421.20 toks/s, output: 42.40 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:27<00:19, 44.72it/s, est. speed input: 43445.32 toks/s, output: 42.43 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:27<00:19, 44.56it/s, est. speed input: 43468.72 toks/s, output: 42.45 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:28<00:19, 44.44it/s, est. speed input: 43491.33 toks/s, output: 42.47 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:28<00:18, 44.35it/s, est. speed input: 43512.80 toks/s, output: 42.49 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:29<00:18, 44.29it/s, est. speed input: 43534.16 toks/s, output: 42.51 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:29<00:18, 44.28it/s, est. speed input: 43555.99 toks/s, output: 42.54 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:29<00:17, 44.19it/s, est. speed input: 43574.07 toks/s, output: 42.55 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:30<00:17, 44.19it/s, est. speed input: 43594.04 toks/s, output: 42.57 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:30<00:16, 44.16it/s, est. speed input: 43612.80 toks/s, output: 42.59 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:30<00:16, 44.15it/s, est. speed input: 43631.21 toks/s, output: 42.61 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:31<00:16, 44.13it/s, est. speed input: 43648.65 toks/s, output: 42.63 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:31<00:15, 44.11it/s, est. speed input: 43665.63 toks/s, output: 42.64 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:31<00:15, 44.10it/s, est. speed input: 43682.22 toks/s, output: 42.66 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:32<00:15, 43.62it/s, est. speed input: 43680.74 toks/s, output: 42.66 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:32<00:15, 43.29it/s, est. speed input: 43679.57 toks/s, output: 42.66 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:33<00:14, 43.06it/s, est. speed input: 43678.04 toks/s, output: 42.65 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:33<00:14, 43.08it/s, est. speed input: 43683.26 toks/s, output: 42.66 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:33<00:14, 43.22it/s, est. speed input: 43693.28 toks/s, output: 42.67 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:34<00:13, 43.31it/s, est. speed input: 43702.67 toks/s, output: 42.68 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:34<00:13, 43.37it/s, est. speed input: 43711.84 toks/s, output: 42.69 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:34<00:12, 43.42it/s, est. speed input: 43720.84 toks/s, output: 42.70 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:35<00:12, 43.45it/s, est. speed input: 43729.63 toks/s, output: 42.70 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:35<00:12, 43.47it/s, est. speed input: 43738.30 toks/s, output: 42.71 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:36<00:11, 43.49it/s, est. speed input: 43746.90 toks/s, output: 42.72 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:36<00:11, 43.50it/s, est. speed input: 43755.25 toks/s, output: 42.73 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:36<00:10, 43.49it/s, est. speed input: 43762.81 toks/s, output: 42.74 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:37<00:10, 43.50it/s, est. speed input: 43770.69 toks/s, output: 42.74 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:37<00:10, 43.47it/s, est. speed input: 43777.41 toks/s, output: 42.75 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:37<00:09, 43.46it/s, est. speed input: 43784.23 toks/s, output: 42.76 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:38<00:09, 43.48it/s, est. speed input: 43791.64 toks/s, output: 42.77 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:38<00:09, 43.48it/s, est. speed input: 43798.58 toks/s, output: 42.77 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:38<00:08, 43.51it/s, est. speed input: 43806.42 toks/s, output: 42.78 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:39<00:08, 43.46it/s, est. speed input: 43811.96 toks/s, output: 42.79 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:39<00:08, 43.47it/s, est. speed input: 43818.59 toks/s, output: 42.79 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:40<00:07, 43.47it/s, est. speed input: 43824.97 toks/s, output: 42.80 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:40<00:07, 43.46it/s, est. speed input: 43830.90 toks/s, output: 42.80 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:40<00:06, 43.45it/s, est. speed input: 43836.84 toks/s, output: 42.81 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:41<00:06, 43.46it/s, est. speed input: 43842.94 toks/s, output: 42.82 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:41<00:06, 43.34it/s, est. speed input: 43845.33 toks/s, output: 42.82 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:41<00:05, 43.25it/s, est. speed input: 43847.41 toks/s, output: 42.82 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:42<00:05, 43.20it/s, est. speed input: 43849.73 toks/s, output: 42.82 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:42<00:05, 43.14it/s, est. speed input: 43851.44 toks/s, output: 42.82 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:43<00:04, 43.12it/s, est. speed input: 43853.42 toks/s, output: 42.83 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:43<00:04, 43.09it/s, est. speed input: 43855.33 toks/s, output: 42.83 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:43<00:03, 43.78it/s, est. speed input: 43877.13 toks/s, output: 42.85 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:44<00:06, 25.72it/s, est. speed input: 43049.70 toks/s, output: 42.04 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:45<00:04, 29.25it/s, est. speed input: 43058.06 toks/s, output: 42.05 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:45<00:03, 32.36it/s, est. speed input: 43066.34 toks/s, output: 42.06 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:46<00:03, 34.96it/s, est. speed input: 43074.30 toks/s, output: 42.06 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:46<00:02, 37.04it/s, est. speed input: 43082.28 toks/s, output: 42.07 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:46<00:02, 38.65it/s, est. speed input: 43089.81 toks/s, output: 42.08 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:47<00:01, 39.87it/s, est. speed input: 43097.54 toks/s, output: 42.09 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:47<00:01, 40.77it/s, est. speed input: 43105.13 toks/s, output: 42.09 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:47<00:00, 41.42it/s, est. speed input: 43112.63 toks/s, output: 42.10 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:48<00:00, 42.71it/s, est. speed input: 43141.79 toks/s, output: 42.13 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:48<00:00, 42.71it/s, est. speed input: 43438.40 toks/s, output: 42.42 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:48<00:00, 42.42it/s, est. speed input: 43438.40 toks/s, output: 42.42 toks/s]
[rank0]:[W128 09:49:05.517918850 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 393.7s

测试结果:
  Requests/s:   39.29
  Tokens/s:     40276.26
  Total Reqs:   2048
  Elapsed:      52.12s

  [Prefill 分析]
  Total Prefill Tokens: 2097152
  Prefill Tokens/s:     40236.97

============================================================
[7/7] 测试 M=32768
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuBLASLt                                        │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 32768
│   M_prefill     = 32768 (= 32 x 1024)
│   M_decode      = 32
│   batched_tokens = 32768 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 4096
│   --max-num-seqs           = 32
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 32768
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:51:14 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:51:15 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=896689) WARNING 01-28 09:53:40 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=896689) WARNING 01-28 09:54:24 [backends.py:609] Failed to read file <frozen os>
Throughput: 39.22 requests/s, 40202.02 total tokens/s, 39.22 output tokens/s
Total num prompt tokens:  4194304
Total num output tokens:  4096


─── STDERR ───
[2026-01-28 09:51:10] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:51:14] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:51:14] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:51:14] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:51:14] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:51:14] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:51:14] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:51:14] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:51:14] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:51:14] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:51:14] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:51:14] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:51:14] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:51:14] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:52:08] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:52:32] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:52:32] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:52:32] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:52:32] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:52:32] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:52:32] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:52:32] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:52:32] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:52:32] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:52:32] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:52:32] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:52:32] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:52:32] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=896689) [2026-01-28 09:53:56] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuBLASLt)
(EngineCore_DP0 pid=896689) [2026-01-28 09:53:56] INFO gemm_wrapper.py:870: cublaslt GEMM extension loaded: cublaslt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=896689) [2026-01-28 09:53:56] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuBLASLt)
(EngineCore_DP0 pid=896689) [2026-01-28 09:53:56] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=896689) [2026-01-28 09:53:56] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuBLASLt
(EngineCore_DP0 pid=896689) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=896689) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.63it/s]
(EngineCore_DP0 pid=896689) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.63it/s]
(EngineCore_DP0 pid=896689) 
(EngineCore_DP0 pid=896689) [rank0]:W0128 09:54:32.363000 896689 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=896689) [rank0]:W0128 09:54:32.469000 896689 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=896689) [rank0]:W0128 09:54:34.905000 896689 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=896689) [rank0]:W0128 09:54:35.083000 896689 torch/_inductor/codegen/triton_combo_kernel.py:110] ComboKernels: 1 large pointwise nodes are separated
(EngineCore_DP0 pid=896689) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/11 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   9%|▉         | 1/11 [00:01<00:16,  1.66s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  18%|█▊        | 2/11 [00:05<00:24,  2.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  27%|██▋       | 3/11 [00:11<00:33,  4.17s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  36%|███▋      | 4/11 [00:13<00:25,  3.57s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  45%|████▌     | 5/11 [00:16<00:19,  3.31s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  55%|█████▍    | 6/11 [00:20<00:17,  3.47s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  64%|██████▎   | 7/11 [00:23<00:12,  3.24s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  73%|███████▎  | 8/11 [00:24<00:07,  2.55s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  82%|████████▏ | 9/11 [00:27<00:05,  2.79s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  91%|█████████ | 10/11 [00:28<00:02,  2.27s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:29<00:00,  1.92s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 11/11 [00:29<00:00,  2.70s/it]
(EngineCore_DP0 pid=896689) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  14%|█▍        | 1/7 [00:01<00:07,  1.32s/it]
Capturing CUDA graphs (decode, FULL):  29%|██▊       | 2/7 [00:02<00:05,  1.20s/it]
Capturing CUDA graphs (decode, FULL):  43%|████▎     | 3/7 [00:03<00:05,  1.25s/it]
Capturing CUDA graphs (decode, FULL):  57%|█████▋    | 4/7 [00:05<00:04,  1.34s/it]
Capturing CUDA graphs (decode, FULL):  71%|███████▏  | 5/7 [00:06<00:02,  1.19s/it]
Capturing CUDA graphs (decode, FULL):  86%|████████▌ | 6/7 [00:07<00:01,  1.14s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:07<00:00,  1.09it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 7/7 [00:07<00:00,  1.09s/it]

Adding requests:   0%|          | 0/4096 [00:00<?, ?it/s]
Adding requests:   1%|          | 35/4096 [00:00<00:11, 344.47it/s]
Adding requests:   2%|▏         | 73/4096 [00:00<00:11, 361.91it/s]
Adding requests:   3%|▎         | 110/4096 [00:00<00:10, 365.37it/s]
Adding requests:   4%|▎         | 147/4096 [00:00<00:10, 363.07it/s]
Adding requests:   4%|▍         | 184/4096 [00:00<00:10, 364.16it/s]
Adding requests:   5%|▌         | 221/4096 [00:00<00:10, 363.75it/s]
Adding requests:   6%|▋         | 261/4096 [00:00<00:10, 373.46it/s]
Adding requests:   7%|▋         | 299/4096 [00:00<00:10, 374.16it/s]
Adding requests:   8%|▊         | 337/4096 [00:00<00:10, 373.56it/s]
Adding requests:   9%|▉         | 376/4096 [00:01<00:09, 376.98it/s]
Adding requests:  10%|█         | 414/4096 [00:01<00:09, 375.55it/s]
Adding requests:  11%|█         | 453/4096 [00:01<00:09, 379.59it/s]
Adding requests:  12%|█▏        | 492/4096 [00:01<00:09, 381.34it/s]
Adding requests:  13%|█▎        | 531/4096 [00:01<00:09, 370.74it/s]
Adding requests:  14%|█▍        | 572/4096 [00:01<00:09, 380.16it/s]
Adding requests:  15%|█▍        | 611/4096 [00:01<00:09, 381.17it/s]
Adding requests:  16%|█▌        | 651/4096 [00:01<00:08, 386.61it/s]
Adding requests:  17%|█▋        | 692/4096 [00:01<00:08, 393.25it/s]
Adding requests:  18%|█▊        | 732/4096 [00:01<00:08, 376.24it/s]
Adding requests:  19%|█▉        | 770/4096 [00:02<00:08, 372.73it/s]
Adding requests:  20%|█▉        | 808/4096 [00:02<00:08, 371.06it/s]
Adding requests:  21%|██        | 846/4096 [00:02<00:08, 373.45it/s]
Adding requests:  22%|██▏       | 887/4096 [00:02<00:08, 383.67it/s]
Adding requests:  23%|██▎       | 928/4096 [00:02<00:08, 389.42it/s]
Adding requests:  24%|██▎       | 968/4096 [00:02<00:07, 391.85it/s]
Adding requests:  25%|██▍       | 1008/4096 [00:02<00:07, 390.07it/s]
Adding requests:  26%|██▌       | 1049/4096 [00:02<00:07, 395.46it/s]
Adding requests:  27%|██▋       | 1089/4096 [00:02<00:07, 394.23it/s]
Adding requests:  28%|██▊       | 1129/4096 [00:02<00:07, 379.91it/s]
Adding requests:  29%|██▊       | 1171/4096 [00:03<00:07, 389.40it/s]
Adding requests:  30%|██▉       | 1214/4096 [00:03<00:07, 398.99it/s]
Adding requests:  31%|███       | 1254/4096 [00:03<00:07, 393.29it/s]
Adding requests:  32%|███▏      | 1294/4096 [00:03<00:07, 394.76it/s]
Adding requests:  33%|███▎      | 1335/4096 [00:03<00:06, 397.81it/s]
Adding requests:  34%|███▎      | 1376/4096 [00:03<00:06, 399.29it/s]
Adding requests:  35%|███▍      | 1417/4096 [00:03<00:06, 400.64it/s]
Adding requests:  36%|███▌      | 1459/4096 [00:03<00:06, 404.96it/s]
Adding requests:  37%|███▋      | 1501/4096 [00:03<00:06, 408.25it/s]
Adding requests:  38%|███▊      | 1542/4096 [00:04<00:06, 406.23it/s]
Adding requests:  39%|███▊      | 1583/4096 [00:04<00:06, 405.84it/s]
Adding requests:  40%|███▉      | 1624/4096 [00:04<00:06, 404.38it/s]
Adding requests:  41%|████      | 1665/4096 [00:04<00:06, 402.04it/s]
Adding requests:  42%|████▏     | 1706/4096 [00:04<00:05, 402.03it/s]
Adding requests:  43%|████▎     | 1747/4096 [00:04<00:05, 401.67it/s]
Adding requests:  44%|████▎     | 1788/4096 [00:04<00:05, 402.20it/s]
Adding requests:  45%|████▍     | 1829/4096 [00:04<00:05, 397.89it/s]
Adding requests:  46%|████▌     | 1869/4096 [00:04<00:05, 398.34it/s]
Adding requests:  47%|████▋     | 1909/4096 [00:04<00:05, 398.28it/s]
Adding requests:  48%|████▊     | 1950/4096 [00:05<00:05, 401.23it/s]
Adding requests:  49%|████▊     | 1991/4096 [00:05<00:05, 401.55it/s]
Adding requests:  50%|████▉     | 2032/4096 [00:05<00:05, 402.93it/s]
Adding requests:  51%|█████     | 2073/4096 [00:05<00:05, 398.67it/s]
Adding requests:  52%|█████▏    | 2113/4096 [00:05<00:05, 392.63it/s]
Adding requests:  53%|█████▎    | 2153/4096 [00:05<00:05, 384.12it/s]
Adding requests:  54%|█████▎    | 2192/4096 [00:05<00:04, 381.50it/s]
Adding requests:  54%|█████▍    | 2231/4096 [00:05<00:04, 380.86it/s]
Adding requests:  55%|█████▌    | 2270/4096 [00:05<00:04, 365.23it/s]
Adding requests:  56%|█████▋    | 2310/4096 [00:05<00:04, 373.24it/s]
Adding requests:  57%|█████▋    | 2348/4096 [00:06<00:04, 359.79it/s]
Adding requests:  58%|█████▊    | 2388/4096 [00:06<00:04, 368.29it/s]
Adding requests:  59%|█████▉    | 2428/4096 [00:06<00:04, 376.10it/s]
Adding requests:  60%|██████    | 2467/4096 [00:06<00:04, 379.97it/s]
Adding requests:  61%|██████    | 2506/4096 [00:06<00:04, 375.79it/s]
Adding requests:  62%|██████▏   | 2544/4096 [00:06<00:04, 373.73it/s]
Adding requests:  63%|██████▎   | 2582/4096 [00:06<00:04, 373.27it/s]
Adding requests:  64%|██████▍   | 2620/4096 [00:06<00:03, 369.48it/s]
Adding requests:  65%|██████▍   | 2658/4096 [00:06<00:03, 372.08it/s]
Adding requests:  66%|██████▌   | 2696/4096 [00:07<00:03, 364.42it/s]
Adding requests:  67%|██████▋   | 2733/4096 [00:07<00:03, 365.26it/s]
Adding requests:  68%|██████▊   | 2770/4096 [00:07<00:03, 365.50it/s]
Adding requests:  69%|██████▊   | 2807/4096 [00:07<00:03, 346.39it/s]
Adding requests:  69%|██████▉   | 2842/4096 [00:07<00:03, 346.42it/s]
Adding requests:  70%|███████   | 2879/4096 [00:07<00:03, 351.26it/s]
Adding requests:  71%|███████   | 2915/4096 [00:07<00:03, 352.30it/s]
Adding requests:  72%|███████▏  | 2951/4096 [00:07<00:03, 351.04it/s]
Adding requests:  73%|███████▎  | 2988/4096 [00:07<00:03, 356.30it/s]
Adding requests:  74%|███████▍  | 3024/4096 [00:07<00:03, 356.43it/s]
Adding requests:  75%|███████▍  | 3060/4096 [00:08<00:02, 353.87it/s]
Adding requests:  76%|███████▌  | 3096/4096 [00:08<00:02, 355.29it/s]
Adding requests:  76%|███████▋  | 3132/4096 [00:08<00:02, 356.36it/s]
Adding requests:  77%|███████▋  | 3168/4096 [00:08<00:02, 353.13it/s]
Adding requests:  78%|███████▊  | 3204/4096 [00:08<00:02, 351.36it/s]
Adding requests:  79%|███████▉  | 3240/4096 [00:08<00:02, 353.31it/s]
Adding requests:  80%|███████▉  | 3276/4096 [00:08<00:02, 354.71it/s]
Adding requests:  81%|████████  | 3313/4096 [00:08<00:02, 358.21it/s]
Adding requests:  82%|████████▏ | 3350/4096 [00:08<00:02, 359.19it/s]
Adding requests:  83%|████████▎ | 3387/4096 [00:08<00:01, 359.46it/s]
Adding requests:  84%|████████▎ | 3425/4096 [00:09<00:01, 363.96it/s]
Adding requests:  85%|████████▍ | 3462/4096 [00:09<00:01, 357.23it/s]
Adding requests:  85%|████████▌ | 3498/4096 [00:09<00:01, 355.36it/s]
Adding requests:  86%|████████▋ | 3534/4096 [00:09<00:01, 355.46it/s]
Adding requests:  87%|████████▋ | 3570/4096 [00:09<00:01, 356.52it/s]
Adding requests:  88%|████████▊ | 3606/4096 [00:09<00:01, 355.24it/s]
Adding requests:  89%|████████▉ | 3642/4096 [00:09<00:01, 353.20it/s]
Adding requests:  90%|████████▉ | 3679/4096 [00:09<00:01, 357.10it/s]
Adding requests:  91%|█████████ | 3715/4096 [00:09<00:01, 341.89it/s]
Adding requests:  92%|█████████▏| 3751/4096 [00:10<00:00, 345.77it/s]
Adding requests:  93%|█████████▎| 3789/4096 [00:10<00:00, 355.57it/s]
Adding requests:  93%|█████████▎| 3826/4096 [00:10<00:00, 358.05it/s]
Adding requests:  94%|█████████▍| 3862/4096 [00:11<00:02, 89.65it/s] 
Adding requests:  95%|█████████▌| 3898/4096 [00:11<00:01, 115.06it/s]
Adding requests:  96%|█████████▌| 3935/4096 [00:11<00:01, 145.06it/s]
Adding requests:  97%|█████████▋| 3972/4096 [00:11<00:00, 177.14it/s]
Adding requests:  98%|█████████▊| 4008/4096 [00:11<00:00, 208.31it/s]
Adding requests:  99%|█████████▊| 4043/4096 [00:11<00:00, 235.86it/s]
Adding requests: 100%|█████████▉| 4077/4096 [00:11<00:00, 258.66it/s]
Adding requests: 100%|██████████| 4096/4096 [00:11<00:00, 341.78it/s]

Processed prompts:   0%|          | 0/4096 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/4096 [00:01<42:26,  1.61it/s, est. speed input: 1646.24 toks/s, output: 1.61 toks/s]
Processed prompts:   1%|          | 34/4096 [00:01<03:15, 20.73it/s, est. speed input: 17542.88 toks/s, output: 17.13 toks/s]
Processed prompts:   2%|▏         | 66/4096 [00:02<02:14, 29.93it/s, est. speed input: 24966.05 toks/s, output: 24.38 toks/s]
Processed prompts:   2%|▏         | 98/4096 [00:03<01:53, 35.07it/s, est. speed input: 29261.46 toks/s, output: 28.58 toks/s]
Processed prompts:   3%|▎         | 130/4096 [00:04<01:43, 38.26it/s, est. speed input: 32089.53 toks/s, output: 31.34 toks/s]
Processed prompts:   4%|▍         | 162/4096 [00:04<01:37, 40.28it/s, est. speed input: 34077.95 toks/s, output: 33.28 toks/s]
Processed prompts:   5%|▍         | 194/4096 [00:05<01:33, 41.62it/s, est. speed input: 35556.57 toks/s, output: 34.72 toks/s]
Processed prompts:   6%|▌         | 226/4096 [00:06<01:31, 42.51it/s, est. speed input: 36695.47 toks/s, output: 35.84 toks/s]
Processed prompts:   6%|▋         | 258/4096 [00:07<01:29, 43.10it/s, est. speed input: 37597.20 toks/s, output: 36.72 toks/s]
Processed prompts:   7%|▋         | 290/4096 [00:07<01:27, 43.50it/s, est. speed input: 38330.78 toks/s, output: 37.43 toks/s]
Processed prompts:   8%|▊         | 322/4096 [00:08<01:26, 43.79it/s, est. speed input: 38941.02 toks/s, output: 38.03 toks/s]
Processed prompts:   9%|▊         | 354/4096 [00:09<01:25, 43.98it/s, est. speed input: 39454.39 toks/s, output: 38.53 toks/s]
Processed prompts:   9%|▉         | 386/4096 [00:09<01:24, 44.10it/s, est. speed input: 39890.47 toks/s, output: 38.96 toks/s]
Processed prompts:  10%|█         | 418/4096 [00:10<01:23, 44.15it/s, est. speed input: 40260.19 toks/s, output: 39.32 toks/s]
Processed prompts:  11%|█         | 450/4096 [00:11<01:22, 44.23it/s, est. speed input: 40590.92 toks/s, output: 39.64 toks/s]
Processed prompts:  12%|█▏        | 482/4096 [00:12<01:20, 45.10it/s, est. speed input: 41029.42 toks/s, output: 40.07 toks/s]
Processed prompts:  13%|█▎        | 514/4096 [00:12<01:18, 45.87it/s, est. speed input: 41445.54 toks/s, output: 40.47 toks/s]
Processed prompts:  13%|█▎        | 546/4096 [00:13<01:16, 46.42it/s, est. speed input: 41818.68 toks/s, output: 40.84 toks/s]
Processed prompts:  14%|█▍        | 578/4096 [00:14<01:15, 46.80it/s, est. speed input: 42154.84 toks/s, output: 41.17 toks/s]
Processed prompts:  15%|█▍        | 610/4096 [00:14<01:14, 47.07it/s, est. speed input: 42460.42 toks/s, output: 41.47 toks/s]
Processed prompts:  16%|█▌        | 642/4096 [00:15<01:13, 47.26it/s, est. speed input: 42739.08 toks/s, output: 41.74 toks/s]
Processed prompts:  16%|█▋        | 674/4096 [00:16<01:12, 47.39it/s, est. speed input: 42993.60 toks/s, output: 41.99 toks/s]
Processed prompts:  17%|█▋        | 706/4096 [00:16<01:12, 46.85it/s, est. speed input: 43149.92 toks/s, output: 42.14 toks/s]
Processed prompts:  18%|█▊        | 738/4096 [00:17<01:13, 45.97it/s, est. speed input: 43231.50 toks/s, output: 42.22 toks/s]
Processed prompts:  19%|█▉        | 770/4096 [00:18<01:13, 45.38it/s, est. speed input: 43306.47 toks/s, output: 42.29 toks/s]
Processed prompts:  20%|█▉        | 802/4096 [00:18<01:13, 44.98it/s, est. speed input: 43376.16 toks/s, output: 42.36 toks/s]
Processed prompts:  20%|██        | 834/4096 [00:19<01:12, 44.69it/s, est. speed input: 43439.19 toks/s, output: 42.42 toks/s]
Processed prompts:  21%|██        | 866/4096 [00:20<01:12, 44.47it/s, est. speed input: 43495.68 toks/s, output: 42.48 toks/s]
Processed prompts:  22%|██▏       | 898/4096 [00:21<01:12, 44.31it/s, est. speed input: 43547.92 toks/s, output: 42.53 toks/s]
Processed prompts:  23%|██▎       | 930/4096 [00:21<01:11, 44.19it/s, est. speed input: 43595.30 toks/s, output: 42.57 toks/s]
Processed prompts:  23%|██▎       | 962/4096 [00:22<01:10, 44.50it/s, est. speed input: 43680.35 toks/s, output: 42.66 toks/s]
Processed prompts:  24%|██▍       | 994/4096 [00:23<01:10, 44.27it/s, est. speed input: 43715.47 toks/s, output: 42.69 toks/s]
Processed prompts:  25%|██▌       | 1026/4096 [00:24<01:09, 44.14it/s, est. speed input: 43751.39 toks/s, output: 42.73 toks/s]
Processed prompts:  26%|██▌       | 1058/4096 [00:24<01:09, 44.03it/s, est. speed input: 43782.88 toks/s, output: 42.76 toks/s]
Processed prompts:  27%|██▋       | 1090/4096 [00:25<01:08, 43.94it/s, est. speed input: 43811.64 toks/s, output: 42.78 toks/s]
Processed prompts:  27%|██▋       | 1122/4096 [00:26<01:07, 43.86it/s, est. speed input: 43837.57 toks/s, output: 42.81 toks/s]
Processed prompts:  28%|██▊       | 1154/4096 [00:26<01:06, 44.16it/s, est. speed input: 43893.08 toks/s, output: 42.86 toks/s]
Processed prompts:  29%|██▉       | 1186/4096 [00:27<01:06, 43.89it/s, est. speed input: 43904.75 toks/s, output: 42.88 toks/s]
Processed prompts:  30%|██▉       | 1218/4096 [00:28<01:06, 43.36it/s, est. speed input: 43885.55 toks/s, output: 42.86 toks/s]
Processed prompts:  31%|███       | 1250/4096 [00:29<01:06, 43.00it/s, est. speed input: 43867.24 toks/s, output: 42.84 toks/s]
Processed prompts:  31%|███▏      | 1282/4096 [00:29<01:05, 42.73it/s, est. speed input: 43848.34 toks/s, output: 42.82 toks/s]
Processed prompts:  32%|███▏      | 1314/4096 [00:30<01:05, 42.55it/s, est. speed input: 43830.68 toks/s, output: 42.80 toks/s]
Processed prompts:  33%|███▎      | 1346/4096 [00:31<01:04, 42.41it/s, est. speed input: 43813.26 toks/s, output: 42.79 toks/s]
Processed prompts:  34%|███▎      | 1378/4096 [00:33<01:29, 30.29it/s, est. speed input: 42477.71 toks/s, output: 41.48 toks/s]
Processed prompts:  34%|███▍      | 1410/4096 [00:33<01:21, 33.06it/s, est. speed input: 42490.11 toks/s, output: 41.49 toks/s]
Processed prompts:  35%|███▌      | 1442/4096 [00:34<01:14, 35.62it/s, est. speed input: 42533.38 toks/s, output: 41.54 toks/s]
Processed prompts:  36%|███▌      | 1474/4096 [00:35<01:09, 37.67it/s, est. speed input: 42575.51 toks/s, output: 41.58 toks/s]
Processed prompts:  37%|███▋      | 1506/4096 [00:36<01:05, 39.26it/s, est. speed input: 42616.03 toks/s, output: 41.62 toks/s]
Processed prompts:  38%|███▊      | 1538/4096 [00:36<01:03, 40.49it/s, est. speed input: 42658.02 toks/s, output: 41.66 toks/s]
Processed prompts:  38%|███▊      | 1570/4096 [00:37<01:00, 41.44it/s, est. speed input: 42701.39 toks/s, output: 41.70 toks/s]
Processed prompts:  39%|███▉      | 1602/4096 [00:38<00:59, 42.13it/s, est. speed input: 42742.76 toks/s, output: 41.74 toks/s]
Processed prompts:  40%|███▉      | 1634/4096 [00:39<00:57, 42.62it/s, est. speed input: 42782.58 toks/s, output: 41.78 toks/s]
Processed prompts:  41%|████      | 1666/4096 [00:39<00:56, 42.97it/s, est. speed input: 42820.61 toks/s, output: 41.82 toks/s]
Processed prompts:  41%|████▏     | 1698/4096 [00:40<00:55, 43.23it/s, est. speed input: 42857.72 toks/s, output: 41.85 toks/s]
Processed prompts:  42%|████▏     | 1730/4096 [00:41<00:54, 43.40it/s, est. speed input: 42893.01 toks/s, output: 41.89 toks/s]
Processed prompts:  43%|████▎     | 1762/4096 [00:42<00:53, 43.51it/s, est. speed input: 42926.76 toks/s, output: 41.92 toks/s]
Processed prompts:  44%|████▍     | 1794/4096 [00:42<00:52, 43.60it/s, est. speed input: 42959.57 toks/s, output: 41.95 toks/s]
Processed prompts:  45%|████▍     | 1826/4096 [00:43<00:52, 43.65it/s, est. speed input: 42990.86 toks/s, output: 41.98 toks/s]
Processed prompts:  45%|████▌     | 1858/4096 [00:44<00:50, 44.04it/s, est. speed input: 43040.50 toks/s, output: 42.03 toks/s]
Processed prompts:  46%|████▌     | 1890/4096 [00:44<00:49, 44.45it/s, est. speed input: 43094.90 toks/s, output: 42.08 toks/s]
Processed prompts:  47%|████▋     | 1922/4096 [00:45<00:48, 45.05it/s, est. speed input: 43163.32 toks/s, output: 42.15 toks/s]
Processed prompts:  48%|████▊     | 1954/4096 [00:46<00:47, 45.48it/s, est. speed input: 43229.72 toks/s, output: 42.22 toks/s]
Processed prompts:  48%|████▊     | 1986/4096 [00:46<00:46, 45.79it/s, est. speed input: 43294.28 toks/s, output: 42.28 toks/s]
Processed prompts:  49%|████▉     | 2018/4096 [00:47<00:45, 46.00it/s, est. speed input: 43356.73 toks/s, output: 42.34 toks/s]
Processed prompts:  50%|█████     | 2050/4096 [00:48<00:44, 46.15it/s, est. speed input: 43417.39 toks/s, output: 42.40 toks/s]
Processed prompts:  51%|█████     | 2082/4096 [00:49<00:43, 46.25it/s, est. speed input: 43476.22 toks/s, output: 42.46 toks/s]
Processed prompts:  52%|█████▏    | 2114/4096 [00:49<00:42, 46.22it/s, est. speed input: 43528.87 toks/s, output: 42.51 toks/s]
Processed prompts:  52%|█████▏    | 2146/4096 [00:50<00:42, 45.35it/s, est. speed input: 43542.82 toks/s, output: 42.52 toks/s]
Processed prompts:  53%|█████▎    | 2178/4096 [00:51<00:42, 44.76it/s, est. speed input: 43556.51 toks/s, output: 42.54 toks/s]
Processed prompts:  54%|█████▍    | 2210/4096 [00:51<00:42, 44.36it/s, est. speed input: 43569.62 toks/s, output: 42.55 toks/s]
Processed prompts:  55%|█████▍    | 2242/4096 [00:52<00:42, 44.07it/s, est. speed input: 43581.81 toks/s, output: 42.56 toks/s]
Processed prompts:  56%|█████▌    | 2274/4096 [00:53<00:41, 44.22it/s, est. speed input: 43609.47 toks/s, output: 42.59 toks/s]
Processed prompts:  56%|█████▋    | 2306/4096 [00:54<00:40, 43.96it/s, est. speed input: 43620.31 toks/s, output: 42.60 toks/s]
Processed prompts:  57%|█████▋    | 2338/4096 [00:54<00:40, 43.78it/s, est. speed input: 43630.92 toks/s, output: 42.61 toks/s]
Processed prompts:  58%|█████▊    | 2370/4096 [00:55<00:39, 43.65it/s, est. speed input: 43641.08 toks/s, output: 42.62 toks/s]
Processed prompts:  59%|█████▊    | 2402/4096 [00:56<00:38, 43.57it/s, est. speed input: 43651.16 toks/s, output: 42.63 toks/s]
Processed prompts:  59%|█████▉    | 2434/4096 [00:57<00:38, 43.51it/s, est. speed input: 43660.98 toks/s, output: 42.64 toks/s]
Processed prompts:  60%|██████    | 2466/4096 [00:57<00:37, 43.45it/s, est. speed input: 43669.95 toks/s, output: 42.65 toks/s]
Processed prompts:  61%|██████    | 2498/4096 [00:58<00:36, 43.77it/s, est. speed input: 43693.67 toks/s, output: 42.67 toks/s]
Processed prompts:  62%|██████▏   | 2530/4096 [00:59<00:35, 43.64it/s, est. speed input: 43702.11 toks/s, output: 42.68 toks/s]
Processed prompts:  63%|██████▎   | 2562/4096 [01:00<00:35, 43.54it/s, est. speed input: 43710.22 toks/s, output: 42.69 toks/s]
Processed prompts:  63%|██████▎   | 2594/4096 [01:00<00:34, 43.26it/s, est. speed input: 43709.40 toks/s, output: 42.68 toks/s]
Processed prompts:  64%|██████▍   | 2626/4096 [01:01<00:34, 42.64it/s, est. speed input: 43690.80 toks/s, output: 42.67 toks/s]
Processed prompts:  65%|██████▍   | 2658/4096 [01:02<00:34, 42.21it/s, est. speed input: 43672.59 toks/s, output: 42.65 toks/s]
Processed prompts:  66%|██████▌   | 2690/4096 [01:03<00:33, 41.91it/s, est. speed input: 43654.77 toks/s, output: 42.63 toks/s]
Processed prompts:  66%|██████▋   | 2722/4096 [01:03<00:32, 41.71it/s, est. speed input: 43637.39 toks/s, output: 42.61 toks/s]
Processed prompts:  67%|██████▋   | 2754/4096 [01:04<00:32, 41.57it/s, est. speed input: 43620.62 toks/s, output: 42.60 toks/s]
Processed prompts:  68%|██████▊   | 2786/4096 [01:06<00:43, 29.80it/s, est. speed input: 42943.41 toks/s, output: 41.94 toks/s]
Processed prompts:  69%|██████▉   | 2818/4096 [01:07<00:38, 32.90it/s, est. speed input: 42959.98 toks/s, output: 41.95 toks/s]
Processed prompts:  70%|██████▉   | 2850/4096 [01:07<00:35, 35.47it/s, est. speed input: 42976.17 toks/s, output: 41.97 toks/s]
Processed prompts:  70%|███████   | 2882/4096 [01:08<00:32, 37.54it/s, est. speed input: 42992.16 toks/s, output: 41.98 toks/s]
Processed prompts:  71%|███████   | 2914/4096 [01:09<00:30, 39.13it/s, est. speed input: 43007.71 toks/s, output: 42.00 toks/s]
Processed prompts:  72%|███████▏  | 2946/4096 [01:10<00:28, 40.55it/s, est. speed input: 43032.27 toks/s, output: 42.02 toks/s]
Processed prompts:  73%|███████▎  | 2978/4096 [01:10<00:26, 41.68it/s, est. speed input: 43058.83 toks/s, output: 42.05 toks/s]
Processed prompts:  73%|███████▎  | 3010/4096 [01:11<00:25, 42.51it/s, est. speed input: 43084.75 toks/s, output: 42.07 toks/s]
Processed prompts:  74%|███████▍  | 3042/4096 [01:12<00:24, 43.12it/s, est. speed input: 43110.41 toks/s, output: 42.10 toks/s]
Processed prompts:  75%|███████▌  | 3074/4096 [01:12<00:23, 43.55it/s, est. speed input: 43135.62 toks/s, output: 42.12 toks/s]
Processed prompts:  76%|███████▌  | 3106/4096 [01:13<00:22, 43.86it/s, est. speed input: 43160.42 toks/s, output: 42.15 toks/s]
Processed prompts:  77%|███████▋  | 3138/4096 [01:14<00:21, 44.09it/s, est. speed input: 43184.85 toks/s, output: 42.17 toks/s]
Processed prompts:  77%|███████▋  | 3170/4096 [01:15<00:20, 44.29it/s, est. speed input: 43209.93 toks/s, output: 42.20 toks/s]
Processed prompts:  78%|███████▊  | 3202/4096 [01:15<00:20, 44.35it/s, est. speed input: 43232.44 toks/s, output: 42.22 toks/s]
Processed prompts:  79%|███████▉  | 3234/4096 [01:16<00:19, 44.47it/s, est. speed input: 43256.65 toks/s, output: 42.24 toks/s]
Processed prompts:  80%|███████▉  | 3266/4096 [01:17<00:18, 44.50it/s, est. speed input: 43278.71 toks/s, output: 42.26 toks/s]
Processed prompts:  81%|████████  | 3298/4096 [01:17<00:17, 44.52it/s, est. speed input: 43300.48 toks/s, output: 42.29 toks/s]
Processed prompts:  81%|████████▏ | 3330/4096 [01:18<00:17, 44.57it/s, est. speed input: 43322.71 toks/s, output: 42.31 toks/s]
Processed prompts:  82%|████████▏ | 3362/4096 [01:19<00:16, 44.53it/s, est. speed input: 43342.49 toks/s, output: 42.33 toks/s]
Processed prompts:  83%|████████▎ | 3394/4096 [01:20<00:15, 44.54it/s, est. speed input: 43362.96 toks/s, output: 42.35 toks/s]
Processed prompts:  84%|████████▎ | 3426/4096 [01:20<00:15, 44.54it/s, est. speed input: 43382.97 toks/s, output: 42.37 toks/s]
Processed prompts:  84%|████████▍ | 3458/4096 [01:21<00:14, 44.55it/s, est. speed input: 43402.97 toks/s, output: 42.39 toks/s]
Processed prompts:  85%|████████▌ | 3490/4096 [01:22<00:13, 44.55it/s, est. speed input: 43422.33 toks/s, output: 42.40 toks/s]
Processed prompts:  86%|████████▌ | 3522/4096 [01:23<00:12, 44.56it/s, est. speed input: 43441.53 toks/s, output: 42.42 toks/s]
Processed prompts:  87%|████████▋ | 3554/4096 [01:23<00:12, 44.56it/s, est. speed input: 43460.43 toks/s, output: 42.44 toks/s]
Processed prompts:  88%|████████▊ | 3586/4096 [01:24<00:11, 44.58it/s, est. speed input: 43479.20 toks/s, output: 42.46 toks/s]
Processed prompts:  88%|████████▊ | 3618/4096 [01:25<00:10, 44.58it/s, est. speed input: 43497.66 toks/s, output: 42.48 toks/s]
Processed prompts:  89%|████████▉ | 3650/4096 [01:25<00:10, 44.24it/s, est. speed input: 43506.32 toks/s, output: 42.49 toks/s]
Processed prompts:  90%|████████▉ | 3682/4096 [01:26<00:09, 43.97it/s, est. speed input: 43513.82 toks/s, output: 42.49 toks/s]
Processed prompts:  91%|█████████ | 3714/4096 [01:27<00:08, 44.14it/s, est. speed input: 43531.22 toks/s, output: 42.51 toks/s]
Processed prompts:  91%|█████████▏| 3746/4096 [01:28<00:07, 43.91it/s, est. speed input: 43538.69 toks/s, output: 42.52 toks/s]
Processed prompts:  92%|█████████▏| 3778/4096 [01:28<00:07, 43.75it/s, est. speed input: 43546.04 toks/s, output: 42.53 toks/s]
Processed prompts:  93%|█████████▎| 3810/4096 [01:29<00:06, 43.64it/s, est. speed input: 43553.11 toks/s, output: 42.53 toks/s]
Processed prompts:  94%|█████████▍| 3842/4096 [01:30<00:05, 43.55it/s, est. speed input: 43560.05 toks/s, output: 42.54 toks/s]
Processed prompts:  95%|█████████▍| 3874/4096 [01:31<00:05, 43.50it/s, est. speed input: 43566.92 toks/s, output: 42.55 toks/s]
Processed prompts:  95%|█████████▌| 3906/4096 [01:31<00:04, 43.46it/s, est. speed input: 43573.67 toks/s, output: 42.55 toks/s]
Processed prompts:  96%|█████████▌| 3938/4096 [01:32<00:03, 43.42it/s, est. speed input: 43580.13 toks/s, output: 42.56 toks/s]
Processed prompts:  97%|█████████▋| 3970/4096 [01:33<00:02, 43.40it/s, est. speed input: 43586.41 toks/s, output: 42.56 toks/s]
Processed prompts:  98%|█████████▊| 4002/4096 [01:34<00:02, 43.15it/s, est. speed input: 43586.56 toks/s, output: 42.56 toks/s]
Processed prompts:  98%|█████████▊| 4034/4096 [01:34<00:01, 43.18it/s, est. speed input: 43592.07 toks/s, output: 42.57 toks/s]
Processed prompts:  99%|█████████▉| 4066/4096 [01:35<00:00, 43.34it/s, est. speed input: 43600.98 toks/s, output: 42.58 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:35<00:00, 43.34it/s, est. speed input: 43922.44 toks/s, output: 42.89 toks/s]
Processed prompts: 100%|██████████| 4096/4096 [01:35<00:00, 42.89it/s, est. speed input: 43922.44 toks/s, output: 42.89 toks/s]
[rank0]:[W128 09:57:47.816153198 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 451.7s

测试结果:
  Requests/s:   39.22
  Tokens/s:     40202.02
  Total Reqs:   4096
  Elapsed:      104.43s

  [Prefill 分析]
  Total Prefill Tokens: 4194304
  Prefill Tokens/s:     40162.80


------------------------------------------------------------
  生成 CSV: BitNet-2B-FP8
------------------------------------------------------------
[SUCCESS] CSV 保存到: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cublaslt/BitNet-2B-FP8_prefill.csv

预览:
------------------------------------------------------------
M_prefill,prompt_len,max_num_seqs,num_prompts,N_prefill,requests_per_s,tokens_per_s,elapsed_time_s
512,512,1,128,128,13.9367,7149.5451,9.1844
1024,1024,1,128,128,13.4609,13797.4447,9.5090
2048,1024,2,256,128,21.7542,22298.0205,11.7679
4096,1024,4,512,128,28.2134,28918.7714,18.1474
8192,1024,8,1024,128,28.3622,29071.2338,36.1044
16384,1024,16,2048,128,39.2939,40276.2605,52.1200
32768,1024,32,4096,128,39.2215,40202.0219,104.4326

------------------------------------------------------------

[INFO] 完成: 7 成功, 0 失败

============================================================
  BitNet-2B-FP8 | cuSPARSELt (2_4) | prefill
============================================================

[INFO] Checkpoint: /root/vllmbench/checkpoints_slidesparse/BitNet-2B-FP8-SlideSparse-2_4
[INFO] Output: /root/vllmbench/slidesparse/tools/throughput_benchmark_results/prefill/RTX4090_cc89_FP8E4M3_py312_cu129_x86_64/cusparselt/2_4

============================================================
[1/7] 测试 M=512
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 512
│   M_prefill     = 512 (= 1 x 512)
│   M_decode      = 1
│   batched_tokens = 513 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 512
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 513
│   --max-num-batched-tokens = 513
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 09:59:24 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 09:59:25 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=900415) WARNING 01-28 10:00:39 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=900415) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=900415) WARNING 01-28 10:03:01 [backends.py:609] Failed to read file <frozen os>
Throughput: 14.83 requests/s, 7605.61 total tokens/s, 14.83 output tokens/s
Total num prompt tokens:  65536
Total num output tokens:  128


─── STDERR ───
[2026-01-28 09:59:02] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:59:24] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:59:24] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:59:24] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:24] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:24] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:24] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:24] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:24] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:59:24] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:59:24] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:59:24] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:59:24] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:59:24] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 09:59:44] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 09:59:56] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 09:59:56] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 09:59:56] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:56] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:56] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:56] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:56] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 09:59:56] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 09:59:56] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 09:59:56] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 09:59:56] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 09:59:56] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 09:59:56] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=900415) [2026-01-28 10:00:44] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=900415) [2026-01-28 10:00:44] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=900415) [2026-01-28 10:00:44] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=900415) [2026-01-28 10:00:44] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=900415) [2026-01-28 10:00:44] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=900415) [2026-01-28 10:00:44] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=900415) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=900415) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.41s/it]
(EngineCore_DP0 pid=900415) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:02<00:00,  2.41s/it]
(EngineCore_DP0 pid=900415) 
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:41] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:42] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:42] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:43] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:43] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:44] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:44] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=900415) [2026-01-28 10:01:45] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=900415) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:04<00:04,  4.58s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:05<00:00,  2.41s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:05<00:00,  2.74s/it]
(EngineCore_DP0 pid=900415) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  3.17it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  3.17it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  49%|████▉     | 63/128 [00:00<00:00, 620.83it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 641.39it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   1%|          | 1/128 [00:00<00:30,  4.13it/s, est. speed input: 2116.07 toks/s, output: 4.13 toks/s]
Processed prompts:   2%|▏         | 2/128 [00:00<00:23,  5.44it/s, est. speed input: 2658.53 toks/s, output: 5.19 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:13,  9.28it/s, est. speed input: 4015.92 toks/s, output: 7.84 toks/s]
Processed prompts:   5%|▍         | 6/128 [00:00<00:10, 11.61it/s, est. speed input: 4844.02 toks/s, output: 9.46 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:09, 12.43it/s, est. speed input: 5264.66 toks/s, output: 10.28 toks/s]
Processed prompts:   8%|▊         | 10/128 [00:00<00:09, 12.95it/s, est. speed input: 5558.05 toks/s, output: 10.86 toks/s]
Processed prompts:   9%|▉         | 12/128 [00:01<00:08, 13.27it/s, est. speed input: 5769.84 toks/s, output: 11.27 toks/s]
Processed prompts:  11%|█         | 14/128 [00:01<00:08, 14.08it/s, est. speed input: 6026.94 toks/s, output: 11.77 toks/s]
Processed prompts:  12%|█▎        | 16/128 [00:01<00:07, 14.69it/s, est. speed input: 6239.44 toks/s, output: 12.19 toks/s]
Processed prompts:  14%|█▍        | 18/128 [00:01<00:07, 15.09it/s, est. speed input: 6410.61 toks/s, output: 12.52 toks/s]
Processed prompts:  16%|█▌        | 20/128 [00:01<00:07, 15.28it/s, est. speed input: 6544.69 toks/s, output: 12.78 toks/s]
Processed prompts:  17%|█▋        | 22/128 [00:01<00:06, 15.44it/s, est. speed input: 6659.98 toks/s, output: 13.01 toks/s]
Processed prompts:  19%|█▉        | 24/128 [00:01<00:06, 15.55it/s, est. speed input: 6760.24 toks/s, output: 13.20 toks/s]
Processed prompts:  20%|██        | 26/128 [00:01<00:06, 15.59it/s, est. speed input: 6843.63 toks/s, output: 13.37 toks/s]
Processed prompts:  22%|██▏       | 28/128 [00:02<00:06, 15.59it/s, est. speed input: 6914.10 toks/s, output: 13.50 toks/s]
Processed prompts:  23%|██▎       | 30/128 [00:02<00:06, 15.68it/s, est. speed input: 6983.66 toks/s, output: 13.64 toks/s]
Processed prompts:  25%|██▌       | 32/128 [00:02<00:06, 15.72it/s, est. speed input: 7044.62 toks/s, output: 13.76 toks/s]
Processed prompts:  27%|██▋       | 34/128 [00:02<00:05, 15.75it/s, est. speed input: 7099.15 toks/s, output: 13.87 toks/s]
Processed prompts:  28%|██▊       | 36/128 [00:02<00:05, 15.79it/s, est. speed input: 7149.32 toks/s, output: 13.96 toks/s]
Processed prompts:  30%|██▉       | 38/128 [00:02<00:05, 15.78it/s, est. speed input: 7192.45 toks/s, output: 14.05 toks/s]
Processed prompts:  31%|███▏      | 40/128 [00:02<00:05, 15.79it/s, est. speed input: 7232.96 toks/s, output: 14.13 toks/s]
Processed prompts:  33%|███▎      | 42/128 [00:02<00:05, 15.80it/s, est. speed input: 7270.14 toks/s, output: 14.20 toks/s]
Processed prompts:  34%|███▍      | 44/128 [00:03<00:05, 15.79it/s, est. speed input: 7303.19 toks/s, output: 14.26 toks/s]
Processed prompts:  36%|███▌      | 46/128 [00:03<00:05, 15.75it/s, est. speed input: 7331.70 toks/s, output: 14.32 toks/s]
Processed prompts:  38%|███▊      | 48/128 [00:03<00:05, 15.71it/s, est. speed input: 7357.22 toks/s, output: 14.37 toks/s]
Processed prompts:  39%|███▉      | 50/128 [00:03<00:04, 15.67it/s, est. speed input: 7380.19 toks/s, output: 14.41 toks/s]
Processed prompts:  41%|████      | 52/128 [00:03<00:04, 15.68it/s, est. speed input: 7403.15 toks/s, output: 14.46 toks/s]
Processed prompts:  42%|████▏     | 54/128 [00:03<00:04, 15.67it/s, est. speed input: 7424.14 toks/s, output: 14.50 toks/s]
Processed prompts:  44%|████▍     | 56/128 [00:03<00:04, 15.69it/s, est. speed input: 7445.06 toks/s, output: 14.54 toks/s]
Processed prompts:  45%|████▌     | 58/128 [00:03<00:04, 15.64it/s, est. speed input: 7461.24 toks/s, output: 14.57 toks/s]
Processed prompts:  47%|████▋     | 60/128 [00:04<00:04, 15.59it/s, est. speed input: 7475.77 toks/s, output: 14.60 toks/s]
Processed prompts:  48%|████▊     | 62/128 [00:04<00:04, 15.60it/s, est. speed input: 7491.55 toks/s, output: 14.63 toks/s]
Processed prompts:  50%|█████     | 64/128 [00:04<00:04, 15.64it/s, est. speed input: 7508.24 toks/s, output: 14.66 toks/s]
Processed prompts:  52%|█████▏    | 66/128 [00:04<00:03, 15.67it/s, est. speed input: 7523.49 toks/s, output: 14.69 toks/s]
Processed prompts:  53%|█████▎    | 68/128 [00:04<00:03, 15.63it/s, est. speed input: 7535.82 toks/s, output: 14.72 toks/s]
Processed prompts:  55%|█████▍    | 70/128 [00:04<00:03, 15.65it/s, est. speed input: 7549.27 toks/s, output: 14.74 toks/s]
Processed prompts:  56%|█████▋    | 72/128 [00:04<00:03, 15.65it/s, est. speed input: 7561.43 toks/s, output: 14.77 toks/s]
Processed prompts:  58%|█████▊    | 74/128 [00:05<00:03, 15.65it/s, est. speed input: 7572.82 toks/s, output: 14.79 toks/s]
Processed prompts:  59%|█████▉    | 76/128 [00:05<00:03, 15.66it/s, est. speed input: 7584.38 toks/s, output: 14.81 toks/s]
Processed prompts:  61%|██████    | 78/128 [00:05<00:03, 15.66it/s, est. speed input: 7594.87 toks/s, output: 14.83 toks/s]
Processed prompts:  62%|██████▎   | 80/128 [00:05<00:03, 15.69it/s, est. speed input: 7606.18 toks/s, output: 14.86 toks/s]
Processed prompts:  64%|██████▍   | 82/128 [00:05<00:02, 15.71it/s, est. speed input: 7616.65 toks/s, output: 14.88 toks/s]
Processed prompts:  66%|██████▌   | 84/128 [00:05<00:02, 15.73it/s, est. speed input: 7627.18 toks/s, output: 14.90 toks/s]
Processed prompts:  67%|██████▋   | 86/128 [00:05<00:02, 15.76it/s, est. speed input: 7637.59 toks/s, output: 14.92 toks/s]
Processed prompts:  69%|██████▉   | 88/128 [00:05<00:02, 15.79it/s, est. speed input: 7647.79 toks/s, output: 14.94 toks/s]
Processed prompts:  70%|███████   | 90/128 [00:06<00:02, 15.79it/s, est. speed input: 7657.02 toks/s, output: 14.96 toks/s]
Processed prompts:  72%|███████▏  | 92/128 [00:06<00:02, 15.69it/s, est. speed input: 7662.40 toks/s, output: 14.97 toks/s]
Processed prompts:  73%|███████▎  | 94/128 [00:06<00:02, 15.66it/s, est. speed input: 7669.17 toks/s, output: 14.98 toks/s]
Processed prompts:  75%|███████▌  | 96/128 [00:06<00:02, 14.98it/s, est. speed input: 7653.03 toks/s, output: 14.95 toks/s]
Processed prompts:  77%|███████▋  | 98/128 [00:06<00:01, 15.24it/s, est. speed input: 7662.03 toks/s, output: 14.96 toks/s]
Processed prompts:  78%|███████▊  | 100/128 [00:06<00:01, 15.43it/s, est. speed input: 7671.04 toks/s, output: 14.98 toks/s]
Processed prompts:  80%|███████▉  | 102/128 [00:06<00:01, 15.63it/s, est. speed input: 7681.54 toks/s, output: 15.00 toks/s]
Processed prompts:  81%|████████▏ | 104/128 [00:06<00:01, 15.71it/s, est. speed input: 7689.85 toks/s, output: 15.02 toks/s]
Processed prompts:  83%|████████▎ | 106/128 [00:07<00:01, 15.80it/s, est. speed input: 7698.94 toks/s, output: 15.04 toks/s]
Processed prompts:  84%|████████▍ | 108/128 [00:07<00:01, 15.89it/s, est. speed input: 7708.49 toks/s, output: 15.06 toks/s]
Processed prompts:  86%|████████▌ | 110/128 [00:07<00:01, 15.97it/s, est. speed input: 7717.92 toks/s, output: 15.07 toks/s]
Processed prompts:  88%|████████▊ | 112/128 [00:07<00:00, 16.02it/s, est. speed input: 7727.19 toks/s, output: 15.09 toks/s]
Processed prompts:  89%|████████▉ | 114/128 [00:07<00:00, 16.03it/s, est. speed input: 7735.35 toks/s, output: 15.11 toks/s]
Processed prompts:  91%|█████████ | 116/128 [00:07<00:00, 15.93it/s, est. speed input: 7740.33 toks/s, output: 15.12 toks/s]
Processed prompts:  92%|█████████▏| 118/128 [00:07<00:00, 15.98it/s, est. speed input: 7748.31 toks/s, output: 15.13 toks/s]
Processed prompts:  94%|█████████▍| 120/128 [00:07<00:00, 15.86it/s, est. speed input: 7752.00 toks/s, output: 15.14 toks/s]
Processed prompts:  95%|█████████▌| 122/128 [00:08<00:00, 15.83it/s, est. speed input: 7756.92 toks/s, output: 15.15 toks/s]
Processed prompts:  97%|█████████▋| 124/128 [00:08<00:00, 15.76it/s, est. speed input: 7760.53 toks/s, output: 15.16 toks/s]
Processed prompts:  98%|█████████▊| 126/128 [00:08<00:00, 15.74it/s, est. speed input: 7764.77 toks/s, output: 15.17 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 15.85it/s, est. speed input: 7771.86 toks/s, output: 15.18 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 15.85it/s, est. speed input: 7771.86 toks/s, output: 15.18 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:08<00:00, 15.18it/s, est. speed input: 7771.86 toks/s, output: 15.18 toks/s]
[rank0]:[W128 10:04:22.753793584 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 468.0s

测试结果:
  Requests/s:   14.83
  Tokens/s:     7605.61
  Total Reqs:   128
  Elapsed:      8.63s

  [Prefill 分析]
  Total Prefill Tokens: 65536
  Prefill Tokens/s:     7590.79

============================================================
[2/7] 测试 M=1024
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 1024
│   M_prefill     = 1024 (= 1 x 1024)
│   M_decode      = 1
│   batched_tokens = 1025 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 128
│   --max-num-seqs           = 1
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 1025
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 10:06:53 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 10:06:54 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=903938) WARNING 01-28 10:08:24 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=903938) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=903938) WARNING 01-28 10:10:40 [backends.py:609] Failed to read file <frozen os>
Throughput: 15.39 requests/s, 15769.87 total tokens/s, 15.39 output tokens/s
Total num prompt tokens:  131072
Total num output tokens:  128


─── STDERR ───
[2026-01-28 10:06:52] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:06:53] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:06:53] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:06:53] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:06:53] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:06:53] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:06:53] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:06:53] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:06:53] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:06:53] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:06:53] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:06:53] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:06:53] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:06:53] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 10:07:46] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:07:57] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:07:57] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:07:57] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:07:57] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:07:57] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:07:57] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:07:57] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:07:57] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:07:57] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:07:57] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:07:57] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:07:57] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:07:57] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=903938) [2026-01-28 10:08:30] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=903938) [2026-01-28 10:08:30] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=903938) [2026-01-28 10:08:30] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=903938) [2026-01-28 10:08:30] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=903938) [2026-01-28 10:08:30] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=903938) [2026-01-28 10:08:30] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=903938) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=903938) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.33it/s]
(EngineCore_DP0 pid=903938) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.33it/s]
(EngineCore_DP0 pid=903938) 
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=903938) [2026-01-28 10:09:33] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=903938) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 1/2 [00:01<00:01,  1.20s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:02<00:00,  1.02it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 2/2 [00:02<00:00,  1.02s/it]
(EngineCore_DP0 pid=903938) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/1 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.36it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 1/1 [00:00<00:00,  1.36it/s]

Adding requests:   0%|          | 0/128 [00:00<?, ?it/s]
Adding requests:  28%|██▊       | 36/128 [00:00<00:00, 357.51it/s]
Adding requests:  59%|█████▊    | 75/128 [00:00<00:00, 375.54it/s]
Adding requests:  88%|████████▊ | 113/128 [00:00<00:00, 375.03it/s]
Adding requests: 100%|██████████| 128/128 [00:00<00:00, 373.20it/s]

Processed prompts:   0%|          | 0/128 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   3%|▎         | 4/128 [00:00<00:03, 34.03it/s, est. speed input: 34856.87 toks/s, output: 34.03 toks/s]
Processed prompts:   6%|▋         | 8/128 [00:00<00:05, 20.90it/s, est. speed input: 22719.59 toks/s, output: 22.19 toks/s]
Processed prompts:   9%|▊         | 11/128 [00:00<00:06, 17.79it/s, est. speed input: 19791.96 toks/s, output: 19.33 toks/s]
Processed prompts:  10%|█         | 13/128 [00:00<00:06, 17.26it/s, est. speed input: 19174.10 toks/s, output: 18.72 toks/s]
Processed prompts:  12%|█▏        | 15/128 [00:00<00:06, 16.95it/s, est. speed input: 18784.47 toks/s, output: 18.34 toks/s]
Processed prompts:  13%|█▎        | 17/128 [00:00<00:06, 16.75it/s, est. speed input: 18506.08 toks/s, output: 18.07 toks/s]
Processed prompts:  15%|█▍        | 19/128 [00:01<00:06, 16.65it/s, est. speed input: 18310.70 toks/s, output: 17.88 toks/s]
Processed prompts:  16%|█▋        | 21/128 [00:01<00:06, 16.52it/s, est. speed input: 18133.99 toks/s, output: 17.71 toks/s]
Processed prompts:  18%|█▊        | 23/128 [00:01<00:06, 16.38it/s, est. speed input: 17971.05 toks/s, output: 17.55 toks/s]
Processed prompts:  20%|█▉        | 25/128 [00:01<00:06, 16.22it/s, est. speed input: 17819.98 toks/s, output: 17.40 toks/s]
Processed prompts:  21%|██        | 27/128 [00:01<00:06, 16.17it/s, est. speed input: 17708.18 toks/s, output: 17.29 toks/s]
Processed prompts:  23%|██▎       | 29/128 [00:01<00:06, 16.13it/s, est. speed input: 17613.63 toks/s, output: 17.20 toks/s]
Processed prompts:  24%|██▍       | 31/128 [00:01<00:06, 16.13it/s, est. speed input: 17538.77 toks/s, output: 17.13 toks/s]
Processed prompts:  26%|██▌       | 33/128 [00:01<00:05, 16.08it/s, est. speed input: 17460.82 toks/s, output: 17.05 toks/s]
Processed prompts:  27%|██▋       | 35/128 [00:02<00:05, 16.02it/s, est. speed input: 17387.31 toks/s, output: 16.98 toks/s]
Processed prompts:  29%|██▉       | 37/128 [00:02<00:05, 15.99it/s, est. speed input: 17324.55 toks/s, output: 16.92 toks/s]
Processed prompts:  30%|███       | 39/128 [00:02<00:05, 15.99it/s, est. speed input: 17273.82 toks/s, output: 16.87 toks/s]
Processed prompts:  32%|███▏      | 41/128 [00:02<00:05, 15.98it/s, est. speed input: 17225.77 toks/s, output: 16.82 toks/s]
Processed prompts:  34%|███▎      | 43/128 [00:02<00:05, 15.98it/s, est. speed input: 17183.24 toks/s, output: 16.78 toks/s]
Processed prompts:  35%|███▌      | 45/128 [00:02<00:05, 15.90it/s, est. speed input: 17132.29 toks/s, output: 16.73 toks/s]
Processed prompts:  37%|███▋      | 47/128 [00:02<00:05, 15.84it/s, est. speed input: 17083.66 toks/s, output: 16.68 toks/s]
Processed prompts:  38%|███▊      | 49/128 [00:02<00:05, 15.73it/s, est. speed input: 17029.96 toks/s, output: 16.63 toks/s]
Processed prompts:  40%|███▉      | 51/128 [00:03<00:04, 15.71it/s, est. speed input: 16988.91 toks/s, output: 16.59 toks/s]
Processed prompts:  41%|████▏     | 53/128 [00:03<00:04, 15.73it/s, est. speed input: 16956.39 toks/s, output: 16.56 toks/s]
Processed prompts:  43%|████▎     | 55/128 [00:03<00:04, 15.77it/s, est. speed input: 16928.56 toks/s, output: 16.53 toks/s]
Processed prompts:  45%|████▍     | 57/128 [00:03<00:04, 15.29it/s, est. speed input: 16835.56 toks/s, output: 16.44 toks/s]
Processed prompts:  46%|████▌     | 59/128 [00:03<00:04, 15.48it/s, est. speed input: 16817.75 toks/s, output: 16.42 toks/s]
Processed prompts:  48%|████▊     | 61/128 [00:03<00:04, 15.63it/s, est. speed input: 16802.29 toks/s, output: 16.41 toks/s]
Processed prompts:  49%|████▉     | 63/128 [00:03<00:04, 15.77it/s, est. speed input: 16792.46 toks/s, output: 16.40 toks/s]
Processed prompts:  51%|█████     | 65/128 [00:03<00:03, 15.84it/s, est. speed input: 16779.72 toks/s, output: 16.39 toks/s]
Processed prompts:  52%|█████▏    | 67/128 [00:04<00:03, 15.91it/s, est. speed input: 16769.79 toks/s, output: 16.38 toks/s]
Processed prompts:  54%|█████▍    | 69/128 [00:04<00:03, 15.85it/s, est. speed input: 16749.23 toks/s, output: 16.36 toks/s]
Processed prompts:  55%|█████▌    | 71/128 [00:04<00:03, 15.86it/s, est. speed input: 16735.30 toks/s, output: 16.34 toks/s]
Processed prompts:  57%|█████▋    | 73/128 [00:04<00:03, 15.87it/s, est. speed input: 16722.37 toks/s, output: 16.33 toks/s]
Processed prompts:  59%|█████▊    | 75/128 [00:04<00:03, 15.87it/s, est. speed input: 16709.48 toks/s, output: 16.32 toks/s]
Processed prompts:  60%|██████    | 77/128 [00:04<00:03, 15.85it/s, est. speed input: 16695.53 toks/s, output: 16.30 toks/s]
Processed prompts:  62%|██████▏   | 79/128 [00:04<00:03, 15.81it/s, est. speed input: 16679.83 toks/s, output: 16.29 toks/s]
Processed prompts:  63%|██████▎   | 81/128 [00:04<00:02, 15.72it/s, est. speed input: 16659.30 toks/s, output: 16.27 toks/s]
Processed prompts:  65%|██████▍   | 83/128 [00:05<00:02, 15.70it/s, est. speed input: 16643.68 toks/s, output: 16.25 toks/s]
Processed prompts:  66%|██████▋   | 85/128 [00:05<00:02, 15.71it/s, est. speed input: 16630.57 toks/s, output: 16.24 toks/s]
Processed prompts:  68%|██████▊   | 87/128 [00:05<00:02, 15.75it/s, est. speed input: 16620.63 toks/s, output: 16.23 toks/s]
Processed prompts:  70%|██████▉   | 89/128 [00:05<00:02, 15.76it/s, est. speed input: 16610.35 toks/s, output: 16.22 toks/s]
Processed prompts:  71%|███████   | 91/128 [00:05<00:02, 15.76it/s, est. speed input: 16599.66 toks/s, output: 16.21 toks/s]
Processed prompts:  73%|███████▎  | 93/128 [00:05<00:02, 15.73it/s, est. speed input: 16586.78 toks/s, output: 16.20 toks/s]
Processed prompts:  74%|███████▍  | 95/128 [00:05<00:02, 15.74it/s, est. speed input: 16577.49 toks/s, output: 16.19 toks/s]
Processed prompts:  76%|███████▌  | 97/128 [00:05<00:01, 15.73it/s, est. speed input: 16567.24 toks/s, output: 16.18 toks/s]
Processed prompts:  77%|███████▋  | 99/128 [00:06<00:01, 14.74it/s, est. speed input: 16481.21 toks/s, output: 16.09 toks/s]
Processed prompts:  79%|███████▉  | 101/128 [00:06<00:01, 15.15it/s, est. speed input: 16483.08 toks/s, output: 16.10 toks/s]
Processed prompts:  80%|████████  | 103/128 [00:06<00:01, 15.42it/s, est. speed input: 16482.98 toks/s, output: 16.10 toks/s]
Processed prompts:  82%|████████▏ | 105/128 [00:06<00:01, 15.66it/s, est. speed input: 16485.60 toks/s, output: 16.10 toks/s]
Processed prompts:  84%|████████▎ | 107/128 [00:06<00:01, 15.77it/s, est. speed input: 16484.26 toks/s, output: 16.10 toks/s]
Processed prompts:  85%|████████▌ | 109/128 [00:06<00:01, 15.82it/s, est. speed input: 16481.70 toks/s, output: 16.10 toks/s]
Processed prompts:  87%|████████▋ | 111/128 [00:06<00:01, 15.82it/s, est. speed input: 16476.07 toks/s, output: 16.09 toks/s]
Processed prompts:  88%|████████▊ | 113/128 [00:07<00:00, 15.72it/s, est. speed input: 16464.68 toks/s, output: 16.08 toks/s]
Processed prompts:  90%|████████▉ | 115/128 [00:07<00:00, 15.69it/s, est. speed input: 16456.80 toks/s, output: 16.07 toks/s]
Processed prompts:  91%|█████████▏| 117/128 [00:07<00:00, 15.73it/s, est. speed input: 16451.97 toks/s, output: 16.07 toks/s]
Processed prompts:  93%|█████████▎| 119/128 [00:07<00:00, 15.73it/s, est. speed input: 16445.98 toks/s, output: 16.06 toks/s]
Processed prompts:  95%|█████████▍| 121/128 [00:07<00:00, 15.58it/s, est. speed input: 16431.65 toks/s, output: 16.05 toks/s]
Processed prompts:  96%|█████████▌| 123/128 [00:07<00:00, 15.76it/s, est. speed input: 16433.88 toks/s, output: 16.05 toks/s]
Processed prompts:  98%|█████████▊| 125/128 [00:07<00:00, 15.85it/s, est. speed input: 16434.11 toks/s, output: 16.05 toks/s]
Processed prompts:  99%|█████████▉| 127/128 [00:07<00:00, 15.92it/s, est. speed input: 16434.87 toks/s, output: 16.05 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 15.92it/s, est. speed input: 16435.10 toks/s, output: 16.05 toks/s]
Processed prompts: 100%|██████████| 128/128 [00:07<00:00, 16.05it/s, est. speed input: 16435.10 toks/s, output: 16.05 toks/s]
[rank0]:[W128 10:12:11.837634577 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 439.5s

测试结果:
  Requests/s:   15.39
  Tokens/s:     15769.87
  Total Reqs:   128
  Elapsed:      8.32s

  [Prefill 分析]
  Total Prefill Tokens: 131072
  Prefill Tokens/s:     15754.49

============================================================
[3/7] 测试 M=2048
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 2048
│   M_prefill     = 2048 (= 2 x 1024)
│   M_decode      = 2
│   batched_tokens = 2048 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 256
│   --max-num-seqs           = 2
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 2048
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 10:13:49 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 10:13:50 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=907105) WARNING 01-28 10:15:21 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=907105) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=907105) WARNING 01-28 10:17:34 [backends.py:609] Failed to read file <frozen os>
Throughput: 29.56 requests/s, 30300.05 total tokens/s, 29.56 output tokens/s
Total num prompt tokens:  262144
Total num output tokens:  256


─── STDERR ───
[2026-01-28 10:13:33] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:13:49] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:13:49] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:13:49] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:13:49] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:13:49] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:13:49] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:13:49] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:13:49] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:13:49] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:13:49] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:13:49] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:13:49] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:13:49] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 10:14:42] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:14:46] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:14:46] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:14:46] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:14:46] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:14:46] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:14:46] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:14:46] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:14:46] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:14:46] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:14:46] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:14:46] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:14:46] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:14:46] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=907105) [2026-01-28 10:15:30] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=907105) [2026-01-28 10:15:30] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=907105) [2026-01-28 10:15:30] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=907105) [2026-01-28 10:15:30] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=907105) [2026-01-28 10:15:30] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=907105) [2026-01-28 10:15:30] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=907105) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=907105) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.47it/s]
(EngineCore_DP0 pid=907105) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.47it/s]
(EngineCore_DP0 pid=907105) 
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=907105) [2026-01-28 10:16:27] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=907105) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  33%|███▎      | 1/3 [00:01<00:03,  1.54s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  67%|██████▋   | 2/3 [00:02<00:01,  1.23s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:03<00:00,  1.17s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 3/3 [00:03<00:00,  1.22s/it]
(EngineCore_DP0 pid=907105) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/2 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 1/2 [00:00<00:00,  1.45it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.07it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 2/2 [00:01<00:00,  1.12it/s]

Adding requests:   0%|          | 0/256 [00:00<?, ?it/s]
Adding requests:  13%|█▎        | 34/256 [00:00<00:00, 336.93it/s]
Adding requests:  28%|██▊       | 72/256 [00:00<00:00, 358.33it/s]
Adding requests:  43%|████▎     | 109/256 [00:00<00:00, 361.98it/s]
Adding requests:  57%|█████▋    | 146/256 [00:00<00:00, 360.59it/s]
Adding requests:  71%|███████▏  | 183/256 [00:00<00:00, 329.26it/s]
Adding requests:  85%|████████▌ | 218/256 [00:00<00:00, 333.57it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 345.46it/s]
Adding requests: 100%|██████████| 256/256 [00:00<00:00, 345.42it/s]

Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   5%|▍         | 12/256 [00:00<00:02, 105.10it/s, est. speed input: 107643.29 toks/s, output: 105.10 toks/s]
Processed prompts:   9%|▉         | 23/256 [00:00<00:04, 48.84it/s, est. speed input: 54591.26 toks/s, output: 53.31 toks/s]   
Processed prompts:  12%|█▏        | 30/256 [00:00<00:05, 38.40it/s, est. speed input: 44570.26 toks/s, output: 43.52 toks/s]
Processed prompts:  14%|█▎        | 35/256 [00:00<00:05, 38.24it/s, est. speed input: 43620.22 toks/s, output: 42.60 toks/s]
Processed prompts:  16%|█▌        | 40/256 [00:01<00:06, 33.80it/s, est. speed input: 40305.09 toks/s, output: 39.36 toks/s]
Processed prompts:  17%|█▋        | 44/256 [00:01<00:06, 33.06it/s, est. speed input: 39323.71 toks/s, output: 38.40 toks/s]
Processed prompts:  19%|█▉        | 48/256 [00:01<00:06, 32.56it/s, est. speed input: 38573.13 toks/s, output: 37.67 toks/s]
Processed prompts:  20%|██        | 52/256 [00:01<00:06, 32.10it/s, est. speed input: 37932.27 toks/s, output: 37.04 toks/s]
Processed prompts:  22%|██▏       | 56/256 [00:01<00:06, 31.65it/s, est. speed input: 37361.61 toks/s, output: 36.49 toks/s]
Processed prompts:  23%|██▎       | 60/256 [00:01<00:06, 31.45it/s, est. speed input: 36923.05 toks/s, output: 36.06 toks/s]
Processed prompts:  25%|██▌       | 64/256 [00:01<00:06, 31.28it/s, est. speed input: 36537.30 toks/s, output: 35.68 toks/s]
Processed prompts:  27%|██▋       | 68/256 [00:01<00:06, 31.09it/s, est. speed input: 36188.33 toks/s, output: 35.34 toks/s]
Processed prompts:  28%|██▊       | 72/256 [00:02<00:05, 30.97it/s, est. speed input: 35884.42 toks/s, output: 35.04 toks/s]
Processed prompts:  30%|██▉       | 76/256 [00:02<00:05, 30.93it/s, est. speed input: 35628.93 toks/s, output: 34.79 toks/s]
Processed prompts:  31%|███▏      | 80/256 [00:02<00:05, 30.93it/s, est. speed input: 35407.87 toks/s, output: 34.58 toks/s]
Processed prompts:  33%|███▎      | 84/256 [00:02<00:05, 30.85it/s, est. speed input: 35193.40 toks/s, output: 34.37 toks/s]
Processed prompts:  34%|███▍      | 88/256 [00:02<00:05, 30.87it/s, est. speed input: 35015.41 toks/s, output: 34.19 toks/s]
Processed prompts:  36%|███▌      | 92/256 [00:02<00:05, 30.99it/s, est. speed input: 34873.58 toks/s, output: 34.06 toks/s]
Processed prompts:  38%|███▊      | 96/256 [00:02<00:05, 31.15it/s, est. speed input: 34757.31 toks/s, output: 33.94 toks/s]
Processed prompts:  39%|███▉      | 100/256 [00:02<00:04, 31.23it/s, est. speed input: 34646.31 toks/s, output: 33.83 toks/s]
Processed prompts:  41%|████      | 104/256 [00:03<00:04, 31.29it/s, est. speed input: 34545.57 toks/s, output: 33.74 toks/s]
Processed prompts:  42%|████▏     | 108/256 [00:03<00:05, 29.01it/s, est. speed input: 34089.18 toks/s, output: 33.29 toks/s]
Processed prompts:  44%|████▍     | 112/256 [00:03<00:04, 29.62it/s, est. speed input: 34005.64 toks/s, output: 33.21 toks/s]
Processed prompts:  45%|████▌     | 116/256 [00:03<00:04, 30.00it/s, est. speed input: 33919.92 toks/s, output: 33.12 toks/s]
Processed prompts:  47%|████▋     | 120/256 [00:03<00:04, 30.24it/s, est. speed input: 33835.77 toks/s, output: 33.04 toks/s]
Processed prompts:  48%|████▊     | 124/256 [00:03<00:04, 30.55it/s, est. speed input: 33774.55 toks/s, output: 32.98 toks/s]
Processed prompts:  50%|█████     | 128/256 [00:03<00:04, 30.82it/s, est. speed input: 33723.51 toks/s, output: 32.93 toks/s]
Processed prompts:  52%|█████▏    | 132/256 [00:04<00:04, 30.92it/s, est. speed input: 33665.57 toks/s, output: 32.88 toks/s]
Processed prompts:  53%|█████▎    | 136/256 [00:04<00:03, 30.95it/s, est. speed input: 33606.48 toks/s, output: 32.82 toks/s]
Processed prompts:  55%|█████▍    | 140/256 [00:04<00:03, 31.13it/s, est. speed input: 33568.11 toks/s, output: 32.78 toks/s]
Processed prompts:  56%|█████▋    | 144/256 [00:04<00:03, 31.24it/s, est. speed input: 33530.06 toks/s, output: 32.74 toks/s]
Processed prompts:  58%|█████▊    | 148/256 [00:04<00:03, 31.40it/s, est. speed input: 33503.08 toks/s, output: 32.72 toks/s]
Processed prompts:  59%|█████▉    | 152/256 [00:04<00:03, 31.46it/s, est. speed input: 33471.19 toks/s, output: 32.69 toks/s]
Processed prompts:  61%|██████    | 156/256 [00:04<00:03, 31.44it/s, est. speed input: 33436.07 toks/s, output: 32.65 toks/s]
Processed prompts:  62%|██████▎   | 160/256 [00:04<00:03, 31.36it/s, est. speed input: 33396.30 toks/s, output: 32.61 toks/s]
Processed prompts:  64%|██████▍   | 164/256 [00:05<00:02, 31.39it/s, est. speed input: 33367.02 toks/s, output: 32.58 toks/s]
Processed prompts:  66%|██████▌   | 168/256 [00:05<00:02, 31.47it/s, est. speed input: 33343.44 toks/s, output: 32.56 toks/s]
Processed prompts:  67%|██████▋   | 172/256 [00:05<00:02, 31.46it/s, est. speed input: 33315.36 toks/s, output: 32.53 toks/s]
Processed prompts:  69%|██████▉   | 176/256 [00:05<00:02, 31.44it/s, est. speed input: 33287.72 toks/s, output: 32.51 toks/s]
Processed prompts:  70%|███████   | 180/256 [00:05<00:02, 31.24it/s, est. speed input: 33246.71 toks/s, output: 32.47 toks/s]
Processed prompts:  72%|███████▏  | 184/256 [00:05<00:02, 31.21it/s, est. speed input: 33215.64 toks/s, output: 32.44 toks/s]
Processed prompts:  73%|███████▎  | 188/256 [00:05<00:02, 31.21it/s, est. speed input: 33187.97 toks/s, output: 32.41 toks/s]
Processed prompts:  75%|███████▌  | 192/256 [00:05<00:02, 31.31it/s, est. speed input: 33169.08 toks/s, output: 32.39 toks/s]
Processed prompts:  77%|███████▋  | 196/256 [00:06<00:01, 31.43it/s, est. speed input: 33154.40 toks/s, output: 32.38 toks/s]
Processed prompts:  78%|███████▊  | 200/256 [00:06<00:01, 31.59it/s, est. speed input: 33146.08 toks/s, output: 32.37 toks/s]
Processed prompts:  80%|███████▉  | 204/256 [00:06<00:01, 31.80it/s, est. speed input: 33144.78 toks/s, output: 32.37 toks/s]
Processed prompts:  81%|████████▏ | 208/256 [00:07<00:04, 11.13it/s, est. speed input: 29553.35 toks/s, output: 28.86 toks/s]
Processed prompts:  83%|████████▎ | 212/256 [00:07<00:03, 13.86it/s, est. speed input: 29614.62 toks/s, output: 28.92 toks/s]
Processed prompts:  84%|████████▍ | 216/256 [00:07<00:02, 16.72it/s, est. speed input: 29670.45 toks/s, output: 28.97 toks/s]
Processed prompts:  86%|████████▌ | 220/256 [00:07<00:01, 19.54it/s, est. speed input: 29725.21 toks/s, output: 29.03 toks/s]
Processed prompts:  88%|████████▊ | 224/256 [00:07<00:01, 22.14it/s, est. speed input: 29776.43 toks/s, output: 29.08 toks/s]
Processed prompts:  89%|████████▉ | 228/256 [00:07<00:01, 24.43it/s, est. speed input: 29827.09 toks/s, output: 29.13 toks/s]
Processed prompts:  91%|█████████ | 232/256 [00:07<00:00, 26.36it/s, est. speed input: 29878.24 toks/s, output: 29.18 toks/s]
Processed prompts:  92%|█████████▏| 236/256 [00:08<00:00, 27.91it/s, est. speed input: 29927.87 toks/s, output: 29.23 toks/s]
Processed prompts:  94%|█████████▍| 240/256 [00:08<00:00, 29.01it/s, est. speed input: 29970.26 toks/s, output: 29.27 toks/s]
Processed prompts:  95%|█████████▌| 244/256 [00:08<00:00, 29.97it/s, est. speed input: 30019.01 toks/s, output: 29.32 toks/s]
Processed prompts:  97%|█████████▋| 248/256 [00:08<00:00, 30.60it/s, est. speed input: 30062.35 toks/s, output: 29.36 toks/s]
Processed prompts:  98%|█████████▊| 252/256 [00:08<00:00, 30.87it/s, est. speed input: 30094.74 toks/s, output: 29.39 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 31.34it/s, est. speed input: 30140.05 toks/s, output: 29.43 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 31.34it/s, est. speed input: 30140.05 toks/s, output: 29.43 toks/s]
Processed prompts: 100%|██████████| 256/256 [00:08<00:00, 29.43it/s, est. speed input: 30140.05 toks/s, output: 29.43 toks/s]
[rank0]:[W128 10:19:42.742596736 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 487.5s

测试结果:
  Requests/s:   29.56
  Tokens/s:     30300.05
  Total Reqs:   256
  Elapsed:      8.66s

  [Prefill 分析]
  Total Prefill Tokens: 262144
  Prefill Tokens/s:     30270.49

============================================================
[4/7] 测试 M=4096
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 4096
│   M_prefill     = 4096 (= 4 x 1024)
│   M_decode      = 4
│   batched_tokens = 4096 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 512
│   --max-num-seqs           = 4
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 4096
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 10:22:00 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 10:22:01 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=910936) WARNING 01-28 10:23:44 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=910936) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=910936) WARNING 01-28 10:25:21 [backends.py:609] Failed to read file <frozen os>
Throughput: 57.45 requests/s, 58881.16 total tokens/s, 57.45 output tokens/s
Total num prompt tokens:  524288
Total num output tokens:  512


─── STDERR ───
[2026-01-28 10:21:55] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:22:00] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:22:00] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:22:00] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:00] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:00] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:00] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:00] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:00] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:22:00] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:22:00] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:22:00] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:22:00] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:22:00] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 10:22:24] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:22:45] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:22:45] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:22:45] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:45] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:45] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:45] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:45] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:22:45] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:22:45] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:22:45] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:22:45] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:22:45] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:22:45] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[W128 10:23:43.989633623 socket.cpp:209] [c10d] The hostname of the client socket cannot be retrieved. err=-3
(EngineCore_DP0 pid=910936) [2026-01-28 10:23:47] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=910936) [2026-01-28 10:23:47] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=910936) [2026-01-28 10:23:47] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=910936) [2026-01-28 10:23:47] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=910936) [2026-01-28 10:23:47] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=910936) [2026-01-28 10:23:47] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=910936) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=910936) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=910936) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.42it/s]
(EngineCore_DP0 pid=910936) 
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:16] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:17] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:17] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:19] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:19] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:19] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:19] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=910936) [2026-01-28 10:24:20] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=910936) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  25%|██▌       | 1/4 [00:04<00:14,  4.80s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  50%|█████     | 2/4 [00:10<00:10,  5.15s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  75%|███████▌  | 3/4 [00:14<00:04,  4.66s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:20<00:00,  5.44s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 4/4 [00:20<00:00,  5.23s/it]
(EngineCore_DP0 pid=910936) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/3 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  33%|███▎      | 1/3 [00:01<00:02,  1.23s/it]
Capturing CUDA graphs (decode, FULL):  67%|██████▋   | 2/3 [00:02<00:01,  1.26s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:02<00:00,  1.18it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 3/3 [00:02<00:00,  1.05it/s]

Adding requests:   0%|          | 0/512 [00:00<?, ?it/s]
Adding requests:   7%|▋         | 36/512 [00:00<00:01, 353.86it/s]
Adding requests:  15%|█▍        | 75/512 [00:00<00:01, 371.37it/s]
Adding requests:  22%|██▏       | 113/512 [00:00<00:01, 372.88it/s]
Adding requests:  29%|██▉       | 151/512 [00:00<00:00, 368.28it/s]
Adding requests:  37%|███▋      | 188/512 [00:00<00:00, 361.75it/s]
Adding requests:  44%|████▍     | 225/512 [00:00<00:00, 362.02it/s]
Adding requests:  51%|█████▏    | 263/512 [00:00<00:00, 366.57it/s]
Adding requests:  59%|█████▊    | 300/512 [00:00<00:00, 360.86it/s]
Adding requests:  66%|██████▌   | 337/512 [00:00<00:00, 361.89it/s]
Adding requests:  73%|███████▎  | 375/512 [00:01<00:00, 364.31it/s]
Adding requests:  81%|████████  | 413/512 [00:01<00:00, 366.04it/s]
Adding requests:  88%|████████▊ | 451/512 [00:01<00:00, 368.99it/s]
Adding requests:  95%|█████████▌| 488/512 [00:01<00:00, 351.73it/s]
Adding requests: 100%|██████████| 512/512 [00:01<00:00, 361.09it/s]

Processed prompts:   0%|          | 0/512 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:  13%|█▎        | 66/512 [00:00<00:01, 424.06it/s, est. speed input: 434313.66 toks/s, output: 424.08 toks/s]
Processed prompts:  21%|██▏       | 109/512 [00:00<00:03, 115.77it/s, est. speed input: 136585.02 toks/s, output: 133.38 toks/s]
Processed prompts:  26%|██▌       | 131/512 [00:01<00:04, 90.13it/s, est. speed input: 110437.65 toks/s, output: 107.85 toks/s] 
Processed prompts:  29%|██▊       | 146/512 [00:01<00:04, 80.39it/s, est. speed input: 100968.62 toks/s, output: 98.60 toks/s] 
Processed prompts:  31%|███       | 157/512 [00:01<00:04, 80.82it/s, est. speed input: 99645.66 toks/s, output: 97.31 toks/s] 
Processed prompts:  33%|███▎      | 167/512 [00:01<00:04, 72.63it/s, est. speed input: 94348.15 toks/s, output: 92.14 toks/s]
Processed prompts:  34%|███▍      | 176/512 [00:01<00:04, 71.67it/s, est. speed input: 92658.39 toks/s, output: 90.49 toks/s]
Processed prompts:  36%|███▌      | 184/512 [00:02<00:04, 69.07it/s, est. speed input: 90669.38 toks/s, output: 88.54 toks/s]
Processed prompts:  38%|███▊      | 192/512 [00:02<00:04, 66.94it/s, est. speed input: 88933.60 toks/s, output: 86.85 toks/s]
Processed prompts:  39%|███▉      | 199/512 [00:02<00:04, 63.29it/s, est. speed input: 86958.90 toks/s, output: 84.92 toks/s]
Processed prompts:  40%|████      | 206/512 [00:02<00:05, 60.45it/s, est. speed input: 85191.98 toks/s, output: 83.19 toks/s]
Processed prompts:  42%|████▏     | 214/512 [00:02<00:04, 60.39it/s, est. speed input: 83995.89 toks/s, output: 82.03 toks/s]
Processed prompts:  43%|████▎     | 222/512 [00:02<00:04, 60.32it/s, est. speed input: 82909.34 toks/s, output: 80.97 toks/s]
Processed prompts:  45%|████▍     | 230/512 [00:02<00:04, 60.28it/s, est. speed input: 81924.04 toks/s, output: 80.00 toks/s]
Processed prompts:  46%|████▋     | 238/512 [00:03<00:04, 60.26it/s, est. speed input: 81029.35 toks/s, output: 79.13 toks/s]
Processed prompts:  48%|████▊     | 246/512 [00:03<00:04, 60.24it/s, est. speed input: 80209.18 toks/s, output: 78.33 toks/s]
Processed prompts:  50%|████▉     | 254/512 [00:03<00:04, 60.21it/s, est. speed input: 79452.43 toks/s, output: 77.59 toks/s]
Processed prompts:  51%|█████     | 262/512 [00:03<00:04, 60.16it/s, est. speed input: 78749.11 toks/s, output: 76.90 toks/s]
Processed prompts:  53%|█████▎    | 270/512 [00:03<00:04, 60.14it/s, est. speed input: 78101.85 toks/s, output: 76.27 toks/s]
Processed prompts:  54%|█████▍    | 278/512 [00:03<00:03, 60.12it/s, est. speed input: 77499.98 toks/s, output: 75.68 toks/s]
Processed prompts:  56%|█████▌    | 286/512 [00:03<00:03, 60.13it/s, est. speed input: 76944.93 toks/s, output: 75.14 toks/s]
Processed prompts:  57%|█████▋    | 294/512 [00:03<00:03, 60.16it/s, est. speed input: 76429.61 toks/s, output: 74.64 toks/s]
Processed prompts:  59%|█████▉    | 302/512 [00:04<00:03, 60.16it/s, est. speed input: 75946.28 toks/s, output: 74.17 toks/s]
Processed prompts:  61%|██████    | 310/512 [00:04<00:03, 60.16it/s, est. speed input: 75491.90 toks/s, output: 73.72 toks/s]
Processed prompts:  62%|██████▏   | 318/512 [00:04<00:03, 60.21it/s, est. speed input: 75072.07 toks/s, output: 73.31 toks/s]
Processed prompts:  64%|██████▎   | 326/512 [00:04<00:03, 60.24it/s, est. speed input: 74677.52 toks/s, output: 72.93 toks/s]
Processed prompts:  65%|██████▌   | 334/512 [00:04<00:02, 60.24it/s, est. speed input: 74302.24 toks/s, output: 72.56 toks/s]
Processed prompts:  67%|██████▋   | 342/512 [00:04<00:02, 60.18it/s, est. speed input: 73941.79 toks/s, output: 72.21 toks/s]
Processed prompts:  68%|██████▊   | 350/512 [00:04<00:02, 60.19it/s, est. speed input: 73606.98 toks/s, output: 71.88 toks/s]
Processed prompts:  70%|██████▉   | 358/512 [00:05<00:02, 60.22it/s, est. speed input: 73291.91 toks/s, output: 71.57 toks/s]
Processed prompts:  71%|███████▏  | 366/512 [00:05<00:02, 60.19it/s, est. speed input: 72988.18 toks/s, output: 71.28 toks/s]
Processed prompts:  73%|███████▎  | 374/512 [00:05<00:02, 60.21it/s, est. speed input: 72703.84 toks/s, output: 71.00 toks/s]
Processed prompts:  75%|███████▍  | 382/512 [00:05<00:02, 60.18it/s, est. speed input: 72429.28 toks/s, output: 70.73 toks/s]
Processed prompts:  76%|███████▌  | 390/512 [00:05<00:02, 60.17it/s, est. speed input: 72168.85 toks/s, output: 70.48 toks/s]
Processed prompts:  78%|███████▊  | 398/512 [00:05<00:01, 60.16it/s, est. speed input: 71920.07 toks/s, output: 70.23 toks/s]
Processed prompts:  79%|███████▉  | 406/512 [00:05<00:01, 60.28it/s, est. speed input: 71694.47 toks/s, output: 70.01 toks/s]
Processed prompts:  81%|████████  | 414/512 [00:05<00:01, 60.59it/s, est. speed input: 71498.32 toks/s, output: 69.82 toks/s]
Processed prompts:  82%|████████▏ | 422/512 [00:06<00:01, 60.82it/s, est. speed input: 71312.47 toks/s, output: 69.64 toks/s]
Processed prompts:  84%|████████▍ | 430/512 [00:06<00:01, 60.87it/s, est. speed input: 71124.47 toks/s, output: 69.46 toks/s]
Processed prompts:  86%|████████▌ | 438/512 [00:06<00:01, 61.05it/s, est. speed input: 70955.77 toks/s, output: 69.29 toks/s]
Processed prompts:  87%|████████▋ | 446/512 [00:06<00:01, 61.16it/s, est. speed input: 70792.88 toks/s, output: 69.13 toks/s]
Processed prompts:  89%|████████▊ | 454/512 [00:06<00:00, 61.24it/s, est. speed input: 70636.72 toks/s, output: 68.98 toks/s]
Processed prompts:  90%|█████████ | 462/512 [00:06<00:00, 61.29it/s, est. speed input: 70486.15 toks/s, output: 68.83 toks/s]
Processed prompts:  92%|█████████▏| 470/512 [00:06<00:00, 61.23it/s, est. speed input: 70334.75 toks/s, output: 68.69 toks/s]
Processed prompts:  93%|█████████▎| 478/512 [00:06<00:00, 61.24it/s, est. speed input: 70192.15 toks/s, output: 68.55 toks/s]
Processed prompts:  95%|█████████▍| 486/512 [00:07<00:00, 61.28it/s, est. speed input: 70057.32 toks/s, output: 68.42 toks/s]
Processed prompts:  96%|█████████▋| 494/512 [00:07<00:00, 61.30it/s, est. speed input: 69927.20 toks/s, output: 68.29 toks/s]
Processed prompts:  98%|█████████▊| 502/512 [00:07<00:00, 61.39it/s, est. speed input: 69806.05 toks/s, output: 68.17 toks/s]
Processed prompts: 100%|█████████▉| 510/512 [00:07<00:00, 61.56it/s, est. speed input: 69696.38 toks/s, output: 68.06 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 61.56it/s, est. speed input: 69967.94 toks/s, output: 68.33 toks/s]
Processed prompts: 100%|██████████| 512/512 [00:07<00:00, 68.33it/s, est. speed input: 69967.94 toks/s, output: 68.33 toks/s]
[rank0]:[W128 10:27:02.601461637 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 367.0s

测试结果:
  Requests/s:   57.45
  Tokens/s:     58881.16
  Total Reqs:   512
  Elapsed:      8.91s

  [Prefill 分析]
  Total Prefill Tokens: 524288
  Prefill Tokens/s:     58823.71

============================================================
[5/7] 测试 M=8192
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 8192
│   M_prefill     = 8192 (= 8 x 1024)
│   M_decode      = 8
│   batched_tokens = 8192 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 1024
│   --max-num-seqs           = 8
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 8192
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 10:28:20 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 10:28:21 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=914003) WARNING 01-28 10:30:08 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=914003) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=914003) WARNING 01-28 10:31:26 [backends.py:609] Failed to read file <frozen os>
Throughput: 49.88 requests/s, 51127.17 total tokens/s, 49.88 output tokens/s
Total num prompt tokens:  1048576
Total num output tokens:  1024


─── STDERR ───
[2026-01-28 10:27:59] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:28:20] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:28:20] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:28:20] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:28:20] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:28:20] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:28:20] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:28:20] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:28:20] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:28:20] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:28:20] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:28:20] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:28:20] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:28:20] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 10:29:06] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:29:12] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:29:12] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:29:12] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:29:12] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:29:12] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:29:12] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:29:12] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:29:12] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:29:12] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:29:12] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:29:12] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:29:12] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:29:12] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:10] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:10] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:10] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:10] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:10] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:10] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=914003) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=914003) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.32it/s]
(EngineCore_DP0 pid=914003) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.32it/s]
(EngineCore_DP0 pid=914003) 
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:25] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=914003) [2026-01-28 10:30:26] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=914003) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  20%|██        | 1/5 [00:04<00:19,  4.83s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  40%|████      | 2/5 [00:06<00:08,  2.89s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  60%|██████    | 3/5 [00:13<00:09,  4.86s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  80%|████████  | 4/5 [00:17<00:04,  4.33s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:22<00:00,  4.83s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 5/5 [00:22<00:00,  4.56s/it]
(EngineCore_DP0 pid=914003) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/4 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  25%|██▌       | 1/4 [00:00<00:01,  1.59it/s]
Capturing CUDA graphs (decode, FULL):  50%|█████     | 2/4 [00:02<00:02,  1.23s/it]
Capturing CUDA graphs (decode, FULL):  75%|███████▌  | 3/4 [00:03<00:01,  1.20s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:04<00:00,  1.23s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 4/4 [00:04<00:00,  1.18s/it]

Adding requests:   0%|          | 0/1024 [00:00<?, ?it/s]
Adding requests:   4%|▍         | 39/1024 [00:00<00:02, 380.74it/s]
Adding requests:   8%|▊         | 81/1024 [00:00<00:02, 402.95it/s]
Adding requests:  12%|█▏        | 123/1024 [00:00<00:02, 407.31it/s]
Adding requests:  16%|█▌        | 164/1024 [00:00<00:02, 404.82it/s]
Adding requests:  20%|██        | 205/1024 [00:00<00:02, 405.49it/s]
Adding requests:  24%|██▍       | 248/1024 [00:00<00:01, 411.93it/s]
Adding requests:  28%|██▊       | 290/1024 [00:00<00:01, 412.75it/s]
Adding requests:  32%|███▏      | 332/1024 [00:00<00:01, 413.47it/s]
Adding requests:  37%|███▋      | 374/1024 [00:00<00:01, 414.01it/s]
Adding requests:  41%|████      | 417/1024 [00:01<00:01, 416.67it/s]
Adding requests:  45%|████▍     | 459/1024 [00:01<00:01, 414.03it/s]
Adding requests:  49%|████▉     | 501/1024 [00:01<00:01, 413.21it/s]
Adding requests:  53%|█████▎    | 543/1024 [00:01<00:01, 408.91it/s]
Adding requests:  57%|█████▋    | 587/1024 [00:01<00:01, 417.87it/s]
Adding requests:  62%|██████▏   | 630/1024 [00:01<00:00, 418.32it/s]
Adding requests:  66%|██████▌   | 672/1024 [00:01<00:00, 415.33it/s]
Adding requests:  70%|██████▉   | 716/1024 [00:01<00:00, 421.11it/s]
Adding requests:  74%|███████▍  | 759/1024 [00:01<00:00, 411.13it/s]
Adding requests:  78%|███████▊  | 801/1024 [00:01<00:00, 403.51it/s]
Adding requests:  82%|████████▏ | 842/1024 [00:02<00:00, 394.14it/s]
Adding requests:  86%|████████▌ | 883/1024 [00:02<00:00, 398.04it/s]
Adding requests:  90%|█████████ | 924/1024 [00:02<00:00, 400.46it/s]
Adding requests:  94%|█████████▍| 965/1024 [00:02<00:00, 400.82it/s]
Adding requests:  98%|█████████▊| 1006/1024 [00:02<00:00, 396.85it/s]
Adding requests: 100%|██████████| 1024/1024 [00:02<00:00, 407.31it/s]

Processed prompts:   0%|          | 0/1024 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/1024 [00:01<08:45,  1.94it/s, est. speed input: 1990.15 toks/s, output: 1.94 toks/s]
Processed prompts:   1%|          | 10/1024 [00:01<01:38, 10.26it/s, est. speed input: 8357.35 toks/s, output: 8.16 toks/s]
Processed prompts:   2%|▏         | 18/1024 [00:01<00:53, 18.73it/s, est. speed input: 13530.89 toks/s, output: 13.21 toks/s]
Processed prompts:   3%|▎         | 26/1024 [00:01<00:37, 26.84it/s, est. speed input: 17803.30 toks/s, output: 17.39 toks/s]
Processed prompts:   3%|▎         | 34/1024 [00:01<00:29, 34.10it/s, est. speed input: 21371.69 toks/s, output: 20.87 toks/s]
Processed prompts:   4%|▍         | 42/1024 [00:01<00:24, 40.27it/s, est. speed input: 24403.03 toks/s, output: 23.83 toks/s]
Processed prompts:   5%|▍         | 50/1024 [00:01<00:21, 45.28it/s, est. speed input: 27006.14 toks/s, output: 26.37 toks/s]
Processed prompts:   6%|▌         | 58/1024 [00:02<00:19, 49.16it/s, est. speed input: 29263.11 toks/s, output: 28.58 toks/s]
Processed prompts:   6%|▋         | 66/1024 [00:02<00:18, 52.09it/s, est. speed input: 31239.85 toks/s, output: 30.51 toks/s]
Processed prompts:   7%|▋         | 74/1024 [00:02<00:17, 54.27it/s, est. speed input: 32986.08 toks/s, output: 32.21 toks/s]
Processed prompts:   8%|▊         | 82/1024 [00:02<00:16, 55.83it/s, est. speed input: 34539.14 toks/s, output: 33.73 toks/s]
Processed prompts:   9%|▉         | 90/1024 [00:02<00:16, 57.03it/s, est. speed input: 35933.93 toks/s, output: 35.09 toks/s]
Processed prompts:  10%|▉         | 98/1024 [00:02<00:16, 57.81it/s, est. speed input: 37185.12 toks/s, output: 36.31 toks/s]
Processed prompts:  10%|█         | 106/1024 [00:02<00:15, 58.42it/s, est. speed input: 38322.94 toks/s, output: 37.42 toks/s]
Processed prompts:  11%|█         | 114/1024 [00:02<00:15, 58.83it/s, est. speed input: 39357.17 toks/s, output: 38.43 toks/s]
Processed prompts:  12%|█▏        | 122/1024 [00:03<00:15, 59.17it/s, est. speed input: 40305.34 toks/s, output: 39.36 toks/s]
Processed prompts:  13%|█▎        | 130/1024 [00:03<00:15, 59.34it/s, est. speed input: 41169.86 toks/s, output: 40.20 toks/s]
Processed prompts:  13%|█▎        | 138/1024 [00:03<00:14, 59.54it/s, est. speed input: 41972.54 toks/s, output: 40.99 toks/s]
Processed prompts:  14%|█▍        | 146/1024 [00:03<00:14, 59.63it/s, est. speed input: 42709.94 toks/s, output: 41.71 toks/s]
Processed prompts:  15%|█▌        | 154/1024 [00:03<00:14, 59.72it/s, est. speed input: 43395.49 toks/s, output: 42.38 toks/s]
Processed prompts:  16%|█▌        | 162/1024 [00:03<00:14, 59.72it/s, est. speed input: 44027.92 toks/s, output: 42.99 toks/s]
Processed prompts:  17%|█▋        | 170/1024 [00:03<00:14, 59.87it/s, est. speed input: 44627.27 toks/s, output: 43.58 toks/s]
Processed prompts:  17%|█▋        | 178/1024 [00:04<00:14, 60.04it/s, est. speed input: 45193.98 toks/s, output: 44.13 toks/s]
Processed prompts:  18%|█▊        | 186/1024 [00:04<00:13, 60.13it/s, est. speed input: 45721.64 toks/s, output: 44.65 toks/s]
Processed prompts:  19%|█▉        | 194/1024 [00:04<00:13, 60.16it/s, est. speed input: 46216.43 toks/s, output: 45.13 toks/s]
Processed prompts:  20%|█▉        | 202/1024 [00:04<00:13, 60.22it/s, est. speed input: 46680.98 toks/s, output: 45.59 toks/s]
Processed prompts:  21%|██        | 210/1024 [00:04<00:13, 60.06it/s, est. speed input: 47105.99 toks/s, output: 46.00 toks/s]
Processed prompts:  21%|██▏       | 218/1024 [00:04<00:13, 60.11it/s, est. speed input: 47516.52 toks/s, output: 46.40 toks/s]
Processed prompts:  22%|██▏       | 226/1024 [00:04<00:13, 60.17it/s, est. speed input: 47907.87 toks/s, output: 46.78 toks/s]
Processed prompts:  23%|██▎       | 234/1024 [00:04<00:13, 60.23it/s, est. speed input: 48278.96 toks/s, output: 47.15 toks/s]
Processed prompts:  24%|██▎       | 242/1024 [00:05<00:12, 60.24it/s, est. speed input: 48628.83 toks/s, output: 47.49 toks/s]
Processed prompts:  24%|██▍       | 250/1024 [00:05<00:12, 60.25it/s, est. speed input: 48960.89 toks/s, output: 47.81 toks/s]
Processed prompts:  25%|██▌       | 258/1024 [00:05<00:12, 60.21it/s, est. speed input: 49273.67 toks/s, output: 48.12 toks/s]
Processed prompts:  26%|██▌       | 266/1024 [00:05<00:12, 60.13it/s, est. speed input: 49568.78 toks/s, output: 48.41 toks/s]
Processed prompts:  27%|██▋       | 274/1024 [00:05<00:12, 60.20it/s, est. speed input: 49855.92 toks/s, output: 48.69 toks/s]
Processed prompts:  28%|██▊       | 282/1024 [00:05<00:12, 60.14it/s, est. speed input: 50124.25 toks/s, output: 48.95 toks/s]
Processed prompts:  28%|██▊       | 290/1024 [00:05<00:12, 60.16it/s, est. speed input: 50383.90 toks/s, output: 49.20 toks/s]
Processed prompts:  29%|██▉       | 298/1024 [00:06<00:12, 60.19it/s, est. speed input: 50633.50 toks/s, output: 49.45 toks/s]
Processed prompts:  30%|██▉       | 306/1024 [00:06<00:11, 60.19it/s, est. speed input: 50870.94 toks/s, output: 49.68 toks/s]
Processed prompts:  31%|███       | 314/1024 [00:06<00:11, 60.14it/s, est. speed input: 51095.08 toks/s, output: 49.90 toks/s]
Processed prompts:  31%|███▏      | 322/1024 [00:06<00:11, 60.23it/s, est. speed input: 51317.47 toks/s, output: 50.11 toks/s]
Processed prompts:  32%|███▏      | 330/1024 [00:06<00:11, 60.18it/s, est. speed input: 51525.52 toks/s, output: 50.32 toks/s]
Processed prompts:  33%|███▎      | 338/1024 [00:06<00:11, 61.76it/s, est. speed input: 51812.99 toks/s, output: 50.60 toks/s]
Processed prompts:  34%|███▍      | 346/1024 [00:06<00:11, 61.30it/s, est. speed input: 52005.65 toks/s, output: 50.79 toks/s]
Processed prompts:  35%|███▍      | 354/1024 [00:06<00:10, 61.08it/s, est. speed input: 52196.07 toks/s, output: 50.97 toks/s]
Processed prompts:  35%|███▌      | 362/1024 [00:07<00:10, 60.74it/s, est. speed input: 52369.65 toks/s, output: 51.14 toks/s]
Processed prompts:  36%|███▌      | 370/1024 [00:07<00:10, 60.51it/s, est. speed input: 52537.56 toks/s, output: 51.31 toks/s]
Processed prompts:  37%|███▋      | 378/1024 [00:07<00:10, 60.44it/s, est. speed input: 52703.23 toks/s, output: 51.47 toks/s]
Processed prompts:  38%|███▊      | 386/1024 [00:07<00:10, 60.37it/s, est. speed input: 52862.26 toks/s, output: 51.62 toks/s]
Processed prompts:  38%|███▊      | 394/1024 [00:07<00:10, 60.30it/s, est. speed input: 53014.27 toks/s, output: 51.77 toks/s]
Processed prompts:  39%|███▉      | 402/1024 [00:07<00:10, 60.24it/s, est. speed input: 53160.86 toks/s, output: 51.91 toks/s]
Processed prompts:  40%|████      | 410/1024 [00:07<00:10, 60.17it/s, est. speed input: 53301.21 toks/s, output: 52.05 toks/s]
Processed prompts:  41%|████      | 418/1024 [00:08<00:10, 60.15it/s, est. speed input: 53439.01 toks/s, output: 52.19 toks/s]
Processed prompts:  42%|████▏     | 426/1024 [00:08<00:09, 60.16it/s, est. speed input: 53571.68 toks/s, output: 52.32 toks/s]
Processed prompts:  42%|████▏     | 434/1024 [00:08<00:09, 60.10it/s, est. speed input: 53697.93 toks/s, output: 52.44 toks/s]
Processed prompts:  43%|████▎     | 442/1024 [00:08<00:09, 59.43it/s, est. speed input: 53790.81 toks/s, output: 52.53 toks/s]
Processed prompts:  44%|████▍     | 450/1024 [00:08<00:09, 59.65it/s, est. speed input: 53911.68 toks/s, output: 52.65 toks/s]
Processed prompts:  45%|████▍     | 458/1024 [00:08<00:09, 59.74it/s, est. speed input: 54027.41 toks/s, output: 52.76 toks/s]
Processed prompts:  46%|████▌     | 466/1024 [00:08<00:09, 59.88it/s, est. speed input: 54141.62 toks/s, output: 52.87 toks/s]
Processed prompts:  46%|████▋     | 474/1024 [00:08<00:09, 59.96it/s, est. speed input: 54252.50 toks/s, output: 52.98 toks/s]
Processed prompts:  47%|████▋     | 482/1024 [00:09<00:09, 59.95it/s, est. speed input: 54356.96 toks/s, output: 53.08 toks/s]
Processed prompts:  48%|████▊     | 490/1024 [00:09<00:08, 60.02it/s, est. speed input: 54461.98 toks/s, output: 53.19 toks/s]
Processed prompts:  49%|████▊     | 498/1024 [00:09<00:08, 60.00it/s, est. speed input: 54561.21 toks/s, output: 53.28 toks/s]
Processed prompts:  49%|████▉     | 506/1024 [00:09<00:08, 60.03it/s, est. speed input: 54659.65 toks/s, output: 53.38 toks/s]
Processed prompts:  50%|█████     | 514/1024 [00:09<00:08, 60.06it/s, est. speed input: 54755.56 toks/s, output: 53.47 toks/s]
Processed prompts:  51%|█████     | 522/1024 [00:09<00:08, 60.07it/s, est. speed input: 54847.39 toks/s, output: 53.56 toks/s]
Processed prompts:  52%|█████▏    | 530/1024 [00:09<00:08, 60.10it/s, est. speed input: 54938.27 toks/s, output: 53.65 toks/s]
Processed prompts:  53%|█████▎    | 538/1024 [00:10<00:08, 60.08it/s, est. speed input: 55025.68 toks/s, output: 53.74 toks/s]
Processed prompts:  53%|█████▎    | 546/1024 [00:10<00:07, 60.14it/s, est. speed input: 55113.16 toks/s, output: 53.82 toks/s]
Processed prompts:  54%|█████▍    | 554/1024 [00:10<00:07, 60.15it/s, est. speed input: 55197.00 toks/s, output: 53.90 toks/s]
Processed prompts:  55%|█████▍    | 562/1024 [00:10<00:07, 60.09it/s, est. speed input: 55277.40 toks/s, output: 53.98 toks/s]
Processed prompts:  56%|█████▌    | 570/1024 [00:10<00:07, 60.08it/s, est. speed input: 55355.39 toks/s, output: 54.06 toks/s]
Processed prompts:  56%|█████▋    | 578/1024 [00:10<00:07, 60.11it/s, est. speed input: 55433.22 toks/s, output: 54.13 toks/s]
Processed prompts:  57%|█████▋    | 586/1024 [00:10<00:07, 60.05it/s, est. speed input: 55507.04 toks/s, output: 54.21 toks/s]
Processed prompts:  58%|█████▊    | 594/1024 [00:10<00:07, 60.11it/s, est. speed input: 55581.64 toks/s, output: 54.28 toks/s]
Processed prompts:  59%|█████▉    | 602/1024 [00:11<00:07, 60.11it/s, est. speed input: 55653.27 toks/s, output: 54.35 toks/s]
Processed prompts:  60%|█████▉    | 610/1024 [00:11<00:06, 60.07it/s, est. speed input: 55721.83 toks/s, output: 54.42 toks/s]
Processed prompts:  60%|██████    | 618/1024 [00:11<00:06, 60.08it/s, est. speed input: 55790.69 toks/s, output: 54.48 toks/s]
Processed prompts:  61%|██████    | 626/1024 [00:11<00:06, 60.12it/s, est. speed input: 55858.15 toks/s, output: 54.55 toks/s]
Processed prompts:  62%|██████▏   | 634/1024 [00:11<00:06, 60.05it/s, est. speed input: 55920.74 toks/s, output: 54.61 toks/s]
Processed prompts:  63%|██████▎   | 642/1024 [00:11<00:06, 60.11it/s, est. speed input: 55986.25 toks/s, output: 54.67 toks/s]
Processed prompts:  63%|██████▎   | 650/1024 [00:11<00:06, 60.08it/s, est. speed input: 56047.58 toks/s, output: 54.73 toks/s]
Processed prompts:  64%|██████▍   | 658/1024 [00:12<00:06, 59.99it/s, est. speed input: 56105.29 toks/s, output: 54.79 toks/s]
Processed prompts:  65%|██████▌   | 666/1024 [00:12<00:05, 59.93it/s, est. speed input: 56161.64 toks/s, output: 54.85 toks/s]
Processed prompts:  66%|██████▌   | 674/1024 [00:12<00:05, 59.86it/s, est. speed input: 56215.45 toks/s, output: 54.90 toks/s]
Processed prompts:  67%|██████▋   | 682/1024 [00:12<00:05, 59.79it/s, est. speed input: 56268.62 toks/s, output: 54.95 toks/s]
Processed prompts:  67%|██████▋   | 690/1024 [00:12<00:05, 59.77it/s, est. speed input: 56320.32 toks/s, output: 55.00 toks/s]
Processed prompts:  68%|██████▊   | 698/1024 [00:12<00:05, 59.74it/s, est. speed input: 56370.63 toks/s, output: 55.05 toks/s]
Processed prompts:  69%|██████▉   | 706/1024 [00:12<00:05, 59.73it/s, est. speed input: 56420.59 toks/s, output: 55.10 toks/s]
Processed prompts:  70%|██████▉   | 714/1024 [00:12<00:05, 59.72it/s, est. speed input: 56469.35 toks/s, output: 55.15 toks/s]
Processed prompts:  71%|███████   | 722/1024 [00:13<00:05, 59.70it/s, est. speed input: 56517.00 toks/s, output: 55.19 toks/s]
Processed prompts:  71%|███████▏  | 730/1024 [00:13<00:04, 59.69it/s, est. speed input: 56563.20 toks/s, output: 55.24 toks/s]
Processed prompts:  72%|███████▏  | 738/1024 [00:13<00:04, 59.71it/s, est. speed input: 56609.67 toks/s, output: 55.28 toks/s]
Processed prompts:  73%|███████▎  | 746/1024 [00:13<00:04, 59.74it/s, est. speed input: 56655.34 toks/s, output: 55.33 toks/s]
Processed prompts:  74%|███████▎  | 754/1024 [00:13<00:04, 59.71it/s, est. speed input: 56699.01 toks/s, output: 55.37 toks/s]
Processed prompts:  74%|███████▍  | 762/1024 [00:13<00:04, 59.70it/s, est. speed input: 56741.96 toks/s, output: 55.41 toks/s]
Processed prompts:  75%|███████▌  | 770/1024 [00:13<00:04, 59.68it/s, est. speed input: 56783.64 toks/s, output: 55.45 toks/s]
Processed prompts:  76%|███████▌  | 778/1024 [00:14<00:04, 59.68it/s, est. speed input: 56825.42 toks/s, output: 55.49 toks/s]
Processed prompts:  77%|███████▋  | 786/1024 [00:14<00:03, 59.73it/s, est. speed input: 56867.25 toks/s, output: 55.53 toks/s]
Processed prompts:  78%|███████▊  | 794/1024 [00:14<00:03, 59.73it/s, est. speed input: 56907.46 toks/s, output: 55.57 toks/s]
Processed prompts:  78%|███████▊  | 802/1024 [00:14<00:03, 59.77it/s, est. speed input: 56948.15 toks/s, output: 55.61 toks/s]
Processed prompts:  79%|███████▉  | 810/1024 [00:14<00:03, 59.70it/s, est. speed input: 56985.94 toks/s, output: 55.65 toks/s]
Processed prompts:  80%|███████▉  | 818/1024 [00:14<00:03, 59.70it/s, est. speed input: 57023.44 toks/s, output: 55.69 toks/s]
Processed prompts:  81%|████████  | 826/1024 [00:14<00:03, 59.70it/s, est. speed input: 57060.84 toks/s, output: 55.72 toks/s]
Processed prompts:  81%|████████▏ | 834/1024 [00:14<00:03, 59.69it/s, est. speed input: 57096.47 toks/s, output: 55.76 toks/s]
Processed prompts:  82%|████████▏ | 842/1024 [00:15<00:03, 59.71it/s, est. speed input: 57133.15 toks/s, output: 55.79 toks/s]
Processed prompts:  83%|████████▎ | 850/1024 [00:15<00:02, 59.72it/s, est. speed input: 57168.22 toks/s, output: 55.83 toks/s]
Processed prompts:  84%|████████▍ | 858/1024 [00:15<00:02, 59.72it/s, est. speed input: 57202.91 toks/s, output: 55.86 toks/s]
Processed prompts:  85%|████████▍ | 866/1024 [00:15<00:02, 59.72it/s, est. speed input: 57237.31 toks/s, output: 55.90 toks/s]
Processed prompts:  85%|████████▌ | 874/1024 [00:15<00:02, 59.73it/s, est. speed input: 57270.99 toks/s, output: 55.93 toks/s]
Processed prompts:  86%|████████▌ | 882/1024 [00:15<00:02, 59.70it/s, est. speed input: 57303.44 toks/s, output: 55.96 toks/s]
Processed prompts:  87%|████████▋ | 890/1024 [00:15<00:02, 59.69it/s, est. speed input: 57335.56 toks/s, output: 55.99 toks/s]
Processed prompts:  88%|████████▊ | 898/1024 [00:16<00:02, 59.71it/s, est. speed input: 57367.39 toks/s, output: 56.02 toks/s]
Processed prompts:  88%|████████▊ | 906/1024 [00:16<00:01, 59.71it/s, est. speed input: 57398.79 toks/s, output: 56.05 toks/s]
Processed prompts:  89%|████████▉ | 914/1024 [00:16<00:01, 59.72it/s, est. speed input: 57430.11 toks/s, output: 56.08 toks/s]
Processed prompts:  90%|█████████ | 922/1024 [00:16<00:01, 59.76it/s, est. speed input: 57461.06 toks/s, output: 56.11 toks/s]
Processed prompts:  91%|█████████ | 930/1024 [00:16<00:01, 59.71it/s, est. speed input: 57490.05 toks/s, output: 56.14 toks/s]
Processed prompts:  92%|█████████▏| 938/1024 [00:16<00:01, 59.68it/s, est. speed input: 57518.61 toks/s, output: 56.17 toks/s]
Processed prompts:  92%|█████████▏| 946/1024 [00:16<00:01, 59.68it/s, est. speed input: 57547.19 toks/s, output: 56.20 toks/s]
Processed prompts:  93%|█████████▎| 954/1024 [00:16<00:01, 59.60it/s, est. speed input: 57573.45 toks/s, output: 56.22 toks/s]
Processed prompts:  94%|█████████▍| 962/1024 [00:17<00:01, 59.55it/s, est. speed input: 57599.71 toks/s, output: 56.25 toks/s]
Processed prompts:  95%|█████████▍| 970/1024 [00:17<00:00, 59.56it/s, est. speed input: 57625.94 toks/s, output: 56.28 toks/s]
Processed prompts:  96%|█████████▌| 978/1024 [00:17<00:00, 59.58it/s, est. speed input: 57652.41 toks/s, output: 56.30 toks/s]
Processed prompts:  96%|█████████▋| 986/1024 [00:17<00:00, 61.46it/s, est. speed input: 57723.29 toks/s, output: 56.37 toks/s]
Processed prompts:  97%|█████████▋| 994/1024 [00:17<00:00, 60.83it/s, est. speed input: 57747.06 toks/s, output: 56.39 toks/s]
Processed prompts:  98%|█████████▊| 1002/1024 [00:17<00:00, 60.41it/s, est. speed input: 57771.17 toks/s, output: 56.42 toks/s]
Processed prompts:  99%|█████████▊| 1010/1024 [00:17<00:00, 60.20it/s, est. speed input: 57796.14 toks/s, output: 56.44 toks/s]
Processed prompts:  99%|█████████▉| 1018/1024 [00:18<00:00, 62.22it/s, est. speed input: 57870.65 toks/s, output: 56.51 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:18<00:00, 62.22it/s, est. speed input: 58210.98 toks/s, output: 56.85 toks/s]
Processed prompts: 100%|██████████| 1024/1024 [00:18<00:00, 56.85it/s, est. speed input: 58210.98 toks/s, output: 56.85 toks/s]
[rank0]:[W128 10:33:27.465267864 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())

[SUCCESS] 测试完成! 耗时: 423.2s

测试结果:
  Requests/s:   49.88
  Tokens/s:     51127.17
  Total Reqs:   1024
  Elapsed:      20.53s

  [Prefill 分析]
  Total Prefill Tokens: 1048576
  Prefill Tokens/s:     51077.29

============================================================
[6/7] 测试 M=16384
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    测试参数                                  │
├─────────────────────────────────────────────────────────────┤
│ 模型:     BitNet-2B-FP8                                   │
│ Backend:  cuSPARSELt (2:4)                                │
│ 阶段:     prefill                                         │
├─────────────────────────────────────────────────────────────┤
│ GEMM M 维度 (精确控制):
│   目标 M        = 16384
│   M_prefill     = 16384 (= 16 x 1024)
│   M_decode      = 16
│   batched_tokens = 16384 (控制 M 的关键参数)
├─────────────────────────────────────────────────────────────┤
│ vLLM 参数:
│   --input-len              = 1024
│   --output-len             = 1
│   --num-prompts            = 2048
│   --max-num-seqs           = 16
│   --max-model-len          = 1025
│   --max-num-batched-tokens = 16384
│   --no-enable-chunked-prefill
├─────────────────────────────────────────────────────────────┤
│ 迭代次数:
│   N_prefill = 128
│   N_decode  = 0
└─────────────────────────────────────────────────────────────┘

[INFO] 开始测试...

─── STDOUT ───
When dataset path is not set, it will default to random dataset
WARNING 01-28 10:35:04 [arg_utils.py:1869] This model does not officially support disabling chunked prefill. Disabling this manually may cause the engine to crash or produce incorrect outputs.
WARNING 01-28 10:35:05 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=917163) WARNING 01-28 10:36:14 [interface.py:465] Using 'pin_memory=False' as WSL is detected. This may slow down the performance.
(EngineCore_DP0 pid=917163) [INFO] Loading compress extension: cusparselt_compress_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=917163) WARNING 01-28 10:38:24 [backends.py:609] Failed to read file <frozen os>
Throughput: 50.30 requests/s, 51560.37 total tokens/s, 50.30 output tokens/s
Total num prompt tokens:  2097152
Total num output tokens:  2048


─── STDERR ───
[2026-01-28 10:35:00] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:35:04] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:35:04] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:35:04] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:04] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:04] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:04] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:04] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:04] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:35:04] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:35:04] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:35:04] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:35:04] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:35:04] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
[2026-01-28 10:35:20] INFO kernels.py:578: Triton kernel custom ops registered
[2026-01-28 10:35:38] INFO kernels.py:627: Optimization enabled: Only preloading kernels for model 'BitNet-2B-FP8'
[2026-01-28 10:35:38] INFO kernels.py:109: Loaded tuned kernel for model: BitNet-2B-FP8
[2026-01-28 10:35:38] INFO kernels.py:155: Dequant+bias kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:38] INFO kernels.py:224: FP8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:38] INFO kernels.py:348: INT8 quant kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:38] INFO kernels.py:284: FP8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:38] INFO kernels.py:408: INT8 quant+slide kernel loaded for model: BitNet-2B-FP8
[2026-01-28 10:35:38] INFO gemm_wrapper.py:157: Optimization enabled: Only loading GEMM configs for model 'BitNet-2B-FP8'
[2026-01-28 10:35:38] INFO gemm_wrapper.py:172: Loaded algorithm configs: cuBLASLt=1, cuSPARSELt=1 models
[2026-01-28 10:35:38] INFO gemm_wrapper.py:944: cuBLASLt FP8 custom op registered: slidesparse::cublaslt_fp8_mm
[2026-01-28 10:35:38] INFO gemm_wrapper.py:1009: cuSPARSELt FP8 custom op registered: slidesparse::cusparselt_fp8_mm
[2026-01-28 10:35:38] INFO gemm_wrapper.py:1075: cuBLASLt INT8 custom op registered: slidesparse::cublaslt_int8_mm
[2026-01-28 10:35:38] INFO gemm_wrapper.py:1141: cuSPARSELt INT8 custom op registered: slidesparse::cusparselt_int8_mm
(EngineCore_DP0 pid=917163) [2026-01-28 10:36:27] INFO SlideSparseLinearMethod_FP8.py:734: Wrapping CompressedTensorsW8A8Fp8 with SlideSparse (cuSPARSELt)
(EngineCore_DP0 pid=917163) [2026-01-28 10:36:27] INFO gemm_wrapper.py:870: cusparselt GEMM extension loaded: cusparselt_gemm_RTX4090_cc89_py312_cu129_x86_64.so
(EngineCore_DP0 pid=917163) [2026-01-28 10:36:27] INFO SlideSparseLinearMethod_FP8.py:392: SlideSparseFp8LinearOp initialized (kernel=cuSPARSELt)
(EngineCore_DP0 pid=917163) [2026-01-28 10:36:27] INFO SlideSparseLinearMethod_FP8.py:539: SlideSparseFp8LinearMethod: cuSPARSELt sparsity=2:4, expand_ratio=2.000
(EngineCore_DP0 pid=917163) [2026-01-28 10:36:27] INFO SlideSparseLinearMethod_FP8.py:556: Preloaded FP8 Triton kernels for model: BitNet-2B-FP8
(EngineCore_DP0 pid=917163) [2026-01-28 10:36:27] INFO SlideSparseLinearMethod_FP8.py:560: SlideSparseFp8LinearMethod initialized, kernel=cuSPARSELt
(EngineCore_DP0 pid=917163) 
Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
(EngineCore_DP0 pid=917163) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.43it/s]
(EngineCore_DP0 pid=917163) 
Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:00<00:00,  1.43it/s]
(EngineCore_DP0 pid=917163) 
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [3840, 2560] -> 1D uint8
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:11] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 7372800 bytes
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 2560] -> 1D uint8
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:11] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 4915200 bytes
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:11] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [13824, 2560] -> 1D uint8
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:12] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 26542080 bytes
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:12] INFO SlideSparseLinearMethod_FP8.py:660: cuSPARSELt compression: [2560, 6912] -> 1D uint8
(EngineCore_DP0 pid=917163) [2026-01-28 10:37:12] INFO SlideSparseLinearMethod_FP8.py:670: cuSPARSELt compression done: 13271040 bytes
(EngineCore_DP0 pid=917163) 
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):   0%|          | 0/7 [00:00<?, ?it/s]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  14%|█▍        | 1/7 [00:04<00:28,  4.72s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  29%|██▊       | 2/7 [00:09<00:24,  4.89s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  43%|████▎     | 3/7 [00:10<00:12,  3.09s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  57%|█████▋    | 4/7 [00:13<00:09,  3.10s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  71%|███████▏  | 5/7 [00:22<00:10,  5.30s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE):  86%|████████▌ | 6/7 [00:27<00:04,  4.88s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:30<00:00,  4.45s/it]
Capturing CUDA graphs (mixed prefill-decode, PIECEWISE): 100%|██████████| 7/7 [00:30<00:00,  4.37s/it]
(EngineCore_DP0 pid=917163) 
Capturing CUDA graphs (decode, FULL):   0%|          | 0/5 [00:00<?, ?it/s]
Capturing CUDA graphs (decode, FULL):  20%|██        | 1/5 [00:01<00:05,  1.44s/it]
Capturing CUDA graphs (decode, FULL):  40%|████      | 2/5 [00:01<00:02,  1.17it/s]
Capturing CUDA graphs (decode, FULL):  60%|██████    | 3/5 [00:02<00:01,  1.07it/s]
Capturing CUDA graphs (decode, FULL):  80%|████████  | 4/5 [00:03<00:00,  1.20it/s]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:04<00:00,  1.03s/it]
Capturing CUDA graphs (decode, FULL): 100%|██████████| 5/5 [00:04<00:00,  1.01it/s]

Adding requests:   0%|          | 0/2048 [00:00<?, ?it/s]
Adding requests:   2%|▏         | 35/2048 [00:00<00:05, 342.59it/s]
Adding requests:   4%|▎         | 73/2048 [00:00<00:05, 362.58it/s]
Adding requests:   5%|▌         | 110/2048 [00:00<00:05, 358.52it/s]
Adding requests:   7%|▋         | 146/2048 [00:00<00:05, 357.53it/s]
Adding requests:   9%|▉         | 183/2048 [00:00<00:05, 359.57it/s]
Adding requests:  11%|█         | 221/2048 [00:00<00:05, 363.80it/s]
Adding requests:  13%|█▎        | 260/2048 [00:00<00:04, 371.86it/s]
Adding requests:  15%|█▍        | 298/2048 [00:00<00:04, 371.83it/s]
Adding requests:  16%|█▋        | 336/2048 [00:00<00:04, 368.93it/s]
Adding requests:  18%|█▊        | 374/2048 [00:01<00:04, 370.63it/s]
Adding requests:  20%|██        | 412/2048 [00:01<00:04, 371.87it/s]
Adding requests:  22%|██▏       | 451/2048 [00:01<00:04, 374.42it/s]
Adding requests:  24%|██▍       | 489/2048 [00:01<00:04, 371.87it/s]
Adding requests:  26%|██▌       | 527/2048 [00:01<00:04, 366.21it/s]
Adding requests:  28%|██▊       | 566/2048 [00:01<00:03, 372.98it/s]
Adding requests:  29%|██▉       | 604/2048 [00:01<00:03, 371.61it/s]
Adding requests:  31%|███▏      | 645/2048 [00:01<00:03, 382.16it/s]
Adding requests:  33%|███▎      | 685/2048 [00:01<00:03, 386.67it/s]
Adding requests:  35%|███▌      | 724/2048 [00:01<00:03, 387.50it/s]
Adding requests:  37%|███▋      | 763/2048 [00:02<00:03, 377.56it/s]
Adding requests:  39%|███▉      | 801/2048 [00:02<00:03, 375.57it/s]
Adding requests:  41%|████      | 839/2048 [00:02<00:03, 369.36it/s]
Adding requests:  43%|████▎     | 878/2048 [00:02<00:03, 373.91it/s]
Adding requests:  45%|████▍     | 919/2048 [00:02<00:02, 382.51it/s]
Adding requests:  47%|████▋     | 958/2048 [00:02<00:02, 384.22it/s]
Adding requests:  49%|████▊     | 998/2048 [00:02<00:02, 386.07it/s]
Adding requests:  51%|█████     | 1039/2048 [00:02<00:02, 391.66it/s]
Adding requests:  53%|█████▎    | 1079/2048 [00:02<00:02, 386.26it/s]
Adding requests:  55%|█████▍    | 1118/2048 [00:02<00:02, 383.74it/s]
Adding requests:  57%|█████▋    | 1158/2048 [00:03<00:02, 388.06it/s]
Adding requests:  59%|█████▊    | 1199/2048 [00:03<00:02, 393.21it/s]
Adding requests:  60%|██████    | 1239/2048 [00:03<00:02, 392.39it/s]
Adding requests:  62%|██████▏   | 1279/2048 [00:03<00:01, 386.25it/s]
Adding requests:  64%|██████▍   | 1318/2048 [00:03<00:01, 365.13it/s]
Adding requests:  66%|██████▋   | 1357/2048 [00:03<00:01, 369.52it/s]
Adding requests:  68%|██████▊   | 1398/2048 [00:03<00:01, 378.74it/s]
Adding requests:  70%|███████   | 1437/2048 [00:03<00:01, 380.19it/s]
Adding requests:  72%|███████▏  | 1477/2048 [00:03<00:01, 384.04it/s]
Adding requests:  74%|███████▍  | 1518/2048 [00:04<00:01, 389.45it/s]
Adding requests:  76%|███████▌  | 1558/2048 [00:04<00:01, 389.63it/s]
Adding requests:  78%|███████▊  | 1598/2048 [00:04<00:01, 392.33it/s]
Adding requests:  80%|████████  | 1639/2048 [00:04<00:01, 395.85it/s]
Adding requests:  82%|████████▏ | 1679/2048 [00:04<00:00, 383.92it/s]
Adding requests:  84%|████████▍ | 1719/2048 [00:04<00:00, 388.34it/s]
Adding requests:  86%|████████▌ | 1758/2048 [00:04<00:00, 387.39it/s]
Adding requests:  88%|████████▊ | 1797/2048 [00:04<00:00, 385.52it/s]
Adding requests:  90%|████████▉ | 1836/2048 [00:04<00:00, 386.68it/s]
Adding requests:  92%|█████████▏| 1875/2048 [00:04<00:00, 386.68it/s]
Adding requests:  93%|█████████▎| 1914/2048 [00:05<00:00, 385.87it/s]
Adding requests:  95%|█████████▌| 1953/2048 [00:05<00:00, 374.41it/s]
Adding requests:  97%|█████████▋| 1993/2048 [00:05<00:00, 379.73it/s]
Adding requests:  99%|█████████▉| 2033/2048 [00:05<00:00, 384.97it/s]
Adding requests: 100%|██████████| 2048/2048 [00:05<00:00, 379.49it/s]

Processed prompts:   0%|          | 0/2048 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
Processed prompts:   0%|          | 2/2048 [00:01<29:49,  1.14it/s, est. speed input: 1170.85 toks/s, output: 1.14 toks/s]
Processed prompts:   1%|          | 18/2048 [00:02<02:53, 11.68it/s, est. speed input: 9150.17 toks/s, output: 8.94 toks/s]
Processed prompts:   2%|▏         | 34/2048 [00:02<01:33, 21.57it/s, est. speed input: 15281.55 toks/s, output: 14.92 toks/s]
Processed prompts:   2%|▏         | 50/2048 [00:02<01:05, 30.31it/s, est. speed input: 20139.32 toks/s, output: 19.67 toks/s]
Processed prompts:   3%|▎         | 66/2048 [00:02<00:52, 37.65it/s, est. speed input: 24082.41 toks/s, output: 23.52 toks/s]
Processed prompts:   4%|▍         | 82/2048 [00:03<00:45, 43.59it/s, est. speed input: 27354.29 toks/s, output: 26.71 toks/s]
Processed prompts:   5%|▍         | 98/2048 [00:03<00:40, 48.12it/s, est. speed input: 30095.78 toks/s, output: 29.39 toks/s]
Processed prompts:   6%|▌         | 114/2048 [00:03<00:37, 51.59it/s, est. speed input: 32441.06 toks/s, output: 31.68 toks/s]
Processed prompts:   6%|▋         | 130/2048 [00:03<00:35, 54.14it/s, est. speed input: 34465.43 toks/s, output: 33.66 toks/s]
Processed prompts:   7%|▋         | 146/2048 [00:04<00:33, 56.01it/s, est. speed input: 36230.87 toks/s, output: 35.38 toks/s]
Processed prompts:   8%|▊         | 162/2048 [00:04<00:32, 57.35it/s, est. speed input: 37784.43 toks/s, output: 36.90 toks/s]
Processed prompts:   9%|▊         | 178/2048 [00:04<00:32, 58.30it/s, est. speed input: 39159.62 toks/s, output: 38.24 toks/s]
Processed prompts:   9%|▉         | 194/2048 [00:04<00:31, 58.97it/s, est. speed input: 40387.42 toks/s, output: 39.44 toks/s]
Processed prompts:  10%|█         | 210/2048 [00:05<00:30, 59.45it/s, est. speed input: 41491.25 toks/s, output: 40.52 toks/s]
Processed prompts:  11%|█         | 226/2048 [00:05<00:30, 59.81it/s, est. speed input: 42489.46 toks/s, output: 41.49 toks/s]
Processed prompts:  12%|█▏        | 242/2048 [00:05<00:30, 60.07it/s, est. speed input: 43396.86 toks/s, output: 42.38 toks/s]
Processed prompts:  13%|█▎        | 258/2048 [00:05<00:29, 60.23it/s, est. speed input: 44221.91 toks/s, output: 43.19 toks/s]
Processed prompts:  13%|█▎        | 274/2048 [00:06<00:29, 60.35it/s, est. speed input: 44976.95 toks/s, output: 43.92 toks/s]
Processed prompts:  14%|█▍        | 290/2048 [00:06<00:29, 60.41it/s, est. speed input: 45669.04 toks/s, output: 44.60 toks/s]
Processed prompts:  15%|█▍        | 306/2048 [00:06<00:28, 60.47it/s, est. speed input: 46308.53 toks/s, output: 45.22 toks/s]
Processed prompts:  16%|█▌        | 322/2048 [00:07<00:28, 60.49it/s, est. speed input: 46898.28 toks/s, output: 45.80 toks/s]
Processed prompts:  17%|█▋        | 338/2048 [00:07<00:28, 60.51it/s, est. speed input: 47445.91 toks/s, output: 46.33 toks/s]
Processed prompts:  17%|█▋        | 354/2048 [00:07<00:27, 60.53it/s, est. speed input: 47955.31 toks/s, output: 46.83 toks/s]
Processed prompts:  18%|█▊        | 370/2048 [00:07<00:27, 60.56it/s, est. speed input: 48431.78 toks/s, output: 47.30 toks/s]
Processed prompts:  19%|█▉        | 386/2048 [00:08<00:27, 60.59it/s, est. speed input: 48877.93 toks/s, output: 47.73 toks/s]
Processed prompts:  20%|█▉        | 402/2048 [00:08<00:27, 60.60it/s, est. speed input: 49294.93 toks/s, output: 48.14 toks/s]
Processed prompts:  20%|██        | 418/2048 [00:08<00:26, 60.60it/s, est. speed input: 49686.18 toks/s, output: 48.52 toks/s]
Processed prompts:  21%|██        | 434/2048 [00:08<00:26, 60.58it/s, est. speed input: 50052.63 toks/s, output: 48.88 toks/s]
Processed prompts:  22%|██▏       | 450/2048 [00:09<00:26, 60.59it/s, est. speed input: 50399.16 toks/s, output: 49.22 toks/s]
Processed prompts:  23%|██▎       | 466/2048 [00:09<00:26, 60.57it/s, est. speed input: 50724.97 toks/s, output: 49.54 toks/s]
Processed prompts:  24%|██▎       | 482/2048 [00:09<00:25, 60.55it/s, est. speed input: 51031.75 toks/s, output: 49.84 toks/s]
Processed prompts:  24%|██▍       | 498/2048 [00:09<00:25, 60.51it/s, est. speed input: 51320.67 toks/s, output: 50.12 toks/s]
Processed prompts:  25%|██▌       | 514/2048 [00:10<00:25, 60.51it/s, est. speed input: 51596.73 toks/s, output: 50.39 toks/s]
Processed prompts:  26%|██▌       | 530/2048 [00:10<00:25, 60.55it/s, est. speed input: 51861.78 toks/s, output: 50.65 toks/s]
Processed prompts:  27%|██▋       | 546/2048 [00:10<00:24, 60.51it/s, est. speed input: 52108.53 toks/s, output: 50.89 toks/s]
Processed prompts:  27%|██▋       | 562/2048 [00:10<00:24, 60.50it/s, est. speed input: 52344.78 toks/s, output: 51.12 toks/s]
Processed prompts:  28%|██▊       | 578/2048 [00:11<00:24, 60.50it/s, est. speed input: 52570.31 toks/s, output: 51.34 toks/s]
Processed prompts:  29%|██▉       | 594/2048 [00:11<00:24, 60.51it/s, est. speed input: 52786.48 toks/s, output: 51.55 toks/s]
Processed prompts:  30%|██▉       | 610/2048 [00:11<00:23, 60.52it/s, est. speed input: 52992.76 toks/s, output: 51.75 toks/s]
Processed prompts:  31%|███       | 626/2048 [00:12<00:23, 60.52it/s, est. speed input: 53189.70 toks/s, output: 51.94 toks/s]
Processed prompts:  31%|███▏      | 642/2048 [00:12<00:23, 60.53it/s, est. speed input: 53378.71 toks/s, output: 52.13 toks/s]
Processed prompts:  32%|███▏      | 658/2048 [00:12<00:22, 60.52it/s, est. speed input: 53558.80 toks/s, output: 52.30 toks/s]
Processed prompts:  33%|███▎      | 674/2048 [00:12<00:22, 60.51it/s, est. speed input: 53731.26 toks/s, output: 52.47 toks/s]
Processed prompts:  34%|███▎      | 690/2048 [00:13<00:22, 60.49it/s, est. speed input: 53896.55 toks/s, output: 52.63 toks/s]
Processed prompts:  34%|███▍      | 706/2048 [00:13<00:22, 60.49it/s, est. speed input: 54055.35 toks/s, output: 52.79 toks/s]
Processed prompts:  35%|███▌      | 722/2048 [00:13<00:21, 60.47it/s, est. speed input: 54207.18 toks/s, output: 52.94 toks/s]
Processed prompts:  36%|███▌      | 738/2048 [00:13<00:21, 60.49it/s, est. speed input: 54355.21 toks/s, output: 53.08 toks/s]
Processed prompts:  37%|███▋      | 754/2048 [00:14<00:21, 60.54it/s, est. speed input: 54499.60 toks/s, output: 53.22 toks/s]
Processed prompts:  38%|███▊      | 770/2048 [00:14<00:21, 60.45it/s, est. speed input: 54631.76 toks/s, output: 53.35 toks/s]
Processed prompts:  38%|███▊      | 786/2048 [00:14<00:20, 60.45it/s, est. speed input: 54762.62 toks/s, output: 53.48 toks/s]
Processed prompts:  39%|███▉      | 802/2048 [00:14<00:20, 60.44it/s, est. speed input: 54888.60 toks/s, output: 53.60 toks/s]
Processed prompts:  40%|███▉      | 818/2048 [00:15<00:20, 60.48it/s, est. speed input: 55012.15 toks/s, output: 53.72 toks/s]
Processed prompts:  41%|████      | 834/2048 [00:15<00:20, 60.48it/s, est. speed input: 55130.18 toks/s, output: 53.84 toks/s]
Processed prompts:  42%|████▏     | 850/2048 [00:15<00:19, 60.54it/s, est. speed input: 55247.64 toks/s, output: 53.95 toks/s]
Processed prompts:  42%|████▏     | 866/2048 [00:16<00:19, 60.47it/s, est. speed input: 55355.49 toks/s, output: 54.06 toks/s]
Processed prompts:  43%|████▎     | 882/2048 [00:16<00:19, 60.48it/s, est. speed input: 55462.39 toks/s, output: 54.16 toks/s]
Processed prompts:  44%|████▍     | 898/2048 [00:16<00:19, 60.49it/s, est. speed input: 55566.36 toks/s, output: 54.26 toks/s]
Processed prompts:  45%|████▍     | 914/2048 [00:16<00:18, 60.54it/s, est. speed input: 55669.18 toks/s, output: 54.36 toks/s]
Processed prompts:  45%|████▌     | 930/2048 [00:17<00:18, 60.46it/s, est. speed input: 55763.02 toks/s, output: 54.46 toks/s]
Processed prompts:  46%|████▌     | 946/2048 [00:17<00:18, 60.46it/s, est. speed input: 55856.89 toks/s, output: 54.55 toks/s]
Processed prompts:  47%|████▋     | 962/2048 [00:17<00:17, 60.47it/s, est. speed input: 55948.28 toks/s, output: 54.64 toks/s]
Processed prompts:  48%|████▊     | 978/2048 [00:17<00:17, 61.41it/s, est. speed input: 56079.38 toks/s, output: 54.76 toks/s]
Processed prompts:  49%|████▊     | 994/2048 [00:18<00:17, 61.13it/s, est. speed input: 56164.57 toks/s, output: 54.85 toks/s]
Processed prompts:  49%|████▉     | 1010/2048 [00:18<00:17, 60.93it/s, est. speed input: 56247.72 toks/s, output: 54.93 toks/s]
Processed prompts:  50%|█████     | 1026/2048 [00:18<00:16, 60.81it/s, est. speed input: 56328.85 toks/s, output: 55.01 toks/s]
Processed prompts:  51%|█████     | 1042/2048 [00:18<00:16, 60.71it/s, est. speed input: 56407.38 toks/s, output: 55.09 toks/s]
Processed prompts:  52%|█████▏    | 1058/2048 [00:19<00:16, 60.62it/s, est. speed input: 56483.13 toks/s, output: 55.16 toks/s]
Processed prompts:  52%|█████▏    | 1074/2048 [00:19<00:16, 60.59it/s, est. speed input: 56557.21 toks/s, output: 55.23 toks/s]
Processed prompts:  53%|█████▎    | 1090/2048 [00:19<00:15, 60.53it/s, est. speed input: 56628.39 toks/s, output: 55.30 toks/s]
Processed prompts:  54%|█████▍    | 1106/2048 [00:19<00:15, 60.52it/s, est. speed input: 56698.61 toks/s, output: 55.37 toks/s]
Processed prompts:  55%|█████▍    | 1122/2048 [00:20<00:15, 60.50it/s, est. speed input: 56766.80 toks/s, output: 55.44 toks/s]
Processed prompts:  56%|█████▌    | 1138/2048 [00:20<00:15, 60.46it/s, est. speed input: 56832.21 toks/s, output: 55.50 toks/s]
Processed prompts:  56%|█████▋    | 1154/2048 [00:20<00:14, 61.47it/s, est. speed input: 56936.55 toks/s, output: 55.60 toks/s]
Processed prompts:  57%|█████▋    | 1170/2048 [00:21<00:14, 61.16it/s, est. speed input: 56998.94 toks/s, output: 55.66 toks/s]
Processed prompts:  58%|█████▊    | 1186/2048 [00:21<00:14, 60.92it/s, est. speed input: 57058.98 toks/s, output: 55.72 toks/s]
Processed prompts:  59%|█████▊    | 1202/2048 [00:21<00:13, 60.76it/s, est. speed input: 57117.61 toks/s, output: 55.78 toks/s]
Processed prompts:  59%|█████▉    | 1218/2048 [00:21<00:13, 60.63it/s, est. speed input: 57174.60 toks/s, output: 55.83 toks/s]
Processed prompts:  60%|██████    | 1234/2048 [00:22<00:13, 60.57it/s, est. speed input: 57230.74 toks/s, output: 55.89 toks/s]
Processed prompts:  61%|██████    | 1250/2048 [00:22<00:13, 60.47it/s, est. speed input: 57283.73 toks/s, output: 55.94 toks/s]
Processed prompts:  62%|██████▏   | 1266/2048 [00:22<00:12, 60.43it/s, est. speed input: 57336.56 toks/s, output: 55.99 toks/s]
Processed prompts:  63%|██████▎   | 1282/2048 [00:22<00:12, 60.42it/s, est. speed input: 57388.82 toks/s, output: 56.04 toks/s]
Processed prompts:  63%|██████▎   | 1298/2048 [00:23<00:12, 60.41it/s, est. speed input: 57439.85 toks/s, output: 56.09 toks/s]
Processed prompts:  64%|██████▍   | 1314/2048 [00:23<00:12, 60.40it/s, est. speed input: 57489.53 toks/s, output: 56.14 toks/s]
Processed prompts:  65%|██████▍   | 1330/2048 [00:23<00:11, 60.40it/s, est. speed input: 57538.27 toks/s, output: 56.19 toks/s]
Processed prompts:  66%|██████▌   | 1346/2048 [00:23<00:11, 60.40it/s, est. speed input: 57586.11 toks/s, output: 56.24 toks/s]
Processed prompts:  67%|██████▋   | 1362/2048 [00:24<00:11, 60.39it/s, est. speed input: 57632.38 toks/s, output: 56.28 toks/s]
Processed prompts:  67%|██████▋   | 1378/2048 [00:24<00:11, 60.38it/s, est. speed input: 57677.69 toks/s, output: 56.33 toks/s]
Processed prompts:  68%|██████▊   | 1394/2048 [00:24<00:10, 60.38it/s, est. speed input: 57722.05 toks/s, output: 56.37 toks/s]
Processed prompts:  69%|██████▉   | 1410/2048 [00:25<00:22, 28.63it/s, est. speed input: 55587.55 toks/s, output: 54.28 toks/s]
Processed prompts:  70%|██████▉   | 1426/2048 [00:26<00:18, 34.00it/s, est. speed input: 55650.68 toks/s, output: 54.35 toks/s]
Processed prompts:  70%|███████   | 1442/2048 [00:26<00:15, 39.12it/s, est. speed input: 55712.30 toks/s, output: 54.41 toks/s]
Processed prompts:  71%|███████   | 1458/2048 [00:26<00:13, 43.77it/s, est. speed input: 55774.44 toks/s, output: 54.47 toks/s]
Processed prompts:  72%|███████▏  | 1474/2048 [00:27<00:12, 47.67it/s, est. speed input: 55831.78 toks/s, output: 54.52 toks/s]
Processed prompts:  73%|███████▎  | 1490/2048 [00:27<00:10, 50.87it/s, est. speed input: 55889.40 toks/s, output: 54.58 toks/s]
Processed prompts:  74%|███████▎  | 1506/2048 [00:27<00:10, 53.38it/s, est. speed input: 55946.14 toks/s, output: 54.63 toks/s]
Processed prompts:  74%|███████▍  | 1522/2048 [00:27<00:09, 55.31it/s, est. speed input: 56002.23 toks/s, output: 54.69 toks/s]
Processed prompts:  75%|███████▌  | 1538/2048 [00:28<00:08, 56.73it/s, est. speed input: 56057.04 toks/s, output: 54.74 toks/s]
Processed prompts:  76%|███████▌  | 1554/2048 [00:28<00:08, 57.78it/s, est. speed input: 56110.97 toks/s, output: 54.80 toks/s]
Processed prompts:  77%|███████▋  | 1570/2048 [00:28<00:08, 58.53it/s, est. speed input: 56163.66 toks/s, output: 54.85 toks/s]
Processed prompts:  77%|███████▋  | 1586/2048 [00:28<00:07, 59.04it/s, est. speed input: 56214.76 toks/s, output: 54.90 toks/s]
Processed prompts:  78%|███████▊  | 1602/2048 [00:29<00:07, 59.41it/s, est. speed input: 56264.85 toks/s, output: 54.95 toks/s]
Processed prompts:  79%|███████▉  | 1618/2048 [00:29<00:07, 59.65it/s, est. speed input: 56313.76 toks/s, output: 54.99 toks/s]
Processed prompts:  80%|███████▉  | 1634/2048 [00:29<00:06, 59.83it/s, est. speed input: 56361.79 toks/s, output: 55.04 toks/s]
Processed prompts:  81%|████████  | 1650/2048 [00:29<00:06, 59.97it/s, est. speed input: 56409.67 toks/s, output: 55.09 toks/s]
Processed prompts:  81%|████████▏ | 1666/2048 [00:30<00:06, 59.89it/s, est. speed input: 56451.43 toks/s, output: 55.13 toks/s]
Processed prompts:  82%|████████▏ | 1682/2048 [00:30<00:06, 59.59it/s, est. speed input: 56485.94 toks/s, output: 55.16 toks/s]
Processed prompts:  83%|████████▎ | 1698/2048 [00:30<00:05, 59.83it/s, est. speed input: 56532.03 toks/s, output: 55.21 toks/s]
Processed prompts:  84%|████████▎ | 1714/2048 [00:31<00:05, 59.94it/s, est. speed input: 56575.90 toks/s, output: 55.25 toks/s]
Processed prompts:  84%|████████▍ | 1730/2048 [00:31<00:05, 60.08it/s, est. speed input: 56620.60 toks/s, output: 55.29 toks/s]
Processed prompts:  85%|████████▌ | 1746/2048 [00:31<00:05, 60.18it/s, est. speed input: 56664.50 toks/s, output: 55.34 toks/s]
Processed prompts:  86%|████████▌ | 1762/2048 [00:31<00:04, 60.25it/s, est. speed input: 56707.78 toks/s, output: 55.38 toks/s]
Processed prompts:  87%|████████▋ | 1778/2048 [00:32<00:04, 60.30it/s, est. speed input: 56750.39 toks/s, output: 55.42 toks/s]
Processed prompts:  88%|████████▊ | 1794/2048 [00:32<00:04, 60.31it/s, est. speed input: 56791.67 toks/s, output: 55.46 toks/s]
Processed prompts:  88%|████████▊ | 1810/2048 [00:32<00:03, 60.31it/s, est. speed input: 56832.08 toks/s, output: 55.50 toks/s]
Processed prompts:  89%|████████▉ | 1826/2048 [00:32<00:03, 60.33it/s, est. speed input: 56872.34 toks/s, output: 55.54 toks/s]
Processed prompts:  90%|████████▉ | 1842/2048 [00:33<00:03, 60.33it/s, est. speed input: 56911.68 toks/s, output: 55.58 toks/s]
Processed prompts:  91%|█████████ | 1858/2048 [00:33<00:03, 60.34it/s, est. speed input: 56950.50 toks/s, output: 55.62 toks/s]
Processed prompts:  92%|█████████▏| 1874/2048 [00:33<00:02, 61.35it/s, est. speed input: 57013.24 toks/s, output: 55.68 toks/s]
Processed prompts:  92%|█████████▏| 1890/2048 [00:33<00:02, 61.09it/s, est. speed input: 57051.69 toks/s, output: 55.71 toks/s]
Processed prompts:  93%|█████████▎| 1906/2048 [00:34<00:02, 60.83it/s, est. speed input: 57087.68 toks/s, output: 55.75 toks/s]
Processed prompts:  94%|█████████▍| 1922/2048 [00:34<00:02, 60.68it/s, est. speed input: 57123.67 toks/s, output: 55.78 toks/s]
Processed prompts:  95%|█████████▍| 1938/2048 [00:34<00:01, 60.58it/s, est. speed input: 57159.45 toks/s, output: 55.82 toks/s]
Processed prompts:  95%|█████████▌| 1954/2048 [00:34<00:01, 60.51it/s, est. speed input: 57194.54 toks/s, output: 55.85 toks/s]
Processed prompts:  96%|█████████▌| 1970/2048 [00:35<00:01, 60.46it/s, est. speed input: 57229.13 toks/s, output: 55.89 toks/s]
Processed prompts:  97%|█████████▋| 1986/2048 [00:35<00:01, 60.42it/s, est. speed input: 57263.14 toks/s, output: 55.92 toks/s]
Processed prompts:  98%|█████████▊| 2002/2048 [00:35<00:00, 60.39it/s, est. speed input: 57296.54 toks/s, output: 55.95 toks/s]
Processed prompts:  99%|█████████▊| 2018/2048 [00:36<00:00, 60.38it/s, est. speed input: 57329.76 toks/s, output: 55.99 toks/s]
Processed prompts:  99%|█████████▉| 2034/2048 [00:36<00:00, 61.51it/s, est. speed input: 57388.19 toks/s, output: 56.04 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:36<00:00, 61.51it/s, est. speed input: 57782.63 toks/s, output: 56.43 toks/s]
Processed prompts: 100%|██████████| 2048/2048 [00:36<00:00, 56.43it/s, est. speed input: 57782.63 toks/s, output: 56.43 toks/s]
[rank0]:[W128 10:40:54.133247101 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
