{
    // Dev Container æ˜¾ç¤ºåç§°
    "name": "Slidesparse vllm benchmark",

    // ä½¿ç”¨æœ¬åœ°æ„å»ºçš„å¼€å‘é•œåƒ
    "image": "bcacdwk/vllmbench:universal",

    // [é‡è¦] è‡ªåŠ¨æ£€æµ‹é•œåƒæ›´æ–°ï¼Œåˆ é™¤ä½¿ç”¨æ—§é•œåƒçš„å®¹å™¨
    // åŸç†ï¼šæ¯”è¾ƒç°æœ‰å®¹å™¨çš„é•œåƒIDä¸æœ€æ–°é•œåƒIDï¼Œä¸åŒ¹é…åˆ™åˆ é™¤æ—§å®¹å™¨
    "initializeCommand": "bash -c 'LATEST=$(docker images -q bcacdwk/vllmbench:universal 2>/dev/null); for CID in $(docker ps -aq --filter label=devcontainer.local_folder=$(pwd)); do CIMG=$(docker inspect $CID --format \"{{.Image}}\" 2>/dev/null); if [[ \"$CIMG\" != *\"$LATEST\"* ]] && [ -n \"$LATEST\" ]; then echo \"ğŸ”„ æ£€æµ‹åˆ°é•œåƒæ›´æ–°ï¼Œåˆ é™¤æ—§å®¹å™¨ $CID...\"; docker rm -f $CID 2>/dev/null || true; fi; done; echo \"âœ… é•œåƒæ£€æŸ¥å®Œæˆ\"'",

    // å®¹å™¨ä¸­çš„é»˜è®¤ç”¨æˆ·ï¼Œä½¿ç”¨ root ä¾¿äºå®‰è£…ç³»ç»Ÿä¾èµ–
    "remoteUser": "root",
    // å®¹å™¨å†…çš„å·¥ä½œç›®å½•ï¼Œå¯¹åº”æœ¬åœ°ä»“åº“æŒ‚è½½ä½ç½®
    "workspaceFolder": "/root/vllmbench",
    
    // [å…³é”®é…ç½®] å¢å¼ºè¿è¡Œå‚æ•°
    "runArgs": [
        // ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œæ ˆï¼šè§£å†³ K8s/å†…ç½‘ DNS è§£æå¤±è´¥ã€Copilot è¶…æ—¶ç­‰é—®é¢˜
        "--network=host",
        
        // --- GPU å’Œç³»ç»Ÿæƒé™é…ç½® ---
        "--gpus=all",
        "--privileged",
        "--cap-add=SYS_ADMIN",
        "--cap-add=SYS_PTRACE",
        "--security-opt=seccomp=unconfined",
        "--security-opt=apparmor=unconfined",
        "--ipc=host",
        "--ulimit=memlock=-1:-1",
        "--ulimit=stack=67108864",
        "--ulimit=nofile=1048576:1048576",
        "--volume=/usr/lib/modules:/usr/lib/modules:ro",
        "--volume=/lib/modules:/lib/modules:ro"
    ],

    "containerEnv": {
        "NVIDIA_VISIBLE_DEVICES": "all",
        "NVIDIA_DRIVER_CAPABILITIES": "compute,utility"
    },

    // å°†æœ¬åœ°ä»“åº“ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œä¿æŒä»£ç åŒæ­¥
    "mounts": [
        {
            "type": "bind",
            "source": "${localWorkspaceFolder}",
            "target": "/root/vllmbench"
        }
    ],

    "customizations": {
        "vscode": {
            "settings": {
                "python.defaultInterpreterPath": "/usr/bin/python3",
                "python.analysis.typeCheckingMode": "basic"
            },
            "extensions": [
                "ms-python.python",
                "ms-python.debugpy",
                "ms-toolsai.jupyter",
                "ms-azuretools.vscode-docker",
                "GitHub.copilot"
            ]
        }
    },
    
    // å®¹å™¨é¦–æ¬¡åˆ›å»ºåæ‰§è¡Œï¼šå¯ç¼–è¾‘å®‰è£… vLLM æºç  + å®‰è£…é¢å¤–ä¾èµ–
    // uv pip install -e . ä¼šåˆ›å»ºè½¯é“¾æ¥ï¼Œä¿®æ”¹ Python/Triton ä»£ç åç«‹å³ç”Ÿæ•ˆ
    // ç¯å¢ƒå˜é‡ VLLM_USE_PRECOMPILED / VLLM_PRECOMPILED_WHEEL_* å·²åœ¨ Dockerfile ä¸­è®¾ç½®
    "postCreateCommand": "uv pip install --system --editable . && uv pip install --system -r requirements.txt && echo '=== éªŒè¯ vLLM å®‰è£… ===' && python3 -c \"import vllm; print('âœ… vllm:', vllm.__file__)\" && python3 -c \"import vllm._C; print('âœ… vllm._C:', vllm._C.__file__)\"",
    // å®¹å™¨å¯åŠ¨åæ‰§è¡Œï¼šå¯ç”¨ GPU æŒä¹…åŒ–æ¨¡å¼å¹¶æ‰“å°çŠ¶æ€
    "postStartCommand": "bash -lc 'nvidia-smi -pm 1 2>/dev/null || true; nvidia-smi'",
    // é˜»æ­¢ Dev Container é‡å†™å…¥å£å‘½ä»¤
    "overrideCommand": true
}
